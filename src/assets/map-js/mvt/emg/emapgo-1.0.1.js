!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.emapgo=e()}(this,function(){"use strict";var r,o,a;function t(t,e){if(r)if(o){var n="var sharedChunk = {}; ("+r+")(sharedChunk); ("+o+")(sharedChunk);",i={};r(i),(a=e(i)).workerUrl=window.URL.createObjectURL(new Blob([n],{type:"text/javascript"}))}else o=e;else r=e}return t(0,function(t){var z="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}function h(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}var I=n(function(t){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;function n(){}n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),x=n(function(t,p){var l=/%[sdj%]/g;p.format=function(t){var e=arguments;if(!x(t)){for(var n=[],i=0;i<arguments.length;i++)n.push(u(e[i]));return n.join(" ")}i=1;for(var r=arguments,o=r.length,a=String(t).replace(l,function(t){if("%%"===t)return"%";if(o<=i)return t;switch(t){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(t){return"[Circular]"}default:return t}}),s=r[i];i<o;s=r[++i])v(s)||!c(s)?a+=" "+s:a+=" "+u(s);return a},p.deprecate=function(t,e){if(b(z.process))return function(){return p.deprecate(t,e).apply(this,arguments)};if(!0===process.noDeprecation)return t;var n=!1;return function(){if(!n){if(process.throwDeprecation)throw new Error(e);process.traceDeprecation?console.trace(e):console.error(e),n=!0}return t.apply(this,arguments)}};var i,r={};function u(t,e){var n={seen:[],stylize:a};return 3<=arguments.length&&(n.depth=arguments[2]),4<=arguments.length&&(n.colors=arguments[3]),g(e)?n.showHidden=e:e&&p._extend(n,e),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),f(n,t,n.depth)}function o(t,e){var n=u.styles[e];return n?"["+u.colors[n][0]+"m"+t+"["+u.colors[n][1]+"m":t}function a(t,e){return t}function f(e,n,i){if(e.customInspect&&n&&T(n.inspect)&&n.inspect!==p.inspect&&(!n.constructor||n.constructor.prototype!==n)){var t=n.inspect(i,e);return x(t)||(t=f(e,t,i)),t}var r=function(t,e){if(b(e))return t.stylize("undefined","undefined");if(x(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(_(e))return t.stylize(""+e,"number");if(g(e))return t.stylize(""+e,"boolean");if(v(e))return t.stylize("null","null")}(e,n);if(r)return r;var o=Object.keys(n),a=function(t){var n={};return t.forEach(function(t,e){n[t]=!0}),n}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),S(n)&&(0<=o.indexOf("message")||0<=o.indexOf("description")))return d(n);if(0===o.length){if(T(n)){var s=n.name?": "+n.name:"";return e.stylize("[Function"+s+"]","special")}if(w(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return e.stylize(Date.prototype.toString.call(n),"date");if(S(n))return d(n)}var l,u="",c=!1,h=["{","}"];y(n)&&(c=!0,h=["[","]"]),T(n)&&(u=" [Function"+(n.name?": "+n.name:"")+"]");return w(n)&&(u=" "+RegExp.prototype.toString.call(n)),E(n)&&(u=" "+Date.prototype.toUTCString.call(n)),S(n)&&(u=" "+d(n)),0!==o.length||c&&0!=n.length?i<0?w(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),l=c?function(e,n,i,r,t){for(var o=[],a=0,s=n.length;a<s;++a)A(n,String(a))?o.push(m(e,n,i,r,String(a),!0)):o.push("");return t.forEach(function(t){t.match(/^\d+$/)||o.push(m(e,n,i,r,t,!0))}),o}(e,n,i,a,o):o.map(function(t){return m(e,n,i,a,t,c)}),e.seen.pop(),function(t,e,n){if(60<t.reduce(function(t,e){return 0,0<=e.indexOf("\n")&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(l,u,h)):h[0]+u+h[1]}function d(t){return"["+Error.prototype.toString.call(t)+"]"}function m(t,e,n,i,r,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?s=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(s=t.stylize("[Setter]","special")),A(i,r)||(a="["+r+"]"),s||(t.seen.indexOf(l.value)<0?-1<(s=v(n)?f(t,l.value,null):f(t,l.value,n-1)).indexOf("\n")&&(s=o?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")):s=t.stylize("[Circular]","special")),b(a)){if(o&&r.match(/^\d+$/))return s;a=(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(a,"string"))}return a+": "+s}function y(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function v(t){return null===t}function _(t){return"number"==typeof t}function x(t){return"string"==typeof t}function b(t){return void 0===t}function w(t){return c(t)&&"[object RegExp]"===e(t)}function c(t){return"object"==typeof t&&null!==t}function E(t){return c(t)&&"[object Date]"===e(t)}function S(t){return c(t)&&("[object Error]"===e(t)||t instanceof Error)}function T(t){return"function"==typeof t}function e(t){return Object.prototype.toString.call(t)}function n(t){return t<10?"0"+t.toString(10):t.toString(10)}p.debuglog=function(e){if(b(i)&&(i=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!r[e])if(new RegExp("\\b"+e+"\\b","i").test(i)){var n=process.pid;r[e]=function(){var t=p.format.apply(p,arguments);console.error("%s %d: %s",e,n,t)}}else r[e]=function(){};return r[e]},(p.inspect=u).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},p.isArray=y,p.isBoolean=g,p.isNull=v,p.isNullOrUndefined=function(t){return null==t},p.isNumber=_,p.isString=x,p.isSymbol=function(t){return"symbol"==typeof t},p.isUndefined=b,p.isRegExp=w,p.isObject=c,p.isDate=E,p.isError=S,p.isFunction=T,p.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},p.isBuffer=h;var s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}p.log=function(){console.log("%s - %s",function(){var t=new Date,e=[n(t.getHours()),n(t.getMinutes()),n(t.getSeconds())].join(":");return[t.getDate(),s[t.getMonth()],e].join(" ")}(),p.format.apply(p,arguments))},p.inherits=I,p._extend=function(t,e){if(!e||!c(e))return t;for(var n=Object.keys(e),i=n.length;i--;)t[n[i]]=e[n[i]];return t}}),L=(x.format,x.deprecate,x.debuglog,x.inspect,x.isArray,x.isBoolean,x.isNull,x.isNullOrUndefined,x.isNumber,x.isString,x.isSymbol,x.isUndefined,x.isRegExp,x.isObject,x.isDate,x.isError,x.isFunction,x.isPrimitive,x.isBuffer,x.log,x.inherits,x._extend,n(function(t){function o(t,e){if(t===e)return 0;for(var n=t.length,i=e.length,r=0,o=Math.min(n,i);r<o;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:i<n?1:0}function a(t){return z.Buffer&&"function"==typeof z.Buffer.isBuffer?z.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var i=Object.prototype.hasOwnProperty,c=Array.prototype.slice,n="foo"===function(){}.name;function s(t){return Object.prototype.toString.call(t)}function l(t){return!a(t)&&("function"==typeof z.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var u=t.exports=e,r=/\s*function\s+([^\(\s]*)\s*/;function h(t){if(x.isFunction(t)){if(n)return t.name;var e=t.toString().match(r);return e&&e[1]}}function p(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function f(t){if(n||!x.isFunction(t))return x.inspect(t);var e=h(t);return"[Function"+(e?": "+e:"")+"]"}function d(t,e,n,i,r){throw new u.AssertionError({message:n,actual:t,expected:e,operator:i,stackStartFunction:r})}function e(t,e){t||d(t,!0,e,"==",u.ok)}function m(t,e,n,i){if(t===e)return!0;if(a(t)&&a(e))return 0===o(t,e);if(x.isDate(t)&&x.isDate(e))return t.getTime()===e.getTime();if(x.isRegExp(t)&&x.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(l(t)&&l(e)&&s(t)===s(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===o(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(a(t)!==a(e))return!1;var r=(i=i||{actual:[],expected:[]}).actual.indexOf(t);return-1!==r&&r===i.expected.indexOf(e)||(i.actual.push(t),i.expected.push(e),function(t,e,n,i){if(null==t||null==e)return!1;if(x.isPrimitive(t)||x.isPrimitive(e))return t===e;if(n&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var r=y(t),o=y(e);if(r&&!o||!r&&o)return!1;if(r)return t=c.call(t),e=c.call(e),m(t,e,n);var a,s,l=_(t),u=_(e);if(l.length!==u.length)return!1;for(l.sort(),u.sort(),s=l.length-1;0<=s;s--)if(l[s]!==u[s])return!1;for(s=l.length-1;0<=s;s--)if(a=l[s],!m(t[a],e[a],n,i))return!1;return!0}(t,e,n,i))}return n?t===e:t==e}function y(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function g(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function v(t,e,n,i){var r;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(i=n,n=null),r=function(t){var e;try{t()}catch(t){e=t}return e}(e),i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:"."),t&&!r&&d(r,n,"Missing expected exception"+i);var o="string"==typeof i,a=!t&&r&&!n;if((!t&&x.isError(r)&&o&&g(r,n)||a)&&d(r,n,"Got unwanted exception"+i),t&&r&&n&&!g(r,n)||!t&&r)throw r}u.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=function(t){return p(f(t.actual),128)+" "+t.operator+" "+p(f(t.expected),128)}(this),this.generatedMessage=!0);var e=t.stackStartFunction||d;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var n=new Error;if(n.stack){var i=n.stack,r=h(e),o=i.indexOf("\n"+r);if(0<=o){var a=i.indexOf("\n",o+1);i=i.substring(a+1)}this.stack=i}}},x.inherits(u.AssertionError,Error),u.fail=d,u.ok=e,u.equal=function(t,e,n){t!=e&&d(t,e,n,"==",u.equal)},u.notEqual=function(t,e,n){t==e&&d(t,e,n,"!=",u.notEqual)},u.deepEqual=function(t,e,n){m(t,e,!1)||d(t,e,n,"deepEqual",u.deepEqual)},u.deepStrictEqual=function(t,e,n){m(t,e,!0)||d(t,e,n,"deepStrictEqual",u.deepStrictEqual)},u.notDeepEqual=function(t,e,n){m(t,e,!1)&&d(t,e,n,"notDeepEqual",u.notDeepEqual)},u.notDeepStrictEqual=function t(e,n,i){m(e,n,!0)&&d(e,n,i,"notDeepStrictEqual",t)},u.strictEqual=function(t,e,n){t!==e&&d(t,e,n,"===",u.strictEqual)},u.notStrictEqual=function(t,e,n){t===e&&d(t,e,n,"!==",u.notStrictEqual)},u.throws=function(t,e,n){v(!0,t,e,n)},u.doesNotThrow=function(t,e,n){v(!1,t,e,n)},u.ifError=function(t){if(t)throw t};var _=Object.keys||function(t){var e=[];for(var n in t)i.call(t,n)&&e.push(n);return e}})),a=i;function i(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=i}i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var n,i,r,o,a;for(void 0===e&&(e=1e-6),r=t,a=0;a<8;a++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s}if((r=t)<(n=0))return n;if((i=1)<r)return i;for(;n<i;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;o<t?n=r:i=r,r=.5*(i-n)+n}return r},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};function c(t,e,n){this.column=t,this.row=e,this.zoom=n}c.prototype.clone=function(){return new c(this.column,this.row,this.zoom)},c.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},c.prototype.sub=function(t){return this.clone()._sub(t)},c.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},c.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this};var m=r;function r(t,e){this.x=t,this.y=e}function o(t,e,n,i){var r=new a(t,e,n,i);return function(t){return r.solve(t)}}r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=i,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.x+n*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=r,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t};var s=o(.25,.1,.25,1);function g(t,e,n){return Math.min(n,Math.max(e,t))}function l(t){for(var e=[],n=arguments.length-1;0<n--;)e[n]=arguments[n+1];for(var i=0,r=e;i<r.length;i+=1){var o=r[i];for(var a in o)t[a]=o[a]}return t}var u=1;function p(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})}function f(t,e){return-1!==t.indexOf(e,t.length-e.length)}function d(t,e,n){var i={};for(var r in t)i[r]=e.call(n||this,t[r],r,t);return i}function y(t,e,n){var i={};for(var r in t)e.call(n||this,t[r],r,t)&&(i[r]=t[r]);return i}function v(t){return Array.isArray(t)?t.map(v):"object"==typeof t&&t?d(t,v):t}var _={};function b(t){_[t]||("undefined"!=typeof console&&console.warn(t),_[t]=!0)}function w(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function E(t){for(var e=0,n=0,i=t.length,r=i-1,o=void 0,a=void 0;n<i;r=n++)o=t[n],e+=((a=t[r]).x-o.x)*(o.y+a.y);return e}var S={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(S);var T,A=((T=Error)&&(k.__proto__=T),((k.prototype=Object.create(T&&T.prototype)).constructor=k).prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},k);function k(t,e,n){T.call(this,t),this.status=e,this.url=n,this.name=this.constructor.name,this.message=t}function M(t){var e=new self.XMLHttpRequest;for(var n in e.open("GET",t.url,!0),t.headers)e.setRequestHeader(n,t.headers[n]);return e.withCredentials="include"===t.credentials,e}function C(e,n){var i=M(e);return i.responseType="arraybuffer",i.onerror=function(){n(new Error(i.statusText))},i.onload=function(){var t=i.response;if(0===t.byteLength&&200===i.status)return n(new Error("http status 200 returned without content."));200<=i.status&&i.status<300&&i.response?n(null,{data:t,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):n(new A(i.statusText,i.status,e.url))},i.send(),i}function P(t,e,n){n[t]=n[t]||[],n[t].push(e)}function D(t,e,n){if(n&&n[t]){var i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}function R(t,e){void 0===e&&(e={}),l(this,e),this.type=t}var B,O=((B=R)&&(F.__proto__=B),(F.prototype=Object.create(B&&B.prototype)).constructor=F);function F(t,e){void 0===e&&(e={}),B.call(this,"error",l({error:t},e))}function V(){}V.prototype.on=function(t,e){return this._listeners=this._listeners||{},P(t,e,this._listeners),this},V.prototype.off=function(t,e){return D(t,e,this._listeners),D(t,e,this._oneTimeListeners),this},V.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},P(t,e,this._oneTimeListeners),this},V.prototype.fire=function(t){var e=t.type;if(this.listens(e)){for(var n=0,i=(t.target=this)._listeners&&this._listeners[e]?this._listeners[e].slice():[];n<i.length;n+=1){i[n].call(this,t)}for(var r=0,o=this._oneTimeListeners&&this._oneTimeListeners[e]?this._oneTimeListeners[e].slice():[];r<o.length;r+=1){var a=o[r];D(e,a,this._oneTimeListeners),a.call(this,t)}var s=this._eventedParent;s&&(l(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),s.fire(t))}else f(e,"error")?console.error(t&&t.error||t||"Empty error event"):f(e,"warning")&&console.warn(t&&t.warning||t||"Empty warning event");return this},V.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&0<this._listeners[t].length||this._oneTimeListeners&&this._oneTimeListeners[t]&&0<this._oneTimeListeners[t].length||this._eventedParent&&this._eventedParent.listens(t)};V.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var N={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},emapgo:{}},default:"emapgo"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!(V.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this})},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},lineMetrics:{type:"boolean",default:!1}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{butt:{},round:{},square:{}},default:"butt"},"line-join":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{bevel:{},round:{},miter:{}},default:"miter"},"line-miter-limit":{type:"number",default:2,function:"interpolated","zoom-function":!0,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated","zoom-function":!0,requires:[{"line-join":"round"}]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{point:{},line:{}},default:"point"},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated","zoom-function":!0,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,units:"factor of the original icon size",requires:["icon-image"]},"icon-text-fit":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",function:"interpolated","zoom-function":!0,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,tokens:!0},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,"property-function":!0,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated","zoom-function":!0,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image"]},"icon-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"]},"icon-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"text-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:"",tokens:!0},"text-font":{type:"array",value:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{left:{},center:{},right:{}},default:"center",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field","icon-image"]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Heatmap"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},transition:!1,"zoom-function":!0,"property-function":!1,function:"piecewise-constant"},position:{type:"array",default:[1.15,210,30],length:3,value:"number",transition:!0,function:"interpolated","zoom-function":!0,"property-function":!1},color:{type:"color",default:"#ffffff",function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},intensity:{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0},"fill-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"fill-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},paint_line:{"line-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-gap-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-offset":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant","zoom-function":!0,minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"line-gradient":{type:"color",function:"interpolated","zoom-function":!1,"property-function":!1,transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}]}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-blur":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"circle-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map"},"circle-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"viewport"},"circle-stroke-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-stroke-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"heatmap-weight":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!1},"heatmap-intensity":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],function:"interpolated","zoom-function":!1,"property-function":!1,transition:!1},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,transition:!0,units:"degrees"},"raster-brightness-min":{type:"number",function:"interpolated","zoom-function":!0,default:0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number",function:"interpolated","zoom-function":!0,default:1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated","zoom-function":!0,transition:!1,units:"milliseconds"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,function:"interpolated","zoom-function":!0,transition:!1},"hillshade-illumination-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"viewport"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"hillshade-shadow-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",function:"interpolated","zoom-function":!0,transition:!0},"hillshade-accent-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0}},paint_background:{"background-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!1,default:1,minimum:0,maximum:1,transition:!0},"fill-extrusion-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-extrusion-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"fill-extrusion-height":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0},"fill-extrusion-base":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"]}}},j=function(t,e,n,i){this.message=(t?t+": ":"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)};function G(t){var e=t.key,n=t.value;return n?[new j(e,n,"constants have been deprecated as of v8")]:[]}function U(t){for(var e=[],n=arguments.length-1;0<n--;)e[n]=arguments[n+1];for(var i=0,r=e;i<r.length;i+=1){var o=r[i];for(var a in o)t[a]=o[a]}return t}function W(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function $(t){return Array.isArray(t)?t.map($):W(t)}var q,Z=((q=Error)&&(X.__proto__=q),(X.prototype=Object.create(q&&q.prototype)).constructor=X);function X(t,e){q.call(this,e),this.message=e,this.key=t}function H(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,i=e;n<i.length;n+=1){var r=i[n],o=r[0],a=r[1];this.bindings[o]=a}}H.prototype.concat=function(t){return new H(this,t)},H.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},H.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var K={kind:"null"},Y={kind:"number"},J={kind:"string"},Q={kind:"boolean"},tt={kind:"color"},et={kind:"object"},nt={kind:"value"},it={kind:"collator"};function rt(t,e){return{kind:"array",itemType:t,N:e}}function ot(t){if("array"!==t.kind)return t.kind;var e=ot(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}var at=[K,Y,J,Q,tt,et,rt(nt)];function st(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&!st(t.itemType,e.itemType)&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,i=at;n<i.length;n+=1){if(!st(i[n],e))return null}}return"Expected "+ot(t)+" but found "+ot(e)+" instead."}var lt=n(function(t,e){var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(t){return(t=Math.round(t))<0?0:255<t?255:t}function n(t){return t<0?0:1<t?1:t}function m(t){return"%"===t[t.length-1]?d(parseFloat(t)/100*255):d(parseInt(t))}function y(t){return"%"===t[t.length-1]?n(parseFloat(t)/100):n(parseFloat(t))}function g(t,e,n){return n<0?n+=1:1<n&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in f)return f[n].slice();if("#"===n[0])return 4===n.length?0<=(e=parseInt(n.substr(1),16))&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&0<=(e=parseInt(n.substr(1),16))&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),r=n.indexOf(")");if(-1!==i&&r+1===n.length){var o=n.substr(0,i),a=n.substr(i+1,r-(i+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=y(a.pop());case"rgb":return 3!==a.length?null:[m(a[0]),m(a[1]),m(a[2]),s];case"hsla":if(4!==a.length)return null;s=y(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,u=y(a[1]),c=y(a[2]),h=c<=.5?c*(u+1):c+u-c*u,p=2*c-h;return[d(255*g(p,h,l+1/3)),d(255*g(p,h,l)),d(255*g(p,h,l-1/3)),s];default:return null}}return null}}catch(t){}}).parseCSSColor,ut=function(t,e,n,i){void 0===i&&(i=1),this.r=t,this.g=e,this.b=n,this.a=i};ut.parse=function(t){if(t){if(t instanceof ut)return t;if("string"==typeof t){var e=lt(t);if(e)return new ut(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},ut.prototype.toString=function(){var t=this.toArray(),e=t[0],n=t[1],i=t[2],r=t[3];return"rgba("+Math.round(e)+","+Math.round(n)+","+Math.round(i)+","+r+")"},ut.prototype.toArray=function(){var t=this.r,e=this.g,n=this.b,i=this.a;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*n/i,i]},ut.black=new ut(0,0,0,1),ut.white=new ut(1,1,1,1),ut.transparent=new ut(0,0,0,0);var ct=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ct.prototype.compare=function(t,e){return this.collator.compare(t,e)},ct.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale},ct.prototype.serialize=function(){var t={};return t.caseSensitive="variant"===this.sensitivity||"case"===this.sensitivity,t.diacriticSensitive="variant"===this.sensitivity||"accent"===this.sensitivity,this.locale&&(t.locale=this.locale),["collator",t]};function ht(t,e,n){this.type=it,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}function pt(t,e,n,i){return"number"==typeof t&&0<=t&&t<=255&&"number"==typeof e&&0<=e&&e<=255&&"number"==typeof n&&0<=n&&n<=255?void 0===i||"number"==typeof i&&0<=i&&i<=1?null:"Invalid rgba value ["+[t,e,n,i].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ft(t){if(null===t)return K;if("string"==typeof t)return J;if("boolean"==typeof t)return Q;if("number"==typeof t)return Y;if(t instanceof ut)return tt;if(t instanceof ct)return it;if(Array.isArray(t)){for(var e,n=t.length,i=0,r=t;i<r.length;i+=1){var o=ft(r[i]);if(e){if(e===o)continue;e=nt;break}e=o}return rt(e||nt,n)}return L("object"==typeof t),et}ht.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");var i=e.parse(void 0!==n.caseSensitive&&n.caseSensitive,1,Q);if(!i)return null;var r=e.parse(void 0!==n.diacriticSensitive&&n.diacriticSensitive,1,Q);if(!r)return null;var o=null;return n.locale&&!(o=e.parse(n.locale,1,J))?null:new ht(i,r,o)},ht.prototype.evaluate=function(t){return new ct(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},ht.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},ht.prototype.possibleOutputs=function(){return[void 0]},ht.prototype.serialize=function(){var t={};return t.caseSensitive=this.caseSensitive,t.diacriticSensitive=this.diacriticSensitive,this.locale&&(t.locale=this.locale),["collator",t]};var dt=function(t,e){this.type=t,this.value=e};dt.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof ut)return!0;if(e instanceof ct)return!0;if(Array.isArray(e)){for(var n=0,i=e;n<i.length;n+=1)if(!t(i[n]))return!1;return!0}if("object"!=typeof e)return!1;for(var r in e)if(!t(e[r]))return!1;return!0}(t[1]))return e.error("invalid value");var n=t[1],i=ft(n),r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new dt(i,n)},dt.prototype.evaluate=function(){return this.value},dt.prototype.eachChild=function(){},dt.prototype.possibleOutputs=function(){return[this.value]},dt.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ut?["rgba"].concat(this.value.toArray()):this.value instanceof ct?this.value.serialize():(L(null===this.value||"string"==typeof this.value||"number"==typeof this.value||"boolean"==typeof this.value),this.value)};function mt(t){this.name="ExpressionEvaluationError",this.message=t}mt.prototype.toJSON=function(){return this.message};var yt={string:J,number:Y,boolean:Q,object:et},gt=function(t,e){this.type=t,this.args=e};gt.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];L(yt[n],n);for(var i=yt[n],r=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,nt);if(!a)return null;r.push(a)}return new gt(i,r)},gt.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!st(this.type,ft(n)))return n;if(e===this.args.length-1)throw new mt("Expected value to be of type "+ot(this.type)+", but found "+ot(ft(n))+" instead.")}return L(!1),null},gt.prototype.eachChild=function(t){this.args.forEach(t)},gt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t},gt.prototype.serialize=function(){return[this.type.kind].concat(this.args.map(function(t){return t.serialize()}))};var vt={string:J,number:Y,boolean:Q},_t=function(t,e){this.type=t,this.input=e};_t.parse=function(t,e){if(t.length<2||4<t.length)return e.error("Expected 1, 2, or 3 arguments, but found "+(t.length-1)+" instead.");var n,i;if(2<t.length){var r=t[1];if("string"!=typeof r||!(r in vt))return e.error('The item type argument of "array" must be one of string, number, boolean',1);n=vt[r]}else n=nt;if(3<t.length){if("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2]))return e.error('The length argument to "array" must be a positive integer literal',2);i=t[2]}var o=rt(n,i),a=e.parse(t[t.length-1],t.length-1,nt);return a?new _t(o,a):null},_t.prototype.evaluate=function(t){var e=this.input.evaluate(t);if(st(this.type,ft(e)))throw new mt("Expected value to be of type "+ot(this.type)+", but found "+ot(ft(e))+" instead.");return e},_t.prototype.eachChild=function(t){t(this.input)},_t.prototype.possibleOutputs=function(){return this.input.possibleOutputs()},_t.prototype.serialize=function(){var t=["array"],e=this.type.itemType;if("string"===e.kind||"number"===e.kind||"boolean"===e.kind){t.push(e.kind);var n=this.type.N;"number"==typeof n&&t.push(n)}return t.push(this.input.serialize()),t};var xt={"to-number":Y,"to-color":tt},bt=function(t,e){this.type=t,this.args=e};bt.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];L(xt[n],n);for(var i=xt[n],r=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,nt);if(!a)return null;r.push(a)}return new bt(i,r)},bt.prototype.evaluate=function(t){if("color"===this.type.kind){for(var e,n,i=0,r=this.args;i<r.length;i+=1){if(n=null,"string"==typeof(e=r[i].evaluate(t))){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(n=e.length<3||4<e.length?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":pt(e[0],e[1],e[2],e[3])))return new ut(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new mt(n||"Could not parse color from value '"+("string"==typeof e?e:JSON.stringify(e))+"'")}for(var a=null,s=0,l=this.args;s<l.length;s+=1){if(null!==(a=l[s].evaluate(t))){var u=Number(a);if(!isNaN(u))return u}}throw new mt("Could not convert "+JSON.stringify(a)+" to number.")},bt.prototype.eachChild=function(t){this.args.forEach(t)},bt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t},bt.prototype.serialize=function(){var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};function wt(){this._parseColorCache={}}var Et=["Unknown","Point","LineString","Polygon"];wt.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},wt.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?Et[this.feature.type]:this.feature.type:null},wt.prototype.properties=function(){return this.feature&&this.feature.properties||{}},wt.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e=e||(this._parseColorCache[t]=ut.parse(t))};var St=function(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i};function Tt(t){if(t instanceof St){if("get"===t.name&&1===t.args.length)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild(function(t){e&&!Tt(t)&&(e=!1)}),e}function At(t,e){if(t instanceof St&&0<=e.indexOf(t.name))return!1;var n=!0;return t.eachChild(function(t){n&&!At(t,e)&&(n=!1)}),n}St.prototype.evaluate=function(t){return this._evaluate(t,this.args)},St.prototype.eachChild=function(t){this.args.forEach(t)},St.prototype.possibleOutputs=function(){return[void 0]},St.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},St.parse=function(n,t){var e=n[0],i=St.definitions[e];if(!i)return t.error('Unknown expression "'+e+'". If you wanted a literal array, use ["literal", [...]].',0);for(var r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=o.filter(function(t){var e=t[0];return!Array.isArray(e)||e.length===n.length-1}),s=[],l=1;l<n.length;l++){var u=n[l],c=void 0;if(1===a.length){var h=a[0][0];c=Array.isArray(h)?h[l-1]:h.type}var p=t.parse(u,1+s.length,c);if(!p)return null;s.push(p)}for(var f=null,d=0,m=a;d<m.length;d+=1){var y=m[d],g=y[0],v=y[1];if(f=new It(t.registry,t.path,null,t.scope),Array.isArray(g)&&g.length!==s.length)f.error("Expected "+g.length+" arguments, but found "+s.length+" instead.");else{for(var _=0;_<s.length;_++){var x=Array.isArray(g)?g[_]:g.type,b=s[_];f.concat(_+1).checkSubtype(x,b.type)}if(0===f.errors.length)return new St(e,r,v,s)}}if(L(!f||0<f.errors.length),1===a.length)t.errors.push.apply(t.errors,f.errors);else{var w=(a.length?a:o).map(function(t){return function(t){return Array.isArray(t)?"("+t.map(ot).join(", ")+")":"("+ot(t.type)+"...)"}(t[0])}).join(" | "),E=s.map(function(t){return ot(t.type)}).join(", ");t.error("Expected arguments of type "+w+", but found ("+E+") instead.")}return null},St.register=function(t,e){for(var n in L(!St.definitions),St.definitions=e)t[n]=St};var zt=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};zt.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new zt(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},zt.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},zt.prototype.eachChild=function(){},zt.prototype.possibleOutputs=function(){return[void 0]},zt.prototype.serialize=function(){return["var",this.name]};var It=function(t,e,n,i,r){void 0===e&&(e=[]),void 0===i&&(i=new H),void 0===r&&(r=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=i,this.errors=r,this.expectedType=n};function kt(t,e){for(var n,i,r=0,o=t.length-1,a=0;r<=o;){if(n=t[a=Math.floor((r+o)/2)],i=t[a+1],e===n||n<e&&e<i)return a;if(n<e)r=a+1;else{if(!(e<n))throw new mt("Input is not a number.");o=a-1}}return Math.max(a-1,0)}It.prototype.parse=function(t,e,n,i,r){return void 0===r&&(r={}),e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)},It.prototype._parse=function(t,e){if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var r=i.parse(t,this);if(!r)return null;if(this.expectedType){var o=this.expectedType,a=r.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind||"value"!==a.kind)if("array"===o.kind&&"value"===a.kind)e.omitTypeAnnotations||(r=new _t(o,r));else if("color"!==o.kind||"value"!==a.kind&&"string"!==a.kind){if(this.checkSubtype(this.expectedType,r.type))return null}else e.omitTypeAnnotations||(r=new bt(o,[r]));else e.omitTypeAnnotations||(r=new gt(o,[r]))}if(!(r instanceof dt)&&function e(t){{if(t instanceof zt)return e(t.boundExpression);if(t instanceof St&&"error"===t.name)return!1}var n=t instanceof bt||t instanceof gt||t instanceof _t;var i=!0;t.eachChild(function(t){i=n?i&&e(t):i&&t instanceof dt});if(!i)return!1;return Tt(t)&&At(t,["zoom","heatmap-density","line-progress"])}(r)){var s=new wt;try{r=new dt(r.type,r.evaluate(s))}catch(t){return this.error(t.message),null}}return r}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},It.prototype.concat=function(t,e,n){var i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new It(this.registry,i,e||null,r,this.errors)},It.prototype.error=function(t){for(var e=[],n=arguments.length-1;0<n--;)e[n]=arguments[n+1];var i=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new Z(i,t))},It.prototype.checkSubtype=function(t,e){var n=st(t,e);return n&&this.error(n),n};var Mt=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var i=0,r=n;i<r.length;i+=1){var o=r[i],a=o[0],s=o[1];this.labels.push(a),this.outputs.push(s)}};function Ct(t,e,n){return t*(1-n)+e*n}Mt.parse=function(t,e){var n=t[1],i=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(n=e.parse(n,1,Y)))return null;var r=[],o=null;e.expectedType&&"value"!==e.expectedType.kind&&(o=e.expectedType),i.unshift(-1/0);for(var a=0;a<i.length;a+=2){var s=i[a],l=i[a+1],u=a+1,c=a+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var h=e.parse(l,c,o);if(!h)return null;o=o||h.type,r.push([s,h])}return new Mt(o,n,r)},Mt.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);var r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[kt(e,i)].evaluate(t)},Mt.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1){t(n[e])}},Mt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t},Mt.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)0<e&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var Pt=Object.freeze({number:Ct,color:function(t,e,n){return new ut(Ct(t.r,e.r,n),Ct(t.g,e.g,n),Ct(t.b,e.b,n),Ct(t.a,e.a,n))},array:function(t,n,i){return t.map(function(t,e){return Ct(t,n[e],i)})}}),Lt=function(t,e,n,i){this.type=t,this.interpolation=e,this.input=n,this.labels=[],this.outputs=[];for(var r=0,o=i;r<o.length;r+=1){var a=o[r],s=a[0],l=a[1];this.labels.push(s),this.outputs.push(l)}};function Dt(t,e,n,i){var r=i-n,o=t-n;return 0==r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}Lt.interpolationFactor=function(t,e,n,i){var r=0;if("exponential"===t.name)r=Dt(e,t.base,n,i);else if("linear"===t.name)r=Dt(e,1,n,i);else if("cubic-bezier"===t.name){var o=t.controlPoints;r=new a(o[0],o[1],o[2],o[3]).solve(Dt(e,1,n,i))}return r},Lt.parse=function(t,e){var n=t[1],i=t[2],r=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var o=n[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:o}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var a=n.slice(1);if(4!==a.length||a.some(function(t){return"number"!=typeof t||t<0||1<t}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:a}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Y)))return null;var s=[],l=null;e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var u=0;u<r.length;u+=2){var c=r[u],h=r[u+1],p=u+3,f=u+4;if("number"!=typeof c)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(s.length&&s[s.length-1][0]>=c)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);var d=e.parse(h,f,l);if(!d)return null;l=l||d.type,s.push([c,d])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new Lt(l,n,i,s):e.error("Type "+ot(l)+" is not interpolatable.")},Lt.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);var r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);var o=kt(e,i),a=e[o],s=e[o+1],l=Lt.interpolationFactor(this.interpolation,i,a,s),u=n[o].evaluate(t),c=n[o+1].evaluate(t);return Pt[this.type.kind.toLowerCase()](u,c,l)},Lt.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1){t(n[e])}},Lt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t},Lt.prototype.serialize=function(){for(var t=["interpolate","linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints),this.input.serialize()],e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t};var Rt=function(t,e){this.type=t,this.args=e};Rt.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,i=e.expectedType;i&&"value"!==i.kind&&(n=i);for(var r=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=a[o],l=e.parse(s,1+r.length,n,void 0,{omitTypeAnnotations:!0});if(!l)return null;n=n||l.type,r.push(l)}L(n);var u=i&&r.some(function(t){return st(i,t.type)});return new Rt(u?nt:n,r)},Rt.prototype.evaluate=function(t){for(var e=null,n=0,i=this.args;n<i.length;n+=1){if(null!==(e=i[n].evaluate(t)))break}return e},Rt.prototype.eachChild=function(t){this.args.forEach(t)},Rt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t},Rt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Bt=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Bt.prototype.evaluate=function(t){return this.result.evaluate(t)},Bt.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1){t(n[e][1])}t(this.result)},Bt.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],i=1;i<t.length-1;i+=2){var r=t[i];if("string"!=typeof r)return e.error("Expected string, but found "+typeof r+" instead.",i);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);var o=e.parse(t[i+1],i+1);if(!o)return null;n.push([r,o])}var a=e.parse(t[t.length-1],t.length-1,void 0,n);return a?new Bt(n,a):null},Bt.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},Bt.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var i=n[e],r=i[0],o=i[1];t.push(r,o.serialize())}return t.push(this.result.serialize()),t};function Ot(t,e,n){this.type=t,this.index=e,this.input=n}Ot.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Y),i=e.parse(t[2],2,rt(e.expectedType||nt));if(!n||!i)return null;var r=i.type;return new Ot(r.itemType,n,i)},Ot.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new mt("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new mt("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new mt("Array index must be an integer, but found "+e+" instead.");return n[e]},Ot.prototype.eachChild=function(t){t(this.index),t(this.input)},Ot.prototype.possibleOutputs=function(){return[void 0]},Ot.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};function Ft(t,e,n,i,r,o){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}Ft.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var r={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],l=t[a+1];Array.isArray(s)||(s=[s]);var u=e.concat(a);if(0===s.length)return u.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return u.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return u.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return u.error("Numeric branch labels must be integer values.");if(n){if(u.checkSubtype(n,ft(p)))return null}else n=ft(p);if(void 0!==r[String(p)])return u.error("Branch labels must be unique.");r[String(p)]=o.length}var f=e.parse(l,a,i);if(!f)return null;i=i||f.type,o.push(f)}var d=e.parse(t[1],1,n);if(!d)return null;var m=e.parse(t[t.length-1],t.length-1,i);return m?(L(n&&i),new Ft(n,i,d,r,o,m)):null},Ft.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Ft.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Ft.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t},Ft.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],n=[],i={},r=0,o=Object.keys(this.cases).sort();r<o.length;r+=1){var a=o[r],s=i[e.cases[a]];void 0===s?(i[e.cases[a]]=n.length,n.push([e.cases[a],[a]])):n[s][1].push(a)}for(var l=function(t){return"number"===e.input.type.kind?Number(t):t},u=0,c=n;u<c.length;u+=1){var h=c[u],p=h[0],f=h[1];1===f.length?t.push(l(f[0])):t.push(f.map(l)),t.push(e.outputs[p].serialize())}return t.push(this.otherwise.serialize()),t};function Vt(t,e,n){this.type=t,this.branches=e,this.otherwise=n}function Nt(t){return"string"===t.kind||"number"===t.kind||"boolean"===t.kind||"null"===t.kind}function jt(t,n){return o.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=e.parse(t[1],1,nt);if(!n)return null;var i=e.parse(t[2],2,nt);if(!i)return null;if(!Nt(n.type)&&!Nt(i.type))return e.error("Expected at least one argument to be a string, number, boolean, or null, but found ("+ot(n.type)+", "+ot(i.type)+") instead.");if(n.type.kind!==i.type.kind&&"value"!==n.type.kind&&"value"!==i.type.kind)return e.error("Cannot compare "+ot(n.type)+" and "+ot(i.type)+".");var r=null;if(4===t.length){if("string"!==n.type.kind&&"string"!==i.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(r=e.parse(t[3],3,it)))return null}return new o(n,i,r)},o.prototype.evaluate=function(t){var e=this.collator?0===this.collator.evaluate(t).compare(this.lhs.evaluate(t),this.rhs.evaluate(t)):this.lhs.evaluate(t)===this.rhs.evaluate(t);return n?!e:e},o.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},o.prototype.possibleOutputs=function(){return[!0,!1]},o.prototype.serialize=function(){var e=[t];return this.eachChild(function(t){e.push(t.serialize())}),e},o;function o(t,e,n){this.type=Q,this.lhs=t,this.rhs=e,this.collator=n}}Vt.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i=[],r=1;r<t.length-1;r+=2){var o=e.parse(t[r],r,Q);if(!o)return null;var a=e.parse(t[r+1],r+1,n);if(!a)return null;i.push([o,a]),n=n||a.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?(L(n),new Vt(n,i,s)):null},Vt.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var i=n[e],r=i[0],o=i[1];if(r.evaluate(t))return o.evaluate(t)}return this.otherwise.evaluate(t)},Vt.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var i=n[e],r=i[0],o=i[1];t(r),t(o)}t(this.otherwise)},Vt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.branches.map(function(t){t[0];return t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t};function Gt(t){this.type=Y,this.input=t}var Ut=jt("==",!(Vt.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e})),Wt=jt("!=",!0);Gt.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+ot(n.type)+" instead."):new Gt(n):null},Gt.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new mt("Expected value to be of type string or array, but found "+ot(ft(e))+" instead.")},Gt.prototype.eachChild=function(t){t(this.input)},Gt.prototype.possibleOutputs=function(){return[void 0]},Gt.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var $t={"==":Ut,"!=":Wt,array:_t,at:Ot,boolean:gt,case:Vt,coalesce:Rt,collator:ht,interpolate:Lt,length:Gt,let:Bt,literal:dt,match:Ft,number:gt,object:gt,step:Mt,string:gt,"to-color":bt,"to-number":bt,var:zt};function qt(t,e){var n=e[0],i=e[1],r=e[2],o=e[3];n=n.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);var a=o?o.evaluate(t):1,s=pt(n,i,r,a);if(s)throw new mt(s);return new ut(n/255*a,i/255*a,r/255*a,a)}function Zt(t,e){return t in e}function Xt(t,e){var n=e[t];return void 0===n?null:n}function Ht(t,e){var n=e[0],i=e[1];return n.evaluate(t)<i.evaluate(t)}function Kt(t,e){var n=e[0],i=e[1];return n.evaluate(t)>i.evaluate(t)}function Yt(t,e){var n=e[0],i=e[1];return n.evaluate(t)<=i.evaluate(t)}function Jt(t,e){var n=e[0],i=e[1];return n.evaluate(t)>=i.evaluate(t)}function Qt(t){return{type:t}}function te(t){return{result:"success",value:t}}function ee(t){return{result:"error",value:t}}St.register($t,{error:[{kind:"error"},[J],function(t,e){var n=e[0];throw new mt(n.evaluate(t))}],typeof:[J,[nt],function(t,e){return ot(ft(e[0].evaluate(t)))}],"to-string":[J,[nt],function(t,e){var n=e[0],i=typeof(n=n.evaluate(t));return null===n||"string"==i||"number"==i||"boolean"==i?String(n):n instanceof ut?n.toString():JSON.stringify(n)}],"to-boolean":[Q,[nt],function(t,e){var n=e[0];return Boolean(n.evaluate(t))}],"to-rgba":[rt(Y,4),[tt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[tt,[Y,Y,Y],qt],rgba:[tt,[Y,Y,Y,Y],qt],has:{type:Q,overloads:[[[J],function(t,e){return Zt(e[0].evaluate(t),t.properties())}],[[J,et],function(t,e){var n=e[0],i=e[1];return Zt(n.evaluate(t),i.evaluate(t))}]]},get:{type:nt,overloads:[[[J],function(t,e){return Xt(e[0].evaluate(t),t.properties())}],[[J,et],function(t,e){var n=e[0],i=e[1];return Xt(n.evaluate(t),i.evaluate(t))}]]},properties:[et,[],function(t){return t.properties()}],"geometry-type":[J,[],function(t){return t.geometryType()}],id:[nt,[],function(t){return t.id()}],zoom:[Y,[],function(t){return t.globals.zoom}],"heatmap-density":[Y,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Y,[],function(t){return t.globals.lineProgress||0}],"+":[Y,Qt(Y),function(t,e){for(var n=0,i=0,r=e;i<r.length;i+=1){n+=r[i].evaluate(t)}return n}],"*":[Y,Qt(Y),function(t,e){for(var n=1,i=0,r=e;i<r.length;i+=1){n*=r[i].evaluate(t)}return n}],"-":{type:Y,overloads:[[[Y,Y],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)-i.evaluate(t)}],[[Y],function(t,e){return-e[0].evaluate(t)}]]},"/":[Y,[Y,Y],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)/i.evaluate(t)}],"%":[Y,[Y,Y],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)%i.evaluate(t)}],ln2:[Y,[],function(){return Math.LN2}],pi:[Y,[],function(){return Math.PI}],e:[Y,[],function(){return Math.E}],"^":[Y,[Y,Y],function(t,e){var n=e[0],i=e[1];return Math.pow(n.evaluate(t),i.evaluate(t))}],sqrt:[Y,[Y],function(t,e){var n=e[0];return Math.sqrt(n.evaluate(t))}],log10:[Y,[Y],function(t,e){var n=e[0];return Math.log10(n.evaluate(t))}],ln:[Y,[Y],function(t,e){var n=e[0];return Math.log(n.evaluate(t))}],log2:[Y,[Y],function(t,e){var n=e[0];return Math.log2(n.evaluate(t))}],sin:[Y,[Y],function(t,e){var n=e[0];return Math.sin(n.evaluate(t))}],cos:[Y,[Y],function(t,e){var n=e[0];return Math.cos(n.evaluate(t))}],tan:[Y,[Y],function(t,e){var n=e[0];return Math.tan(n.evaluate(t))}],asin:[Y,[Y],function(t,e){var n=e[0];return Math.asin(n.evaluate(t))}],acos:[Y,[Y],function(t,e){var n=e[0];return Math.acos(n.evaluate(t))}],atan:[Y,[Y],function(t,e){var n=e[0];return Math.atan(n.evaluate(t))}],min:[Y,Qt(Y),function(e,t){return Math.min.apply(Math,t.map(function(t){return t.evaluate(e)}))}],max:[Y,Qt(Y),function(e,t){return Math.max.apply(Math,t.map(function(t){return t.evaluate(e)}))}],abs:[Y,[Y],function(t,e){var n=e[0];return Math.abs(n.evaluate(t))}],round:[Y,[Y],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Y,[Y],function(t,e){var n=e[0];return Math.floor(n.evaluate(t))}],ceil:[Y,[Y],function(t,e){var n=e[0];return Math.ceil(n.evaluate(t))}],"filter-==":[Q,[J,nt],function(t,e){var n=e[0],i=e[1];return t.properties()[n.value]===i.value}],"filter-id-==":[Q,[nt],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[Q,[J],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[Q,[J,nt],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],o=i.value;return typeof r==typeof o&&r<o}],"filter-id-<":[Q,[nt],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[Q,[J,nt],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],o=i.value;return typeof r==typeof o&&o<r}],"filter-id->":[Q,[nt],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&r<i}],"filter-<=":[Q,[J,nt],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],o=i.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[Q,[nt],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[Q,[J,nt],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],o=i.value;return typeof r==typeof o&&o<=r}],"filter-id->=":[Q,[nt],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&r<=i}],"filter-has":[Q,[nt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Q,[],function(t){return null!==t.id()}],"filter-type-in":[Q,[rt(J)],function(t,e){return 0<=e[0].value.indexOf(t.geometryType())}],"filter-id-in":[Q,[rt(nt)],function(t,e){return 0<=e[0].value.indexOf(t.id())}],"filter-in-small":[Q,[J,rt(nt)],function(t,e){var n=e[0];return 0<=e[1].value.indexOf(t.properties()[n.value])}],"filter-in-large":[Q,[J,rt(nt)],function(t,e){var n=e[0],i=e[1];return function(t,e,n,i){for(;n<=i;){var r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=1+r}return!1}(t.properties()[n.value],i.value,0,i.value.length-1)}],">":{type:Q,overloads:[[[Y,Y],Kt],[[J,J],Kt],[[J,J,it],function(t,e){var n=e[0],i=e[1];return 0<e[2].evaluate(t).compare(n.evaluate(t),i.evaluate(t))}]]},"<":{type:Q,overloads:[[[Y,Y],Ht],[[J,J],Ht],[[J,J,it],function(t,e){var n=e[0],i=e[1];return e[2].evaluate(t).compare(n.evaluate(t),i.evaluate(t))<0}]]},">=":{type:Q,overloads:[[[Y,Y],Jt],[[J,J],Jt],[[J,J,it],function(t,e){var n=e[0],i=e[1];return 0<=e[2].evaluate(t).compare(n.evaluate(t),i.evaluate(t))}]]},"<=":{type:Q,overloads:[[[Y,Y],Yt],[[J,J],Yt],[[J,J,it],function(t,e){var n=e[0],i=e[1];return e[2].evaluate(t).compare(n.evaluate(t),i.evaluate(t))<=0}]]},all:{type:Q,overloads:[[[Q,Q],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)&&i.evaluate(t)}],[Qt(Q),function(t,e){for(var n=0,i=e;n<i.length;n+=1){if(!i[n].evaluate(t))return!1}return!0}]]},any:{type:Q,overloads:[[[Q,Q],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)||i.evaluate(t)}],[Qt(Q),function(t,e){for(var n=0,i=e;n<i.length;n+=1){if(i[n].evaluate(t))return!0}return!1}]]},"!":[Q,[Q],function(t,e){return!e[0].evaluate(t)}],upcase:[J,[J],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[J,[J],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[J,Qt(J),function(e,t){return t.map(function(t){return t.evaluate(e)}).join("")}],"resolved-locale":[J,[it],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var ne=.95047,ie=1,re=1.08883,oe=4/29,ae=6/29,se=3*ae*ae,le=ae*ae*ae,ue=Math.PI/180,ce=180/Math.PI;function he(t){return le<t?Math.pow(t,1/3):t/se+oe}function pe(t){return ae<t?t*t*t:se*(t-oe)}function fe(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function de(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function me(t){var e=de(t.r),n=de(t.g),i=de(t.b),r=he((.4124564*e+.3575761*n+.1804375*i)/ne),o=he((.2126729*e+.7151522*n+.072175*i)/ie);return{l:116*o-16,a:500*(r-o),b:200*(o-he((.0193339*e+.119192*n+.9503041*i)/re)),alpha:t.a}}function ye(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=ie*pe(e),n=ne*pe(n),i=re*pe(i),new ut(fe(3.2404542*n-1.5371385*e-.4985314*i),fe(-.969266*n+1.8760108*e+.041556*i),fe(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}var ge={forward:me,reverse:ye,interpolate:function(t,e,n){return{l:Ct(t.l,e.l,n),a:Ct(t.a,e.a,n),b:Ct(t.b,e.b,n),alpha:Ct(t.alpha,e.alpha,n)}}},ve={forward:function(t){var e=me(t),n=e.l,i=e.a,r=e.b,o=Math.atan2(r,i)*ce;return{h:o<0?360+o:o,c:Math.sqrt(i*i+r*r),l:n,alpha:t.a}},reverse:function(t){var e=t.h*ue,n=t.c;return ye({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:function(t,e,n){var i=e-t;return t+n*(180<i||i<-180?i-360*Math.round(i/360):i)}(t.h,e.h,n),c:Ct(t.c,e.c,n),l:Ct(t.l,e.l,n),alpha:Ct(t.alpha,e.alpha,n)}}},_e=Object.freeze({lab:ge,hcl:ve});function xe(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function be(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function we(t){return t}function Ee(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Se(t,e,n,i,r){return Ee(typeof n===r?i[n]:void 0,t.default,e.default)}function Te(t,e,n){if("number"!==xe(n))return Ee(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var r=Ie(t.stops,n);return t.stops[r][1]}function Ae(t,e,n){var i=void 0!==t.base?t.base:1;if("number"!==xe(n))return Ee(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var o=Ie(t.stops,n),a=function(t,e,n,i){var r=i-n,o=t-n;return 0==r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],l=t.stops[o+1][1],u=Pt[e.type]||we;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=_e[t.colorSpace];u=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==i)return u(n,i,a)}}:u(s,l,a)}function ze(t,e,n){return"color"===e.type?n=ut.parse(n):xe(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),Ee(n,t.default,e.default)}function Ie(t,e){for(var n,i,r=0,o=t.length-1,a=0;r<=o;){if(n=t[a=Math.floor((r+o)/2)][0],i=t[a+1][0],e===n||n<e&&e<i)return a;n<e?r=a+1:e<n&&(o=a-1)}return Math.max(a-1,0)}var ke=function(t,e){this.expression=t,this._warningHistory={},this._defaultValue=function(t){return"color"===t.type&&be(t.default)?new ut(0,0,0,0):"color"===t.type?ut.parse(t.default)||null:void 0===t.default?null:t.default}(e),"enum"===e.type&&(this._enumValues=e.values)};function Me(t){return Array.isArray(t)&&0<t.length&&"string"==typeof t[0]&&t[0]in $t}function Ce(t,e){var n=new It($t,[],function(t){var e={color:tt,string:J,number:Y,enum:J,boolean:Q};return"array"!==t.type?e[t.type]||null:rt(e[t.value]||nt,t.length)}(e)),i=n.parse(t);return i?te(new ke(i,e)):(L(0<n.errors.length),ee(n.errors))}ke.prototype.evaluateWithoutErrorHandling=function(t,e){return this._evaluator||(this._evaluator=new wt),this._evaluator.globals=t,this._evaluator.feature=e,this.expression.evaluate(this._evaluator)},ke.prototype.evaluate=function(t,e){this._evaluator||(this._evaluator=new wt),this._evaluator.globals=t,this._evaluator.feature=e;try{var n=this.expression.evaluate(this._evaluator);if(null==n)return this._defaultValue;if(this._enumValues&&!(n in this._enumValues))throw new mt("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(n)+" instead.");return n}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Pe=function(t,e){this.kind=t,this._styleExpression=e};Pe.prototype.evaluateWithoutErrorHandling=function(t,e){return this._styleExpression.evaluateWithoutErrorHandling(t,e)},Pe.prototype.evaluate=function(t,e){return this._styleExpression.evaluate(t,e)};var Le=function(t,e,n){this.kind=t,this.zoomStops=n.labels,this._styleExpression=e,n instanceof Lt&&(this._interpolationType=n.interpolation)};function De(t,e){if("error"===(t=Ce(t,e)).result)return t;var n=t.value.expression,i=Tt(n);if(!i&&!e["property-function"])return ee([new Z("","property expressions not supported")]);var r=At(n,["zoom"]);if(!r&&!1===e["zoom-function"])return ee([new Z("","zoom expressions not supported")]);var o=function n(t){var i=null;if(t instanceof Bt)i=n(t.result);else if(t instanceof Rt)for(var e=0,r=t.args;e<r.length;e+=1){var o=r[e];if(i=n(o))break}else(t instanceof Mt||t instanceof Lt)&&t.input instanceof St&&"zoom"===t.input.name&&(i=t);if(i instanceof Z)return i;t.eachChild(function(t){var e=n(t);e instanceof Z?i=e:!i&&e?i=new Z("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&e&&i!==e&&(i=new Z("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))});return i}(n);return o||r?o instanceof Z?ee([o]):o instanceof Lt&&"piecewise-constant"===e.function?ee([new Z("",'"interpolate" expressions cannot be used with this property')]):te(o?new Le(i?"camera":"composite",t.value,o):new Pe(i?"constant":"source",t.value)):ee([new Z("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Le.prototype.evaluateWithoutErrorHandling=function(t,e){return this._styleExpression.evaluateWithoutErrorHandling(t,e)},Le.prototype.evaluate=function(t,e){return this._styleExpression.evaluate(t,e)},Le.prototype.interpolationFactor=function(t,e,n){return this._interpolationType?Lt.interpolationFactor(this._interpolationType,t,e,n):0};var Re=function(t,e){this._parameters=t,this._specification=e,U(this,function t(i,r){var o,a,s,e="color"===r.type,n=i.stops&&"object"==typeof i.stops[0][0],l=n||void 0!==i.property,u=n||!l,c=i.type||("interpolated"===r.function?"exponential":"interval");if(e&&((i=U({},i)).stops&&(i.stops=i.stops.map(function(t){return[t[0],ut.parse(t[1])]})),i.default?i.default=ut.parse(i.default):i.default=ut.parse(r.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!_e[i.colorSpace])throw new Error("Unknown color space: "+i.colorSpace);if("exponential"===c)o=Ae;else if("interval"===c)o=Te;else if("categorical"===c){o=Se,a=Object.create(null);for(var h=0,p=i.stops;h<p.length;h+=1){var f=p[h];a[f[0]]=f[1]}s=typeof i.stops[0][0]}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');o=ze}if(n){for(var d={},m=[],y=0;y<i.stops.length;y++){var g=i.stops[y],v=g[0].zoom;void 0===d[v]&&(d[v]={zoom:v,type:i.type,property:i.property,default:i.default,stops:[]},m.push(v)),d[v].stops.push([g[0].value,g[1]])}for(var _=[],x=0,b=m;x<b.length;x+=1){var w=b[x];_.push([d[w].zoom,t(d[w],r)])}return{kind:"composite",interpolationFactor:Lt.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:_.map(function(t){return t[0]}),evaluate:function(t,e){var n=t.zoom;return Ae({stops:_,base:i.base},r,n).evaluate(n,e)}}}return u?{kind:"camera",interpolationFactor:"exponential"===c?Lt.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==i.base?i.base:1}):function(){return 0},zoomStops:i.stops.map(function(t){return t[0]}),evaluate:function(t){var e=t.zoom;return o(i,r,e,a,s)}}:{kind:"source",evaluate:function(t,e){var n=e&&e.properties?e.properties[i.property]:void 0;return void 0===n?Ee(i.default,r.default):o(i,r,n,a,s)}}}(this._parameters,this._specification))};function Be(t,e){if(be(t))return new Re(t,e);if(Me(t)){var n=De(t,e);if("error"===n.result)throw new Error(n.value.map(function(t){return t.key+": "+t.message}).join(", "));return n.value}var i=t;return"string"==typeof t&&"color"===e.type&&(i=ut.parse(t)),{kind:"constant",evaluate:function(){return i}}}function Oe(t){var e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],l=xe(n);if("object"!==l)return[new j(e,n,"object expected, "+l+" found")];for(var u in n){var c=u.split(".")[0],h=i[c]||i["*"],p=void 0;if(r[c])p=r[c];else if(i[c])p=ln;else if(r["*"])p=r["*"];else{if(!i["*"]){s.push(new j(e,n[u],'unknown property "'+u+'"'));continue}p=ln}s=s.concat(p({key:(e?e+".":e)+u,value:n[u],valueSpec:h,style:o,styleSpec:a,object:n,objectKey:u},n))}for(var f in i)r[f]||i[f].required&&void 0===i[f].default&&void 0===n[f]&&s.push(new j(e,n,'missing required property "'+f+'"'));return s}function Fe(t){var e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,o=t.key,a=t.arrayElementValidator||ln;if("array"!==xe(e))return[new j(o,e,"array expected, "+xe(e)+" found")];if(n.length&&e.length!==n.length)return[new j(o,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new j(o,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value};r.$version<7&&(s.function=n.function),"object"===xe(n.value)&&(s=n.value);for(var l=[],u=0;u<e.length;u++)l=l.concat(a({array:e,arrayIndex:u,value:e[u],valueSpec:s,style:i,styleSpec:r,key:o+"["+u+"]"}));return l}function Ve(t){var e=t.key,n=t.value,i=t.valueSpec,r=xe(n);return"number"!==r?[new j(e,n,"number expected, "+r+" found")]:"minimum"in i&&n<i.minimum?[new j(e,n,n+" is less than the minimum value "+i.minimum)]:"maximum"in i&&n>i.maximum?[new j(e,n,n+" is greater than the maximum value "+i.maximum)]:[]}function Ne(t){var a,s,r,l=t.valueSpec,u=W(t.value.type),c={},e="categorical"!==u&&void 0===t.value.property,n=!e,o="array"===xe(t.value.stops)&&"array"===xe(t.value.stops[0])&&"object"===xe(t.value.stops[0][0]),i=Oe({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===u)return[new j(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;e=e.concat(Fe({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===xe(n)&&0===n.length&&e.push(new j(t.key,n,"array must have at least one stop"));return e},default:function(t){return ln({key:t.key,value:t.value,valueSpec:l,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===u&&e&&i.push(new j(t.key,t.value,'missing required property "property"')),"identity"===u||t.value.stops||i.push(new j(t.key,t.value,'missing required property "stops"')),"exponential"===u&&"piecewise-constant"===t.valueSpec.function&&i.push(new j(t.key,t.value,"exponential functions not supported")),8<=t.styleSpec.$version&&(n&&!t.valueSpec["property-function"]?i.push(new j(t.key,t.value,"property functions not supported")):e&&!t.valueSpec["zoom-function"]&&"heatmap-color"!==t.objectKey&&"line-gradient"!==t.objectKey&&i.push(new j(t.key,t.value,"zoom functions not supported"))),"categorical"!==u&&!o||void 0!==t.value.property||i.push(new j(t.key,t.value,'"property" property is required')),i;function h(t){var e=[],n=t.value,i=t.key;if("array"!==xe(n))return[new j(i,n,"array expected, "+xe(n)+" found")];if(2!==n.length)return[new j(i,n,"array length 2 expected, length "+n.length+" found")];if(o){if("object"!==xe(n[0]))return[new j(i,n,"object expected, "+xe(n[0])+" found")];if(void 0===n[0].zoom)return[new j(i,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new j(i,n,"object stop key must have value")];if(r&&r>W(n[0].zoom))return[new j(i,n[0].zoom,"stop zoom values must appear in ascending order")];W(n[0].zoom)!==r&&(r=W(n[0].zoom),s=void 0,c={}),e=e.concat(Oe({key:i+"[0]",value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Ve,value:p}}))}else e=e.concat(p({key:i+"[0]",value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return e.concat(ln({key:i+"[1]",value:n[1],valueSpec:l,style:t.style,styleSpec:t.styleSpec}))}function p(t,e){var n=xe(t.value),i=W(t.value),r=null!==t.value?t.value:e;if(a){if(n!==a)return[new j(t.key,r,n+" stop domain type must match previous stop domain type "+a)]}else a=n;if("number"!==n&&"string"!==n&&"boolean"!==n)return[new j(t.key,r,"stop domain value must be a number, string, or boolean")];if("number"===n||"categorical"===u)return"categorical"!==u||"number"!==n||isFinite(i)&&Math.floor(i)===i?"categorical"!==u&&"number"===n&&void 0!==s&&i<s?[new j(t.key,r,"stop domain values must appear in ascending order")]:(s=i,"categorical"===u&&i in c?[new j(t.key,r,"stop domain values must be unique")]:(c[i]=!0,[])):[new j(t.key,r,"integer expected, found "+i)];var o="number expected, "+n+" found";return l["property-function"]&&void 0===u&&(o+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new j(t.key,r,o)]}}function je(e){var t=("property"===e.expressionContext?De:Ce)($(e.value),e.valueSpec);return"error"===t.result?t.value.map(function(t){return new j(""+e.key+t.key,e.value,t.message)}):"property"===e.expressionContext&&"text-font"===e.propertyKey&&-1!==t.value._styleExpression.expression.possibleOutputs().indexOf(void 0)?[new j(e.key,e.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')]:[]}function Ge(t){var e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(W(n))&&r.push(new j(e,n,"expected one of ["+i.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(i.values).indexOf(W(n))&&r.push(new j(e,n,"expected one of ["+Object.keys(i.values).join(", ")+"], "+JSON.stringify(n)+" found")),r}function Ue(t){if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return 2<=t.length&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3===t.length&&(Array.isArray(t[1])||Array.isArray(t[2]));case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var i=n[e];if(!Ue(i)&&"boolean"!=typeof i)return!1}return!0;default:return!0}}Re.deserialize=function(t){return new Re(t._parameters,t._specification)};var We={type:"boolean",default:!(Re.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}}),function:!0,"property-function":!0,"zoom-function":!0};function $e(t){if(!t)return function(){return!0};Ue(t)||(t=Ze(t));var n=Ce(t,We);if("error"===n.result)throw new Error(n.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,e){return n.value.evaluate(t,e)}}function qe(t,e){return t<e?-1:e<t?1:0}function Ze(t){if(!t)return!0;var e=t[0];return t.length<=1?"any"!==e:"=="===e?Xe(t[1],t[2],"=="):"!="===e?Ye(Xe(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Xe(t[1],t[2],e):"any"===e?function(t){return["any"].concat(t.map(Ze))}(t.slice(1)):"all"===e?["all"].concat(t.slice(1).map(Ze)):"none"===e?["all"].concat(t.slice(1).map(Ze).map(Ye)):"in"===e?He(t[1],t.slice(2)):"!in"===e?Ye(He(t[1],t.slice(2))):"has"===e?Ke(t[1]):"!has"!==e||Ye(Ke(t[1]))}function Xe(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function He(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return 200<e.length&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(qe)]]:["filter-in-small",t,["literal",e]]}}function Ke(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ye(t){return["!",t]}function Je(t){return Ue($(t.value))?je(U({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value;var i=e.key;if("array"!==xe(n))return[new j(i,n,"array expected, "+xe(n)+" found")];var r=e.styleSpec;var o;var a=[];if(n.length<1)return[new j(i,n,"filter array must have at least 1 element")];a=a.concat(Ge({key:i+"[0]",value:n[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec}));switch(W(n[0])){case"<":case"<=":case">":case">=":2<=n.length&&"$type"===W(n[1])&&a.push(new j(i,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&a.push(new j(i,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":2<=n.length&&"string"!==(o=xe(n[1]))&&a.push(new j(i+"[1]",n[1],"string expected, "+o+" found"));for(var s=2;s<n.length;s++)o=xe(n[s]),"$type"===W(n[1])?a=a.concat(Ge({key:i+"["+s+"]",value:n[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&a.push(new j(i+"["+s+"]",n[s],"string, number, or boolean expected, "+o+" found"));break;case"any":case"all":case"none":for(var l=1;l<n.length;l++)a=a.concat(t({key:i+"["+l+"]",value:n[l],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":o=xe(n[1]),2!==n.length?a.push(new j(i,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==o&&a.push(new j(i+"[1]",n[1],"string expected, "+o+" found"))}return a}(t)}function Qe(t,e){var n=t.key,i=t.style,r=t.styleSpec,o=t.value,a=t.objectKey,s=r[e+"_"+t.layerType];if(!s)return[];var l=a.match(/^(.*)-transition$/);if("paint"===e&&l&&s[l[1]]&&s[l[1]].transition)return ln({key:n,value:o,valueSpec:r.transition,style:i,styleSpec:r});var u,c=t.valueSpec||s[a];if(!c)return[new j(n,o,'unknown property "'+a+'"')];if("string"===xe(o)&&c["property-function"]&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new j(n,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(u[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&i&&!i.glyphs&&h.push(new j(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&be($(o))&&"identity"===W(o.type)&&h.push(new j(n,o,'"text-font" does not support identity functions'))),h.concat(ln({key:t.key,value:o,valueSpec:c,style:i,styleSpec:r,expressionContext:"property",propertyKey:a}))}function tn(t){return Qe(t,"paint")}function en(t){return Qe(t,"layout")}function nn(t){var e=[],n=t.value,i=t.key,r=t.style,o=t.styleSpec;n.type||n.ref||e.push(new j(i,n,'either "type" or "ref" is required'));var a,s=W(n.type),l=W(n.ref);if(n.id)for(var u=W(n.id),c=0;c<t.arrayIndex;c++){var h=r.layers[c];W(h.id)===u&&e.push(new j(i,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach(function(t){t in n&&e.push(new j(i,n[t],'"'+t+'" is prohibited for ref layers'))}),r.layers.forEach(function(t){W(t.id)===l&&(a=t)}),a?a.ref?e.push(new j(i,n.ref,"ref cannot reference another ref layer")):s=W(a.type):e.push(new j(i,n.ref,'ref layer "'+l+'" not found'));else if("background"!==s)if(n.source){var p=r.sources&&r.sources[n.source],f=p&&W(p.type);p?"vector"===f&&"raster"===s?e.push(new j(i,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new j(i,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==f||n["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new j(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new j(i,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new j(i,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new j(i,n.source,'source "'+n.source+'" not found'))}else e.push(new j(i,n,'missing required property "source"'));return e=e.concat(Oe({key:i,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ln({key:i+".type",value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:Je,layout:function(t){return Oe({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return en(U({layerType:s},t))}}})},paint:function(t){return Oe({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return tn(U({layerType:s},t))}}})}}}))}function rn(t){var e=t.value,n=t.key,i=t.styleSpec,r=t.style;if(!e.type)return[new j(n,e,'"type" is required')];var o=W(e.type),a=[];switch(o){case"vector":case"raster":case"raster-dem":if(a=a.concat(Oe({key:n,value:e,valueSpec:i["source_"+o.replace("-","_")],style:t.style,styleSpec:i})),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&a.push(new j(n+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return a;case"geojson":return Oe({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i});case"video":return Oe({key:n,value:e,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return Oe({key:n,value:e,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return a.push(new j(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")),a;default:return Ge({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:i})}}function on(t){var e=t.value,n=t.styleSpec,i=n.light,r=t.style,o=[],a=xe(e);if(void 0===e)return o;if("object"!==a)return o=o.concat([new j("light",e,"object expected, "+a+" found")]);for(var s in e){var l=s.match(/^(.*)-transition$/);o=l&&i[l[1]]&&i[l[1]].transition?o.concat(ln({key:s,value:e[s],valueSpec:n.transition,style:r,styleSpec:n})):i[s]?o.concat(ln({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n})):o.concat([new j(s,e[s],'unknown property "'+s+'"')])}return o}function an(t){var e=t.value,n=t.key,i=xe(e);return"string"!==i?[new j(n,e,"string expected, "+i+" found")]:[]}var sn={"*":function(){return[]},array:Fe,boolean:function(t){var e=t.value,n=t.key,i=xe(e);return"boolean"!==i?[new j(n,e,"boolean expected, "+i+" found")]:[]},number:Ve,color:function(t){var e=t.key,n=t.value,i=xe(n);return"string"!==i?[new j(e,n,"color expected, "+i+" found")]:null===lt(n)?[new j(e,n,'color expected, "'+n+'" found')]:[]},constants:G,enum:Ge,filter:Je,function:Ne,layer:nn,object:Oe,source:rn,light:on,string:an};function ln(t){var e=t.value,n=t.valueSpec,i=t.styleSpec;return n.function&&be(W(e))?Ne(t):n.function&&Me($(e))?je(t):n.type&&sn[n.type]?sn[n.type](t):Oe(U({},t,{valueSpec:n.type?i[n.type]:n}))}function un(t){var e=t.value,n=t.key,i=an(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new j(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new j(n,e,'"glyphs" url must include a "{range}" token'))),i}function cn(t,e){e=e||N;var n=[];return n=n.concat(ln({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:un,"*":function(){return[]}}})),t.constants&&(n=n.concat(G({key:"constants",value:t.constants,style:t,styleSpec:e}))),hn(n)}function hn(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function pn(t){return function(){return hn(t.apply(this,arguments))}}cn.source=pn(rn),cn.light=pn(on),cn.layer=pn(nn),cn.filter=pn(Je),cn.paintProperty=pn(tn),cn.layoutProperty=pn(en);var fn=cn,dn=cn.light,mn=cn.paintProperty,yn=cn.layoutProperty;function gn(t,e){var n=!1;if(e&&e.length)for(var i=0,r=e;i<r.length;i+=1){var o=r[i];t.fire(new O(new Error(o.message))),n=!0}return n}var vn=xn,_n=3;function xn(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],e=r[1],n=r[2],this.d=e+2*n;for(var o=0;o<this.d*this.d;o++){var a=r[_n+o],s=r[_n+o+1];i.push(a===s?null:r.subarray(a,s))}var l=r[_n+i.length],u=r[_n+i.length+1];this.keys=r.subarray(l,u),this.bboxes=r.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var h=n/e*t;this.min=-h,this.max=t+h}xn.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},xn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xn.prototype._insertCell=function(t,e,n,i,r,o){this.cells[r].push(o)},xn.prototype.query=function(t,e,n,i){var r=this.min,o=this.max;if(t<=r&&e<=r&&o<=n&&o<=i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,n,i,this._queryCell,a,{}),a},xn.prototype._queryCell=function(t,e,n,i,r,o,a){var s=this.cells[r];if(null!==s)for(var l=this.keys,u=this.bboxes,c=0;c<s.length;c++){var h=s[c];if(void 0===a[h]){var p=4*h;t<=u[2+p]&&e<=u[3+p]&&n>=u[0+p]&&i>=u[1+p]?(a[h]=!0,o.push(l[h])):a[h]=!1}}},xn.prototype._forEachCell=function(t,e,n,i,r,o,a){for(var s=this._convertToCellCoord(t),l=this._convertToCellCoord(e),u=this._convertToCellCoord(n),c=this._convertToCellCoord(i),h=s;h<=u;h++)for(var p=l;p<=c;p++){var f=this.d*p+h;if(r.call(this,t,e,n,i,f,o,a))return}},xn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},xn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=_n+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(e+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];r[_n+a]=o,r.set(s,o),o+=s.length}return r[_n+t.length]=o,r.set(this.keys,o),o+=this.keys.length,r[_n+t.length+1]=o,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};var bn=self.ImageData,wn={};function En(t,e,n){void 0===n&&(n={}),L(!wn[t],t+" is already registered."),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),wn[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var Sn in En("Object",Object),vn.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),n},vn.deserialize=function(t){return new vn(t)},En("Grid",vn),En("Color",ut),En("Error",Error),En("StylePropertyFunction",Re),En("StyleExpression",ke,{omit:["_evaluator"]}),En("ZoomDependentExpression",Le),En("ZoomConstantExpression",Pe),En("CompoundExpression",St,{omit:["_evaluate"]}),$t)$t[Sn]._classRegistryKey||En("Expression_"+Sn,$t[Sn]);function Tn(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof bn)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var i=[],r=0,o=t;r<o.length;r+=1){var a=o[r];i.push(Tn(a,e))}return i}if("object"!=typeof t)throw new Error("can't serialize object of type "+typeof t);var s=t.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");L(wn[l]);var u={};if(s.serialize)u._serialized=s.serialize(t,e);else{for(var c in t)if(t.hasOwnProperty(c)&&!(0<=wn[l].omit.indexOf(c))){var h=t[c];u[c]=0<=wn[l].shallow.indexOf(c)?h:Tn(h,e)}t instanceof Error&&(u.message=t.message)}return{name:l,properties:u}}function An(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof bn)return t;if(Array.isArray(t))return t.map(function(t){return An(t)});if("object"!=typeof t)throw new Error("can't deserialize object of type "+typeof t);var e=t,n=e.name,i=e.properties;if(!n)throw new Error("can't deserialize object of anonymous class");var r=wn[n].klass;if(!r)throw new Error("can't deserialize unregistered class "+n);if(r.deserialize)return r.deserialize(i._serialized);for(var o=Object.create(r.prototype),a=0,s=Object.keys(i);a<s.length;a+=1){var l=s[a];o[l]=0<=wn[n].shallow.indexOf(l)?i[l]:An(i[l])}return o}function zn(t,e){this.property=t,this.value=e,this.expression=Be(void 0===e?t.specification.default:e,t.specification)}zn.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},zn.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};function In(t){this.property=t,this.value=new zn(t,void 0)}In.prototype.transitioned=function(t,e){return new Mn(this.property,this.value,e,l({},t.transition,this.transition),t.now)},In.prototype.untransitioned=function(){return new Mn(this.property,this.value,null,{},0)};function kn(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}kn.prototype.getValue=function(t){return v(this._values[t].value.value)},kn.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new In(this._values[t].property)),this._values[t].value=new zn(this._values[t].property,null===e?void 0:v(e))},kn.prototype.getTransition=function(t){return v(this._values[t].transition)},kn.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new In(this._values[t].property)),this._values[t].transition=v(e)||void 0},kn.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e],r=this.getValue(i);void 0!==r&&(t[i]=r);var o=this.getTransition(i);void 0!==o&&(t[i+"-transition"]=o)}return t},kn.prototype.transitioned=function(t,e){for(var n=new Cn(this._properties),i=0,r=Object.keys(this._values);i<r.length;i+=1){var o=r[i];n._values[o]=this._values[o].transitioned(t,e._values[o])}return n},kn.prototype.untransitioned=function(){for(var t=new Cn(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e];t._values[i]=this._values[i].untransitioned()}return t};var Mn=function(t,e,n,i,r){this.property=t,this.value=e,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)};Mn.prototype.possiblyEvaluate=function(t){var e=t.now||0,n=this.value.possiblyEvaluate(t),i=this.prior;if(i){if(e>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(e<this.begin)return i.possiblyEvaluate(t);var r=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(i.possiblyEvaluate(t),n,function(t){if(t<=0)return 0;if(1<=t)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(r))}return n};var Cn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Cn.prototype.possiblyEvaluate=function(t){for(var e=new Dn(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var r=i[n];e._values[r]=this._values[r].possiblyEvaluate(t)}return e},Cn.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var n=e[t];if(this._values[n].prior)return!0}return!1};function Pn(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}Pn.prototype.getValue=function(t){return v(this._values[t].value)},Pn.prototype.setValue=function(t,e){this._values[t]=new zn(this._values[t].property,null===e?void 0:v(e))},Pn.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e],r=this.getValue(i);void 0!==r&&(t[i]=r)}return t},Pn.prototype.possiblyEvaluate=function(t){for(var e=new Dn(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var r=i[n];e._values[r]=this._values[r].possiblyEvaluate(t)}return e};function Ln(t,e,n){this.property=t,this.value=e,this.globals=n}Ln.prototype.isConstant=function(){return"constant"===this.value.kind},Ln.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},Ln.prototype.evaluate=function(t){return this.property.evaluate(this.value,this.globals,t)};var Dn=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Dn.prototype.get=function(t){return this._values[t]};function Rn(t){this.specification=t}Rn.prototype.possiblyEvaluate=function(t,e){return L(!t.isDataDriven()),t.expression.evaluate(e)},Rn.prototype.interpolate=function(t,e,n){var i=Pt[this.specification.type];return i?i(t,e,n):t};function Bn(t){this.specification=t}Bn.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new Ln(this,{kind:"constant",value:t.expression.evaluate(e)},e):new Ln(this,t.expression,e)},Bn.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Ln(this,{kind:"constant",value:void 0},t.globals);var i=Pt[this.specification.type];return i?new Ln(this,{kind:"constant",value:i(t.value.value,e.value.value,n)},t.globals):t},Bn.prototype.evaluate=function(t,e,n){return"constant"===t.kind?t.value:t.evaluate(e,n)};function On(t){this.specification=t}On.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"!==t.expression.kind)return L(!t.isDataDriven()),this._calculate(t.expression.evaluate({zoom:Math.floor(e.zoom-1)}),t.expression.evaluate({zoom:Math.floor(e.zoom)}),t.expression.evaluate({zoom:Math.floor(e.zoom+1)}),e);var n=t.expression.evaluate(e);return this._calculate(n,n,n,e)}},On.prototype._calculate=function(t,e,n,i){var r=i.zoom,o=r-Math.floor(r),a=i.crossFadingFactor();return r>i.zoomHistory.lastIntegerZoom?{from:t,to:e,fromScale:2,toScale:1,t:o+(1-o)*a}:{from:n,to:e,fromScale:.5,toScale:1,t:1-(1-a)*o}},On.prototype.interpolate=function(t){return t};function Fn(t){this.specification=t}Fn.prototype.possiblyEvaluate=function(t,e){return!!t.expression.evaluate(e)},Fn.prototype.interpolate=function(){return!1};function Vn(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var n=t[e],i=this.defaultPropertyValues[e]=new zn(n,void 0),r=this.defaultTransitionablePropertyValues[e]=new In(n);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}}En("DataDrivenProperty",Bn),En("DataConstantProperty",Rn),En("CrossFadedProperty",On),En("ColorRampProperty",Fn);var Nn,jn="-transition",Gn=((Nn=V)&&(Un.__proto__=Nn),((Un.prototype=Object.create(Nn&&Nn.prototype)).constructor=Un).prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},Un.prototype.setLayoutProperty=function(t,e,n){if(null!=e){var i="layers."+this.id+".layout."+t;if(this._validate(yn,i,t,e,n))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility="none"===e?e:"visible"},Un.prototype.getPaintProperty=function(t){return f(t,jn)?this._transitionablePaint.getTransition(t.slice(0,-jn.length)):this._transitionablePaint.getValue(t)},Un.prototype.setPaintProperty=function(t,e,n){if(null!=e){var i="layers."+this.id+".paint."+t;if(this._validate(mn,i,t,e,n))return}f(t,jn)?this._transitionablePaint.setTransition(t.slice(0,-jn.length),e||void 0):this._transitionablePaint.setValue(t,e)},Un.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},Un.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},Un.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},Un.prototype.recalculate=function(t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t)},Un.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return"none"===this.visibility&&(t.layout=t.layout||{},t.layout.visibility="none"),y(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},Un.prototype._validate=function(t,e,n,i,r){return(!r||!1!==r.validate)&&gn(this,t.call(fn,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:N,style:{glyphs:!0,sprite:!0}}))},Un.prototype.hasOffscreenPass=function(){return!1},Un.prototype.resize=function(){},Un);function Un(t,e){for(var n in Nn.call(this),this.id=t.id,this.metadata=t.metadata,this.type=t.type,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.visibility="visible","background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this._featureFilter=function(){return!0},e.layout&&(this._unevaluatedLayout=new Pn(e.layout)),this._transitionablePaint=new kn(e.paint),t.paint)this.setPaintProperty(n,t.paint[n],{validate:!1});for(var i in t.layout)this.setLayoutProperty(i,t.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}function Wn(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}function $n(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}var qn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};function Zn(t,r){void 0===r&&(r=1);var o=0,a=0;return{members:t.map(function(t){L(t.name.length);var e=function(t){return qn[t].BYTES_PER_ELEMENT}(t.type),n=o=Xn(o,Math.max(r,e)),i=t.components||1;return a=Math.max(a,e),o+=e*i,{name:t.name,type:t.type,components:i,offset:n}}),size:Xn(o,Math.max(a,r)),alignment:r}}function Xn(t,e){return Math.ceil(t/e)*e}$n.serialize=function(t,e){return L(!t.isTransferred),t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},$n.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},$n.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},$n.prototype.clear=function(){this.length=0},$n.prototype.resize=function(t){L(!this.isTransferred),this.reserve(t),this.length=t},$n.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},$n.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Hn,Kn=((Hn=$n)&&(Yn.__proto__=Hn),((Yn.prototype=Object.create(Hn&&Hn.prototype)).constructor=Yn).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},Yn.prototype.emplaceBack=function(t,e){var n=this.length;this.resize(n+1);var i=2*n;return this.int16[0+i]=t,this.int16[1+i]=e,n},Yn);function Yn(){Hn.apply(this,arguments)}Kn.prototype.bytesPerElement=4,En("StructArrayLayout2i4",Kn);var Jn,Qn=((Jn=$n)&&(ti.__proto__=Jn),((ti.prototype=Object.create(Jn&&Jn.prototype)).constructor=ti).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},ti.prototype.emplaceBack=function(t,e,n,i){var r=this.length;this.resize(r+1);var o=4*r;return this.int16[0+o]=t,this.int16[1+o]=e,this.int16[2+o]=n,this.int16[3+o]=i,r},ti);function ti(){Jn.apply(this,arguments)}Qn.prototype.bytesPerElement=8,En("StructArrayLayout4i8",Qn);var ei,ni=((ei=$n)&&(ii.__proto__=ei),((ii.prototype=Object.create(ei&&ei.prototype)).constructor=ii).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},ii.prototype.emplaceBack=function(t,e,n,i,r,o){var a=this.length;this.resize(a+1);var s=6*a;return this.int16[0+s]=t,this.int16[1+s]=e,this.int16[2+s]=n,this.int16[3+s]=i,this.int16[4+s]=r,this.int16[5+s]=o,a},ii);function ii(){ei.apply(this,arguments)}ni.prototype.bytesPerElement=12,En("StructArrayLayout2i4i12",ni);var ri,oi=((ri=$n)&&(ai.__proto__=ri),((ai.prototype=Object.create(ri&&ri.prototype)).constructor=ai).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},ai.prototype.emplaceBack=function(t,e,n,i,r,o,a,s){var l=this.length;this.resize(l+1);var u=6*l,c=12*l;return this.int16[0+u]=t,this.int16[1+u]=e,this.int16[2+u]=n,this.int16[3+u]=i,this.uint8[8+c]=r,this.uint8[9+c]=o,this.uint8[10+c]=a,this.uint8[11+c]=s,l},ai);function ai(){ri.apply(this,arguments)}oi.prototype.bytesPerElement=12,En("StructArrayLayout4i4ub12",oi);var si,li=((si=$n)&&(ui.__proto__=si),((ui.prototype=Object.create(si&&si.prototype)).constructor=ui).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},ui.prototype.emplaceBack=function(t,e,n,i,r,o,a,s){var l=this.length;this.resize(l+1);var u=8*l;return this.int16[0+u]=t,this.int16[1+u]=e,this.int16[2+u]=n,this.int16[3+u]=i,this.uint16[4+u]=r,this.uint16[5+u]=o,this.uint16[6+u]=a,this.uint16[7+u]=s,l},ui);function ui(){si.apply(this,arguments)}li.prototype.bytesPerElement=16,En("StructArrayLayout4i4ui16",li);var ci,hi=((ci=$n)&&(pi.__proto__=ci),((pi.prototype=Object.create(ci&&ci.prototype)).constructor=pi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},pi.prototype.emplaceBack=function(t,e,n){var i=this.length;this.resize(i+1);var r=3*i;return this.float32[0+r]=t,this.float32[1+r]=e,this.float32[2+r]=n,i},pi);function pi(){ci.apply(this,arguments)}hi.prototype.bytesPerElement=12,En("StructArrayLayout3f12",hi);var fi,di=((fi=$n)&&(mi.__proto__=fi),((mi.prototype=Object.create(fi&&fi.prototype)).constructor=mi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},mi.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var n=1*e;return this.uint32[0+n]=t,e},mi);function mi(){fi.apply(this,arguments)}di.prototype.bytesPerElement=4,En("StructArrayLayout1ul4",di);var yi,gi=((yi=$n)&&(vi.__proto__=yi),((vi.prototype=Object.create(yi&&yi.prototype)).constructor=vi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},vi.prototype.emplaceBack=function(t,e,n,i,r,o,a,s,l,u,c){var h=this.length;this.resize(h+1);var p=12*h,f=6*h;return this.int16[0+p]=t,this.int16[1+p]=e,this.int16[2+p]=n,this.int16[3+p]=i,this.int16[4+p]=r,this.int16[5+p]=o,this.uint32[3+f]=a,this.uint16[8+p]=s,this.uint16[9+p]=l,this.int16[10+p]=u,this.int16[11+p]=c,h},vi);function vi(){yi.apply(this,arguments)}gi.prototype.bytesPerElement=24,En("StructArrayLayout6i1ul2ui2i24",gi);var _i,xi=((_i=$n)&&(bi.__proto__=_i),((bi.prototype=Object.create(_i&&_i.prototype)).constructor=bi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},bi.prototype.emplaceBack=function(t,e,n,i,r,o){var a=this.length;this.resize(a+1);var s=6*a;return this.int16[0+s]=t,this.int16[1+s]=e,this.int16[2+s]=n,this.int16[3+s]=i,this.int16[4+s]=r,this.int16[5+s]=o,a},bi);function bi(){_i.apply(this,arguments)}xi.prototype.bytesPerElement=12,En("StructArrayLayout2i2i2i12",xi);var wi,Ei=((wi=$n)&&(Si.__proto__=wi),((Si.prototype=Object.create(wi&&wi.prototype)).constructor=Si).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer)},Si.prototype.emplaceBack=function(t,e){var n=this.length;this.resize(n+1);var i=4*n;return this.uint8[0+i]=t,this.uint8[1+i]=e,n},Si);function Si(){wi.apply(this,arguments)}Ei.prototype.bytesPerElement=4,En("StructArrayLayout2ub4",Ei);var Ti,Ai=((Ti=$n)&&(zi.__proto__=Ti),((zi.prototype=Object.create(Ti&&Ti.prototype)).constructor=zi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},zi.prototype.emplaceBack=function(t,e,n,i,r,o,a,s,l,u,c,h,p,f){var d=this.length;this.resize(d+1);var m=20*d,y=10*d,g=40*d;return this.int16[0+m]=t,this.int16[1+m]=e,this.uint16[2+m]=n,this.uint16[3+m]=i,this.uint32[2+y]=r,this.uint32[3+y]=o,this.uint32[4+y]=a,this.uint16[10+m]=s,this.uint16[11+m]=l,this.uint16[12+m]=u,this.float32[7+y]=c,this.float32[8+y]=h,this.uint8[36+g]=p,this.uint8[37+g]=f,d},zi);function zi(){Ti.apply(this,arguments)}Ai.prototype.bytesPerElement=40,En("StructArrayLayout2i2ui3ul3ui2f2ub40",Ai);var Ii,ki=((Ii=$n)&&(Mi.__proto__=Ii),((Mi.prototype=Object.create(Ii&&Ii.prototype)).constructor=Mi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},Mi.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var n=1*e;return this.float32[0+n]=t,e},Mi);function Mi(){Ii.apply(this,arguments)}ki.prototype.bytesPerElement=4,En("StructArrayLayout1f4",ki);var Ci,Pi=((Ci=$n)&&(Li.__proto__=Ci),((Li.prototype=Object.create(Ci&&Ci.prototype)).constructor=Li).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},Li.prototype.emplaceBack=function(t,e,n){var i=this.length;this.resize(i+1);var r=3*i;return this.int16[0+r]=t,this.int16[1+r]=e,this.int16[2+r]=n,i},Li);function Li(){Ci.apply(this,arguments)}Pi.prototype.bytesPerElement=6,En("StructArrayLayout3i6",Pi);var Di,Ri=((Di=$n)&&(Bi.__proto__=Di),((Bi.prototype=Object.create(Di&&Di.prototype)).constructor=Bi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},Bi.prototype.emplaceBack=function(t,e,n){var i=this.length;this.resize(i+1);var r=2*i,o=4*i;return this.uint32[0+r]=t,this.uint16[2+o]=e,this.uint16[3+o]=n,i},Bi);function Bi(){Di.apply(this,arguments)}Ri.prototype.bytesPerElement=8,En("StructArrayLayout1ul2ui8",Ri);var Oi,Fi=((Oi=$n)&&(Vi.__proto__=Oi),((Vi.prototype=Object.create(Oi&&Oi.prototype)).constructor=Vi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},Vi.prototype.emplaceBack=function(t,e,n){var i=this.length;this.resize(i+1);var r=3*i;return this.uint16[0+r]=t,this.uint16[1+r]=e,this.uint16[2+r]=n,i},Vi);function Vi(){Oi.apply(this,arguments)}Fi.prototype.bytesPerElement=6,En("StructArrayLayout3ui6",Fi);var Ni,ji=((Ni=$n)&&(Gi.__proto__=Ni),((Gi.prototype=Object.create(Ni&&Ni.prototype)).constructor=Gi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},Gi.prototype.emplaceBack=function(t,e){var n=this.length;this.resize(n+1);var i=2*n;return this.uint16[0+i]=t,this.uint16[1+i]=e,n},Gi);function Gi(){Ni.apply(this,arguments)}ji.prototype.bytesPerElement=4,En("StructArrayLayout2ui4",ji);var Ui,Wi=((Ui=$n)&&($i.__proto__=Ui),(($i.prototype=Object.create(Ui&&Ui.prototype)).constructor=$i).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},$i.prototype.emplaceBack=function(t,e){var n=this.length;this.resize(n+1);var i=2*n;return this.float32[0+i]=t,this.float32[1+i]=e,n},$i);function $i(){Ui.apply(this,arguments)}Wi.prototype.bytesPerElement=8,En("StructArrayLayout2f8",Wi);var qi,Zi=((qi=$n)&&(Xi.__proto__=qi),((Xi.prototype=Object.create(qi&&qi.prototype)).constructor=Xi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},Xi.prototype.emplaceBack=function(t,e,n,i){var r=this.length;this.resize(r+1);var o=4*r;return this.float32[0+o]=t,this.float32[1+o]=e,this.float32[2+o]=n,this.float32[3+o]=i,r},Xi);function Xi(){qi.apply(this,arguments)}Zi.prototype.bytesPerElement=16,En("StructArrayLayout4f16",Zi);var Hi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},n.radius.get=function(){return this._structArray.int16[this._pos2+10]},n.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},n.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},n.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},n.anchorPoint.get=function(){return new m(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(Wn);Hi.prototype.size=24;var Ki,Yi=((Ki=gi)&&(Ji.__proto__=Ki),((Ji.prototype=Object.create(Ki&&Ki.prototype)).constructor=Ji).prototype.get=function(t){return L(!this.isTransferred),new Hi(this,t)},Ji);function Ji(){Ki.apply(this,arguments)}En("CollisionBoxArray",Yi);var Qi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t},Object.defineProperties(e.prototype,n),e}(Wn);Qi.prototype.size=40;var tr,er=((tr=Ai)&&(nr.__proto__=tr),((nr.prototype=Object.create(tr&&tr.prototype)).constructor=nr).prototype.get=function(t){return L(!this.isTransferred),new Qi(this,t)},nr);function nr(){tr.apply(this,arguments)}En("PlacedSymbolArray",er);var ir=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={offsetX:{configurable:!0}};return n.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},n.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,n),e}(Wn);ir.prototype.size=4;var rr,or=((rr=ki)&&(ar.__proto__=rr),((ar.prototype=Object.create(rr&&rr.prototype)).constructor=ar).prototype.getoffsetX=function(t){return this.float32[1*t+0]},ar.prototype.get=function(t){return L(!this.isTransferred),new ir(this,t)},ar);function ar(){rr.apply(this,arguments)}En("GlyphOffsetArray",or);var sr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return n.x.get=function(){return this._structArray.int16[this._pos2+0]},n.x.set=function(t){this._structArray.int16[this._pos2+0]=t},n.y.get=function(){return this._structArray.int16[this._pos2+1]},n.y.set=function(t){this._structArray.int16[this._pos2+1]=t},n.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},n.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,n),e}(Wn);sr.prototype.size=6;var lr,ur=((lr=Pi)&&(cr.__proto__=lr),((cr.prototype=Object.create(lr&&lr.prototype)).constructor=cr).prototype.getx=function(t){return this.int16[3*t+0]},cr.prototype.gety=function(t){return this.int16[3*t+1]},cr.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},cr.prototype.get=function(t){return L(!this.isTransferred),new sr(this,t)},cr);function cr(){lr.apply(this,arguments)}En("SymbolLineVertexArray",ur);var hr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},n.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,n),e}(Wn);hr.prototype.size=8;var pr,fr=((pr=Ri)&&(dr.__proto__=pr),((dr.prototype=Object.create(pr&&pr.prototype)).constructor=dr).prototype.get=function(t){return L(!this.isTransferred),new hr(this,t)},dr);function dr(){pr.apply(this,arguments)}En("FeatureIndexArray",fr);function mr(t){void 0===t&&(t=[]),this.segments=t}var yr=Zn([{name:"a_pos",components:2,type:"Int16"}],4),gr=yr.members;yr.size,yr.alignment;mr.prototype.prepareSegment=function(t,e,n){var i=this.segments[this.segments.length-1];return mr.MAX_VERTEX_ARRAY_LENGTH<t&&b("Max vertices per segment is "+mr.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>mr.MAX_VERTEX_ARRAY_LENGTH)&&(i={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},this.segments.push(i)),i},mr.prototype.get=function(){return this.segments},mr.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var i in n.vaos)n.vaos[i].destroy()}},mr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,En("SegmentVector",mr);function vr(t,e){return 256*(t=g(Math.floor(t),0,255))+(e=g(Math.floor(e),0,255))}function _r(t){return[vr(255*t.r,255*t.g),vr(255*t.b,255*t.a)]}function xr(t,e,n){this.value=t,this.name=e,this.type=n,this.statistics={max:-1/0}}xr.prototype.defines=function(){return["#define HAS_UNIFORM_u_"+this.name]},xr.prototype.populatePaintArray=function(){},xr.prototype.upload=function(){},xr.prototype.destroy=function(){},xr.prototype.setUniforms=function(t,e,n,i){var r=i.constantOr(this.value),o=t.gl;"color"===this.type?o.uniform4f(e.uniforms["u_"+this.name],r.r,r.g,r.b,r.a):o.uniform1f(e.uniforms["u_"+this.name],r)};function br(t,e,n){this.expression=t,this.name=e,this.type=n,this.statistics={max:-1/0};var i="color"===n?Wi:ki;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===n?2:1,offset:0}],this.paintVertexArray=new i}br.prototype.defines=function(){return[]},br.prototype.populatePaintArray=function(t,e){var n=this.paintVertexArray,i=n.length;n.reserve(t);var r=this.expression.evaluate({zoom:0},e);if("color"===this.type)for(var o=_r(r),a=i;a<t;a++)n.emplaceBack(o[0],o[1]);else{for(var s=i;s<t;s++)n.emplaceBack(r);this.statistics.max=Math.max(this.statistics.max,r)}},br.prototype.upload=function(t){this.paintVertexArray&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},br.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},br.prototype.setUniforms=function(t,e){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],0)};function wr(t,e,n,i,r){this.expression=t,this.name=e,this.type=n,this.useIntegerZoom=i,this.zoom=r,this.statistics={max:-1/0};var o="color"===n?Zi:Wi;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===n?4:2,offset:0}],this.paintVertexArray=new o}wr.prototype.defines=function(){return[]},wr.prototype.populatePaintArray=function(t,e){var n=this.paintVertexArray,i=n.length;n.reserve(t);var r=this.expression.evaluate({zoom:this.zoom},e),o=this.expression.evaluate({zoom:this.zoom+1},e);if("color"===this.type)for(var a=_r(r),s=_r(o),l=i;l<t;l++)n.emplaceBack(a[0],a[1],s[0],s[1]);else{for(var u=i;u<t;u++)n.emplaceBack(r,o);this.statistics.max=Math.max(this.statistics.max,r,o)}},wr.prototype.upload=function(t){this.paintVertexArray&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},wr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},wr.prototype.interpolationFactor=function(t){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(t),this.zoom,this.zoom+1):this.expression.interpolationFactor(t,this.zoom,this.zoom+1)},wr.prototype.setUniforms=function(t,e,n){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],this.interpolationFactor(n.zoom))};function Er(){this.binders={},this.cacheKey="",this._buffers=[]}Er.createDynamic=function(t,e,n){var i,r,o=new Er,a=[];for(var s in t.paint._values)if(n(s)){var l=t.paint.get(s);if(l instanceof Ln&&l.property.specification["property-function"]){var u=(i=s,r=t.type,void 0,{"text-opacity":"opacity","icon-opacity":"opacity","text-color":"fill_color","icon-color":"fill_color","text-halo-color":"halo_color","icon-halo-color":"halo_color","text-halo-blur":"halo_blur","icon-halo-blur":"halo_blur","text-halo-width":"halo_width","icon-halo-width":"halo_width","line-gap-width":"gapwidth"},{"text-opacity":"opacity","icon-opacity":"opacity","text-color":"fill_color","icon-color":"fill_color","text-halo-color":"halo_color","icon-halo-color":"halo_color","text-halo-blur":"halo_blur","icon-halo-blur":"halo_blur","text-halo-width":"halo_width","icon-halo-width":"halo_width","line-gap-width":"gapwidth"}[i]||i.replace(r+"-","").replace(/-/g,"_")),c=l.property.specification.type,h=l.property.useIntegerZoom;"constant"===l.value.kind?(o.binders[s]=new xr(l.value,u,c),a.push("/u_"+u)):"source"===l.value.kind?(o.binders[s]=new br(l.value,u,c),a.push("/a_"+u)):(o.binders[s]=new wr(l.value,u,c,h,e),a.push("/z_"+u))}}return o.cacheKey=a.sort().join(""),o},Er.prototype.populatePaintArrays=function(t,e){for(var n in this.binders)this.binders[n].populatePaintArray(t,e)},Er.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},Er.prototype.setUniforms=function(t,e,n,i){for(var r in this.binders){this.binders[r].setUniforms(t,e,i,n.get(r))}},Er.prototype.getPaintVertexBuffers=function(){return this._buffers},Er.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var n=[];for(var i in this.binders){var r=this.binders[i];(r instanceof br||r instanceof wr)&&r.paintVertexBuffer&&n.push(r.paintVertexBuffer)}this._buffers=n},Er.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};function Sr(t,e,n,i){void 0===i&&(i=function(){return!0}),this.programConfigurations={};for(var r=0,o=e;r<o.length;r+=1){var a=o[r];this.programConfigurations[a.id]=Er.createDynamic(a,n,i),this.programConfigurations[a.id].layoutAttributes=t}}Sr.prototype.populatePaintArrays=function(t,e){for(var n in this.programConfigurations)this.programConfigurations[n].populatePaintArrays(t,e)},Sr.prototype.get=function(t){return this.programConfigurations[t]},Sr.prototype.upload=function(t){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t)},Sr.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},En("ConstantBinder",xr),En("SourceExpressionBinder",br),En("CompositeExpressionBinder",wr),En("ProgramConfiguration",Er,{omit:["_buffers"]}),En("ProgramConfigurationSet",Sr);var Tr=8192;var Ar,zr=(Ar=16,{min:-1*Math.pow(2,Ar-1),max:Math.pow(2,Ar-1)-1});function Ir(t){for(var e=Tr/t.extent,n=t.loadGeometry(),i=0;i<n.length;i++)for(var r=n[i],o=0;o<r.length;o++){var a=r[o];a.x=Math.round(a.x*e),a.y=Math.round(a.y*e),(a.x<zr.min||a.x>zr.max||a.y<zr.min||a.y>zr.max)&&b("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function kr(t,e,n,i,r){t.emplaceBack(2*e+(i+1)/2,2*n+(r+1)/2)}function Mr(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Kn,this.indexArray=new Fi,this.segments=new mr,this.programConfigurations=new Sr(gr,t.layers,t.zoom)}function Cr(t,e,n){for(var i=0;i<t.length;i++){var r=t[i];if(Vr(r,e))return!0;if(Br(e,r,n))return!0}return!1}function Pr(t,e){if(1===t.length&&1===t[0].length)return Fr(e,t[0][0]);for(var n=0;n<e.length;n++)for(var i=e[n],r=0;r<i.length;r++)if(Fr(t,i[r]))return!0;for(var o=0;o<t.length;o++){for(var a=t[o],s=0;s<a.length;s++)if(Fr(e,a[s]))return!0;for(var l=0;l<e.length;l++)if(Rr(a,e[l]))return!0}return!1}function Lr(t,e,n){for(var i=0;i<e.length;i++)for(var r=e[i],o=0;o<t.length;o++){var a=t[o];if(3<=a.length)for(var s=0;s<r.length;s++)if(Vr(a,r[s]))return!0;if(Dr(a,r,n))return!0}return!1}function Dr(t,e,n){if(1<t.length){if(Rr(t,e))return!0;for(var i=0;i<e.length;i++)if(Br(e[i],t,n))return!0}for(var r=0;r<t.length;r++)if(Br(t[r],e,n))return!0;return!1}function Rr(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var i=t[n],r=t[n+1],o=0;o<e.length-1;o++){var a=e[o],s=e[o+1];if(u=r,w(l=i,c=a,h=s)!==w(u,c,h)&&w(l,u,c)!==w(l,u,h))return!0}var l,u,c,h;return!1}function Br(t,e,n){var i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(var r=1;r<e.length;r++){if(Or(t,e[r-1],e[r])<i)return!0}return!1}function Or(t,e,n){var i=e.distSqr(n);if(0===i)return t.distSqr(e);var r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return r<0?t.distSqr(e):1<r?t.distSqr(n):t.distSqr(n.sub(e)._mult(r)._add(e))}function Fr(t,e){for(var n,i,r,o=!1,a=0;a<t.length;a++)for(var s=0,l=(n=t[a]).length-1;s<n.length;l=s++)i=n[s],r=n[l],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(o=!o);return o}function Vr(t,e){for(var n=!1,i=0,r=t.length-1;i<t.length;r=i++){var o=t[i],a=t[r];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function Nr(t,e,n){var i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).binders[t].statistics.max}function jr(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Gr(t,e,n,i,r){if(!e[0]&&!e[1])return t;var o=m.convert(e);"viewport"===n&&o._rotate(-i);for(var a=[],s=0;s<t.length;s++){for(var l=t[s],u=[],c=0;c<l.length;c++)u.push(l[c].sub(o._mult(r)));a.push(u)}return a}Mr.prototype.populate=function(t,e){for(var n=0,i=t;n<i.length;n+=1){var r=i[n],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=Ir(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},Mr.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Mr.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gr),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},Mr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Mr.prototype.addFeature=function(t,e){for(var n=this,i=0,r=e;i<r.length;i+=1)for(var o=0,a=r[i];o<a.length;o+=1){var s=a[o],l=s.x,u=s.y;if(!(l<0||Tr<=l||u<0||Tr<=u)){var c=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),h=c.vertexLength;kr(n.layoutVertexArray,l,u,-1,-1),kr(n.layoutVertexArray,l,u,1,-1),kr(n.layoutVertexArray,l,u,1,1),kr(n.layoutVertexArray,l,u,-1,1),n.indexArray.emplaceBack(h,h+1,h+2),n.indexArray.emplaceBack(h,h+3,h+2),c.vertexLength+=4,c.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},En("CircleBucket",Mr,{omit:["layers"]});var Ur,Wr={paint:new Vn({"circle-radius":new Bn(N.paint_circle["circle-radius"]),"circle-color":new Bn(N.paint_circle["circle-color"]),"circle-blur":new Bn(N.paint_circle["circle-blur"]),"circle-opacity":new Bn(N.paint_circle["circle-opacity"]),"circle-translate":new Rn(N.paint_circle["circle-translate"]),"circle-translate-anchor":new Rn(N.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rn(N.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rn(N.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bn(N.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bn(N.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bn(N.paint_circle["circle-stroke-opacity"])})},$r=n(function(t,e){var n;n=function(){var t;(t=new Float32Array(3))[0]=0,t[1]=0,t[2]=0;var e;(e=new Float32Array(4))[0]=0,e[1]=0,e[2]=0,e[3]=0;return{vec3:{transformMat3:function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t}},vec4:{transformMat4:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*a,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*a,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*a,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*a,t}},mat2:{create:function(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},rotate:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*s,t[1]=r*l+a*s,t[2]=i*-s+o*l,t[3]=r*-s+a*l,t},scale:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],l=n[1];return t[0]=i*s,t[1]=r*s,t[2]=o*l,t[3]=a*l,t}},mat3:{create:function(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromRotation:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}},mat4:{create:function(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},translate:function(t,e,n){var i,r,o,a,s,l,u,c,h,p,f,d,m=n[0],y=n[1],g=n[2];return e===t?(t[12]=e[0]*m+e[4]*y+e[8]*g+e[12],t[13]=e[1]*m+e[5]*y+e[9]*g+e[13],t[14]=e[2]*m+e[6]*y+e[10]*g+e[14],t[15]=e[3]*m+e[7]*y+e[11]*g+e[15]):(i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=i*m+s*y+h*g+e[12],t[13]=r*m+l*y+p*g+e[13],t[14]=o*m+u*y+f*g+e[14],t[15]=a*m+c*y+d*g+e[15]),t},scale:function(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},multiply:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],y=e[13],g=e[14],v=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*i+x*s+b*h+w*m,t[1]=_*r+x*l+b*p+w*y,t[2]=_*o+x*u+b*f+w*g,t[3]=_*a+x*c+b*d+w*v,_=n[4],x=n[5],b=n[6],w=n[7],t[4]=_*i+x*s+b*h+w*m,t[5]=_*r+x*l+b*p+w*y,t[6]=_*o+x*u+b*f+w*g,t[7]=_*a+x*c+b*d+w*v,_=n[8],x=n[9],b=n[10],w=n[11],t[8]=_*i+x*s+b*h+w*m,t[9]=_*r+x*l+b*p+w*y,t[10]=_*o+x*u+b*f+w*g,t[11]=_*a+x*c+b*d+w*v,_=n[12],x=n[13],b=n[14],w=n[15],t[12]=_*i+x*s+b*h+w*m,t[13]=_*r+x*l+b*p+w*y,t[14]=_*o+x*u+b*f+w*g,t[15]=_*a+x*c+b*d+w*v,t},perspective:function(t,e,n,i,r){var o=1/Math.tan(e/2),a=1/(i-r);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*a,t[15]=0,t},rotateX:function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*i,t[5]=a*r+c*i,t[6]=s*r+h*i,t[7]=l*r+p*i,t[8]=u*r-o*i,t[9]=c*r-a*i,t[10]=h*r-s*i,t[11]=p*r-l*i,t},rotateZ:function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*i,t[1]=a*r+c*i,t[2]=s*r+h*i,t[3]=l*r+p*i,t[4]=u*r-o*i,t[5]=c*r-a*i,t[6]=h*r-s*i,t[7]=p*r-l*i,t},invert:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],g=e[15],v=n*s-i*a,_=n*l-r*a,x=n*u-o*a,b=i*l-r*s,w=i*u-o*s,E=r*u-o*l,S=c*m-h*d,T=c*y-p*d,A=c*g-f*d,z=h*y-p*m,I=h*g-f*m,k=p*g-f*y,M=v*k-_*I+x*z+b*A-w*T+E*S;return M?(M=1/M,t[0]=(s*k-l*I+u*z)*M,t[1]=(r*I-i*k-o*z)*M,t[2]=(m*E-y*w+g*b)*M,t[3]=(p*w-h*E-f*b)*M,t[4]=(l*A-a*k-u*T)*M,t[5]=(n*k-r*A+o*T)*M,t[6]=(y*x-d*E-g*_)*M,t[7]=(c*E-p*x+f*_)*M,t[8]=(a*I-s*A+u*S)*M,t[9]=(i*A-n*I-o*S)*M,t[10]=(d*w-m*x+g*v)*M,t[11]=(h*x-c*w-f*v)*M,t[12]=(s*T-a*z-l*S)*M,t[13]=(n*z-i*T+r*S)*M,t[14]=(m*_-d*b-y*v)*M,t[15]=(c*b-h*_+p*v)*M,t):null},ortho:function(t,e,n,i,r,o,a){var s=1/(e-n),l=1/(i-r),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*l,t[14]=(a+o)*u,t[15]=1,t}}}},t.exports=n()}),qr=($r.vec3,$r.vec4),Zr=($r.mat2,$r.mat3,$r.mat4),Xr=((Ur=Gn)&&(Hr.__proto__=Ur),((Hr.prototype=Object.create(Ur&&Ur.prototype)).constructor=Hr).prototype.createBucket=function(t){return new Mr(t)},Hr.prototype.queryRadius=function(t){var e=t;return Nr("circle-radius",this,e)+Nr("circle-stroke-width",this,e)+jr(this.paint.get("circle-translate"))},Hr.prototype.queryIntersectsFeature=function(t,e,n,i,r,o,a){for(var s=Gr(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),r.angle,o),l=this.paint.get("circle-radius").evaluate(e)+this.paint.get("circle-stroke-width").evaluate(e),u="map"===this.paint.get("circle-pitch-alignment"),c=u?s:function(t,e,n){return t.map(function(t){return t.map(function(t){return Kr(t,e,n)})})}(s,a,r),h=u?l*o:l,p=0,f=n;p<f.length;p+=1)for(var d=0,m=f[p];d<m.length;d+=1){var y=m[d],g=u?y:Kr(y,a,r),v=h,_=qr.transformMat4([],[y.x,y.y,0,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?v*=_[3]/r.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(v*=r.cameraToCenterDistance/_[3]),Cr(c,g,v))return!0}return!1},Hr);function Hr(t){Ur.call(this,t,Wr)}function Kr(t,e,n){var i=qr.transformMat4([],[t.x,t.y,0,1],e);return new m((i[0]/i[3]+1)*n.width*.5,(i[1]/i[3]+1)*n.height*.5)}var Yr,Jr=((Yr=Mr)&&(Qr.__proto__=Yr),(Qr.prototype=Object.create(Yr&&Yr.prototype)).constructor=Qr);function Qr(){Yr.apply(this,arguments)}function to(t,e,n,i){var r=e.width,o=e.height;if(i){if(i.length!==r*o*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*o*n);return t.width=r,t.height=o,t.data=i,t}function eo(t,e,n){var i=e.width,r=e.height;if(i!==t.width||r!==t.height){var o=to({},{width:i,height:r},n);no(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,r)},n),t.width=i,t.height=r,t.data=o.data}}function no(t,e,n,i,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");var a=t.data,s=e.data;L(a!==s);for(var l=0;l<r.height;l++)for(var u=((n.y+l)*t.width+n.x)*o,c=((i.y+l)*e.width+i.x)*o,h=0;h<r.width*o;h++)s[c+h]=a[u+h];return e}En("HeatmapBucket",Jr,{omit:["layers"]});var io=function(t,e){to(this,t,1,e)};io.prototype.resize=function(t){eo(this,t,1)},io.prototype.clone=function(){return new io({width:this.width,height:this.height},new Uint8Array(this.data))},io.copy=function(t,e,n,i,r){no(t,e,n,i,r,1)};function ro(t,e){to(this,t,4,e)}ro.prototype.resize=function(t){eo(this,t,4)},ro.prototype.clone=function(){return new ro({width:this.width,height:this.height},new Uint8Array(this.data))},ro.copy=function(t,e,n,i,r){no(t,e,n,i,r,4)},En("AlphaImage",io),En("RGBAImage",ro);var oo={paint:new Vn({"heatmap-radius":new Bn(N.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bn(N.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rn(N.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Fn(N.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rn(N.paint_heatmap["heatmap-opacity"])})};function ao(t,e){for(var n=new Uint8Array(1024),i={},r=0,o=0;r<256;r++,o+=4){i[e]=r/255;var a=t.evaluate(i);n[o+0]=Math.floor(255*a.r/a.a),n[o+1]=Math.floor(255*a.g/a.a),n[o+2]=Math.floor(255*a.b/a.a),n[o+3]=Math.floor(255*a.a)}return new ro({width:256,height:1},n)}var so,lo=((so=Gn)&&(uo.__proto__=so),((uo.prototype=Object.create(so&&so.prototype)).constructor=uo).prototype.createBucket=function(t){return new Jr(t)},uo.prototype.setPaintProperty=function(t,e,n){so.prototype.setPaintProperty.call(this,t,e,n),"heatmap-color"===t&&this._updateColorRamp()},uo.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=ao(t,"heatmapDensity"),this.colorRampTexture=null},uo.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},uo.prototype.queryRadius=function(){return 0},uo.prototype.queryIntersectsFeature=function(){return!1},uo.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},uo);function uo(t){so.call(this,t,oo),this._updateColorRamp()}var co,ho={paint:new Vn({"hillshade-illumination-direction":new Rn(N.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Rn(N.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rn(N.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rn(N.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rn(N.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rn(N.paint_hillshade["hillshade-accent-color"])})},po=((co=Gn)&&(fo.__proto__=co),((fo.prototype=Object.create(co&&co.prototype)).constructor=fo).prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},fo);function fo(t){co.call(this,t,ho)}var mo=Zn([{name:"a_pos",components:2,type:"Int16"}],4),yo=mo.members,go=(mo.size,mo.alignment,_o),vo=_o;function _o(t,e,n){n=n||2;var i,r,o,a,s,l,u,c=e&&e.length,h=c?e[0]*n:t.length,p=xo(t,0,h,n,!0),f=[];if(!p)return f;if(c&&(p=function(t,e,n,i){var r,o,a,s,l,u=[];for(r=0,o=e.length;r<o;r++)a=e[r]*i,s=r<o-1?e[r+1]*i:t.length,(l=xo(t,a,s,i,!1))===l.next&&(l.steiner=!0),u.push(Mo(l));for(u.sort(zo),r=0;r<u.length;r++)Io(u[r],n),n=bo(n,n.next);return n}(t,e,p,n)),t.length>80*n){i=o=t[0],r=a=t[1];for(var d=n;d<h;d+=n)(s=t[d])<i&&(i=s),(l=t[d+1])<r&&(r=l),o<s&&(o=s),a<l&&(a=l);u=0!==(u=Math.max(o-i,a-r))?1/u:0}return wo(p,f,n,i,r,u),f}function xo(t,e,n,i,r){var o,a;if(r===0<No(t,e,n,i))for(o=e;o<n;o+=i)a=Oo(o,t[o],t[o+1],a);else for(o=n-i;e<=o;o-=i)a=Oo(o,t[o],t[o+1],a);return a&&Lo(a,a.next)&&(Fo(a),a=a.next),a}function bo(t,e){if(!t)return t;e=e||t;var n,i=t;do{if(n=!1,i.steiner||!Lo(i,i.next)&&0!==Po(i.prev,i,i.next))i=i.next;else{if(Fo(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function wo(t,e,n,i,r,o,a){if(t){!a&&o&&function(t,e,n,i){var r=t;for(;null===r.z&&(r.z=ko(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next,r!==t;);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,a,s,l,u=1;do{for(n=t,o=t=null,a=0;n;){for(a++,i=n,e=s=0;e<u&&(s++,i=i.nextZ);e++);for(l=u;0<s||0<l&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(n=(r=n).nextZ,s--):(i=(r=i).nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,u*=2}while(1<a)}(r)}(t,i,r,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?So(t,i,r,o):Eo(t))e.push(s.i/n),e.push(t.i/n),e.push(l.i/n),Fo(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?wo(t=To(t,e,n),e,n,i,r,o,2):2===a&&Ao(t,e,n,i,r,o):wo(bo(t),e,n,i,r,o,1);break}}}function Eo(t){var e=t.prev,n=t,i=t.next;if(0<=Po(e,n,i))return!1;for(var r=t.next.next;r!==t.prev;){if(Co(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&0<=Po(r.prev,r,r.next))return!1;r=r.next}return!0}function So(t,e,n,i){var r=t.prev,o=t,a=t.next;if(0<=Po(r,o,a))return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,u=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=ko(s,l,e,n,i),p=ko(u,c,e,n,i),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&Co(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=Po(f.prev,f,f.next))return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&Co(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=Po(d.prev,d,d.next))return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&Co(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=Po(f.prev,f,f.next))return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&Co(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=Po(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function To(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!Lo(r,o)&&Do(r,i,i.next,o)&&Ro(r,o)&&Ro(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),Fo(i),Fo(i.next),i=t=o),i=i.next}while(i!==t);return i}function Ao(t,e,n,i,r,o){var a,s,l=t;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&(s=u,(a=l).next.i!==s.i&&a.prev.i!==s.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Do(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(a,s)&&Ro(a,s)&&Ro(s,a)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;for(;n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next,n!==t;);return i}(a,s))){var c=Bo(l,u);return l=bo(l,l.next),c=bo(c,c.next),wo(l,e,n,i,r,o),void wo(c,e,n,i,r,o)}u=u.next}l=l.next}while(l!==t)}function zo(t,e){return t.x-e.x}function Io(t,e){if(e=function(t,e){var n,i=e,r=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&a<s){if((a=s)===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===a)return n.prev;var l,u=n,c=n.x,h=n.y,p=1/0;i=n.next;for(;i!==u;)r>=i.x&&i.x>=c&&r!==i.x&&Co(o<h?r:a,o,c,h,o<h?a:r,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(r-i.x))<p||l===p&&i.x>n.x)&&Ro(i,t)&&(n=i,p=l),i=i.next;return n}(t,e)){var n=Bo(e,t);bo(n,n.next)}}function ko(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Mo(t){for(var e=t,n=t;e.x<n.x&&(n=e),(e=e.next)!==t;);return n}function Co(t,e,n,i,r,o,a,s){return 0<=(r-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(i-s)-(n-a)*(e-s)&&0<=(n-a)*(o-s)-(r-a)*(i-s)}function Po(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Lo(t,e){return t.x===e.x&&t.y===e.y}function Do(t,e,n,i){return!!(Lo(t,e)&&Lo(n,i)||Lo(t,i)&&Lo(n,e))||0<Po(t,e,n)!=0<Po(t,e,i)&&0<Po(n,i,t)!=0<Po(n,i,e)}function Ro(t,e){return Po(t.prev,t,t.next)<0?0<=Po(t,e,t.next)&&0<=Po(t,t.prev,e):Po(t,e,t.prev)<0||Po(t,t.next,e)<0}function Bo(t,e){var n=new Vo(t.i,t.x,t.y),i=new Vo(e.i,e.x,e.y),r=t.next,o=e.prev;return(t.next=e).prev=t,(n.next=r).prev=n,(i.next=n).prev=i,(o.next=i).prev=o,i}function Oo(t,e,n,i){var r=new Vo(t,e,n);return i?(r.next=i.next,(r.prev=i).next.prev=r,i.next=r):(r.prev=r).next=r,r}function Fo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Vo(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function No(t,e,n,i){for(var r=0,o=e,a=n-i;o<n;o+=i)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}_o.deviation=function(t,e,n,i){var r=e&&e.length,o=r?e[0]*n:t.length,a=Math.abs(No(t,0,o,n));if(r)for(var s=0,l=e.length;s<l;s++){var u=e[s]*n,c=s<l-1?e[s+1]*n:t.length;a-=Math.abs(No(t,u,c,n))}var h=0;for(s=0;s<i.length;s+=3){var p=i[s]*n,f=i[s+1]*n,d=i[s+2]*n;h+=Math.abs((t[p]-t[d])*(t[1+f]-t[1+p])-(t[p]-t[f])*(t[1+d]-t[1+p]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},_o.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[r][o][a]);0<r&&(i+=t[r-1].length,n.holes.push(i))}return n},go.default=vo;var jo=Uo,Go=Uo;function Uo(t,e,n,i,r){!function t(e,n,i,r,o){for(;i<r;){if(600<r-i){var a=r-i+1,s=n-i+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(s-a/2<0?-1:1),h=Math.max(i,Math.floor(n-s*u/a+c)),p=Math.min(r,Math.floor(n+(a-s)*u/a+c));t(e,n,h,p,o)}var f=e[n],d=i,m=r;for(Wo(e,i,n),0<o(e[r],f)&&Wo(e,i,r);d<m;){for(Wo(e,d,m),d++,m--;o(e[d],f)<0;)d++;for(;0<o(e[m],f);)m--}0===o(e[i],f)?Wo(e,i,m):Wo(e,++m,r),m<=n&&(i=m+1),n<=m&&(r=m-1)}}(t,e,n||0,i||t.length-1,r||$o)}function Wo(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function $o(t,e){return t<e?-1:e<t?1:0}function qo(t,e){var n=t.length;if(n<=1)return[t];for(var i,r,o=[],a=0;a<n;a++){var s=E(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===r&&(r=s<0),r===s<0?(i&&o.push(i),i=[t[a]]):i.push(t[a]))}if(i&&o.push(i),1<e)for(var l=0;l<o.length;l++)o[l].length<=e||(jo(o[l],e,1,o[l].length-1,Zo),o[l]=o[l].slice(0,e));return o}function Zo(t,e){return e.area-t.area}jo.default=Go;function Xo(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Kn,this.indexArray=new Fi,this.indexArray2=new ji,this.programConfigurations=new Sr(yo,t.layers,t.zoom),this.segments=new mr,this.segments2=new mr}Xo.prototype.populate=function(t,e){for(var n=0,i=t;n<i.length;n+=1){var r=i[n],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=Ir(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},Xo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Xo.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yo),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2),this.programConfigurations.upload(t)},Xo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Xo.prototype.addFeature=function(t,e){for(var n=this,i=0,r=qo(e,500);i<r.length;i+=1){for(var o=r[i],a=0,s=0,l=o;s<l.length;s+=1){a+=l[s].length}for(var u=n.segments.prepareSegment(a,n.layoutVertexArray,n.indexArray),c=u.vertexLength,h=[],p=[],f=0,d=o;f<d.length;f+=1){var m=d[f];if(0!==m.length){m!==o[0]&&p.push(h.length/2);var y=n.segments2.prepareSegment(m.length,n.layoutVertexArray,n.indexArray2),g=y.vertexLength;n.layoutVertexArray.emplaceBack(m[0].x,m[0].y),n.indexArray2.emplaceBack(g+m.length-1,g),h.push(m[0].x),h.push(m[0].y);for(var v=1;v<m.length;v++)n.layoutVertexArray.emplaceBack(m[v].x,m[v].y),n.indexArray2.emplaceBack(g+v-1,g+v),h.push(m[v].x),h.push(m[v].y);y.vertexLength+=m.length,y.primitiveLength+=m.length}}var _=go(h,p);L(_.length%3==0);for(var x=0;x<_.length;x+=3)n.indexArray.emplaceBack(c+_[x],c+_[x+1],c+_[x+2]);u.vertexLength+=a,u.primitiveLength+=_.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},En("FillBucket",Xo,{omit:["layers"]});var Ho,Ko={paint:new Vn({"fill-antialias":new Rn(N.paint_fill["fill-antialias"]),"fill-opacity":new Bn(N.paint_fill["fill-opacity"]),"fill-color":new Bn(N.paint_fill["fill-color"]),"fill-outline-color":new Bn(N.paint_fill["fill-outline-color"]),"fill-translate":new Rn(N.paint_fill["fill-translate"]),"fill-translate-anchor":new Rn(N.paint_fill["fill-translate-anchor"]),"fill-pattern":new On(N.paint_fill["fill-pattern"])})},Yo=((Ho=Gn)&&(Jo.__proto__=Ho),((Jo.prototype=Object.create(Ho&&Ho.prototype)).constructor=Jo).prototype.recalculate=function(t){this.paint=this._transitioningPaint.possiblyEvaluate(t);var e=this.paint._values["fill-outline-color"];"constant"===e.value.kind&&void 0===e.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},Jo.prototype.createBucket=function(t){return new Xo(t)},Jo.prototype.queryRadius=function(){return jr(this.paint.get("fill-translate"))},Jo.prototype.queryIntersectsFeature=function(t,e,n,i,r,o){return Pr(Gr(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),r.angle,o),n)},Jo);function Jo(t){Ho.call(this,t,Ko)}var Qo=Zn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ta=Qo.members,ea=(Qo.size,Qo.alignment,Math.pow(2,13));function na(t,e,n,i,r,o,a,s){t.emplaceBack(e,n,2*Math.floor(i*ea)+a,r*ea*2,o*ea*2,Math.round(s))}function ia(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new ni,this.indexArray=new Fi,this.programConfigurations=new Sr(ta,t.layers,t.zoom),this.segments=new mr}ia.prototype.populate=function(t,e){for(var n=0,i=t;n<i.length;n+=1){var r=i[n],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=Ir(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},ia.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ia.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ta),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},ia.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ia.prototype.addFeature=function(t,e){for(var n,i,r,o=this,a=0,s=qo(e,500);a<s.length;a+=1){for(var l=s[a],u=0,c=0,h=l;c<h.length;c+=1){u+=h[c].length}for(var p=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),f=0,d=l;f<d.length;f+=1){var m=d[f];if(0!==m.length&&!((r=m).every(function(t){return t.x<0})||r.every(function(t){return t.x>Tr})||r.every(function(t){return t.y<0})||r.every(function(t){return t.y>Tr})))for(var y=0,g=0;g<m.length;g++){var v=m[g];if(1<=g){var _=m[g-1];if(i=_,!((n=v).x===i.x&&(n.x<0||n.x>Tr)||n.y===i.y&&(n.y<0||n.y>Tr))){p.vertexLength+4>mr.MAX_VERTEX_ARRAY_LENGTH&&(p=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray));var x=v.sub(_)._perp()._unit(),b=_.dist(v);32768<y+b&&(y=0),na(o.layoutVertexArray,v.x,v.y,x.x,x.y,0,0,y),na(o.layoutVertexArray,v.x,v.y,x.x,x.y,0,1,y),y+=b,na(o.layoutVertexArray,_.x,_.y,x.x,x.y,0,0,y),na(o.layoutVertexArray,_.x,_.y,x.x,x.y,0,1,y);var w=p.vertexLength;o.indexArray.emplaceBack(w,w+1,w+2),o.indexArray.emplaceBack(w+1,w+2,w+3),p.vertexLength+=4,p.primitiveLength+=2}}}}p.vertexLength+u>mr.MAX_VERTEX_ARRAY_LENGTH&&(p=o.segments.prepareSegment(u,o.layoutVertexArray,o.indexArray));for(var E=[],S=[],T=p.vertexLength,A=0,z=l;A<z.length;A+=1){var I=z[A];if(0!==I.length){I!==l[0]&&S.push(E.length/2);for(var k=0;k<I.length;k++){var M=I[k];na(o.layoutVertexArray,M.x,M.y,0,0,1,1,0),E.push(M.x),E.push(M.y)}}}var C=go(E,S);L(C.length%3==0);for(var P=0;P<C.length;P+=3)o.indexArray.emplaceBack(T+C[P],T+C[P+1],T+C[P+2]);p.primitiveLength+=C.length/3,p.vertexLength+=u}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},En("FillExtrusionBucket",ia,{omit:["layers"]});var ra,oa={paint:new Vn({"fill-extrusion-opacity":new Rn(N["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bn(N["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rn(N["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rn(N["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new On(N["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Bn(N["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bn(N["paint_fill-extrusion"]["fill-extrusion-base"])})},aa=((ra=Gn)&&(sa.__proto__=ra),((sa.prototype=Object.create(ra&&ra.prototype)).constructor=sa).prototype.createBucket=function(t){return new ia(t)},sa.prototype.queryRadius=function(){return jr(this.paint.get("fill-extrusion-translate"))},sa.prototype.queryIntersectsFeature=function(t,e,n,i,r,o){return Pr(Gr(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),r.angle,o),n)},sa.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("fill-extrusion-opacity")&&"none"!==this.visibility},sa.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null)},sa);function sa(t){ra.call(this,t,oa)}var la=Zn([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),ua=la.members,ca=(la.size,la.alignment,ha);function ha(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(pa,this,e)}function pa(t,e,n){1==t?e.id=n.readVarint():7==t?function(t,e){var n=t.readVarint()+t.pos;for(;t.pos<n;){var i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}(n,e):6==t?e.type=n.readVarint():2==t&&(e._geometry=n.pos)}function fa(t){for(var e,n,i=0,r=0,o=t.length,a=o-1;r<o;a=r++)e=t[r],i+=((n=t[a]).x-e.x)*(e.y+n.y);return i}ha.types=["Unknown","Point","LineString","Polygon"],ha.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,r=0,o=0,a=0,s=[];t.pos<n;){if(!r){var l=t.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)o+=t.readSVarint(),a+=t.readSVarint(),1===i&&(e&&s.push(e),e=[]),e.push(new m(o,a));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&s.push(e),s},ha.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(!i){var c=t.readVarint();n=7&c,i=c>>3}if(i--,1===n||2===n)(r+=t.readSVarint())<a&&(a=r),s<r&&(s=r),(o+=t.readSVarint())<l&&(l=o),u<o&&(u=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,l,s,u]},ha.prototype.toGeoJSON=function(t,e,n){var i,r,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=ha.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e],i=180-360*(n.y+s)/o;t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];c(l=h);break;case 2:for(i=0;i<l.length;i++)c(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],o=0;o<e;o++){var a=fa(t[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(n&&r.push(n),n=[t[o]]):n.push(t[o]))}n&&r.push(n);return r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)c(l[i][r])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var da=ma;function ma(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ya,this,e),this.length=this._features.length}function ya(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():6===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):4===t?e._keys.push(n.readString()):5===t&&e._values.push(function(t){var e=null,n=t.readVarint()+t.pos;for(;t.pos<n;){var i=t.readVarint()>>3;e=1==i?t.readString():2==i?t.readFloat():3==i?t.readDouble():4==i?t.readVarint64():5==i?t.readVarint():6==i?t.readSVarint():7==i?t.readBoolean():null}return e}(n))}function ga(t,e,n){if(2===t){var i=new da(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}ma.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ca(this._pbf,e,this.extent,this._keys,this._values)};var va={VectorTile:function(t,e){this.layers=t.readFields(ga,{},e)},VectorTileFeature:ca,VectorTileLayer:da},_a=va.VectorTileFeature.types,xa=Math.cos(Math.PI/180*37.5),ba=Math.pow(2,14)/.5;function wa(t,e,n,i,r,o,a){t.emplaceBack(e.x,e.y,i?1:0,r?1:-1,Math.round(63*n.x)+128,Math.round(63*n.y)+128,1+(0===o?0:o<0?-1:1)|(.5*a&63)<<2,.5*a>>6)}function Ea(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new oi,this.indexArray=new Fi,this.programConfigurations=new Sr(ua,t.layers,t.zoom),this.segments=new mr}function Sa(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(ba-1)}Ea.prototype.populate=function(t,e){for(var n=0,i=t;n<i.length;n+=1){var r=i[n],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=Ir(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},Ea.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ea.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ua),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},Ea.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ea.prototype.addFeature=function(t,e){for(var n=this.layers[0].layout,i=n.get("line-join").evaluate(t),r=n.get("line-cap"),o=n.get("line-miter-limit"),a=n.get("line-round-limit"),s=0,l=e;s<l.length;s+=1){var u=l[s];this.addLine(u,t,i,r,o,a)}},Ea.prototype.addLine=function(t,e,n,i,r,o){var a=this,s=null;e.properties&&e.properties.hasOwnProperty("emapgoMap_clip_start")&&e.properties.hasOwnProperty("emapgoMap_clip_end")&&(s={start:e.properties.emapgoMap_clip_start,end:e.properties.emapgoMap_clip_end,tileTotal:void 0});for(var l="Polygon"===_a[e.type],u=t.length;2<=u&&t[u-1].equals(t[u-2]);)u--;for(var c=0;c<u-1&&t[c].equals(t[c+1]);)c++;if(!(u<(l?3:2))){s&&(s.tileTotal=function(t,e,n){for(var i,r,o=0,a=e;a<n-1;a++)i=t[a],r=t[a+1],o+=i.dist(r);return o}(t,c,u)),"bevel"===n&&(r=1.05);var h,p,f,d=Tr/(512*this.overscaling)*15,m=t[c],y=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray),g=i,v=l?"butt":i,_=!(this.distance=0),x=void 0,b=void 0,w=void 0,E=void 0;this.e1=this.e2=this.e3=-1,l&&(h=t[u-2],E=m.sub(h)._unit()._perp());for(var S=c;S<u;S++)if(!(b=l&&S===u-1?t[c+1]:t[S+1])||!t[S].equals(b)){E&&(w=E),h&&(x=h),h=t[S],E=b?b.sub(h)._unit()._perp():w;var T=(w=w||E).add(E);0===T.x&&0===T.y||T._unit();var A=T.x*E.x+T.y*E.y,z=0!=A?1/A:1/0,I=A<xa&&x&&b;if(I&&c<S){var k=h.dist(x);if(2*d<k){var M=h.sub(h.sub(x)._mult(d/k)._round());a.distance+=M.dist(x),a.addCurrentVertex(M,a.distance,w.mult(1),0,0,!1,y,s),x=M}}var C=x&&b,P=C?n:b?g:v;if(C&&"round"===P&&(z<o?P="miter":z<=2&&(P="fakeround")),"miter"===P&&r<z&&(P="bevel"),"bevel"===P&&(2<z&&(P="flipbevel"),z<r&&(P="miter")),x&&(a.distance+=h.dist(x)),"miter"===P)T._mult(z),a.addCurrentVertex(h,a.distance,T,0,0,!1,y,s);else if("flipbevel"===P){if(100<z)T=E.clone().mult(-1);else{var L=0<w.x*E.y-w.y*E.x?-1:1,D=z*w.add(E).mag()/w.sub(E).mag();T._perp()._mult(D*L)}a.addCurrentVertex(h,a.distance,T,0,0,!1,y,s),a.addCurrentVertex(h,a.distance,T.mult(-1),0,0,!1,y,s)}else if("bevel"===P||"fakeround"===P){var R=0<w.x*E.y-w.y*E.x,B=-Math.sqrt(z*z-1);if(R?(f=0,p=B):(p=0,f=B),_||a.addCurrentVertex(h,a.distance,w,p,f,!1,y,s),"fakeround"===P){for(var O=Math.floor(8*(.5-(A-.5))),F=void 0,V=0;V<O;V++)F=E.mult((V+1)/(O+1))._add(w)._unit(),a.addPieSliceVertex(h,a.distance,F,R,y,s);a.addPieSliceVertex(h,a.distance,T,R,y,s);for(var N=O-1;0<=N;N--)F=w.mult((N+1)/(O+1))._add(E)._unit(),a.addPieSliceVertex(h,a.distance,F,R,y,s)}b&&a.addCurrentVertex(h,a.distance,E,-p,-f,!1,y,s)}else"butt"===P?(_||a.addCurrentVertex(h,a.distance,w,0,0,!1,y,s),b&&a.addCurrentVertex(h,a.distance,E,0,0,!1,y,s)):"square"===P?(_||(a.addCurrentVertex(h,a.distance,w,1,1,!1,y,s),a.e1=a.e2=-1),b&&a.addCurrentVertex(h,a.distance,E,-1,-1,!1,y,s)):"round"===P&&(_||(a.addCurrentVertex(h,a.distance,w,0,0,!1,y,s),a.addCurrentVertex(h,a.distance,w,1,1,!0,y,s),a.e1=a.e2=-1),b&&(a.addCurrentVertex(h,a.distance,E,-1,-1,!0,y,s),a.addCurrentVertex(h,a.distance,E,0,0,!1,y,s)));if(I&&S<u-1){var j=h.dist(b);if(2*d<j){var G=h.add(b.sub(h)._mult(d/j)._round());a.distance+=G.dist(h),a.addCurrentVertex(G,a.distance,E.mult(1),0,0,!1,y,s),h=G}}_=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e)}},Ea.prototype.addCurrentVertex=function(t,e,n,i,r,o,a,s){var l,u=this.layoutVertexArray,c=this.indexArray;s&&(e=Sa(e,s)),l=n.clone(),i&&l._sub(n.perp()._mult(i)),wa(u,t,l,o,!1,i,e),this.e3=a.vertexLength++,0<=this.e1&&0<=this.e2&&(c.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,l=n.mult(-1),r&&l._sub(n.perp()._mult(r)),wa(u,t,l,o,!0,-r,e),this.e3=a.vertexLength++,0<=this.e1&&0<=this.e2&&(c.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,ba/2<e&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,n,i,r,o,a))},Ea.prototype.addPieSliceVertex=function(t,e,n,i,r,o){n=n.mult(i?-1:1);var a=this.layoutVertexArray,s=this.indexArray;o&&(e=Sa(e,o)),wa(a,t,n,!1,i,0,e),this.e3=r.vertexLength++,0<=this.e1&&0<=this.e2&&(s.emplaceBack(this.e1,this.e2,this.e3),r.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},En("LineBucket",Ea,{omit:["layers"]});function Ta(){this.first=!0}var Aa=new Vn({"line-cap":new Rn(N.layout_line["line-cap"]),"line-join":new Bn(N.layout_line["line-join"]),"line-miter-limit":new Rn(N.layout_line["line-miter-limit"]),"line-round-limit":new Rn(N.layout_line["line-round-limit"])}),za={paint:new Vn({"line-opacity":new Bn(N.paint_line["line-opacity"]),"line-color":new Bn(N.paint_line["line-color"]),"line-translate":new Rn(N.paint_line["line-translate"]),"line-translate-anchor":new Rn(N.paint_line["line-translate-anchor"]),"line-width":new Bn(N.paint_line["line-width"]),"line-gap-width":new Bn(N.paint_line["line-gap-width"]),"line-offset":new Bn(N.paint_line["line-offset"]),"line-blur":new Bn(N.paint_line["line-blur"]),"line-dasharray":new On(N.paint_line["line-dasharray"]),"line-pattern":new On(N.paint_line["line-pattern"]),"line-gradient":new Fn(N.paint_line["line-gradient"])}),layout:Aa};Ta.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};function Ia(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ta,this.transition={})}var ka;function Ma(){ka.apply(this,arguments)}Ia.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)};var Ca=new((ka=Bn)&&(Ma.__proto__=ka),((Ma.prototype=Object.create(ka&&ka.prototype)).constructor=Ma).prototype.possiblyEvaluate=function(t,e){return e=new Ia(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),ka.prototype.possiblyEvaluate.call(this,t,e)},Ma.prototype.evaluate=function(t,e,n){return e=l({},e,{zoom:Math.floor(e.zoom)}),ka.prototype.evaluate.call(this,t,e,n)},Ma)(za.paint.properties["line-width"].specification);Ca.useIntegerZoom=!0;var Pa,La=((Pa=Gn)&&(Da.__proto__=Pa),((Da.prototype=Object.create(Pa&&Pa.prototype)).constructor=Da).prototype.setPaintProperty=function(t,e,n){Pa.prototype.setPaintProperty.call(this,t,e,n),"line-gradient"===t&&this._updateGradient()},Da.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=ao(t,"lineProgress"),this.gradientTexture=null},Da.prototype.recalculate=function(t){Pa.prototype.recalculate.call(this,t),this.paint._values["line-floorwidth"]=Ca.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)},Da.prototype.createBucket=function(t){return new Ea(t)},Da.prototype.queryRadius=function(t){var e=t,n=Ra(Nr("line-width",this,e),Nr("line-gap-width",this,e)),i=Nr("line-offset",this,e);return n/2+Math.abs(i)+jr(this.paint.get("line-translate"))},Da.prototype.queryIntersectsFeature=function(t,e,n,i,r,o){var a=Gr(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),r.angle,o),s=o/2*Ra(this.paint.get("line-width").evaluate(e),this.paint.get("line-gap-width").evaluate(e)),l=this.paint.get("line-offset").evaluate(e);return l&&(n=function(t,e){for(var n=[],i=new m(0,0),r=0;r<t.length;r++){for(var o=t[r],a=[],s=0;s<o.length;s++){var l=o[s-1],u=o[s],c=o[s+1],h=0===s?i:u.sub(l)._unit()._perp(),p=s===o.length-1?i:c.sub(u)._unit()._perp(),f=h._add(p)._unit(),d=f.x*p.x+f.y*p.y;f._mult(1/d),a.push(f._mult(e)._add(u))}n.push(a)}return n}(n,l*o)),Lr(a,n,s)},Da);function Da(t){Pa.call(this,t,za)}function Ra(t,e){return 0<e?e+2*t:t}var Ba,Oa=Zn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),Fa=Zn([{name:"a_projected_pos",components:3,type:"Float32"}],4),Va=(Zn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Zn([{name:"a_placed",components:2,type:"Uint8"}],4)),Na=(Zn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Zn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),ja=Zn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ga=(Zn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),Zn([{type:"Float32",name:"offsetX"}]),Zn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),!1),Ua=null,Wa=new V,$a={applyArabicShaping:null,processBidirectionalText:null};var qa={"Latin-1 Supplement":function(t){return 128<=t&&t<=255},Arabic:function(t){return 1536<=t&&t<=1791},"Arabic Supplement":function(t){return 1872<=t&&t<=1919},"Arabic Extended-A":function(t){return 2208<=t&&t<=2303},"Hangul Jamo":function(t){return 4352<=t&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return 5120<=t&&t<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(t){return 6320<=t&&t<=6399},"General Punctuation":function(t){return 8192<=t&&t<=8303},"Letterlike Symbols":function(t){return 8448<=t&&t<=8527},"Number Forms":function(t){return 8528<=t&&t<=8591},"Miscellaneous Technical":function(t){return 8960<=t&&t<=9215},"Control Pictures":function(t){return 9216<=t&&t<=9279},"Optical Character Recognition":function(t){return 9280<=t&&t<=9311},"Enclosed Alphanumerics":function(t){return 9312<=t&&t<=9471},"Geometric Shapes":function(t){return 9632<=t&&t<=9727},"Miscellaneous Symbols":function(t){return 9728<=t&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return 11008<=t&&t<=11263},"CJK Radicals Supplement":function(t){return 11904<=t&&t<=12031},"Kangxi Radicals":function(t){return 12032<=t&&t<=12255},"Ideographic Description Characters":function(t){return 12272<=t&&t<=12287},"CJK Symbols and Punctuation":function(t){return 12288<=t&&t<=12351},Hiragana:function(t){return 12352<=t&&t<=12447},Katakana:function(t){return 12448<=t&&t<=12543},Bopomofo:function(t){return 12544<=t&&t<=12591},"Hangul Compatibility Jamo":function(t){return 12592<=t&&t<=12687},Kanbun:function(t){return 12688<=t&&t<=12703},"Bopomofo Extended":function(t){return 12704<=t&&t<=12735},"CJK Strokes":function(t){return 12736<=t&&t<=12783},"Katakana Phonetic Extensions":function(t){return 12784<=t&&t<=12799},"Enclosed CJK Letters and Months":function(t){return 12800<=t&&t<=13055},"CJK Compatibility":function(t){return 13056<=t&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return 13312<=t&&t<=19903},"Yijing Hexagram Symbols":function(t){return 19904<=t&&t<=19967},"CJK Unified Ideographs":function(t){return 19968<=t&&t<=40959},"Yi Syllables":function(t){return 40960<=t&&t<=42127},"Yi Radicals":function(t){return 42128<=t&&t<=42191},"Hangul Jamo Extended-A":function(t){return 43360<=t&&t<=43391},"Hangul Syllables":function(t){return 44032<=t&&t<=55215},"Hangul Jamo Extended-B":function(t){return 55216<=t&&t<=55295},"Private Use Area":function(t){return 57344<=t&&t<=63743},"CJK Compatibility Ideographs":function(t){return 63744<=t&&t<=64255},"Arabic Presentation Forms-A":function(t){return 64336<=t&&t<=65023},"Vertical Forms":function(t){return 65040<=t&&t<=65055},"CJK Compatibility Forms":function(t){return 65072<=t&&t<=65103},"Small Form Variants":function(t){return 65104<=t&&t<=65135},"Arabic Presentation Forms-B":function(t){return 65136<=t&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return 65280<=t&&t<=65519}};function Za(t){for(var e=0,n=t;e<n.length;e+=1){if(Ka(n[e].charCodeAt(0)))return!0}return!1}function Xa(t){return!qa.Arabic(t)&&(!qa["Arabic Supplement"](t)&&(!qa["Arabic Extended-A"](t)&&(!qa["Arabic Presentation Forms-A"](t)&&!qa["Arabic Presentation Forms-B"](t))))}function Ha(t){return!(t<11904)&&(!!qa["Bopomofo Extended"](t)||(!!qa.Bopomofo(t)||(!!qa["CJK Compatibility Forms"](t)||(!!qa["CJK Compatibility Ideographs"](t)||(!!qa["CJK Compatibility"](t)||(!!qa["CJK Radicals Supplement"](t)||(!!qa["CJK Strokes"](t)||(!!qa["CJK Symbols and Punctuation"](t)||(!!qa["CJK Unified Ideographs Extension A"](t)||(!!qa["CJK Unified Ideographs"](t)||(!!qa["Enclosed CJK Letters and Months"](t)||(!!qa["Halfwidth and Fullwidth Forms"](t)||(!!qa.Hiragana(t)||(!!qa["Ideographic Description Characters"](t)||(!!qa["Kangxi Radicals"](t)||(!!qa["Katakana Phonetic Extensions"](t)||(!!qa.Katakana(t)||(!!qa["Vertical Forms"](t)||(!!qa["Yi Radicals"](t)||!!qa["Yi Syllables"](t))))))))))))))))))))}function Ka(t){return 746===t||747===t||!(t<4352)&&(!!qa["Bopomofo Extended"](t)||(!!qa.Bopomofo(t)||(!(!qa["CJK Compatibility Forms"](t)||65097<=t&&t<=65103)||(!!qa["CJK Compatibility Ideographs"](t)||(!!qa["CJK Compatibility"](t)||(!!qa["CJK Radicals Supplement"](t)||(!!qa["CJK Strokes"](t)||(!(!qa["CJK Symbols and Punctuation"](t)||12296<=t&&t<=12305||12308<=t&&t<=12319||12336===t)||(!!qa["CJK Unified Ideographs Extension A"](t)||(!!qa["CJK Unified Ideographs"](t)||(!!qa["Enclosed CJK Letters and Months"](t)||(!!qa["Hangul Compatibility Jamo"](t)||(!!qa["Hangul Jamo Extended-A"](t)||(!!qa["Hangul Jamo Extended-B"](t)||(!!qa["Hangul Jamo"](t)||(!!qa["Hangul Syllables"](t)||(!!qa.Hiragana(t)||(!!qa["Ideographic Description Characters"](t)||(!!qa.Kanbun(t)||(!!qa["Kangxi Radicals"](t)||(!!qa["Katakana Phonetic Extensions"](t)||(!(!qa.Katakana(t)||12540===t)||(!(!qa["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||65306<=t&&t<=65310||65339===t||65341===t||65343===t||65371<=t&&t<=65503||65507===t||65512<=t&&t<=65519)||(!(!qa["Small Form Variants"](t)||65112<=t&&t<=65118||65123<=t&&t<=65126)||(!!qa["Unified Canadian Aboriginal Syllabics"](t)||(!!qa["Unified Canadian Aboriginal Syllabics Extended"](t)||(!!qa["Vertical Forms"](t)||(!!qa["Yijing Hexagram Symbols"](t)||(!!qa["Yi Syllables"](t)||!!qa["Yi Radicals"](t))))))))))))))))))))))))))))))}function Ya(t){return!(Ka(t)||function(t){return!(!qa["Latin-1 Supplement"](t)||167!==t&&169!==t&&174!==t&&177!==t&&188!==t&&189!==t&&190!==t&&215!==t&&247!==t)||(!(!qa["General Punctuation"](t)||8214!==t&&8224!==t&&8225!==t&&8240!==t&&8241!==t&&8251!==t&&8252!==t&&8258!==t&&8263!==t&&8264!==t&&8265!==t&&8273!==t)||(!!qa["Letterlike Symbols"](t)||(!!qa["Number Forms"](t)||(!(!qa["Miscellaneous Technical"](t)||!(8960<=t&&t<=8967||8972<=t&&t<=8991||8996<=t&&t<=9e3||9003===t||9085<=t&&t<=9114||9150<=t&&t<=9165||9167===t||9169<=t&&t<=9179||9186<=t&&t<=9215))||(!(!qa["Control Pictures"](t)||9251===t)||(!!qa["Optical Character Recognition"](t)||(!!qa["Enclosed Alphanumerics"](t)||(!!qa["Geometric Shapes"](t)||(!(!qa["Miscellaneous Symbols"](t)||9754<=t&&t<=9759)||(!(!qa["Miscellaneous Symbols and Arrows"](t)||!(11026<=t&&t<=11055||11088<=t&&t<=11097||11192<=t&&t<=11243))||(!!qa["CJK Symbols and Punctuation"](t)||(!!qa.Katakana(t)||(!!qa["Private Use Area"](t)||(!!qa["CJK Compatibility Forms"](t)||(!!qa["Small Form Variants"](t)||(!!qa["Halfwidth and Fullwidth Forms"](t)||(8734===t||8756===t||8757===t||9984<=t&&t<=10087||10102<=t&&t<=10131||65532===t||65533===t)))))))))))))))))}(t))}var Ja={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Qa,ts=((Qa=m)&&(es.__proto__=Qa),((es.prototype=Object.create(Qa&&Qa.prototype)).constructor=es).prototype.clone=function(){return new es(this.x,this.y,this.angle,this.segment)},es);function es(t,e,n,i){Qa.call(this,t,e),this.angle=n,void 0!==i&&(this.segment=i)}function ns(t,e){var n=e.expression;if("constant"===n.kind)return{functionType:"constant",layoutSize:n.evaluate({zoom:t+1})};if("source"===n.kind)return{functionType:"source"};for(var i=n.zoomStops,r=0;r<i.length&&i[r]<=t;)r++;for(var o=r=Math.max(0,r-1);o<i.length&&i[o]<t+1;)o++;o=Math.min(i.length-1,o);var a={min:i[r],max:i[o]};return"composite"===n.kind?{functionType:"composite",zoomRange:a,propertyValue:e.value}:{functionType:"camera",layoutSize:n.evaluate({zoom:t+1}),zoomRange:a,sizeRange:{min:n.evaluate({zoom:a.min}),max:n.evaluate({zoom:a.max})},propertyValue:e.value}}En("Anchor",ts);var is=va.VectorTileFeature.types,rs=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function os(t,e,n,i,r,o,a,s){t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),o,a,s?s[0]:0,s?s[1]:0)}function as(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function ss(t){this.layoutVertexArray=new li,this.indexArray=new Fi,this.programConfigurations=t,this.segments=new mr,this.dynamicLayoutVertexArray=new hi,this.opacityVertexArray=new di,this.placedSymbolArray=new er}ss.prototype.upload=function(t,e){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Oa.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.programConfigurations.upload(t),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Fa.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,rs,!0),this.opacityVertexBuffer.itemSize=1},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},En("SymbolBuffers",ss);function ls(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new mr,this.collisionVertexArray=new Ei}ls.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Va.members,!0)},ls.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},En("CollisionBuffers",ls);function us(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ns(this.zoom,e["text-size"]),this.iconSizeData=ns(this.zoom,e["icon-size"]);var n=this.layers[0].layout;this.sortFeaturesByY=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement")}us.prototype.createArrays=function(){this.text=new ss(new Sr(Oa.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new ss(new Sr(Oa.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new ls(xi,Na.members,ji),this.collisionCircle=new ls(xi,ja.members,Fi),this.glyphOffsetArray=new or,this.lineVertexArray=new ur},us.prototype.populate=function(t,e){var n=this.layers[0],i=n.layout,r=i.get("text-font"),o=i.get("text-field"),a=i.get("icon-image"),s=("constant"!==o.value.kind||0<o.value.value.length)&&("constant"!==r.value.kind||0<r.value.value.length),l="constant"!==a.value.kind||a.value.value&&0<a.value.value.length;if(this.features=[],s||l){for(var u,c,h,p=e.iconDependencies,f=e.glyphDependencies,d={zoom:this.zoom},m=0,y=t;m<y.length;m+=1){var g=y[m],v=g.feature,_=g.index,x=g.sourceLayerIndex;if(n._featureFilter(d,v)){var b=void 0;s&&(b=n.getValueAndResolveTokens("text-field",v),u=b,c=v,void 0,"uppercase"===(h=n.layout.get("text-transform").evaluate(c))?u=u.toLocaleUpperCase():"lowercase"===h&&(u=u.toLocaleLowerCase()),$a.applyArabicShaping&&(u=$a.applyArabicShaping(u)),b=u);var w=void 0;if(l&&(w=n.getValueAndResolveTokens("icon-image",v)),b||w){var E={text:b,icon:w,index:_,sourceLayerIndex:x,geometry:Ir(v),properties:v.properties,type:is[v.type]};if(void 0!==v.id&&(E.id=v.id),this.features.push(E),w&&(p[w]=!0),b)for(var S=r.evaluate(v).join(","),T=f[S]=f[S]||{},A="map"===i.get("text-rotation-alignment")&&"line"===i.get("symbol-placement"),z=Za(b),I=0;I<b.length;I++)if(T[b.charCodeAt(I)]=!0,A&&z){var k=Ja[b.charAt(I)];k&&(T[k.charCodeAt(0)]=!0)}}}}"line"===i.get("symbol-placement")&&(this.features=function(e){var r={},o={},a=[],n=0;function t(t){a.push(e[t]),n++}function i(t,e,n){var i=o[t];return delete o[t],o[e]=i,a[i].geometry[0].pop(),a[i].geometry[0]=a[i].geometry[0].concat(n[0]),i}function s(t,e,n){var i=r[e];return delete r[e],r[t]=i,a[i].geometry[0].shift(),a[i].geometry[0]=n[0].concat(a[i].geometry[0]),i}function l(t,e,n){var i=n?e[0][e[0].length-1]:e[0][0];return t+":"+i.x+":"+i.y}for(var u=0;u<e.length;u++){var c=e[u],h=c.geometry,p=c.text;if(p){var f=l(p,h),d=l(p,h,!0);if(f in o&&d in r&&o[f]!==r[d]){var m=s(f,d,h),y=i(f,d,a[m].geometry);delete r[f],delete o[d],o[l(p,a[y].geometry,!0)]=y,a[m].geometry=null}else f in o?i(f,d,h):d in r?s(f,d,h):(t(u),r[f]=n-1,o[d]=n-1)}else t(u)}return a.filter(function(t){return t.geometry})}(this.features))}},us.prototype.isEmpty=function(){return 0===this.symbolInstances.length},us.prototype.upload=function(t){this.text.upload(t,this.sortFeaturesByY),this.icon.upload(t,this.sortFeaturesByY),this.collisionBox.upload(t),this.collisionCircle.upload(t)},us.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},us.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var i=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:i},a<e.length-1&&(i+=e[a+1].dist(e[a]));for(var s=t.segment||0;0<=s;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:r},0<s&&(r+=e[s-1].dist(e[s]));for(var l=0;l<e.length;l++){var u=o[l];this.lineVertexArray.emplaceBack(u.x,u.y,u.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},us.prototype.addSymbols=function(t,e,n,i,r,o,a,s,l,u){for(var c=t.indexArray,h=t.layoutVertexArray,p=t.dynamicLayoutVertexArray,f=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),d=this.glyphOffsetArray.length,m=f.vertexLength,y=0,g=e;y<g.length;y+=1){var v=g[y],_=v.tl,x=v.tr,b=v.bl,w=v.br,E=v.tex,S=f.vertexLength,T=v.glyphOffset[1];os(h,s.x,s.y,_.x,T+_.y,E.x,E.y,n),os(h,s.x,s.y,x.x,T+x.y,E.x+E.w,E.y,n),os(h,s.x,s.y,b.x,T+b.y,E.x,E.y+E.h,n),os(h,s.x,s.y,w.x,T+w.y,E.x+E.w,E.y+E.h,n),as(p,s,0),c.emplaceBack(S,S+1,S+2),c.emplaceBack(S+1,S+2,S+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(v.glyphOffset[0])}t.placedSymbolArray.emplaceBack(s.x,s.y,d,this.glyphOffsetArray.length-d,m,l,u,s.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],a,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o)},us.prototype._addCollisionDebugVertex=function(t,e,n,i,r){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,i.x,i.y,Math.round(r.x),Math.round(r.y))},us.prototype.addCollisionDebugVertices=function(t,e,n,i,r,o,a,s){var l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),u=l.vertexLength,c=r.layoutVertexArray,h=r.collisionVertexArray;if(this._addCollisionDebugVertex(c,h,o,a.anchor,new m(t,e)),this._addCollisionDebugVertex(c,h,o,a.anchor,new m(n,e)),this._addCollisionDebugVertex(c,h,o,a.anchor,new m(n,i)),this._addCollisionDebugVertex(c,h,o,a.anchor,new m(t,i)),l.vertexLength+=4,s){var p=r.indexArray;p.emplaceBack(u,u+1,u+2),p.emplaceBack(u,u+2,u+3),l.primitiveLength+=2}else{var f=r.indexArray;f.emplaceBack(u,u+1),f.emplaceBack(u+1,u+2),f.emplaceBack(u+2,u+3),f.emplaceBack(u+3,u),l.primitiveLength+=4}},us.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var n=e[t];n.textCollisionFeature={boxStartIndex:n.textBoxStartIndex,boxEndIndex:n.textBoxEndIndex},n.iconCollisionFeature={boxStartIndex:n.iconBoxStartIndex,boxEndIndex:n.iconBoxEndIndex};for(var i=0;i<2;i++){var r=n[0===i?"textCollisionFeature":"iconCollisionFeature"];if(r)for(var o=r.boxStartIndex;o<r.boxEndIndex;o++){var a=this.collisionBoxArray.get(o),s=a.x1,l=a.y1,u=a.x2,c=a.y2,h=0<a.radius;this.addCollisionDebugVertices(s,l,u,c,h?this.collisionCircle:this.collisionBox,a.anchorPoint,n,h)}}}},us.prototype.deserializeCollisionBoxes=function(t,e,n,i,r){for(var o={},a=e;a<n;a++){var s=t.get(a);if(0===s.radius){o.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},o.textFeatureIndex=s.featureIndex;break}o.textCircles||(o.textCircles=[],o.textFeatureIndex=s.featureIndex);o.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var l=i;l<r;l++){var u=t.get(l);if(0===u.radius){o.iconBox={x1:u.x1,y1:u.y1,x2:u.x2,y2:u.y2,anchorPointX:u.anchorPointX,anchorPointY:u.anchorPointY},o.iconFeatureIndex=u.featureIndex;break}}return o},us.prototype.hasTextData=function(){return 0<this.text.segments.get().length},us.prototype.hasIconData=function(){return 0<this.icon.segments.get().length},us.prototype.hasCollisionBoxData=function(){return 0<this.collisionBox.segments.get().length},us.prototype.hasCollisionCircleData=function(){return 0<this.collisionCircle.segments.get().length},us.prototype.sortFeatures=function(t){var r=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(1<this.text.segments.get().length||1<this.icon.segments.get().length))){for(var e=[],n=0;n<this.symbolInstances.length;n++)e.push(n);var o=Math.sin(t),a=Math.cos(t);e.sort(function(t,e){var n=r.symbolInstances[t],i=r.symbolInstances[e];return(o*n.anchor.x+a*n.anchor.y|0)-(o*i.anchor.x+a*i.anchor.y|0)||i.featureIndex-n.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var i=0,s=e;i<s.length;i+=1){var l=s[i],u=r.symbolInstances[l];r.featureSortOrder.push(u.featureIndex);for(var c=0,h=u.placedTextSymbolIndices;c<h.length;c+=1)for(var p=h[c],f=r.text.placedSymbolArray.get(p),d=f.vertexStartIndex+4*f.numGlyphs,m=f.vertexStartIndex;m<d;m+=4)r.text.indexArray.emplaceBack(m,m+1,m+2),r.text.indexArray.emplaceBack(m+1,m+2,m+3);var y=r.icon.placedSymbolArray.get(l);if(y.numGlyphs){var g=y.vertexStartIndex;r.icon.indexArray.emplaceBack(g,g+1,g+2),r.icon.indexArray.emplaceBack(g+1,g+2,g+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},En("SymbolBucket",us,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),us.MAX_GLYPHS=65535,us.addDynamicAttributes=as;var cs,hs=new Vn({"symbol-placement":new Rn(N.layout_symbol["symbol-placement"]),"symbol-spacing":new Rn(N.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rn(N.layout_symbol["symbol-avoid-edges"]),"icon-allow-overlap":new Rn(N.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Rn(N.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rn(N.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rn(N.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bn(N.layout_symbol["icon-size"]),"icon-text-fit":new Rn(N.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Rn(N.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bn(N.layout_symbol["icon-image"]),"icon-rotate":new Bn(N.layout_symbol["icon-rotate"]),"icon-padding":new Rn(N.layout_symbol["icon-padding"]),"icon-keep-upright":new Rn(N.layout_symbol["icon-keep-upright"]),"icon-offset":new Bn(N.layout_symbol["icon-offset"]),"icon-anchor":new Bn(N.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rn(N.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rn(N.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rn(N.layout_symbol["text-rotation-alignment"]),"text-field":new Bn(N.layout_symbol["text-field"]),"text-font":new Bn(N.layout_symbol["text-font"]),"text-size":new Bn(N.layout_symbol["text-size"]),"text-max-width":new Bn(N.layout_symbol["text-max-width"]),"text-line-height":new Rn(N.layout_symbol["text-line-height"]),"text-letter-spacing":new Bn(N.layout_symbol["text-letter-spacing"]),"text-justify":new Bn(N.layout_symbol["text-justify"]),"text-anchor":new Bn(N.layout_symbol["text-anchor"]),"text-max-angle":new Rn(N.layout_symbol["text-max-angle"]),"text-rotate":new Bn(N.layout_symbol["text-rotate"]),"text-padding":new Rn(N.layout_symbol["text-padding"]),"text-keep-upright":new Rn(N.layout_symbol["text-keep-upright"]),"text-transform":new Bn(N.layout_symbol["text-transform"]),"text-offset":new Bn(N.layout_symbol["text-offset"]),"text-allow-overlap":new Rn(N.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Rn(N.layout_symbol["text-ignore-placement"]),"text-optional":new Rn(N.layout_symbol["text-optional"])}),ps={paint:new Vn({"icon-opacity":new Bn(N.paint_symbol["icon-opacity"]),"icon-color":new Bn(N.paint_symbol["icon-color"]),"icon-halo-color":new Bn(N.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bn(N.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bn(N.paint_symbol["icon-halo-blur"]),"icon-translate":new Rn(N.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rn(N.paint_symbol["icon-translate-anchor"]),"text-opacity":new Bn(N.paint_symbol["text-opacity"]),"text-color":new Bn(N.paint_symbol["text-color"]),"text-halo-color":new Bn(N.paint_symbol["text-halo-color"]),"text-halo-width":new Bn(N.paint_symbol["text-halo-width"]),"text-halo-blur":new Bn(N.paint_symbol["text-halo-blur"]),"text-translate":new Rn(N.paint_symbol["text-translate"]),"text-translate-anchor":new Rn(N.paint_symbol["text-translate-anchor"])}),layout:hs},fs=((cs=Gn)&&(ds.__proto__=cs),((ds.prototype=Object.create(cs&&cs.prototype)).constructor=ds).prototype.recalculate=function(t){cs.prototype.recalculate.call(this,t),"auto"===this.layout.get("icon-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},ds.prototype.getValueAndResolveTokens=function(t,e){var n=this.layout.get(t).evaluate(e),i=this._unevaluatedLayout._values[t];return i.isDataDriven()||Me(i.value)?n:function(n,t){return t.replace(/{([^{}]+)}/g,function(t,e){return e in n?String(n[e]):""})}(e.properties,n)},ds.prototype.createBucket=function(t){return new us(t)},ds.prototype.queryRadius=function(){return 0},ds.prototype.queryIntersectsFeature=function(){return L(!1),!1},ds);function ds(t){cs.call(this,t,ps)}var ms,ys={paint:new Vn({"background-color":new Rn(N.paint_background["background-color"]),"background-pattern":new On(N.paint_background["background-pattern"]),"background-opacity":new Rn(N.paint_background["background-opacity"])})},gs=((ms=Gn)&&(vs.__proto__=ms),(vs.prototype=Object.create(ms&&ms.prototype)).constructor=vs);function vs(t){ms.call(this,t,ys)}var _s,xs={paint:new Vn({"raster-opacity":new Rn(N.paint_raster["raster-opacity"]),"raster-hue-rotate":new Rn(N.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rn(N.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rn(N.paint_raster["raster-brightness-max"]),"raster-saturation":new Rn(N.paint_raster["raster-saturation"]),"raster-contrast":new Rn(N.paint_raster["raster-contrast"]),"raster-fade-duration":new Rn(N.paint_raster["raster-fade-duration"])})};function bs(t){_s.call(this,t,xs)}var ws={circle:Xr,heatmap:lo,hillshade:po,fill:Yo,"fill-extrusion":aa,line:La,symbol:fs,background:gs,raster:((_s=Gn)&&(bs.__proto__=_s),(bs.prototype=Object.create(_s&&_s.prototype)).constructor=bs)};function Es(t,e){var n=e.pixelRatio;this.paddedRect=t,this.pixelRatio=n}var Ss=n(function(t,e){var n;n=function(){function t(t,e,n){n=n||{},this.w=t||64,this.h=e||64,this.autoResize=!!n.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function f(t,e,n){this.x=0,this.y=t,this.w=this.free=e,this.h=n}function r(t,e,n,i,r,o,a){this.id=t,this.x=e,this.y=n,this.w=i,this.h=r,this.maxw=o||i,this.maxh=a||r,this.refcount=0}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var n,i,r,o,a=[],s=0;s<t.length;s++)if(n=t[s].w||t[s].width,i=t[s].h||t[s].height,r=t[s].id,n&&i){if(!(o=this.packOne(n,i,r)))continue;e.inPlace&&(t[s].x=o.x,t[s].y=o.y,t[s].id=o.id),a.push(o)}return this.shrink(),a},t.prototype.packOne=function(t,e,n){var i,r,o,a,s,l,u,c,h={freebin:-1,shelf:-1,waste:1/0},p=0;if("string"==typeof n||"number"==typeof n){if(i=this.getBin(n))return this.ref(i),i;"number"==typeof n&&(this.maxId=Math.max(n,this.maxId))}else n=++this.maxId;for(a=0;a<this.freebins.length;a++){if(e===(i=this.freebins[a]).maxh&&t===i.maxw)return this.allocFreebin(a,t,e,n);e>i.maxh||t>i.maxw||e<=i.maxh&&t<=i.maxw&&(o=i.maxw*i.maxh-t*e)<h.waste&&(h.waste=o,h.freebin=a)}for(a=0;a<this.shelves.length;a++)if(p+=(r=this.shelves[a]).h,!(t>r.free)){if(e===r.h)return this.allocShelf(a,t,e,n);e>r.h||e<r.h&&(o=(r.h-e)*t)<h.waste&&(h.freebin=-1,h.waste=o,h.shelf=a)}return-1!==h.freebin?this.allocFreebin(h.freebin,t,e,n):-1!==h.shelf?this.allocShelf(h.shelf,t,e,n):e<=this.h-p&&t<=this.w?(r=new f(p,this.w,e),this.allocShelf(this.shelves.push(r)-1,t,e,n)):this.autoResize?(s=l=this.h,((u=c=this.w)<=s||u<t)&&(c=2*Math.max(t,u)),(s<u||s<e)&&(l=2*Math.max(e,s)),this.resize(c,l),this.packOne(t,e,n)):null},t.prototype.allocFreebin=function(t,e,n,i){var r=this.freebins.splice(t,1)[0];return r.id=i,r.w=e,r.h=n,r.refcount=0,this.bins[i]=r,this.ref(r),r},t.prototype.allocShelf=function(t,e,n,i){var r=this.shelves[t].alloc(e,n,i);return this.bins[i]=r,this.ref(r),r},t.prototype.shrink=function(){if(0<this.shelves.length){for(var t=0,e=0,n=0;n<this.shelves.length;n++){var i=this.shelves[n];e+=i.h,t=Math.max(i.w-i.free,t)}this.resize(t,e)}},t.prototype.getBin=function(t){return this.bins[t]},t.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},t.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},t.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var n=0;n<this.shelves.length;n++)this.shelves[n].resize(t);return!0},f.prototype.alloc=function(t,e,n){if(t>this.free||e>this.h)return null;var i=this.x;return this.x+=t,this.free-=t,new r(n,i,this.y,t,e,t,this.h)},f.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t},t.exports=n()}),Ts={tl:{configurable:!0},br:{configurable:!0},displaySize:{configurable:!0}};Ts.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Ts.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Ts.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Es.prototype,Ts);function As(t){var e=new ro({width:0,height:0}),n={},i=new Ss(0,0,{autoResize:!0});for(var r in t){var o=t[r],a=i.packOne(o.data.width+2,o.data.height+2);e.resize({width:i.w,height:i.h}),ro.copy(o.data,e,{x:0,y:0},{x:a.x+1,y:a.y+1},o.data),n[r]=new Es(a,o)}i.shrink(),e.resize({width:i.w,height:i.h}),this.image=e,this.positions=n}En("ImagePosition",Es),En("ImageAtlas",As);var zs=function(t,e,n,i,r){var o,a,s=8*r-i-1,l=(1<<s)-1,u=l>>1,c=-7,h=n?r-1:0,p=n?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;0<c;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;0<c;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),o-=u}return(f?-1:1)*a*Math.pow(2,o-i)},Is=function(t,e,n,i,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,d=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),2<=(e+=1<=a+h?p/l:p*Math.pow(2,1-h))*l&&(a++,l/=2),c<=a+h?(s=0,a=c):1<=a+h?(s=(e*l-1)*Math.pow(2,r),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),a=0));8<=r;t[n+f]=255&s,f+=d,s/=256,r-=8);for(a=a<<r|s,u+=r;0<u;t[n+f]=255&a,f+=d,a/=256,u-=8);t[n+f-d]|=128*m},ks=Ms;function Ms(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ms.Varint=0,Ms.Fixed64=1,Ms.Bytes=2,Ms.Fixed32=5;var Cs=4294967296,Ps=1/Cs;function Ls(t){return t.type===Ms.Bytes?t.readVarint()+t.pos:t.pos+1}function Ds(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Rs(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;t<=r;r--)n.buf[r+i]=n.buf[r]}function Bs(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Os(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Fs(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Vs(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Ns(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function js(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Gs(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function Us(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Ws(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function $s(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function qs(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Zs(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Ms.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,t(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=$s(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Zs(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=$s(this.buf,this.pos)+$s(this.buf,this.pos+4)*Cs;return this.pos+=8,t},readSFixed64:function(){var t=$s(this.buf,this.pos)+Zs(this.buf,this.pos+4)*Cs;return this.pos+=8,t},readFloat:function(){var t=zs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=zs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,o=n.buf;if(r=o[n.pos++],i=(112&r)>>4,r<128)return Ds(t,i,e);if(r=o[n.pos++],i|=(127&r)<<3,r<128)return Ds(t,i,e);if(r=o[n.pos++],i|=(127&r)<<10,r<128)return Ds(t,i,e);if(r=o[n.pos++],i|=(127&r)<<17,r<128)return Ds(t,i,e);if(r=o[n.pos++],i|=(127&r)<<24,r<128)return Ds(t,i,e);if(r=o[n.pos++],i|=(1&r)<<31,r<128)return Ds(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,n){var i="",r=e;for(;r<n;){var o,a,s,l=t[r],u=null,c=239<l?4:223<l?3:191<l?2:1;if(n<r+c)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[r+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(o=t[r+1],a=t[r+2],128==(192&o)&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||55296<=u&&u<=57343)&&(u=null)):4===c&&(o=t[r+1],a=t[r+2],s=t[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||1114112<=u)&&(u=null)),null===u?(u=65533,c=1):65535<u&&(u-=65536,i+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),i+=String.fromCharCode(u),r+=c}return i}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var n=Ls(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=Ls(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=Ls(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=Ls(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=Ls(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=Ls(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=Ls(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=Ls(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=Ls(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ms.Varint)for(;127<this.buf[this.pos++];);else e===Ms.Bytes?this.pos=this.readVarint()+this.pos:e===Ms.Fixed32?this.pos+=4:e===Ms.Fixed64&&(this.pos+=8)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),qs(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),qs(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),qs(this.buf,-1&t,this.pos),qs(this.buf,Math.floor(t*Ps),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),qs(this.buf,-1&t,this.pos),qs(this.buf,Math.floor(t*Ps),this.pos+4),this.pos+=8},writeVarint:function(t){268435455<(t=+t||0)||t<0?function(t,e){var n,i;0<=t?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:i=i+1|(n=0));if(0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;if(e.buf[e.pos++]|=n|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,o=0;o<e.length;o++){if(55295<(i=e.charCodeAt(o))&&i<57344){if(!r){56319<i||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;128<=n&&Rs(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Is(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Is(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;128<=i&&Rs(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,Ms.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){this.writeMessage(t,Bs,e)},writePackedSVarint:function(t,e){this.writeMessage(t,Os,e)},writePackedBoolean:function(t,e){this.writeMessage(t,Ns,e)},writePackedFloat:function(t,e){this.writeMessage(t,Fs,e)},writePackedDouble:function(t,e){this.writeMessage(t,Vs,e)},writePackedFixed32:function(t,e){this.writeMessage(t,js,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,Gs,e)},writePackedFixed64:function(t,e){this.writeMessage(t,Us,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,Ws,e)},writeBytesField:function(t,e){this.writeTag(t,Ms.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ms.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ms.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ms.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ms.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ms.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ms.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ms.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ms.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ms.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Xs=3;function Hs(t,e,n){1===t&&n.readMessage(Ks,e)}function Ks(t,e,n){if(3===t){var i=n.readMessage(Ys,{}),r=i.id,o=i.bitmap,a=i.width,s=i.height,l=i.left,u=i.top,c=i.advance;e.push({id:r,bitmap:new io({width:a+2*Xs,height:s+2*Xs},o),metrics:{width:a,height:s,left:l,top:u,advance:c}})}}function Ys(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function Js(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.callbackID=0,p(["receive"],this),this.target.addEventListener("message",this.receive,!1)}var Qs=Xs;Js.prototype.send=function(t,e,n,i){var r=n?this.mapId+":"+this.callbackID++:null;n&&(this.callbacks[r]=n);var o=[];this.target.postMessage({targetMapId:i,sourceMapId:this.mapId,type:t,id:String(r),data:Tn(e,o)},o)},Js.prototype.receive=function(t){var e,i=this,n=t.data,r=n.id;if(!n.targetMapId||this.mapId===n.targetMapId){var o=function(t,e){var n=[];i.target.postMessage({sourceMapId:i.mapId,type:"<response>",id:String(r),error:t?Tn(t):null,data:Tn(e,n)},n)};if("<response>"===n.type)e=this.callbacks[n.id],delete this.callbacks[n.id],e&&n.error?e(An(n.error)):e&&e(null,An(n.data));else if(void 0!==n.id&&this.parent[n.type])this.parent[n.type](n.sourceMapId,An(n.data),o);else if(void 0!==n.id&&this.parent.getWorkerSource){var a=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,a[0],a[1])[a[2]](An(n.data),o)}else this.parent[n.type](An(n.data))}},Js.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)};function tl(t,e,n){L(0<=t&&t<=25),L(0<=e&&e<Math.pow(2,t)),L(0<=n&&n<Math.pow(2,t)),this.z=t,this.x=e,this.y=n,this.key=rl(0,t,e,n)}var el=e(n(function(t,e){(function(t){function a(t,e,n){var i=o(256*t,256*(e=Math.pow(2,n)-e-1),n),r=o(256*(t+1),256*(e+1),n);return i[0]+","+i[1]+","+r[0]+","+r[1]}function o(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}t.getURL=function(t,e,n,i,r,o){return o=o||{},t+"?"+["bbox="+a(n,i,r),"format="+(o.format||"image/png"),"service="+(o.service||"WMS"),"version="+(o.version||"1.1.1"),"request="+(o.request||"GetMap"),"srs="+(o.srs||"EPSG:3857"),"width="+(o.width||256),"height="+(o.height||256),"layers="+e].join("&")},t.getTileBBox=a,t.getMercCoords=o,Object.defineProperty(t,"__esModule",{value:!0})})(e)}));tl.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},tl.prototype.url=function(t,e){var n=el.getTileBBox(this.x,this.y,this.z),i=function(t,e,n){for(var i,r="",o=t;0<o;o--)r+=(e&(i=1<<o-1)?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",n)};function nl(t,e){this.wrap=t,this.canonical=e,this.key=rl(t,e.z,e.x,e.y)}function il(t,e,n,i,r){L(n<=t),this.overscaledZ=t,this.wrap=e,this.canonical=new tl(n,+i,+r),this.key=rl(e,t,i,r)}function rl(t,e,n,i){(t*=2)<0&&(t=-1*t-1);var r=1<<e;return 32*(r*r*t+r*i+n)+e}il.prototype.scaledTo=function(t){L(t<=this.overscaledZ);var e=this.canonical.z-t;return t>this.canonical.z?new il(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new il(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},il.prototype.isChildOf=function(t){var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},il.prototype.children=function(t){if(this.overscaledZ>=t)return[new il(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new il(e,this.wrap,e,n,i),new il(e,this.wrap,e,1+n,i),new il(e,this.wrap,e,n,1+i),new il(e,this.wrap,e,1+n,1+i)]},il.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},il.prototype.wrapped=function(){return new il(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},il.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},il.prototype.toUnwrapped=function(){return new nl(this.wrap,this.canonical)},il.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},il.prototype.toCoordinate=function(){return new c(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)},En("CanonicalTileID",tl),En("OverscaledTileID",il,{omit:["posMatrix"]});function ol(t,e,n){if(t<=0)throw new RangeError("Level must have positive dimension");this.dim=t,this.border=e,this.stride=this.dim+2*this.border,this.data=n||new Int32Array((this.dim+2*this.border)*(this.dim+2*this.border))}ol.prototype.set=function(t,e,n){this.data[this._idx(t,e)]=n+65536},ol.prototype.get=function(t,e){return this.data[this._idx(t,e)]-65536},ol.prototype._idx=function(t,e){if(t<-this.border||t>=this.dim+this.border||e<-this.border||e>=this.dim+this.border)throw new RangeError("out of range source coordinates for DEM data");return(e+this.border)*this.stride+(t+this.border)},En("Level",ol);function al(t,e,n){this.uid=t,this.scale=e||1,this.level=n||new ol(256,512),this.loaded=!!n}al.prototype.loadFromImage=function(t,e){if(t.height!==t.width)throw new RangeError("DEM tiles must be square");if(e&&"emapgo"!==e&&"terrarium"!==e)return b('"'+e+'" is not a valid encoding type. Valid types include "emapgo" and "terrarium".');var n=this.level=new ol(t.width,t.width/2),i=t.data;this._unpackData(n,i,e||"emapgo");for(var r=0;r<n.dim;r++)n.set(-1,r,n.get(0,r)),n.set(n.dim,r,n.get(n.dim-1,r)),n.set(r,-1,n.get(r,0)),n.set(r,n.dim,n.get(r,n.dim-1));n.set(-1,-1,n.get(0,0)),n.set(n.dim,-1,n.get(n.dim-1,0)),n.set(-1,n.dim,n.get(0,n.dim-1)),n.set(n.dim,n.dim,n.get(n.dim-1,n.dim-1)),this.loaded=!0},al.prototype._unpackEmapgo=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},al.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},al.prototype._unpackData=function(t,e,n){for(var i={emapgo:this._unpackEmapgo,terrarium:this._unpackTerrarium}[n],r=0;r<t.dim;r++)for(var o=0;o<t.dim;o++){var a=4*(r*t.dim+o);t.set(o,r,this.scale*i(e[a],e[1+a],e[2+a]))}},al.prototype.getPixels=function(){return new ro({width:this.level.dim+2*this.level.border,height:this.level.dim+2*this.level.border},new Uint8Array(this.level.data.buffer))},al.prototype.backfillBorder=function(t,e,n){var i=this.level,r=t.level;if(i.dim!==r.dim)throw new Error("level mismatch (dem dimension)");var o=e*i.dim,a=e*i.dim+i.dim,s=n*i.dim,l=n*i.dim+i.dim;switch(e){case-1:o=a-1;break;case 1:a=o+1}switch(n){case-1:s=l-1;break;case 1:l=s+1}for(var u=g(o,-i.border,i.dim+i.border),c=g(a,-i.border,i.dim+i.border),h=g(s,-i.border,i.dim+i.border),p=g(l,-i.border,i.dim+i.border),f=-e*i.dim,d=-n*i.dim,m=h;m<p;m++)for(var y=u;y<c;y++)i.set(y,m,r.get(y+f,m+d))},En("DEMData",al);function sl(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}}sl.prototype.encode=function(t){return L(t in this._stringToNumber),this._stringToNumber[t]},sl.prototype.decode=function(t){return L(t<this._numberToString.length),this._numberToString[t]};function ll(t,e,n,i){this.type="Feature",(this._vectorTileFeature=t)._z=e,t._x=n,t._y=i,this.properties=t.properties,null!=t.id&&(this.id=t.id)}var ul={geometry:{configurable:!0}};ul.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},ul.geometry.set=function(t){this._geometry=t},ll.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(ll.prototype,ul);function cl(t,e,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new vn(Tr,16,0),this.featureIndexArray=n||new fr}function hl(t,e){return e-t}cl.prototype.insert=function(t,e,n,i,r){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);for(var a=0;a<e.length;a++){for(var s=e[a],l=[1/0,1/0,-1/0,-1/0],u=0;u<s.length;u++){var c=s[u];l[0]=Math.min(l[0],c.x),l[1]=Math.min(l[1],c.y),l[2]=Math.max(l[2],c.x),l[3]=Math.max(l[3],c.y)}l[0]<Tr&&l[1]<Tr&&0<=l[2]&&0<=l[3]&&this.grid.insert(o,l[0],l[1],l[2],l[3])}},cl.prototype.query=function(r,o){var a=this;this.vtLayers||(this.vtLayers=new va.VectorTile(new ks(this.rawTileData)).layers,this.sourceLayerCoder=new sl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));for(var s=r.params||{},l=Tr/r.tileSize/r.scale,u=$e(s.filter),c=r.queryGeometry,t=r.queryPadding*l,e=1/0,n=1/0,i=-1/0,h=-1/0,p=0;p<c.length;p++)for(var f=c[p],d=0;d<f.length;d++){var m=f[d];e=Math.min(e,m.x),n=Math.min(n,m.y),i=Math.max(i,m.x),h=Math.max(h,m.y)}var y=this.grid.query(e-t,n-t,i+t,h+t);y.sort(hl);for(var g,v={},_=function(t){var e=y[t];if(e!==g){g=e;var n=a.featureIndexArray.get(e),i=null;a.loadMatchingFeature(v,n.bucketIndex,n.sourceLayerIndex,n.featureIndex,u,s.layers,o,function(t,e){return i=i||Ir(t),e.queryIntersectsFeature(c,t,i,a.z,r.transform,l,r.posMatrix)})}},x=0;x<y.length;x++)_(x);return v},cl.prototype.loadMatchingFeature=function(t,e,n,i,r,o,a,s){var l=this.bucketLayerIDs[e];if(!o||function(t,e){for(var n=0;n<t.length;n++)if(0<=e.indexOf(t[n]))return!0;return!1}(o,l)){var u=this.sourceLayerCoder.decode(n),c=this.vtLayers[u].feature(i);if(r({zoom:this.tileID.overscaledZ},c))for(var h=0;h<l.length;h++){var p=l[h];if(!(o&&o.indexOf(p)<0)){var f=a[p];if(f&&(!s||s(c,f))){var d=new ll(c,this.z,this.x,this.y);d.layer=f.serialize();var m=t[p];void 0===m&&(m=t[p]=[]),m.push({featureIndex:i,feature:d})}}}}},cl.prototype.lookupSymbolFeatures=function(t,e,n,i,r,o){var a={};this.vtLayers||(this.vtLayers=new va.VectorTile(new ks(this.rawTileData)).layers,this.sourceLayerCoder=new sl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));for(var s=$e(i),l=0,u=t;l<u.length;l+=1){var c=u[l];this.loadMatchingFeature(a,e,n,c,s,r,o)}return a},cl.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var i=0,r=n[e];i<r.length;i+=1){if(t===r[i])return!0}return!1},En("FeatureIndex",cl,{omit:["rawTileData","sourceLayerCoder"]});var pl={horizontal:1,vertical:2,horizontalOnly:3};var fl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dl={};function ml(t,e,n,i){var r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function yl(t,e,n,i,r,o){for(var a=null,s=ml(e,n,r,o),l=0,u=i;l<u.length;l+=1){var c=u[l],h=ml(e-c.x,n,r,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function gl(t,e,n,i){if(!n)return[];if(!t)return[];for(var r,o,a,s=[],l=function(t,e,n,i){for(var r=0,o=0;o<t.length;o++){var a=i[t.charCodeAt(o)];a&&(r+=a.metrics.advance+e)}return r/Math.max(1,Math.ceil(r/n))}(t,e,n,i),u=0,c=0;c<t.length;c++){var h=t.charCodeAt(c),p=i[h];p&&!fl[h]&&(u+=p.metrics.advance+e),c<t.length-1&&(dl[h]||Ha(h))&&s.push(yl(c+1,u,l,s,(r=h,o=t.charCodeAt(c+1),a=void 0,a=0,10===r&&(a-=1e4),40!==r&&65288!==r||(a+=50),41!==o&&65289!==o||(a+=50),a),!1))}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(yl(t.length,u,l,s,0,!0))}function vl(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function _l(t,e,n,i,r){if(r){var o=e[t[i].glyph];if(o)for(var a=o.metrics.advance,s=(t[i].x+a)*r,l=n;l<=i;l++)t[l].x-=s}}dl[10]=!0,dl[32]=!0,dl[38]=!0,dl[40]=!0,dl[41]=!0,dl[43]=!0,dl[45]=!0,dl[47]=!0,dl[173]=!0,dl[183]=!0,dl[8203]=!0,dl[8208]=!0,dl[8211]=!0,dl[8231]=!0,t.commonjsGlobal=z,t.commonjsRequire=function(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")},t.unwrapExports=e,t.createCommonjsModule=n,t.default=self,t.default$1=m,t.default$2=L,t.getJSON=function(e,n){var i=M(e);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){n(new Error(i.statusText))},i.onload=function(){if(200<=i.status&&i.status<300&&i.response){var t;try{t=JSON.parse(i.response)}catch(t){return n(t)}n(null,t)}else 401===i.status&&e.url.match(/webportal.com/)?n(new A(i.statusText+": you may have provided an invalid emapgo access token. See emapgo-webportal",i.status,e.url)):n(new A(i.statusText,i.status,e.url))},i.send(),i},t.getImage=function(t,o){return C(t,function(t,e){if(t)o(t);else if(e){var n=new self.Image,i=self.URL||self.webkitURL;n.onload=function(){o(null,n),i.revokeObjectURL(n.src)};var r=new self.Blob([new Uint8Array(e.data)],{type:"image/png"});n.cacheControl=e.cacheControl,n.expires=e.expires,n.src=e.data.byteLength?i.createObjectURL(r):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}})},t.ResourceType=S,t.RGBAImage=ro,t.default$3=Ss,t.ImagePosition=Es,t.getArrayBuffer=C,t.default$4=function(t){return new ks(t).readFields(Hs,[])},t.default$5=qa,t.asyncAll=function(t,e,i){if(!t.length)return i(null,[]);var r=t.length,o=new Array(t.length),a=null;t.forEach(function(t,n){e(t,function(t,e){t&&(a=t),o[n]=e,0==--r&&i(a,o)})})},t.AlphaImage=io,t.default$6=N,t.endsWith=f,t.extend=l,t.sphericalToCartesian=function(t){var e=t[0],n=t[1],i=t[2];return n+=90,n*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(i),y:e*Math.sin(n)*Math.sin(i),z:e*Math.cos(i)}},t.Evented=V,t.validateStyle=fn,t.validateLight=dn,t.emitValidationErrors=gn,t.default$7=ut,t.number=Ct,t.Properties=Vn,t.Transitionable=kn,t.Transitioning=Cn,t.PossiblyEvaluated=Dn,t.DataConstantProperty=Rn,t.warnOnce=b,t.uniqueId=function(){return u++},t.default$8=Js,t.pick=function(t,e){for(var n={},i=0;i<e.length;i++){var r=e[i];r in t&&(n[r]=t[r])}return n},t.wrap=function(t,e,n){var i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r},t.clamp=g,t.Event=R,t.ErrorEvent=O,t.OverscaledTileID=il,t.default$9=Tr,t.createLayout=Zn,t.getCoordinatesCenter=function(t){for(var e=1/0,n=1/0,i=-1/0,r=-1/0,o=0;o<t.length;o++)e=Math.min(e,t[o].column),n=Math.min(n,t[o].row),i=Math.max(i,t[o].column),r=Math.max(r,t[o].row);var a=i-e,s=r-n,l=Math.max(a,s),u=Math.max(0,Math.floor(-Math.log(l)/Math.LN2));return new c((e+i)/2,(n+r)/2,0).zoomTo(u)},t.CanonicalTileID=tl,t.RasterBoundsArray=Qn,t.getVideo=function(t,e){var n,i,r=self.document.createElement("video");r.onloadstart=function(){e(null,r)};for(var o=0;o<t.length;o++){var a=self.document.createElement("source");n=t[o],i=void 0,(i=self.document.createElement("a")).href=n,i.protocol===self.document.location.protocol&&i.host===self.document.location.host||(r.crossOrigin="Anonymous"),a.src=t[o],r.appendChild(a)}return r},t.default$10=j,t.bindAll=p,t.default$11=function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(var i=0;i<e.length;i++)if(!t(e[i],n[i]))return!1;return!0}if("object"!=typeof e||null===e||null===n)return e===n;if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var r in e)if(!t(e[r],n[r]))return!1;return!0},t.parseCacheControl=function(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,e,n,i){var r=n||i;return o[e]=!r||r.toLowerCase(),""}),o["max-age"]){var e=parseInt(o["max-age"],10);isNaN(e)?delete o["max-age"]:o["max-age"]=e}return o},t.default$12=cl,t.default$13=va,t.default$14=ks,t.default$15=ll,t.default$16=$e,t.default$17=us,t.CollisionBoxArray=Yi,t.default$18=mr,t.TriangleIndexArray=Fi,t.default$19=c,t.keysDifference=function(t,e){var n=[];for(var i in t)i in e||n.push(i);return n},t.default$20=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.mat4=Zr,t.vec4=qr,t.getSizeData=ns,t.evaluateSizeForFeature=function(t,e,n){var i=e;return"source"===t.functionType?n.lowerSize/10:"composite"===t.functionType?Ct(n.lowerSize/10,n.upperSize/10,i.uSizeT):i.uSize},t.evaluateSizeForZoom=function(t,e,n){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var i=t.propertyValue,r=t.zoomRange,o=t.sizeRange,a=g(Be(i,n.specification).interpolationFactor(e,r.min,r.max),0,1);return{uSizeT:0,uSize:o.min+a*(o.max-o.min)}}var s=t.propertyValue,l=t.zoomRange;return{uSizeT:g(Be(s,n.specification).interpolationFactor(e,l.min,l.max),0,1),uSize:0}},t.addDynamicAttributes=as,t.default$21=ps,t.WritingMode=pl,t.multiPolygonIntersectsBufferedPoint=Cr,t.multiPolygonIntersectsBufferedMultiPoint=function(t,e,n){for(var i=0;i<e.length;i++)for(var r=e[i],o=0;o<r.length;o++)if(Cr(t,r[o],n))return!0;return!1},t.multiPolygonIntersectsMultiPolygon=Pr,t.multiPolygonIntersectsBufferedMultiLine=Lr,t.polygonIntersectsPolygon=function(t,e){for(var n=0;n<t.length;n++)if(Vr(e,t[n]))return!0;for(var i=0;i<e.length;i++)if(Vr(t,e[i]))return!0;return!!Rr(t,e)},t.distToSegmentSquared=Or,t.default$22=$r,t.default$23=Gn,t.default$24=function(t){return new ws[t.type](t)},t.clone=v,t.filterObject=y,t.mapObject=d,t.registerForPluginAvailability=function(t){return Ua?t({pluginURL:Ua,errorCallback:Ba}):Wa.once("pluginAvailable",t),t},t.evented=Wa,t.default$25=Ta,t.default$26=Er,t.PosArray=Kn,t.UnwrappedTileID=nl,t.ease=s,t.bezier=o,t.default$27=Ia,t.setRTLTextPlugin=function(t,e){if(Ga)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ga=!0,Ua=t,Wa.fire(new R("pluginAvailable",{pluginURL:Ua,errorCallback:e})),Ba=e},t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.default$28=ts,t.register=En,t.GLYPH_PBF_BORDER=Qs,t.shapeText=function(t,e,n,i,r,o,a,s,l,u){var c=t.trim();u===pl.vertical&&(c=function(t){for(var e="",n=0;n<t.length;n++){var i=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;(!i||!Ya(i)||Ja[t[n+1]])&&(!r||!Ya(r)||Ja[t[n-1]])&&Ja[t[n]]?e+=Ja[t[n]]:e+=t[n]}return e}(c));var h=[],p={positionedGlyphs:h,text:c,top:s[1],bottom:s[1],left:s[0],right:s[0],writingMode:u},f=$a.processBidirectionalText;return function(t,e,n,i,r,o,a,s,l){for(var u=0,c=-17,h=0,p=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,d=0,m=n;d<m.length;d+=1){var y=m[d];if((y=y.trim()).length){for(var g=p.length,v=0;v<y.length;v++){var _=y.charCodeAt(v),x=e[_];x&&(Ka(_)&&a!==pl.horizontal?(p.push({glyph:_,x:u,y:0,vertical:!0}),u+=l+s):(p.push({glyph:_,x:u,y:c,vertical:!1}),u+=x.metrics.advance+s))}if(p.length!==g){var b=u-s;h=Math.max(b,h),_l(p,e,g,p.length-1,f)}u=0,c+=i}else c+=i}var w=vl(r),E=w.horizontalAlign,S=w.verticalAlign;!function(t,e,n,i,r,o,a){for(var s=(e-n)*r,l=(-i*a+.5)*o,u=0;u<t.length;u++)t[u].x+=s,t[u].y+=l}(p,f,E,S,h,i,n.length);var T=n.length*i;t.top+=-S*T,t.bottom=t.top+T,t.left+=-E*h,t.right=t.left+h}(p,e,f?f(c,gl(c,a,n,e)):function(t,e){for(var n=[],i=0,r=0,o=e;r<o.length;r+=1){var a=o[r];n.push(t.substring(i,a)),i=a}return i<t.length&&n.push(t.substring(i,t.length)),n}(c,gl(c,a,n,e)),i,r,o,u,a,l),!!h.length&&p},t.shapeIcon=function(t,e,n){var i=vl(n),r=i.horizontalAlign,o=i.verticalAlign,a=e[0],s=e[1],l=a-t.displaySize[0]*r,u=l+t.displaySize[0],c=s-t.displaySize[1]*o;return{image:t,top:c,bottom:c+t.displaySize[1],left:l,right:u}},t.allowsVerticalWritingMode=Za,t.allowsLetterSpacing=function(t){for(var e=0,n=t;e<n.length;e+=1){if(!Xa(n[e].charCodeAt(0)))return!1}return!0},t.default$29=qo,t.default$30=sl,t.default$31=As,t.default$32=al,t.__moduleExports=va,t.default$33=m,t.__moduleExports$1=ks,t.plugin=$a}),t(0,function(U){function l(t){var e=typeof t;if("number"==e||"boolean"==e||"string"==e||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var n="[",i=0,r=t;i<r.length;i+=1){n+=l(r[i])+","}return n+"]"}for(var o=Object.keys(t).sort(),a="{",s=0;s<o.length;s++)a+=JSON.stringify(o[s])+":"+l(t[o[s]])+",";return a+"}"}function v(t){for(var e="",n=0,i=U.default$20;n<i.length;n+=1){e+="/"+l(t[i[n]])}return e}function n(t){t&&this.replace(t)}function T(t,e,n,i,r){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;-n/2<s;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<n/2;){var c=t[a-1],h=t[a],p=t[a+1];if(!p)return!1;var f=c.angleTo(h)-h.angleTo(p);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:f}),u+=f;s-l[0].distance>i;)u-=l.shift().angleDelta;if(r<u)return!1;a++,s+=h.dist(p)}return!0}function W(t,e,n,i,r,o,a,s,l){var u=i?.6*o*a:0,c=Math.max(i?i.right-i.left:0,r?r.right-r.left:0),h=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-c*a<e/4&&(e=c*a+e/4),function t(e,n,i,r,o,a,s,l,u){var c=a/2;var h=0;for(var p=0;p<e.length-1;p++)h+=e[p].dist(e[p+1]);var f=0,d=n-i;var m=[];for(var y=0;y<e.length-1;y++){for(var g=e[y],v=e[y+1],_=g.dist(v),x=v.angleTo(g);d+i<f+_;){var b=((d+=i)-f)/_,w=U.number(g.x,v.x,b),E=U.number(g.y,v.y,b);if(0<=w&&w<u&&0<=E&&E<u&&0<=d-c&&d+c<=h){var S=new U.default$28(w,E,x,y);S._round(),r&&!T(e,S,a,r,o)||m.push(S)}}f+=_}l||m.length||s||(m=t(e,f/2,i,r,o,a,s,!0,u));return m}(t,h?e/2*s%e:(c/2+2*o)*a*s%e,e,u,n,c*a,h,!1,l)}n.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},n.prototype.update=function(t,e){for(var n=this,i=0,r=t;i<r.length;i+=1){var o=r[i];n._layerConfigs[o.id]=o;var a=n._layers[o.id]=U.default$24(o);a._featureFilter=U.default$16(a.filter)}for(var s=0,l=e;s<l.length;s+=1){var u=l[s];delete n._layerConfigs[u],delete n._layers[u]}this.familiesBySource={};for(var c=0,h=function(t){for(var e={},n=0;n<t.length;n++){var i=v(t[n]),r=e[i];(r=r||(e[i]=[])).push(t[n])}var o=[];for(var a in e)o.push(e[a]);return o}(U.values(this._layerConfigs));c<h.length;c+=1){var p=h[c].map(function(t){return n._layers[t.id]}),f=p[0];if("none"!==f.visibility){var d=f.source||"",m=n.familiesBySource[d];m=m||(n.familiesBySource[d]={});var y=f.sourceLayer||"_geojsonTileLayer",g=m[y];(g=g||(m[y]=[])).push(p)}}};var $=function(){this.opacity=0,this.targetOpacity=0,this.time=0};$.prototype.clone=function(){var t=new $;return t.opacity=this.opacity,t.targetOpacity=this.targetOpacity,t.time=this.time,t},U.register("OpacityState",$);var q=function(t,e,n,i,r,o,a,s,l,u,c){var h=a.top*s-l,p=a.bottom*s+l,f=a.left*s-l,d=a.right*s+l;if(this.boxStartIndex=t.length,u){var m=p-h,y=d-f;0<m&&(m=Math.max(10*s,m),this._addLineCollisionCircles(t,e,n,n.segment,y,m,i,r,o,c))}else t.emplaceBack(n.x,n.y,f,h,d,p,i,r,o,0,0);this.boxEndIndex=t.length};q.prototype._addLineCollisionCircles=function(t,e,n,i,r,o,a,s,l,u){var c=o/2,h=Math.floor(r/c),p=1+.4*Math.log(u)/Math.LN2,f=Math.floor(h*p/2),d=-o/2,m=n,y=i+1,g=d,v=-r/2,_=v-r/4;do{if(--y<0){if(v<g)return;y=0;break}g-=e[y].dist(m),m=e[y]}while(_<g);for(var x=e[y].dist(e[y+1]),b=-f;b<h+f;b++){var w=b*c,E=v+w;if(w<0&&(E+=w),r<w&&(E+=w-r),!(E<g)){for(;g+x<E;){if(g+=x,++y+1>=e.length)return;x=e[y].dist(e[y+1])}var S=E-g,T=e[y],A=e[y+1].sub(T)._unit()._mult(S)._add(T)._round(),z=Math.abs(E-d)<c?0:.8*(E-d);t.emplaceBack(A.x,A.y,-o/2,-o/2,o/2,o/2,a,s,l,o/2,z)}}};var x=i,t=i;function i(t,e){if(!(this instanceof i))return new i(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||r,0<this.length)for(var n=(this.length>>1)-1;0<=n;n--)this._down(n)}function r(t,e){return t<e?-1:e<t?1:0}function Z(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var i=1/0,r=1/0,o=-1/0,a=-1/0,s=t[0],l=0;l<s.length;l++){var u=s[l];(!l||u.x<i)&&(i=u.x),(!l||u.y<r)&&(r=u.y),(!l||u.x>o)&&(o=u.x),(!l||u.y>a)&&(a=u.y)}var c=o-i,h=a-r,p=Math.min(c,h),f=p/2,d=new x(null,b);if(0===p)return new U.default$1(i,r);for(var m=i;m<o;m+=p)for(var y=r;y<a;y+=p)d.push(new w(m+f,y+f,f,t));for(var g=function(t){for(var e=0,n=0,i=0,r=t[0],o=0,a=r.length,s=a-1;o<a;s=o++){var l=r[o],u=r[s],c=l.x*u.y-u.x*l.y;n+=(l.x+u.x)*c,i+=(l.y+u.y)*c,e+=3*c}return new w(n/e,i/e,0,t)}(t),v=d.length;d.length;){var _=d.pop();(_.d>g.d||!g.d)&&(g=_,n&&console.log("found best %d after %d probes",Math.round(1e4*_.d)/1e4,v)),_.max-g.d<=e||(f=_.h/2,d.push(new w(_.p.x-f,_.p.y-f,f,t)),d.push(new w(_.p.x+f,_.p.y-f,f,t)),d.push(new w(_.p.x-f,_.p.y+f,f,t)),d.push(new w(_.p.x+f,_.p.y+f,f,t)),v+=4)}return n&&(console.log("num probes: "+v),console.log("best distance: "+g.d)),g.p}function b(t,e){return e.max-t.max}function w(t,e,n,i){this.p=new U.default$1(t,e),this.h=n,this.d=function(t,e){for(var n=!1,i=1/0,r=0;r<e.length;r++)for(var o=e[r],a=0,s=o.length,l=s-1;a<s;l=a++){var u=o[a],c=o[l];u.y>t.y!=c.y>t.y&&t.x<(c.x-u.x)*(t.y-u.y)/(c.y-u.y)+u.x&&(n=!n),i=Math.min(i,U.distToSegmentSquared(t,u,c))}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}function A(t,e,n,i,r,o){t.createArrays(),t.symbolInstances=[];var a=512*t.overscaling;t.tilePixelRatio=U.default$9/a,t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,l=t.layers[0]._unevaluatedLayout._values,u={};if("composite"===t.textSizeData.functionType){var c=t.textSizeData.zoomRange,h=c.min,p=c.max;u.compositeTextSizes=[l["text-size"].possiblyEvaluate(new U.default$27(h)),l["text-size"].possiblyEvaluate(new U.default$27(p))]}if("composite"===t.iconSizeData.functionType){var f=t.iconSizeData.zoomRange,d=f.min,m=f.max;u.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new U.default$27(d)),l["icon-size"].possiblyEvaluate(new U.default$27(m))]}u.layoutTextSize=l["text-size"].possiblyEvaluate(new U.default$27(t.zoom+1)),u.layoutIconSize=l["icon-size"].possiblyEvaluate(new U.default$27(t.zoom+1)),u.textMaxSize=l["text-size"].possiblyEvaluate(new U.default$27(18));for(var y=24*s.get("text-line-height"),g="map"===s.get("text-rotation-alignment")&&"line"===s.get("symbol-placement"),v=s.get("text-keep-upright"),_=0,x=t.features;_<x.length;_+=1){var b=x[_],w=s.get("text-font").evaluate(b).join(","),E=e[w]||{},S=n[w]||{},T={},A=b.text;if(A){var z=s.get("text-offset").evaluate(b).map(function(t){return 24*t}),I=24*s.get("text-letter-spacing").evaluate(b),k=U.allowsLetterSpacing(A)?I:0,M=s.get("text-anchor").evaluate(b),C=s.get("text-justify").evaluate(b),P="line"!==s.get("symbol-placement")?24*s.get("text-max-width").evaluate(b):0;T.horizontal=U.shapeText(A,E,P,y,M,C,k,z,24,U.WritingMode.horizontal),U.allowsVerticalWritingMode(A)&&g&&v&&(T.vertical=U.shapeText(A,E,P,y,M,C,k,z,24,U.WritingMode.vertical))}var L=void 0;if(b.icon){var D=i[b.icon];D&&(L=U.shapeIcon(r[b.icon],s.get("icon-offset").evaluate(b),s.get("icon-anchor").evaluate(b)),void 0===t.sdfIcons?t.sdfIcons=D.sdf:t.sdfIcons!==D.sdf&&U.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),D.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==s.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}(T.horizontal||L)&&R(t,b,T,L,S,u)}o&&t.generateCollisionDebugBuffers()}function R(n,i,r,o,a,s){var t=s.layoutTextSize.evaluate(i),e=s.layoutIconSize.evaluate(i),l=s.textMaxSize.evaluate(i);void 0===l&&(l=t);function u(t,e){e.x<0||e.x>=U.default$9||e.y<0||e.y>=U.default$9||n.symbolInstances.push(function(t,e,n,i,r,o,a,s,l,u,c,h,p,f,d,m,y,g,v,_,x,b){var w,E,S=t.addToLineVertexArray(e,n),T=0,A=0,z=0,I=i.horizontal?i.horizontal.text:"",k=[];i.horizontal&&(w=new q(a,n,e,s,l,u,i.horizontal,c,h,p,t.overscaling),A+=X(t,e,i.horizontal,o,p,v,_,f,S,i.vertical?U.WritingMode.horizontal:U.WritingMode.horizontalOnly,k,x,b),i.vertical&&(z+=X(t,e,i.vertical,o,p,v,_,f,S,U.WritingMode.vertical,k,x,b)));var M=w?w.boxStartIndex:t.collisionBoxArray.length,C=w?w.boxEndIndex:t.collisionBoxArray.length;if(r){var P=function(t,e,n,i,r,o,a){var s,l,u,c,h=e.image,p=n.layout,f=e.top-1/h.pixelRatio,d=e.left-1/h.pixelRatio,m=e.bottom+1/h.pixelRatio,y=e.right+1/h.pixelRatio;if("none"!==p.get("icon-text-fit")&&r){var g=y-d,v=m-f,_=p.get("text-size").evaluate(a)/24,x=r.left*_,b=r.right*_,w=r.top*_,E=b-x,S=r.bottom*_-w,T=p.get("icon-text-fit-padding")[0],A=p.get("icon-text-fit-padding")[1],z=p.get("icon-text-fit-padding")[2],I=p.get("icon-text-fit-padding")[3],k="width"===p.get("icon-text-fit")?.5*(S-v):0,M="height"===p.get("icon-text-fit")?.5*(E-g):0,C="width"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?E:g,P="height"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?S:v;s=new U.default$1(x+M-I,w+k-T),l=new U.default$1(x+M+A+C,w+k-T),u=new U.default$1(x+M+A+C,w+k+z+P),c=new U.default$1(x+M-I,w+k+z+P)}else s=new U.default$1(d,f),l=new U.default$1(y,f),u=new U.default$1(y,m),c=new U.default$1(d,m);var L=n.layout.get("icon-rotate").evaluate(a)*Math.PI/180;if(L){var D=Math.sin(L),R=Math.cos(L),B=[R,-D,D,R];s._matMult(B),l._matMult(B),c._matMult(B),u._matMult(B)}return[{tl:s,tr:l,bl:c,br:u,tex:h.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,r,o,0,i.horizontal,0,_);E=new q(a,n,e,s,l,u,r,d,m,!1,t.overscaling),T=4*P.length;var L=t.iconSizeData,D=null;"source"===L.functionType?D=[10*o.layout.get("icon-size").evaluate(_)]:"composite"===L.functionType&&(D=[10*b.compositeIconSizes[0].evaluate(_),10*b.compositeIconSizes[1].evaluate(_)]),t.addSymbols(t.icon,P,D,g,y,_,!1,e,S.lineStartIndex,S.lineLength)}var R=E?E.boxStartIndex:t.collisionBoxArray.length,B=E?E.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=U.default$17.MAX_GLYPHS&&U.warnOnce("Too many glyphs being rendered in a tile. See emapgo-webportal");var O=new $,F=new $;return{key:I,textBoxStartIndex:M,textBoxEndIndex:C,iconBoxStartIndex:R,iconBoxEndIndex:B,textOffset:f,iconOffset:g,anchor:e,line:n,featureIndex:s,feature:_,numGlyphVertices:A,numVerticalGlyphVertices:z,numIconVertices:T,textOpacityState:O,iconOpacityState:F,isDuplicate:!1,placedTextSymbolIndices:k,crossTileID:0}}(n,e,t,r,o,n.layers[0],n.collisionBoxArray,i.index,i.sourceLayerIndex,n.index,d,v,b,h,y,_,w,p,{zoom:n.zoom},i,a,s))}var c=n.layers[0].layout,h=c.get("text-offset").evaluate(i),p=c.get("icon-offset").evaluate(i),f=t/24,d=n.tilePixelRatio*f,m=n.tilePixelRatio*l/24,y=n.tilePixelRatio*e,g=n.tilePixelRatio*c.get("symbol-spacing"),v=c.get("text-padding")*n.tilePixelRatio,_=c.get("icon-padding")*n.tilePixelRatio,x=c.get("text-max-angle")/180*Math.PI,b="map"===c.get("text-rotation-alignment")&&"line"===c.get("symbol-placement"),w="map"===c.get("icon-rotation-alignment")&&"line"===c.get("symbol-placement"),E=g/2;if("line"===c.get("symbol-placement"))for(var S=0,T=function(t,e,n,i,r){for(var o=[],a=0;a<t.length;a++)for(var s=t[a],l=void 0,u=0;u<s.length-1;u++){var c=s[u],h=s[u+1];c.x<e&&h.x<e||(c.x<e?c=new U.default$1(e,c.y+(h.y-c.y)*((e-c.x)/(h.x-c.x)))._round():h.x<e&&(h=new U.default$1(e,c.y+(h.y-c.y)*((e-c.x)/(h.x-c.x)))._round()),c.y<n&&h.y<n||(c.y<n?c=new U.default$1(c.x+(h.x-c.x)*((n-c.y)/(h.y-c.y)),n)._round():h.y<n&&(h=new U.default$1(c.x+(h.x-c.x)*((n-c.y)/(h.y-c.y)),n)._round()),c.x>=i&&h.x>=i||(c.x>=i?c=new U.default$1(i,c.y+(h.y-c.y)*((i-c.x)/(h.x-c.x)))._round():h.x>=i&&(h=new U.default$1(i,c.y+(h.y-c.y)*((i-c.x)/(h.x-c.x)))._round()),c.y>=r&&h.y>=r||(c.y>=r?c=new U.default$1(c.x+(h.x-c.x)*((r-c.y)/(h.y-c.y)),r)._round():h.y>=r&&(h=new U.default$1(c.x+(h.x-c.x)*((r-c.y)/(h.y-c.y)),r)._round()),l&&c.equals(l[l.length-1])||(l=[c],o.push(l)),l.push(h)))))}return o}(i.geometry,0,0,U.default$9,U.default$9);S<T.length;S+=1)for(var A=T[S],z=0,I=W(A,g,x,r.vertical||r.horizontal,o,24,m,n.overscaling,U.default$9);z<I.length;z+=1){var k=I[z],M=r.horizontal;M&&H(n,M.text,E,k)||u(A,k)}else if("Polygon"===i.type)for(var C=0,P=U.default$29(i.geometry,0);C<P.length;C+=1){var L=P[C],D=Z(L,16);u(L[0],new U.default$28(D.x,D.y,0))}else if("LineString"===i.type)for(var R=0,B=i.geometry;R<B.length;R+=1){var O=B[R];u(O,new U.default$28(O[0].x,O[0].y,0))}else if("Point"===i.type)for(var F=0,V=i.geometry;F<V.length;F+=1)for(var N=0,j=V[F];N<j.length;N+=1){var G=j[N];u([G],new U.default$28(G.x,G.y,0))}}function X(t,e,n,i,r,o,a,s,l,u,c,h,p){var f=function(t,e,n,i,r,o,a){for(var s=n.layout.get("text-rotate").evaluate(o)*Math.PI/180,l=n.layout.get("text-offset").evaluate(o).map(function(t){return 24*t}),u=e.positionedGlyphs,c=[],h=0;h<u.length;h++){var p=u[h],f=a[p.glyph];if(f){var d=f.rect;if(d){var m=U.GLYPH_PBF_BORDER+1,y=f.metrics.advance/2,g=i?[p.x+y,p.y]:[0,0],v=i?[0,0]:[p.x+y+l[0],p.y+l[1]],_=f.metrics.left-m-y+v[0],x=-f.metrics.top-m+v[1],b=_+d.w,w=x+d.h,E=new U.default$1(_,x),S=new U.default$1(b,x),T=new U.default$1(_,w),A=new U.default$1(b,w);if(i&&p.vertical){var z=new U.default$1(-y,y),I=-Math.PI/2,k=new U.default$1(5,0);E._rotateAround(I,z)._add(k),S._rotateAround(I,z)._add(k),T._rotateAround(I,z)._add(k),A._rotateAround(I,z)._add(k)}if(s){var M=Math.sin(s),C=Math.cos(s),P=[C,-M,M,C];E._matMult(P),S._matMult(P),T._matMult(P),A._matMult(P)}c.push({tl:E,tr:S,bl:T,br:A,tex:d,writingMode:e.writingMode,glyphOffset:g})}}}return c}(0,n,i,r,0,a,h),d=t.textSizeData,m=null;return"source"===d.functionType?m=[10*i.layout.get("text-size").evaluate(a)]:"composite"===d.functionType&&(m=[10*p.compositeTextSizes[0].evaluate(a),10*p.compositeTextSizes[1].evaluate(a)]),t.addSymbols(t.text,f,m,s,r,a,u,e,l.lineStartIndex,l.lineLength),c.push(t.text.placedSymbolArray.length-1),4*f.length}function H(t,e,n,i){var r=t.compareText;if(e in r){for(var o=r[e],a=o.length-1;0<=a;a--)if(i.dist(o[a])<n)return!0}else r[e]=[];return r[e].push(i),!1}i.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,i=e[t];0<t;){var r=t-1>>1,o=e[r];if(0<=n(i,o))break;e[t]=o,t=r}e[t]=i},_down:function(t){for(var e=this.data,n=this.compare,i=this.length>>1,r=e[t];t<i;){var o=1+(t<<1),a=o+1,s=e[o];if(a<this.length&&n(e[a],s)<0&&(s=e[o=a]),0<=n(s,r))break;e[t]=s,t=o}e[t]=r}},x.default=t;function z(t){var e=new U.AlphaImage({width:0,height:0}),n={},i=new U.default$3(0,0,{autoResize:!0});for(var r in t){var o=t[r],a=n[r]={};for(var s in o){var l=o[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var u=i.packOne(l.bitmap.width+2,l.bitmap.height+2);e.resize({width:i.w,height:i.h}),U.AlphaImage.copy(l.bitmap,e,{x:0,y:0},{x:u.x+1,y:u.y+1},l.bitmap),a[s]={rect:u,metrics:l.metrics}}}}i.shrink(),e.resize({width:i.w,height:i.h}),this.image=e,this.positions=n}U.register("GlyphAtlas",z);function e(t){this.tileID=new U.OverscaledTileID(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming}function I(t,e){for(var n=new U.default$27(e),i=0,r=t;i<r.length;i+=1){r[i].recalculate(n)}}e.prototype.parse=function(t,e,n,r){var i=this;this.status="parsing",this.data=t,this.collisionBoxArray=new U.CollisionBoxArray;var o=new U.default$30(Object.keys(t.layers).sort()),a=new U.default$12(this.tileID);a.bucketLayerIDs=[];var s,l,u,c={},h={featureIndex:a,iconDependencies:{},glyphDependencies:{}},p=e.familiesBySource[this.source];for(var f in p){var d=t.layers[f];if(d){1===d.version&&U.warnOnce('Vector tile source "'+i.source+'" layer "'+f+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var m=o.encode(f),y=[],g=0;g<d.length;g++){var v=d.feature(g);y.push({feature:v,index:g,sourceLayerIndex:m})}for(var _=0,x=p[f];_<x.length;_+=1){var b=x[_],w=b[0];if(U.default$2(w.source===i.source),!(w.minzoom&&i.zoom<Math.floor(w.minzoom)))if(!(w.maxzoom&&i.zoom>=w.maxzoom))if("none"!==w.visibility)I(b,i.zoom),(c[w.id]=w.createBucket({index:a.bucketLayerIDs.length,layers:b,zoom:i.zoom,pixelRatio:i.pixelRatio,overscaling:i.overscaling,collisionBoxArray:i.collisionBoxArray,sourceLayerIndex:m})).populate(y,h),a.bucketLayerIDs.push(b.map(function(t){return t.id}))}}}var E=U.mapObject(h.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(E).length?n.send("getGlyphs",{uid:this.uid,stacks:E},function(t,e){s||(s=t,l=e,T.call(i))}):l={};var S=Object.keys(h.iconDependencies);function T(){if(s)return r(s);if(l&&u){var t=new z(l),e=new U.default$31(u);for(var n in c){var i=c[n];i instanceof U.default$17&&(I(i.layers,this.zoom),A(i,l,t.positions,u,e.positions,this.showCollisionBoxes))}this.status="done",r(null,{buckets:U.values(c).filter(function(t){return!t.isEmpty()}),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,iconAtlasImage:e.image})}}S.length?n.send("getImages",{icons:S},function(t,e){s||(s=t,u=e,T.call(i))}):u={},T.call(this)};var h=function(t){return!(!performance||!performance.getEntriesByName)&&performance.getEntriesByName(t)};function o(t,n){var e=U.getArrayBuffer(t.request,function(t,e){t?n(t):e&&n(null,{vectorTile:new U.default$13.VectorTile(new U.default$14(e.data)),rawData:e.data,cacheControl:e.cacheControl,expires:e.expires})});return function(){e.abort(),n()}}function a(t,e,n){this.actor=t,this.layerIndex=e,this.loadVectorData=n||o,this.loading={},this.loaded={}}a.prototype.loadTile=function(a,s){var l=this,u=a.uid;this.loading||(this.loading={});var c=this.loading[u]=new e(a);c.abort=this.loadVectorData(a,function(t,e){if(delete l.loading[u],t||!e)return s(t);var n=e.rawData,i={};e.expires&&(i.expires=e.expires),e.cacheControl&&(i.cacheControl=e.cacheControl);var r={};if(a.request&&a.request.collectResourceTiming){var o=h(a.request.url);o&&(r.resourceTiming=JSON.parse(JSON.stringify(o)))}c.vectorTile=e.vectorTile,c.parse(e.vectorTile,l.layerIndex,l.actor,function(t,e){if(t||!e)return s(t);s(null,U.extend({rawTileData:n.slice(0)},e,i,r))}),l.loaded=l.loaded||{},l.loaded[u]=c})},a.prototype.reloadTile=function(t,i){var e=this.loaded,n=t.uid,r=this;if(e&&e[n]){var o=e[n];o.showCollisionBoxes=t.showCollisionBoxes;var a=function(t,e){var n=o.reloadCallback;n&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,r.actor,n)),i(t,e)};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&o.parse(o.vectorTile,this.layerIndex,this.actor,a)}},a.prototype.abortTile=function(t,e){var n=this.loading,i=t.uid;n&&n[i]&&n[i].abort&&(n[i].abort(),delete n[i]),e()},a.prototype.removeTile=function(t,e){var n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()};function s(){this.loading={},this.loaded={}}s.prototype.loadTile=function(t,e){var n=t.uid,i=t.encoding,r=new U.default$32(n);(this.loading[n]=r).loadFromImage(t.rawImageData,i),delete this.loading[n],this.loaded=this.loaded||{},e(null,this.loaded[n]=r)},s.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var u={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function c(t){var e=0;if(t&&0<t.length){e+=Math.abs(p(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(p(t[n]))}return e}function p(t){var e,n,i,r,o,a,s=0,l=t.length;if(2<l){for(a=0;a<l;a++)o=a===l-2?(i=l-2,r=l-1,0):a===l-1?(i=l-1,r=0,1):(r=(i=a)+1,a+2),e=t[i],n=t[r],s+=(f(t[o][0])-f(e[0]))*Math.sin(f(n[1]));s=s*u.RADIUS*u.RADIUS/2}return s}function f(t){return t*Math.PI/180}var d={geometry:function t(e){var n,i=0;switch(e.type){case"Polygon":return c(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)i+=c(e.coordinates[n]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)i+=t(e.geometries[n]);return i}},ring:p},m=function t(e,n){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(y(t,n)),e;case"Feature":return e.geometry=t(e.geometry,n),e;case"Polygon":case"MultiPolygon":return g(e,n);default:return e}};function y(e,n){return function(t){return e(t,n)}}function g(t,e){return"Polygon"===t.type?t.coordinates=_(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(y(_,e))),t}function _(t,e){e=!!e,t[0]=E(t[0],e);for(var n=1;n<t.length;n++)t[n]=E(t[n],!e);return t}function E(t,e){return function(t){return 0<=d.ring(t)}(t)===e?t:t.reverse()}function S(t){this._feature=t,this.extent=U.default$9,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}var k=U.default$13.VectorTileFeature.prototype.toGeoJSON;S.prototype.loadGeometry=function(){if(1===this._feature.type){for(var t=[],e=0,n=this._feature.geometry;e<n.length;e+=1){var i=n[e];t.push([new U.default$1(i[0],i[1])])}return t}for(var r=[],o=0,a=this._feature.geometry;o<a.length;o+=1){for(var s=[],l=0,u=a[o];l<u.length;l+=1){var c=u[l];s.push(new U.default$1(c[0],c[1]))}r.push(s)}return r},S.prototype.toGeoJSON=function(t,e,n){return k.call(this,t,e,n)};var M=function(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=U.default$9,this.length=t.length,this._features=t};M.prototype.feature=function(t){return new S(this._features[t])};var C=U.__moduleExports.VectorTileFeature,P=L;function L(t,e){this.options=e||{},this.features=t,this.length=t.length}function D(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}L.prototype.feature=function(t){return new D(this.features[t],this.options.extent)},D.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var n=t[e],i=[],r=0;r<n.length;r++)i.push(new U.default$33(n[r][0],n[r][1]));this.geometry.push(i)}return this.geometry},D.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[e,i,n,r]},D.prototype.toGeoJSON=C.prototype.toGeoJSON;function B(t,e){e=e||{};var n={};for(var i in t)n[i]=new P(t[i].features,e),n[i].name=i,n[i].version=e.version,n[i].extent=e.extent;return N({layers:n})}var O=N,F=N,V=P;function N(t){var e=new U.__moduleExports$1;return function(t,e){for(var n in t.layers)e.writeMessage(2,j,t.layers[n])}(t,e),e.finish()}function j(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(6,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)i.feature=t.feature(n),e.writeMessage(2,G,i);var r=i.keys;for(n=0;n<r.length;n++)e.writeStringField(4,r[n]);var o=i.values;for(n=0;n<o.length;n++)e.writeMessage(5,tt,o[n])}function G(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(7,K,t),e.writeVarintField(6,n.type),e.writeMessage(2,Q,n)}function K(t,e){var n=t.feature,i=t.keys,r=t.values,o=t.keycache,a=t.valuecache;for(var s in n.properties){var l=o[s];void 0===l&&(i.push(s),l=i.length-1,o[s]=l),e.writeVarint(l);var u=n.properties[s],c=typeof u;"string"!=c&&"boolean"!=c&&"number"!=c&&(u=JSON.stringify(u));var h=c+":"+u,p=a[h];void 0===p&&(r.push(u),p=r.length-1,a[h]=p),e.writeVarint(p)}}function Y(t,e){return(e<<3)+(7&t)}function J(t){return t<<1^t>>31}function Q(t,e){for(var n=t.loadGeometry(),i=t.type,r=0,o=0,a=n.length,s=0;s<a;s++){var l=n[s],u=1;1===i&&(u=l.length),e.writeVarint(Y(1,u));for(var c=3===i?l.length-1:l.length,h=0;h<c;h++){1===h&&1!==i&&e.writeVarint(Y(2,c-1));var p=l[h].x-r,f=l[h].y-o;e.writeVarint(J(p)),e.writeVarint(J(f)),r+=p,o+=f}3===i&&e.writeVarint(Y(7,0))}}function tt(t,e){var n=typeof t;"string"==n?e.writeStringField(1,t):"boolean"==n?e.writeBooleanField(7,t):"number"==n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}O.fromVectorTileJs=F,O.fromGeojsonVt=B,O.GeoJSONWrapper=V;var et=function t(e,n,i,r,o,a){if(o-r<=i)return;var s=Math.floor((r+o)/2);nt(e,n,s,r,o,a%2);t(e,n,i,r,s-1,a+1);t(e,n,i,s+1,o,a+1)};function nt(t,e,n,i,r,o){for(;i<r;){if(600<r-i){var a=r-i+1,s=n-i+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(s-a/2<0?-1:1);nt(t,e,n,Math.max(i,Math.floor(n-s*u/a+c)),Math.min(r,Math.floor(n+(a-s)*u/a+c)),o)}var h=e[2*n+o],p=i,f=r;for(it(t,e,i,n),e[2*r+o]>h&&it(t,e,i,r);p<f;){for(it(t,e,p,f),p++,f--;e[2*p+o]<h;)p++;for(;e[2*f+o]>h;)f--}e[2*i+o]===h?it(t,e,i,f):it(t,e,++f,r),f<=n&&(i=f+1),n<=f&&(r=f-1)}}function it(t,e,n,i){rt(t,n,i),rt(e,2*n,2*i),rt(e,2*n+1,2*i+1)}function rt(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}var ot=function(t,e,n,i,r,o,a){var s,l,u=[0,t.length-1,0],c=[];for(;u.length;){var h=u.pop(),p=u.pop(),f=u.pop();if(p-f<=a)for(var d=f;d<=p;d++)s=e[2*d],l=e[2*d+1],n<=s&&s<=r&&i<=l&&l<=o&&c.push(t[d]);else{var m=Math.floor((f+p)/2);s=e[2*m],l=e[2*m+1],n<=s&&s<=r&&i<=l&&l<=o&&c.push(t[m]);var y=(h+1)%2;(0===h?n<=s:i<=l)&&(u.push(f),u.push(m-1),u.push(y)),(0===h?s<=r:l<=o)&&(u.push(m+1),u.push(p),u.push(y))}}return c};var at=function(t,e,n,i,r,o){var a=[0,t.length-1,0],s=[],l=r*r;for(;a.length;){var u=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)st(e[2*p],e[2*p+1],n,i)<=l&&s.push(t[p]);else{var f=Math.floor((h+c)/2),d=e[2*f],m=e[2*f+1];st(d,m,n,i)<=l&&s.push(t[f]);var y=(u+1)%2;(0===u?n-r<=d:i-r<=m)&&(a.push(h),a.push(f-1),a.push(y)),(0===u?d<=n+r:m<=i+r)&&(a.push(f+1),a.push(c),a.push(y))}}return s};function st(t,e,n,i){var r=t-n,o=e-i;return r*r+o*o}var lt=function(t,e,n,i,r){return new ut(t,e,n,i,r)};function ut(t,e,n,i,r){e=e||ct,n=n||ht,r=r||Array,this.nodeSize=i||64,this.points=t,this.ids=new r(t.length),this.coords=new r(2*t.length);for(var o=0;o<t.length;o++)this.ids[o]=o,this.coords[2*o]=e(t[o]),this.coords[2*o+1]=n(t[o]);et(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function ct(t){return t[0]}function ht(t){return t[1]}var pt=function(t){return new ft(t)};function ft(t){this.options=_t(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function dt(t,e){var n=t.geometry.coordinates;return{x:gt(n[0]),y:vt(n[1]),zoom:1/0,id:e,parentId:-1}}function mt(t){return{type:"Feature",properties:yt(t),geometry:{type:"Point",coordinates:[function(t){return 360*(t-.5)}(t.x),function(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(t.y)]}}}function yt(t){var e=t.numPoints,n=1e4<=e?Math.round(e/1e3)+"k":1e3<=e?Math.round(e/100)/10+"k":e;return _t(_t({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function gt(t){return t/360+.5}function vt(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:1<n?1:n}function _t(t,e){for(var n in e)t[n]=e[n];return t}function xt(t){return t.x}function bt(t){return t.y}function wt(t,e,n,i,r,o){var a=r-n,s=o-i;if(0!==a||0!==s){var l=((t-n)*a+(e-i)*s)/(a*a+s*s);1<l?(n=r,i=o):0<l&&(n+=a*l,i+=s*l)}return(a=t-n)*a+(s=e-i)*s}function Et(t,e,n,i){var r={id:t||null,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)St(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<e.length;i++)St(t,e[i]);else if("MultiPolygon"===n)for(i=0;i<e.length;i++)for(var r=0;r<e[i].length;r++)St(t,e[i][r])}(r),r}function St(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function Tt(t,e,n){if(e.geometry){var i=e.geometry.coordinates,r=e.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),a=[];if("Point"===r)At(i,a);else if("MultiPoint"===r)for(var s=0;s<i.length;s++)At(i[s],a);else if("LineString"===r)zt(i,a,o,!1);else if("MultiLineString"===r)if(n.lineMetrics)for(s=0;s<i.length;s++)return a=[],zt(i[s],a,o,!1),void t.push(Et(e.id,"LineString",a,e.properties));else It(i,a,o,!1);else if("Polygon"===r)It(i,a,o,!0);else{if("MultiPolygon"!==r){if("GeometryCollection"!==r)throw new Error("Input data is not a valid GeoJSON object.");for(s=0;s<e.geometry.geometries.length;s++)Tt(t,{id:e.id,geometry:e.geometry.geometries[s],properties:e.properties},n);return}for(s=0;s<i.length;s++){var l=[];It(i[s],l,o,!0),a.push(l)}}t.push(Et(e.id,r,a,e.properties))}}function At(t,e){e.push(kt(t[0])),e.push(Mt(t[1])),e.push(0)}function zt(t,e,n,i){for(var r,o,a=0,s=0;s<t.length;s++){var l=kt(t[s][0]),u=Mt(t[s][1]);e.push(l),e.push(u),e.push(0),0<s&&(a+=i?(r*u-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(u-o,2))),r=l,o=u}var c=e.length-3;e[2]=1,function t(e,n,i,r){for(var o,a=r,s=e[n],l=e[n+1],u=e[i],c=e[i+1],h=n+3;h<i;h+=3){var p=wt(e[h],e[h+1],s,l,u,c);a<p&&(o=h,a=p)}r<a&&(3<o-n&&t(e,n,o,r),e[o+2]=a,3<i-o&&t(e,o,i,r))}(e,0,c,n),e[2+c]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function It(t,e,n,i){for(var r=0;r<t.length;r++){var o=[];zt(t[r],o,n,i),e.push(o)}}function kt(t){return t/360+.5}function Mt(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:1<n?1:n}function Ct(t,e,n,i,r,o,a,s){if(i/=e,(n/=e)<=o&&a<=i)return t;if(i<o||a<n)return null;for(var l=[],u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.type,f=0===r?c.minX:c.minY,d=0===r?c.maxX:c.maxY;if(n<=f&&d<=i)l.push(c);else if(!(i<f||d<n)){var m=[];if("Point"===p||"MultiPoint"===p)Pt(h,m,n,i,r);else if("LineString"===p)Lt(h,m,n,i,r,!1,s.lineMetrics);else if("MultiLineString"===p)Rt(h,m,n,i,r,!1);else if("Polygon"===p)Rt(h,m,n,i,r,!0);else if("MultiPolygon"===p)for(var y=0;y<h.length;y++){var g=[];Rt(h[y],g,n,i,r,!0),g.length&&m.push(g)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(y=0;y<m.length;y++)l.push(Et(c.id,p,m[y],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(Et(c.id,p,m,c.tags))}}}return l.length?l:null}function Pt(t,e,n,i,r){for(var o=0;o<t.length;o+=3){var a=t[o+r];n<=a&&a<=i&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function Lt(t,e,n,i,r,o,a){for(var s,l,u=Dt(t),c=0===r?Ot:Ft,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],m=t[p+2],y=t[p+3],g=t[p+4],v=0===r?f:d,_=0===r?y:g,x=!1;a&&(s=Math.sqrt(Math.pow(f-y,2)+Math.pow(d-g,2))),v<n?n<=_&&(l=c(u,f,d,y,g,n),a&&(u.start=h+s*l)):i<v?_<=i&&(l=c(u,f,d,y,g,i),a&&(u.start=h+s*l)):Bt(u,f,d,m),_<n&&n<=v&&(l=c(u,f,d,y,g,n),x=!0),i<_&&v<=i&&(l=c(u,f,d,y,g,i),x=!0),!o&&x&&(a&&(u.end=h+s*l),e.push(u),u=Dt(t)),a&&(h+=s)}var b=t.length-3;f=t[b],d=t[b+1],m=t[b+2],n<=(v=0===r?f:d)&&v<=i&&Bt(u,f,d,m),b=u.length-3,o&&3<=b&&(u[b]!==u[0]||u[b+1]!==u[1])&&Bt(u,u[0],u[1],u[2]),u.length&&e.push(u)}function Dt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function Rt(t,e,n,i,r,o){for(var a=0;a<t.length;a++)Lt(t[a],e,n,i,r,o,!1)}function Bt(t,e,n,i){t.push(e),t.push(n),t.push(i)}function Ot(t,e,n,i,r,o){var a=(o-e)/(i-e);return t.push(o),t.push(n+(r-n)*a),t.push(1),a}function Ft(t,e,n,i,r,o){var a=(o-n)/(r-n);return t.push(e+(i-e)*a),t.push(o),t.push(1),a}function Vt(t,e){for(var n=[],i=0;i<t.length;i++){var r,o=t[i],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)r=Nt(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){r=[];for(var s=0;s<o.geometry.length;s++)r.push(Nt(o.geometry[s],e))}else if("MultiPolygon"===a)for(r=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(Nt(o.geometry[s][u],e));r.push(l)}n.push(Et(o.id,a,r,o.tags))}return n}function Nt(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function jt(t,e){if(t.transformed)return t;var n,i,r,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var l=t.features[n],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(i=0;i<u.length;i+=2)l.geometry.push(Gt(u[i],u[i+1],e,o,a,s));else for(i=0;i<u.length;i++){var h=[];for(r=0;r<u[i].length;r+=2)h.push(Gt(u[i][r],u[i][r+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t}function Gt(t,e,n,i,r,o){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-o))]}function Ut(t,e,n,i,r){for(var o=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,Wt(a,t[s],o,r);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function Wt(t,e,n,i){var r=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<r.length;s+=3)a.push(r[s]),a.push(r[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)$t(a,r,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<r.length;s++)$t(a,r[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var u=r[l];for(s=0;s<u.length;s++)$t(a,u[s],t,n,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.emapgoMap_clip_start=r.start/r.size,c.emapgoMap_clip_end=r.end/r.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function $t(t,e,n,i,r,o){var a=i*i;if(0<i&&e.size<(r?a:i))n.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===i||e[l+2]>a)&&(n.numSimplified++,s.push(e[l]),s.push(e[l+1])),n.numPoints++;r&&function(t,e){for(var n=0,i=0,r=t.length,o=r-2;i<r;o=i,i+=2)n+=(t[i]-t[o])*(t[i+1]+t[o+1]);if(0<n===e)for(i=0,r=t.length;i<r/2;i+=2){var a=t[i],s=t[i+1];t[i]=t[r-2-i],t[i+1]=t[r-1-i],t[r-2-i]=a,t[r-1-i]=s}}(s,o),t.push(s)}}function qt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||24<e.maxZoom)throw new Error("maxZoom should be in the 0-24 range");var i=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)Tt(n,t.features[i],e);else"Feature"===t.type?Tt(n,t,e):Tt(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(t,e){var n=e.buffer/e.extent,i=t,r=Ct(t,1,-1-n,n,0,-1,2,e),o=Ct(t,1,1-n,2+n,0,-1,2,e);return(r||o)&&(i=Ct(t,1,-n,1+n,0,-1,2,e)||[],r&&(i=Vt(r,1).concat(i)),o&&(i=i.concat(Vt(o,-1)))),i}(i,e)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zt(t,e,n){return 32*((1<<t)*n+e)+t}function Xt(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return e(null,null);var r=new M(i.features),o=O(r);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:r,rawData:o.buffer})}qt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!(ft.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!(ut.prototype={range:function(t,e,n,i){return ot(this.ids,this.coords,t,e,n,i,this.nodeSize)},within:function(t,e,n){return at(this.ids,this.coords,t,e,n,this.nodeSize)}}),reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var e=this.options.log;e&&console.time("total time");var n="prepare "+t.length+" points";e&&console.time(n);var i=(this.points=t).map(dt);e&&console.timeEnd(n);for(var r=this.options.maxZoom;r>=this.options.minZoom;r--){var o=+Date.now();this.trees[r+1]=lt(i,xt,bt,this.options.nodeSize,Float32Array),i=this._cluster(i,r),e&&console.log("z%d: %d clusters in %dms",r,i.length,+Date.now()-o)}return this.trees[this.options.minZoom]=lt(i,xt,bt,this.options.nodeSize,Float32Array),e&&console.timeEnd("total time"),this},getClusters:function(t,e){for(var n=this.trees[this._limitZoom(e)],i=n.range(gt(t[0]),vt(t[3]),gt(t[2]),vt(t[1])),r=[],o=0;o<i.length;o++){var a=n.points[i[o]];r.push(a.numPoints?mt(a):this.points[a.id])}return r},getChildren:function(t,e){for(var n=this.trees[e+1].points[t],i=this.options.radius/(this.options.extent*Math.pow(2,e)),r=this.trees[e+1].within(n.x,n.y,i),o=[],a=0;a<r.length;a++){var s=this.trees[e+1].points[r[a]];s.parentId===t&&o.push(s.numPoints?mt(s):this.points[s.id])}return o},getLeaves:function(t,e,n,i){n=n||10,i=i||0;var r=[];return this._appendLeaves(r,t,e,n,i,0),r},getTile:function(t,e,n){var i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),o=this.options.extent,a=this.options.radius/o,s=(n-a)/r,l=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((e-a)/r,s,(e+1+a)/r,l),i.points,e,n,r,u),0===e&&this._addTileFeatures(i.range(1-a/r,s,1,l),i.points,r,n,r,u),e===r-1&&this._addTileFeatures(i.range(0,s,a/r,l),i.points,-1,n,r,u),u.features.length?u:null},getClusterExpansionZoom:function(t,e){for(;e<this.options.maxZoom;){var n=this.getChildren(t,e);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},_appendLeaves:function(t,e,n,i,r,o){for(var a=this.getChildren(e,n),s=0;s<a.length;s++){var l=a[s].properties;if(l.cluster?o+l.point_count<=r?o+=l.point_count:o=this._appendLeaves(t,l.cluster_id,n+1,i,r,o):o<r?o++:t.push(a[s]),t.length===i)break}return o},_addTileFeatures:function(t,e,n,i,r,o){for(var a=0;a<t.length;a++){var s=e[t[a]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(s.x*r-n)),Math.round(this.options.extent*(s.y*r-i))]],tags:s.numPoints?yt(s):this.points[s.id].properties})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var n=[],i=this.options.radius/(this.options.extent*Math.pow(2,e)),r=0;r<t.length;r++){var o=t[r];if(!(o.zoom<=e)){o.zoom=e;var a=this.trees[e+1],s=a.within(o.x,o.y,i),l=o.numPoints||1,u=o.x*l,c=o.y*l,h=null;this.options.reduce&&(h=this.options.initial(),this._accumulate(h,o));for(var p=0;p<s.length;p++){var f=a.points[s[p]];if(e<f.zoom){var d=f.numPoints||1;f.zoom=e,u+=f.x*d,c+=f.y*d,l+=d,f.parentId=r,this.options.reduce&&this._accumulate(h,f)}}1===l?n.push(o):(o.parentId=r,n.push({x:u/l,y:c/l,zoom:1/0,id:r,properties:h,parentId:-1,numPoints:l}))}}return n},_accumulate:function(t,e){var n=e.numPoints?e.properties:this.options.map(this.points[e.id].properties);this.options.reduce(t,n)}}),debug:0},qt.prototype.splitTile=function(t,e,n,i,r,o,a){for(var s=[t,e,n,i],l=this.options,u=l.debug;s.length;){i=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=Zt(e,n,i),p=this.tiles[h];if(!p&&(1<u&&console.time("creation"),p=this.tiles[h]=Ut(t,e,n,i,l),this.tileCoords.push({z:e,x:n,y:i}),u)){1<u&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,r){if(e===l.maxZoom||e===r)continue;var d=1<<r-e;if(n!==Math.floor(o/d)||i!==Math.floor(a/d))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){1<u&&console.time("clipping");var m,y,g,v,_,x,b=.5*l.buffer/l.extent,w=.5-b,E=.5+b,S=1+b;m=y=g=v=null,_=Ct(t,c,n-b,n+E,0,p.minX,p.maxX,l),x=Ct(t,c,n+w,n+S,0,p.minX,p.maxX,l),t=null,_&&(m=Ct(_,c,i-b,i+E,1,p.minY,p.maxY,l),y=Ct(_,c,i+w,i+S,1,p.minY,p.maxY,l),_=null),x&&(g=Ct(x,c,i-b,i+E,1,p.minY,p.maxY,l),v=Ct(x,c,i+w,i+S,1,p.minY,p.maxY,l),x=null),1<u&&console.timeEnd("clipping"),s.push(m||[],e+1,2*n,2*i),s.push(y||[],e+1,2*n,2*i+1),s.push(g||[],e+1,2*n+1,2*i),s.push(v||[],e+1,2*n+1,2*i+1)}}},qt.prototype.getTile=function(t,e,n){var i=this.options,r=i.extent,o=i.debug;if(t<0||24<t)return null;var a=1<<t,s=Zt(t,e=(e%a+a)%a,n);if(this.tiles[s])return jt(this.tiles[s],r);1<o&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var l,u=t,c=e,h=n;!l&&0<u;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[Zt(u,c,h)];return l&&l.source?(1<o&&console.log("found parent tile z%d-%d-%d",u,c,h),1<o&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,n),1<o&&console.timeEnd("drilling down"),this.tiles[s]?jt(this.tiles[s],r):null):null};var Ht,Kt=((Ht=a)&&(Yt.__proto__=Ht),((Yt.prototype=Object.create(Ht&&Ht.prototype)).constructor=Yt).prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},Yt.prototype._loadData=function(){var r=this;if(this._pendingCallback&&this._pendingLoadDataParams){var o=this._pendingCallback,a=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams,this.loadGeoJSON(a,function(t,e){if(t||!e)return o(t);if("object"!=typeof e)return o(new Error("Input data is not a valid GeoJSON object."));m(e,!0);try{r._geoJSONIndex=a.cluster?pt(a.superclusterOptions).load(e.features):function(t,e){return new qt(t,e)}(e,a.geojsonVtOptions)}catch(t){return o(t)}r.loaded={};var n={};if(a.request&&a.request.collectResourceTiming){var i=h(a.request.url);i&&(n.resourceTiming={},n.resourceTiming[a.source]=JSON.parse(JSON.stringify(i)))}o(null,n)})}else U.default$2(!1)},Yt.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},Yt.prototype.reloadTile=function(t,e){var n=this.loaded,i=t.uid;return n&&n[i]?Ht.prototype.reloadTile.call(this,t,e):this.loadTile(t,e)},Yt.prototype.loadGeoJSON=function(t,e){if(t.request)U.getJSON(t.request,e);else{if("string"!=typeof t.data)return e(new Error("Input data is not a valid GeoJSON object."));try{return e(null,JSON.parse(t.data))}catch(t){return e(new Error("Input data is not a valid GeoJSON object."))}}},Yt.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},Yt);function Yt(t,e,n){Ht.call(this,t,e,Xt),n&&(this.loadGeoJSON=n)}function Jt(t){var n=this;this.self=t,this.actor=new U.default$8(t,this),this.layerIndexes={},this.workerSourceTypes={vector:a,geojson:Kt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(t){if(U.plugin.applyArabicShaping||U.plugin.processBidirectionalText)throw new Error("RTL text plugin already registered.");U.plugin.applyArabicShaping=t.applyArabicShaping,U.plugin.processBidirectionalText=t.processBidirectionalText}}return Jt.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},Jt.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},Jt.prototype.loadTile=function(t,e,n){U.default$2(e.type),this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},Jt.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},Jt.prototype.reloadTile=function(t,e,n){U.default$2(e.type),this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},Jt.prototype.abortTile=function(t,e,n){U.default$2(e.type),this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},Jt.prototype.removeTile=function(t,e,n){U.default$2(e.type),this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},Jt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},Jt.prototype.removeSource=function(t,e,n){if(U.default$2(e.type),U.default$2(e.source),this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,n):n()}},Jt.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t)}},Jt.prototype.loadRTLTextPlugin=function(t,e,n){try{U.plugin.applyArabicShaping||U.plugin.processBidirectionalText||(this.self.importScripts(e),U.plugin.applyArabicShaping&&U.plugin.processBidirectionalText||n(new Error("RTL Text Plugin failed to import scripts from "+e)))}catch(t){n(t)}},Jt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e=e||(this.layerIndexes[t]=new n)},Jt.prototype.getWorkerSource=function(i,t,e){var r=this;if(this.workerSources[i]||(this.workerSources[i]={}),this.workerSources[i][t]||(this.workerSources[i][t]={}),!this.workerSources[i][t][e]){var n={send:function(t,e,n){r.actor.send(t,e,n,i)}};this.workerSources[i][t][e]=new this.workerSourceTypes[t](n,this.getLayerIndex(i))}return this.workerSources[i][t][e]},Jt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new s),this.demWorkerSources[t][e]},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&new Jt(self),Jt}),t(0,function(V){var n=V.createCommonjsModule(function(t){function i(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{t=new Worker(i),e=!0}catch(t){e=!1}t&&t.terminate();return URL.revokeObjectURL(i),e}()&&"Uint8ClampedArray"in window&&function(t){void 0===e[t]&&(e[t]=function(t){var e=document.createElement("canvas"),n=Object.create(i.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,e.probablySupportsContext?e.probablySupportsContext("webgl",n)||e.probablySupportsContext("experimental-webgl",n):e.supportsContext?e.supportsContext("webgl",n)||e.supportsContext("experimental-webgl",n):e.getContext("webgl",n)||e.getContext("experimental-webgl",n)}(t));return e[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=i:window&&(window.emapgo=window.emapgo||{},window.emapgo.supported=i);var e={};i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),t=V.default.performance&&V.default.performance.now?V.default.performance.now.bind(V.default.performance):Date.now.bind(Date),e=V.default.requestAnimationFrame||V.default.mozRequestAnimationFrame||V.default.webkitRequestAnimationFrame||V.default.msRequestAnimationFrame,i=V.default.cancelAnimationFrame||V.default.mozCancelAnimationFrame||V.default.webkitCancelAnimationFrame||V.default.msCancelAnimationFrame,T={now:t,frame:function(t){return e(t)},cancelFrame:function(t){return i(t)},getImageData:function(t){var e=V.default.document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(0,0,t.width,t.height)},hardwareConcurrency:V.default.navigator.hardwareConcurrency||4,get devicePixelRatio(){return V.default.devicePixelRatio},supportsWebp:!1};if(V.default.document){var r=V.default.document.createElement("img");r.onload=function(){T.supportsWebp=!0},r.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="}var v={create:function(t,e,n){var i=V.default.document.createElement(t);return e&&(i.className=e),n&&n.appendChild(i),i},createNS:function(t,e){return V.default.document.createElementNS(t,e)}},o=V.default.document?V.default.document.documentElement.style:null;function a(t){if(!o)return null;for(var e=0;e<t.length;e++)if(t[e]in o)return t[e];return t[0]}var s,l=a(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);v.disableDrag=function(){o&&l&&(s=o[l],o[l]="none")},v.enableDrag=function(){o&&l&&(o[l]=s)};var u=a(["transform","WebkitTransform"]),c=!(v.setTransform=function(t,e){t.style[u]=e});try{var h=Object.defineProperty({},"passive",{get:function(){c=!0}});V.default.addEventListener("test",h,h),V.default.removeEventListener("test",h,h)}catch(t){c=!1}v.addEventListener=function(t,e,n,i){void 0===i&&(i={}),"passive"in i&&c?t.addEventListener(e,n,i):t.addEventListener(e,n,i.capture)},v.removeEventListener=function(t,e,n,i){void 0===i&&(i={}),"passive"in i&&c?t.removeEventListener(e,n,i):t.removeEventListener(e,n,i.capture)};var p=function(t){t.preventDefault(),t.stopPropagation(),V.default.removeEventListener("click",p,!0)};v.suppressClick=function(){V.default.addEventListener("click",p,!0),V.default.setTimeout(function(){V.default.removeEventListener("click",p,!0)},0)},v.mousePos=function(t,e){var n=t.getBoundingClientRect();return e=e.touches?e.touches[0]:e,new V.default$1(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},v.touchPos=function(t,e){for(var n=t.getBoundingClientRect(),i=[],r="touchend"===e.type?e.changedTouches:e.touches,o=0;o<r.length;o++)i.push(new V.default$1(r[o].clientX-n.left-t.clientLeft,r[o].clientY-n.top-t.clientTop));return i},v.mouseButton=function(t){return V.default$2("mousedown"===t.type||"mouseup"===t.type),void 0!==V.default.InstallTrigger&&2===t.button&&t.ctrlKey&&0<=V.default.navigator.platform.toUpperCase().indexOf("MAC")?0:t.button},v.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var f={API_URL:"https://api.eMapgo.com",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null},d="See https://www.eMapgo.com/api-documentation";function m(t,e){var n=w(f.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"/"!==n.path&&(t.path=""+n.path+t.path),!f.REQUIRE_ACCESS_TOKEN)return E(t);if(!(e=e||f.ACCESS_TOKEN))throw new Error("An API access token is required to use emapgo GL. "+d);if("s"===e[0])throw new Error("Use a public access token (pk.*) with emapgo GL, not a secret access token (sk.*). "+d);return t.params.push("access_token="+e),E(t)}function y(t){return 0===t.indexOf("eMapgoUrl:")}function g(t,e,n,i){var r=w(t);return y(t)?(r.path="/styles/v1"+r.path+"/sprite"+e+n,m(r,i)):(r.path+=""+e+n,E(r))}function _(t,e,n){if(!e||!y(e))return t.indexOf("?")<0?t+"?token="+f.ACCESS_TOKEN:t+"&token="+f.ACCESS_TOKEN;var i=w(t),r=2<=T.devicePixelRatio||512===n?"@2x":"",o=T.supportsWebp?".webp":"$1";return i.path=i.path.replace(x,r+o),function(t){for(var e=0;e<t.length;e++)0===t[e].indexOf("access_token=tk.")&&(t[e]="access_token="+(f.ACCESS_TOKEN||""))}(i.params),E(i)}var x=/(\.(png|jpg)\d*)(?=$)/;var b=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function w(t){var e=t.match(b);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function E(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}var S=V.default.HTMLImageElement,A=V.default.HTMLCanvasElement,z=V.default.HTMLVideoElement,I=V.default.ImageData,k=function(t,e,n,i){this.context=t;var r=e.width,o=e.height;this.size=[r,o],this.format=n,this.texture=t.gl.createTexture(),this.update(e,i)};k.prototype.update=function(t,e){var n=t.width,i=t.height;this.size=[n,i];var r=this.context,o=r.gl;o.bindTexture(o.TEXTURE_2D,this.texture),r.pixelStoreUnpack.set(1),this.format===o.RGBA&&!1!==e&&r.pixelStoreUnpackPremultiplyAlpha.set(!0),t instanceof S||t instanceof A||t instanceof z||t instanceof I?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,t):o.texImage2D(o.TEXTURE_2D,0,this.format,n,i,0,this.format,o.UNSIGNED_BYTE,t.data)},k.prototype.bind=function(t,e,n){var i=this.context.gl;i.bindTexture(i.TEXTURE_2D,this.texture),t!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrap=e)},k.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};function M(){this.images={},this.loaded=!1,this.requestors=[],this.shelfPack=new V.default$3(64,64,{autoResize:!0}),this.patterns={},this.atlasImage=new V.RGBAImage({width:64,height:64}),this.dirty=!0}M.prototype.isLoaded=function(){return this.loaded},M.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var i=n[e],r=i.ids,o=i.callback;this._notify(r,o)}this.requestors=[]}},M.prototype.getImage=function(t){return this.images[t]},M.prototype.addImage=function(t,e){V.default$2(!this.images[t]),this.images[t]=e},M.prototype.removeImage=function(t){V.default$2(this.images[t]),delete this.images[t];var e=this.patterns[t];e&&(this.shelfPack.unref(e.bin),delete this.patterns[t])},M.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var i=0,r=t;i<r.length;i+=1){var o=r[i];this.images[o]||(n=!1)}this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},M.prototype._notify=function(t,e){for(var n={},i=0,r=t;i<r.length;i+=1){var o=r[i],a=this.images[o];a&&(n[o]={data:a.data.clone(),pixelRatio:a.pixelRatio,sdf:a.sdf})}e(null,n)},M.prototype.getPixelSize=function(){return{width:this.shelfPack.w,height:this.shelfPack.h}},M.prototype.getPattern=function(t){var e=this.patterns[t];if(e)return e.position;var n=this.getImage(t);if(!n)return null;var i=n.data.width+2,r=n.data.height+2,o=this.shelfPack.packOne(i,r);if(!o)return null;this.atlasImage.resize(this.getPixelSize());var a=n.data,s=this.atlasImage,l=o.x+1,u=o.y+1,c=a.width,h=a.height;V.RGBAImage.copy(a,s,{x:0,y:0},{x:l,y:u},{width:c,height:h}),V.RGBAImage.copy(a,s,{x:0,y:h-1},{x:l,y:u-1},{width:c,height:1}),V.RGBAImage.copy(a,s,{x:0,y:0},{x:l,y:u+h},{width:c,height:1}),V.RGBAImage.copy(a,s,{x:c-1,y:0},{x:l-1,y:u},{width:1,height:h}),V.RGBAImage.copy(a,s,{x:0,y:0},{x:l+c,y:u},{width:1,height:h}),this.dirty=!0;var p=new V.ImagePosition(o,n);return this.patterns[t]={bin:o,position:p},p},M.prototype.bind=function(t){var e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new k(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)};var C=L,P=1e20;function L(t,e,n,i,r,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(0<=navigator.userAgent.indexOf("Gecko/")?1.2:1))}function D(t,e,n,i,r,o,a){for(var s=0;s<e;s++){for(var l=0;l<n;l++)i[l]=t[l*e+s];for(R(i,r,o,a,n),l=0;l<n;l++)t[l*e+s]=r[l]}for(l=0;l<n;l++){for(s=0;s<e;s++)i[s]=t[l*e+s];for(R(i,r,o,a,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(r[s])}}function R(t,e,n,i,r){i[n[0]=0]=-P,i[1]=+P;for(var o=1,a=0;o<r;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=i[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,i[a]=s,i[a+1]=+P}for(a=o=0;o<r;o++){for(;i[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}L.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),i=0;i<this.size*this.size;i++){var r=e.data[4*i+3]/255;this.gridOuter[i]=1==r?0:0==r?P:Math.pow(Math.max(0,.5-r),2),this.gridInner[i]=1==r?P:0==r?0:Math.pow(Math.max(0,r-.5),2)}for(D(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),D(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),i=0;i<this.size*this.size;i++){var o=this.gridOuter[i]-this.gridInner[i];n[i]=Math.max(0,Math.min(255,Math.round(255-255*(o/this.radius+this.cutoff))))}return n};function B(t,e){this.requestTransform=t,this.localIdeographFontFamily=e,this.entries={}}B.prototype.setURL=function(t){this.url=t},B.prototype.getGlyphs=function(t,u){var l=this,e=[];for(var n in t)for(var i=0,r=t[n];i<r.length;i+=1){var o=r[i];e.push({stack:n,id:o})}V.asyncAll(e,function(t,n){var i=t.stack,r=t.id,o=l.entries[i],e=(o=o||(l.entries[i]={glyphs:{},requests:{}})).glyphs[r];if(void 0===e)if(e=l._tinySDF(o,i,r))n(null,{stack:i,id:r,glyph:e});else{var a=Math.floor(r/256);if(65535<256*a)n(new Error("glyphs > 65535 not supported"));else{var s=o.requests[a];s||(s=o.requests[a]=[],B.loadGlyphRange(i,a,l.url,l.requestTransform,function(t,e){if(e)for(var n in e)o.glyphs[+n]=e[+n];for(var i=0,r=s;i<r.length;i+=1){(0,r[i])(t,e)}delete o.requests[a]})),s.push(function(t,e){t?n(t):e&&n(null,{stack:i,id:r,glyph:e[r]||null})})}}else n(null,{stack:i,id:r,glyph:e})},function(t,e){if(t)u(t);else if(e){for(var n={},i=0,r=e;i<r.length;i+=1){var o=r[i],a=o.stack,s=o.id,l=o.glyph;(n[a]||(n[a]={}))[s]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}u(null,n)}})},B.prototype._tinySDF=function(t,e,n){var i=this.localIdeographFontFamily;if(i&&(V.default$5["CJK Unified Ideographs"](n)||V.default$5["Hangul Syllables"](n))){var r=t.tinySDF;if(!r){var o="400";/bold/i.test(e)?o="900":/medium/i.test(e)?o="500":/light/i.test(e)&&(o="200"),r=t.tinySDF=new B.TinySDF(24,3,8,.25,i,o)}return{id:n,bitmap:new V.AlphaImage({width:30,height:30},r.draw(String.fromCharCode(n))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},B.loadGlyphRange=function(t,e,n,i,a){var r=256*e,o=255+r,s=i(function(t,e){if(!y(t))return t;var n=w(t);return n.path="/fonts/v1"+n.path,m(n,e)}(n).replace("{fontstack}",t).replace("{range}",r+"-"+o),V.ResourceType.Glyphs);V.getArrayBuffer(s,function(t,e){if(t)a(t);else if(e){for(var n={},i=0,r=V.default$4(e.data);i<r.length;i+=1){var o=r[i];n[o.id]=o}a(null,n)}})},B.TinySDF=C;function O(){this.specification=V.default$6.light.position}O.prototype.possiblyEvaluate=function(t,e){return V.sphericalToCartesian(t.expression.evaluate(e))},O.prototype.interpolate=function(t,e,n){return{x:V.number(t.x,e.x,n),y:V.number(t.y,e.y,n),z:V.number(t.z,e.z,n)}};var F,N=new V.Properties({anchor:new V.DataConstantProperty(V.default$6.light.anchor),position:new O,color:new V.DataConstantProperty(V.default$6.light.color),intensity:new V.DataConstantProperty(V.default$6.light.intensity)}),j="-transition",G=((F=V.Evented)&&(U.__proto__=F),((U.prototype=Object.create(F&&F.prototype)).constructor=U).prototype.getLight=function(){return this._transitionable.serialize()},U.prototype.setLight=function(t){if(!this._validate(V.validateLight,t))for(var e in t){var n=t[e];V.endsWith(e,j)?this._transitionable.setTransition(e.slice(0,-j.length),n):this._transitionable.setValue(e,n)}},U.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},U.prototype.hasTransition=function(){return this._transitioning.hasTransition()},U.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},U.prototype._validate=function(t,e){return V.emitValidationErrors(this,t.call(V.validateStyle,V.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:V.default$6})))},U);function U(t){F.call(this),this._transitionable=new V.Transitionable(N),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}function W(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}}W.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.positions[n]||(this.positions[n]=this.addDash(t,e)),this.positions[n]},W.prototype.addDash=function(t,e){var n=e?7:0,i=2*n+1;if(this.nextRow+i>this.height)return V.warnOnce("LineAtlas out of space"),null;for(var r=0,o=0;o<t.length;o++)r+=t[o];for(var a=this.width/r,s=a/2,l=t.length%2==1,u=-n;u<=n;u++)for(var c=this.nextRow+n+u,h=this.width*c,p=l?-t[t.length-1]:0,f=t[0],d=1,m=0;m<this.width;m++){for(;f<m/a;)p=f,f+=t[d],l&&d===t.length-1&&(f+=t[0]),d++;var y=Math.abs(m-p*a),g=Math.abs(m-f*a),v=Math.min(y,g),_=d%2==1,x=void 0;if(e){var b=n?u/n*(1+s):0;if(_){var w=s-Math.abs(b);x=Math.sqrt(v*v+w*w)}else x=s-Math.sqrt(v*v+b*b)}else x=(_?1:-1)*v;this.data[3+4*(h+m)]=Math.max(0,Math.min(255,x+128))}var E={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:r};return this.nextRow+=i,this.dirty=!0,E},W.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))};function $(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=V.uniqueId();for(var n=this.workerPool.acquire(this.id),i=0;i<n.length;i++){var r=n[i],o=new $.Actor(r,e,this.id);o.name="Worker "+i,this.actors.push(o)}}function q(t,e,i){function n(t,e){if(t)return i(t);if(e){var n=V.pick(e,["tiles","minzoom","maxzoom","attribution","eMapgo_logo","bounds"]);e.vector_layers&&(n.vectorLayers=e.vector_layers,n.vectorLayerIds=n.vectorLayers.map(function(t){return t.id})),i(null,n)}}t.url?V.getJSON(e(function(t,e){if(!y(t))return t;var n=w(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),m(n,e)}(t.url),V.ResourceType.Source),n):T.frame(function(){return n(null,t)})}$.prototype.broadcast=function(n,i,t){t=t||function(){},V.asyncAll(this.actors,function(t,e){t.send(n,i,e)},t)},$.prototype.send=function(t,e,n,i){return"number"==typeof i&&!isNaN(i)||(i=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[i].send(t,e,n),i},$.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},$.Actor=V.default$8;function Z(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}Z.prototype.wrap=function(){return new Z(V.wrap(this.lng,-180,180),this.lat)},Z.prototype.toArray=function(){return[this.lng,this.lat]},Z.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Z.prototype.toBounds=function(t){var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new X(new Z(this.lng-n,this.lat-e),new Z(this.lng+n,this.lat+e))},Z.convert=function(t){if(t instanceof Z)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Z(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Z(Number(t.lng),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var X=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};X.prototype.setNorthEast=function(t){return this._ne=t instanceof Z?new Z(t.lng,t.lat):Z.convert(t),this},X.prototype.setSouthWest=function(t){return this._sw=t instanceof Z?new Z(t.lng,t.lat):Z.convert(t),this},X.prototype.extend=function(t){var e,n,i=this._sw,r=this._ne;if(t instanceof Z)n=e=t;else{if(!(t instanceof X))return Array.isArray(t)?t.every(Array.isArray)?this.extend(X.convert(t)):this.extend(Z.convert(t)):this;if(e=t._sw,n=t._ne,!e||!n)return this}return i||r?(i.lng=Math.min(e.lng,i.lng),i.lat=Math.min(e.lat,i.lat),r.lng=Math.max(n.lng,r.lng),r.lat=Math.max(n.lat,r.lat)):(this._sw=new Z(e.lng,e.lat),this._ne=new Z(n.lng,n.lat)),this},X.prototype.getCenter=function(){return new Z((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},X.prototype.getSouthWest=function(){return this._sw},X.prototype.getNorthEast=function(){return this._ne},X.prototype.getNorthWest=function(){return new Z(this.getWest(),this.getNorth())},X.prototype.getSouthEast=function(){return new Z(this.getEast(),this.getSouth())},X.prototype.getWest=function(){return this._sw.lng},X.prototype.getSouth=function(){return this._sw.lat},X.prototype.getEast=function(){return this._ne.lng},X.prototype.getNorth=function(){return this._ne.lat},X.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},X.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},X.prototype.isEmpty=function(){return!(this._sw&&this._ne)},X.convert=function(t){return!t||t instanceof X?t:new X(t)};function H(t,e,n){this.bounds=X.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=n||24}H.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},H.prototype.contains=function(t){var e=Math.floor(this.lngX(this.bounds.getWest(),t.z)),n=Math.floor(this.latY(this.bounds.getNorth(),t.z)),i=Math.ceil(this.lngX(this.bounds.getEast(),t.z)),r=Math.ceil(this.latY(this.bounds.getSouth(),t.z));return t.x>=e&&t.x<i&&t.y>=n&&t.y<r},H.prototype.lngX=function(t,e){return(t+180)*(Math.pow(2,e)/360)},H.prototype.latY=function(t,e){var n=V.clamp(Math.sin(Math.PI/180*t),-.9999,.9999),i=Math.pow(2,e)/(2*Math.PI);return Math.pow(2,e-1)+.5*Math.log((1+n)/(1-n))*-i};var K,Y=((K=V.Evented)&&(J.__proto__=K),((J.prototype=Object.create(K&&K.prototype)).constructor=J).prototype.load=function(){var n=this;this.fire(new V.Event("dataloading",{dataType:"source"})),q(this._options,this.map._transformRequest,function(t,e){t?n.fire(new V.ErrorEvent(t)):e&&(V.extend(n,e),e.bounds&&(n.tileBounds=new H(e.bounds,n.minzoom,n.maxzoom)),n.fire(new V.Event("data",{dataType:"source",sourceDataType:"metadata"})),n.fire(new V.Event("data",{dataType:"source",sourceDataType:"content"})))})},J.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},J.prototype.onAdd=function(t){this.map=t,this.load()},J.prototype.serialize=function(){return V.extend({},this._options)},J.prototype.loadTile=function(n,i){var t=_(n.tileID.canonical.url(this.tiles,this.scheme),this.url),e={request:this.map._transformRequest(t,V.ResourceType.Tile),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:T.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function r(t,e){return n.aborted?i(null):t?i(t):(e&&e.resourceTiming&&(n.resourceTiming=e.resourceTiming),this.map._refreshExpiredTiles&&n.setExpiryData(e),n.loadVectorData(e,this.map.painter),i(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}e.request.collectResourceTiming=this._collectResourceTiming,void 0===n.workerID||"expired"===n.state?n.workerID=this.dispatcher.send("loadTile",e,r.bind(this)):"loading"===n.state?n.reloadCallback=i:this.dispatcher.send("reloadTile",e,r.bind(this),n.workerID)},J.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},J.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},J.prototype.hasTransition=function(){return!1},J);function J(t,e,n,i){if(K.call(this),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,V.extend(this,V.pick(e,["url","scheme","tileSize"])),this._options=V.extend({type:"vector"},e),this._collectResourceTiming=e.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i)}var Q,tt=((Q=V.Evented)&&(et.__proto__=Q),((et.prototype=Object.create(Q&&Q.prototype)).constructor=et).prototype.load=function(){var n=this;this.fire(new V.Event("dataloading",{dataType:"source"})),q(this._options,this.map._transformRequest,function(t,e){t?n.fire(new V.ErrorEvent(t)):e&&(V.extend(n,e),e.bounds&&(n.tileBounds=new H(e.bounds,n.minzoom,n.maxzoom)),n.fire(new V.Event("data",{dataType:"source",sourceDataType:"metadata"})),n.fire(new V.Event("data",{dataType:"source",sourceDataType:"content"})))})},et.prototype.onAdd=function(t){this.map=t,this.load()},et.prototype.serialize=function(){return V.extend({},this._options)},et.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},et.prototype.loadTile=function(r,o){var a=this,t=_(r.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);r.request=V.getImage(this.map._transformRequest(t,V.ResourceType.Tile),function(t,e){if(delete r.request,r.aborted)r.state="unloaded",o(null);else if(t)r.state="errored",o(t);else if(e){a.map._refreshExpiredTiles&&r.setExpiryData(e),delete e.cacheControl,delete e.expires;var n=a.map.painter.context,i=n.gl;r.texture=a.map.painter.getTileTexture(e.width),r.texture?(r.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE,i.LINEAR_MIPMAP_NEAREST),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,e)):(r.texture=new k(n,e,i.RGBA),r.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE,i.LINEAR_MIPMAP_NEAREST),n.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax)),i.generateMipmap(i.TEXTURE_2D),r.state="loaded",o(null)}})},et.prototype.abortTile=function(t,e){t.request&&(t.request.abort(),delete t.request),e()},et.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},et.prototype.hasTransition=function(){return!1},et);function et(t,e,n,i){Q.call(this),this.id=t,this.dispatcher=n,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=V.extend({},e),V.extend(this,V.pick(e,["url","scheme","tileSize"]))}var nt,it=((nt=tt)&&(rt.__proto__=nt),((rt.prototype=Object.create(nt&&nt.prototype)).constructor=rt).prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},rt.prototype.loadTile=function(r,o){var t=_(r.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);r.request=V.getImage(this.map._transformRequest(t,V.ResourceType.Tile),function(t,e){if(delete r.request,r.aborted)r.state="unloaded",o(null);else if(t)r.state="errored",o(t);else if(e){this.map._refreshExpiredTiles&&r.setExpiryData(e),delete e.cacheControl,delete e.expires;var n=T.getImageData(e),i={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:n,encoding:this.encoding};r.workerID&&"expired"!==r.state||(r.workerID=this.dispatcher.send("loadDEMTile",i,function(t,e){t&&(r.state="errored",o(t)),e&&(r.dem=e,r.needsHillshadePrepare=!0,r.state="loaded",o(null))}.bind(this)))}}.bind(this)),r.neighboringTiles=this._getNeighboringTiles(r.tileID)},rt.prototype._getNeighboringTiles=function(t){var e=t.canonical,n=Math.pow(2,e.z),i=(e.x-1+n)%n,r=0===e.x?t.wrap-1:t.wrap,o=(e.x+1+n)%n,a=e.x+1===n?t.wrap+1:t.wrap,s={};return s[new V.OverscaledTileID(t.overscaledZ,r,e.z,i,e.y).key]={backfilled:!1},s[new V.OverscaledTileID(t.overscaledZ,a,e.z,o,e.y).key]={backfilled:!1},0<e.y&&(s[new V.OverscaledTileID(t.overscaledZ,r,e.z,i,e.y-1).key]={backfilled:!1},s[new V.OverscaledTileID(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},s[new V.OverscaledTileID(t.overscaledZ,a,e.z,o,e.y-1).key]={backfilled:!1}),e.y+1<n&&(s[new V.OverscaledTileID(t.overscaledZ,r,e.z,i,e.y+1).key]={backfilled:!1},s[new V.OverscaledTileID(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},s[new V.OverscaledTileID(t.overscaledZ,a,e.z,o,e.y+1).key]={backfilled:!1}),s},rt.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",this.dispatcher.send("removeDEMTile",{uid:t.uid,source:this.id},void 0,t.workerID)},rt);function rt(t,e,n,i){nt.call(this,t,e,n,i),this.type="raster-dem",this.maxzoom=22,this._options=V.extend({},e),this.encoding=e.encoding||"emapgo"}var ot,at=((ot=V.Evented)&&(st.__proto__=ot),((st.prototype=Object.create(ot&&ot.prototype)).constructor=st).prototype.load=function(){var n=this;this.fire(new V.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(t){if(t)n.fire(new V.ErrorEvent(t));else{var e={dataType:"source",sourceDataType:"metadata"};n._collectResourceTiming&&n._resourceTiming&&0<n._resourceTiming.length&&(e.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new V.Event("data",e))}})},st.prototype.onAdd=function(t){this.map=t,this.load()},st.prototype.setData=function(t){var n=this;return this._data=t,this.fire(new V.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(t){if(t)return n.fire(new V.ErrorEvent(t));var e={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&0<n._resourceTiming.length&&(e.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new V.Event("data",e))}),this},st.prototype._updateWorkerData=function(n){var i=this,r=V.extend({},this.workerOptions),t=this._data;"string"==typeof t?(r.request=this.map._transformRequest(function(t){var e=V.default.document.createElement("a");return e.href=t,e.href}(t),V.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(t),this.workerID=this.dispatcher.send(this.type+"."+r.source+".loadData",r,function(t,e){i._removed||e&&e.abandoned||(i._loaded=!0,e&&e.resourceTiming&&e.resourceTiming[i.id]&&(i._resourceTiming=e.resourceTiming[i.id].slice(0)),i.dispatcher.send(i.type+"."+r.source+".coalesce",null,null,i.workerID),n(t))},this.workerID)},st.prototype.loadTile=function(n,i){var r=this,o=void 0===n.workerID?"loadTile":"reloadTile",t={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:T.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};n.workerID=this.dispatcher.send(o,t,function(t,e){return n.unloadVectorData(),n.aborted?i(null):t?i(t):(n.loadVectorData(e,r.map.painter,"reloadTile"==o),i(null))},this.workerID)},st.prototype.abortTile=function(t){t.aborted=!0},st.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},st.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID)},st.prototype.serialize=function(){return V.extend({},this._options,{type:this.type,data:this._data})},st.prototype.hasTransition=function(){return!1},st);function st(t,e,n,i){ot.call(this),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=n,this.setEventedParent(i),this._data=e.data,this._options=V.extend({},e),this._collectResourceTiming=e.collectResourceTiming,this._resourceTiming=[],void 0!==e.maxzoom&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type);var r=V.default$9/this.tileSize;this.workerOptions=V.extend({source:this.id,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(void 0!==e.buffer?e.buffer:128)*r,tolerance:(void 0!==e.tolerance?e.tolerance:.375)*r,extent:V.default$9,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1},superclusterOptions:{maxZoom:void 0!==e.clusterMaxZoom?Math.min(e.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:V.default$9,radius:(e.clusterRadius||50)*r,log:!1}},e.workerOptions)}var lt=V.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ut=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};ut.prototype.bind=function(t,e,n,i,r,o,a,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==i.length,u=0;!l&&u<i.length;u++)this.boundPaintVertexBuffers[u]!==i[u]&&(l=!0);var c=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==n||l||this.boundIndexBuffer!==r||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==a||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||c?this.freshBind(e,n,i,r,o,a,s):(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind())},ut.prototype.freshBind=function(t,e,n,i,r,o,a){var s,l=t.numAttributes,u=this.context,c=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=u.currentNumAttributes||0;for(var h=l;h<s;h++)V.default$2(0!==h),c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,f=n;p<f.length;p+=1){f[p].enableAttributes(c,t)}o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,r);for(var d=0,m=n;d<m.length;d+=1){var y=m[d];y.bind(),y.setVertexAttribPointers(c,t,r)}o&&(o.bind(),o.setVertexAttribPointers(c,t,r)),i&&i.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,r)),u.currentNumAttributes=l},ut.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var ct,ht=((ct=V.Evented)&&(pt.__proto__=ct),((pt.prototype=Object.create(ct&&ct.prototype)).constructor=pt).prototype.load=function(){var n=this;this.fire(new V.Event("dataloading",{dataType:"source"})),this.url=this.options.url,V.getImage(this.map._transformRequest(this.url,V.ResourceType.Image),function(t,e){t?n.fire(new V.ErrorEvent(t)):e&&(n.image=T.getImageData(e),n._finishLoading())})},pt.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new V.Event("data",{dataType:"source",sourceDataType:"metadata"})))},pt.prototype.onAdd=function(t){this.map=t,this.load()},pt.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,n=t.map(function(t){return e.transform.locationCoordinate(Z.convert(t)).zoomTo(0)}),i=this.centerCoord=V.getCoordinatesCenter(n);i.column=Math.floor(i.column),i.row=Math.floor(i.row),this.tileID=new V.CanonicalTileID(i.zoom,i.column,i.row),this.minzoom=this.maxzoom=i.zoom;var r=n.map(function(t){var e=t.zoomTo(i.zoom);return new V.default$1(Math.round((e.column-i.column)*V.default$9),Math.round((e.row-i.row)*V.default$9))});return this._boundsArray=new V.RasterBoundsArray,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,V.default$9,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,V.default$9),this._boundsArray.emplaceBack(r[2].x,r[2].y,V.default$9,V.default$9),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new V.Event("data",{dataType:"source",sourceDataType:"content"})),this},pt.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,e=t.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,lt.members)),this.boundsVAO||(this.boundsVAO=new ut),this.texture||(this.texture=new k(t,this.image,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},pt.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t).buckets={}:t.state="errored",e(null)},pt.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},pt.prototype.hasTransition=function(){return!1},pt);function pt(t,e,n,i){ct.call(this),this.id=t,this.dispatcher=n,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(i),this.options=e}var ft,dt=((ft=ht)&&(mt.__proto__=ft),((mt.prototype=Object.create(ft&&ft.prototype)).constructor=mt).prototype.load=function(){var n=this,t=this.options;this.urls=[];for(var e=0,i=t.urls;e<i.length;e+=1){var r=i[e];n.urls.push(n.map._transformRequest(r,V.ResourceType.Source).url)}V.getVideo(this.urls,function(t,e){t?n.fire(new V.ErrorEvent(t)):e&&(n.video=e,n.video.loop=!0,n.video.addEventListener("playing",function(){n.map._rerender()}),n.map&&n.video.play(),n._finishLoading())})},mt.prototype.getVideo=function(){return this.video},mt.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},mt.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,e=t.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,lt.members)),this.boundsVAO||(this.boundsVAO=new ut),this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new k(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},mt.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},mt.prototype.hasTransition=function(){return this.video&&!this.video.paused},mt);function mt(t,e,n,i){ft.call(this,t,e,n,i),this.roundZoom=!0,this.type="video",this.options=e}var yt,gt=((yt=ht)&&(vt.__proto__=yt),((vt.prototype=Object.create(yt&&yt.prototype)).constructor=vt).prototype.load=function(){this.canvas||(this.canvas=this.options.canvas instanceof V.default.HTMLCanvasElement?this.options.canvas:V.default.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new V.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map._rerender()},this.pause=function(){this._playing=!1},this._finishLoading())},vt.prototype.getCanvas=function(){return this.canvas},vt.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},vt.prototype.onRemove=function(){this.pause()},vt.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var e=this.map.painter.context,n=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,lt.members)),this.boundsVAO||(this.boundsVAO=new ut),this.texture?t?this.texture.update(this.canvas):this._playing&&(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.canvas)):(this.texture=new k(e,this.canvas,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[i];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},vt.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},vt.prototype.hasTransition=function(){return this._playing},vt.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},vt);function vt(t,e,n,i){yt.call(this,t,e,n,i),e.coordinates?Array.isArray(e.coordinates)&&4===e.coordinates.length&&!e.coordinates.some(function(t){return!Array.isArray(t)||2!==t.length||t.some(function(t){return"number"!=typeof t})})||this.fire(new V.ErrorEvent(new V.default$10("sources."+t,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new V.ErrorEvent(new V.default$10("sources."+t,null,'missing required property "coordinates"'))),e.animate&&"boolean"!=typeof e.animate&&this.fire(new V.ErrorEvent(new V.default$10("sources."+t,null,'optional "animate" property must be a boolean value'))),e.canvas?"string"==typeof e.canvas||e.canvas instanceof V.default.HTMLCanvasElement||this.fire(new V.ErrorEvent(new V.default$10("sources."+t,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new V.ErrorEvent(new V.default$10("sources."+t,null,'missing required property "canvas"'))),this.options=e,this.animate=void 0===e.animate||e.animate}var _t={vector:Y,raster:tt,"raster-dem":it,geojson:at,video:dt,image:ht,canvas:gt};function xt(t,e,n,i,r){var o=r.maxPitchScaleFactor(),a=t.tilesIn(n,o);a.sort(bt);for(var s=[],l=0,u=a;l<u.length;l+=1){var c=u[l];s.push({wrappedTileID:c.tileID.wrapped().key,queryResults:c.tile.queryRenderedFeatures(e,c.queryGeometry,c.scale,i,r,o,t.transform.calculatePosMatrix(c.tileID.toUnwrapped()))})}return function(t){for(var e={},n={},i=0,r=t;i<r.length;i+=1){var o=r[i],a=o.queryResults,s=o.wrappedTileID,l=n[s]=n[s]||{};for(var u in a)for(var c=a[u],h=l[u]=l[u]||{},p=e[u]=e[u]||[],f=0,d=c;f<d.length;f+=1){var m=d[f];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m.feature))}}return e}(s)}function bt(t,e){var n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function wt(t,e){this.tileID=t,this.uid=V.uniqueId(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.expiredRequestCount=0,this.state="loading"}wt.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<T.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},wt.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},wt.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){if(t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var i=0,r=t;i<r.length;i+=1){var o=r[i],a=o.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==a.length)for(var s=0,l=o.layers=a;s<l.length;s+=1){n[l[s].id]=o}}return n}(t.buckets,e.style),n)for(var i in this.buckets){var r=this.buckets[i];r instanceof V.default$17&&(r.justReloaded=!0)}for(var o in this.queryPadding=0,this.buckets){var a=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(a.layerIds[0]).queryRadius(a))}t.iconAtlasImage&&(this.iconAtlasImage=t.iconAtlasImage),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new V.CollisionBoxArray},wt.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.iconAtlasTexture&&this.iconAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},wt.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},wt.prototype.getBucket=function(t){return this.buckets[t.id]},wt.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploaded||(n.upload(t),n.uploaded=!0)}var i=t.gl;this.iconAtlasImage&&(this.iconAtlasTexture=new k(t,this.iconAtlasImage,i.RGBA),this.iconAtlasImage=null),this.glyphAtlasImage&&(this.glyphAtlasTexture=new k(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)},wt.prototype.queryRenderedFeatures=function(t,e,n,i,r,o,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:e,scale:n,tileSize:this.tileSize,posMatrix:a,transform:r,params:i,queryPadding:this.queryPadding*o},t):{}},wt.prototype.querySourceFeatures=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){this.latestFeatureIndex.vtLayers||(this.latestFeatureIndex.vtLayers=new V.default$13.VectorTile(new V.default$14(this.latestFeatureIndex.rawTileData)).layers);var n=this.latestFeatureIndex.vtLayers,i=e?e.sourceLayer:"",r=n._geojsonTileLayer||n[i];if(r)for(var o=V.default$16(e&&e.filter),a={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y},s=0;s<r.length;s++){var l=r.feature(s);if(o({zoom:this.tileID.overscaledZ},l)){var u=new V.default$15(l,a.z,a.x,a.y);u.tile=a,t.push(u)}}}},wt.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},wt.prototype.setMask=function(t,e){if(!V.default$11(this.mask,t)&&(this.mask=t,this.clearMask(),!V.default$11(t,{0:!0}))){var n=new V.RasterBoundsArray,i=new V.TriangleIndexArray;this.segments=new V.default$18,this.segments.prepareSegment(0,n,i);for(var r=Object.keys(t),o=0;o<r.length;o++){var a=t[r[o]],s=V.default$9>>a.z,l=new V.default$1(a.x*s,a.y*s),u=new V.default$1(l.x+s,l.y+s),c=this.segments.prepareSegment(4,n,i);n.emplaceBack(l.x,l.y,l.x,l.y),n.emplaceBack(u.x,l.y,u.x,l.y),n.emplaceBack(l.x,u.y,l.x,u.y),n.emplaceBack(u.x,u.y,u.x,u.y);var h=c.vertexLength;i.emplaceBack(h,h+1,h+2),i.emplaceBack(h+1,h+2,h+3),c.vertexLength+=4,c.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(n,lt.members),this.maskedIndexBuffer=e.createIndexBuffer(i)}},wt.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},wt.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=V.parseCacheControl(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var i=Date.now(),r=!1;if(this.expirationTime>i)r=!1;else if(e)if(this.expirationTime<e)r=!0;else{var o=this.expirationTime-e;o?this.expirationTime=i+Math.max(o,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},wt.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)};function Et(t,e){this.max=t,this.onRemove=e,this.reset()}Et.prototype.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},Et.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var n=this.getAndRemove(this.order[0]);n&&this.onRemove(n)}return this},Et.prototype.has=function(t){return t in this.data},Et.prototype.keys=function(){return this.order},Et.prototype.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},Et.prototype.get=function(t){return this.has(t)?this.data[t]:null},Et.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},Et.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this};function St(t,e,n){var i=(this.context=t).gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}St.prototype.unbindVAO=function(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null)},St.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},St.prototype.updateData=function(t){var e=this.context.gl;V.default$2(this.dynamicDraw),this.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},St.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};function Tt(t,e,n,i){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=i;var r=(this.context=t).gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}var At={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};Tt.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Tt.prototype.updateData=function(t){V.default$2(t.length===this.length);var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},Tt.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var i=this.attributes[n],r=e.attributes[i.name];void 0!==r&&t.enableVertexAttribArray(r)}},Tt.prototype.setVertexAttribPointers=function(t,e,n){for(var i=0;i<this.attributes.length;i++){var r=this.attributes[i],o=e.attributes[r.name];void 0!==o&&t.vertexAttribPointer(o,r.components,t[At[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}},Tt.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};function zt(t){this.context=t,this.current=V.default$7.transparent}zt.prototype.get=function(){return this.current},zt.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t)};function It(t){this.context=t,this.current=1}It.prototype.get=function(){return this.current},It.prototype.set=function(t){this.current!==t&&(this.context.gl.clearDepth(t),this.current=t)};function kt(t){this.context=t,this.current=0}kt.prototype.get=function(){return this.current},kt.prototype.set=function(t){this.current!==t&&(this.context.gl.clearStencil(t),this.current=t)};function Mt(t){this.context=t,this.current=[!0,!0,!0,!0]}Mt.prototype.get=function(){return this.current},Mt.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t)};function Ct(t){this.context=t,this.current=!0}Ct.prototype.get=function(){return this.current},Ct.prototype.set=function(t){this.current!==t&&(this.context.gl.depthMask(t),this.current=t)};function Pt(t){this.context=t,this.current=255}Pt.prototype.get=function(){return this.current},Pt.prototype.set=function(t){this.current!==t&&(this.context.gl.stencilMask(t),this.current=t)};function Lt(t){this.context=t,this.current={func:t.gl.ALWAYS,ref:0,mask:255}}Lt.prototype.get=function(){return this.current},Lt.prototype.set=function(t){var e=this.current;t.func===e.func&&t.ref===e.ref&&t.mask===e.mask||(this.context.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t)};function Dt(t){this.context=t;var e=this.context.gl;this.current=[e.KEEP,e.KEEP,e.KEEP]}Dt.prototype.get=function(){return this.current},Dt.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(this.context.gl.stencilOp(t[0],t[1],t[2]),this.current=t)};function Rt(t){this.context=t,this.current=!1}Rt.prototype.get=function(){return this.current},Rt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t}};function Bt(t){this.context=t,this.current=[0,1]}Bt.prototype.get=function(){return this.current},Bt.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.depthRange(t[0],t[1]),this.current=t)};function Ot(t){this.context=t,this.current=!1}Ot.prototype.get=function(){return this.current},Ot.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t}};function Ft(t){this.context=t,this.current=t.gl.LESS}Ft.prototype.get=function(){return this.current},Ft.prototype.set=function(t){this.current!==t&&(this.context.gl.depthFunc(t),this.current=t)};function Vt(t){this.context=t,this.current=!1}Vt.prototype.get=function(){return this.current},Vt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t}};function Nt(t){this.context=t;var e=this.context.gl;this.current=[e.ONE,e.ZERO]}Nt.prototype.get=function(){return this.current},Nt.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.blendFunc(t[0],t[1]),this.current=t)};function jt(t){this.context=t,this.current=V.default$7.transparent}jt.prototype.get=function(){return this.current},jt.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t)};function Gt(t){this.context=t,this.current=null}Gt.prototype.get=function(){return this.current},Gt.prototype.set=function(t){this.current!==t&&(this.context.gl.useProgram(t),this.current=t)};function Ut(t){this.context=t,this.current=1}Ut.prototype.get=function(){return this.current},Ut.prototype.set=function(t){var e=this.context.lineWidthRange,n=V.clamp(t,e[0],e[1]);this.current!==n&&(this.context.gl.lineWidth(n),this.current=t)};function Wt(t){this.context=t,this.current=t.gl.TEXTURE0}Wt.prototype.get=function(){return this.current},Wt.prototype.set=function(t){this.current!==t&&(this.context.gl.activeTexture(t),this.current=t)};function $t(t){this.context=t;var e=this.context.gl;this.current=[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}$t.prototype.get=function(){return this.current},$t.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t)};function qt(t){this.context=t,this.current=null}qt.prototype.get=function(){return this.current},qt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t}};function Zt(t){this.context=t,this.current=null}Zt.prototype.get=function(){return this.current},Zt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t}};function Xt(t){this.context=t,this.current=null}Xt.prototype.get=function(){return this.current},Xt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t}};function Ht(t){this.context=t,this.current=null}Ht.prototype.get=function(){return this.current},Ht.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t}};function Kt(t){this.context=t,this.current=null}Kt.prototype.get=function(){return this.current},Kt.prototype.set=function(t){var e=this.context.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t};function Yt(t){this.context=t,this.current=null}Yt.prototype.get=function(){return this.current},Yt.prototype.set=function(t){this.current!==t&&this.context.extVertexArrayObject&&(this.context.extVertexArrayObject.bindVertexArrayOES(t),this.current=t)};function Jt(t){this.context=t,this.current=4}Jt.prototype.get=function(){return this.current},Jt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t}};function Qt(t){this.context=t,this.current=!1}Qt.prototype.get=function(){return this.current},Qt.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t}};function te(t,e){this.context=t,this.current=null,this.parent=e}te.prototype.get=function(){return this.current};var ee,ne=((ee=te)&&(ie.__proto__=ee),((ie.prototype=Object.create(ee&&ee.prototype)).constructor=ie).prototype.set=function(t){if(this.dirty||this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},ie.prototype.setDirty=function(){this.dirty=!0},ie);function ie(t,e){ee.call(this,t,e),this.dirty=!1}var re,oe=((re=te)&&(ae.__proto__=re),((ae.prototype=Object.create(re&&re.prototype)).constructor=ae).prototype.set=function(t){if(this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t}},ae);function ae(){re.apply(this,arguments)}function se(t,e,n){this.context=t,this.width=e,this.height=n;var i=t.gl,r=this.framebuffer=i.createFramebuffer();this.colorAttachment=new ne(t,r),this.depthAttachment=new oe(t,r)}se.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n),t.deleteFramebuffer(this.framebuffer)};var le=function(t,e,n){this.func=t,this.mask=e,this.range=n};le.ReadOnly=!1,le.ReadWrite=!0,le.disabled=new le(519,le.ReadOnly,[0,1]);var ue=function(t,e,n,i,r,o){this.test=t,this.ref=e,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o};ue.disabled=new ue({func:519,mask:0},0,0,7680,7680,7680);function ce(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n}ce.disabled=new ce(ce.Replace=[1,0],V.default$7.transparent,[!1,!1,!1,!1]),ce.unblended=new ce(ce.Replace,V.default$7.transparent,[!0,!0,!0,!0]),ce.alphaBlended=new ce([1,771],V.default$7.transparent,[!0,!0,!0,!0]);function he(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.lineWidthRange=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),this.clearColor=new zt(this),this.clearDepth=new It(this),this.clearStencil=new kt(this),this.colorMask=new Mt(this),this.depthMask=new Ct(this),this.stencilMask=new Pt(this),this.stencilFunc=new Lt(this),this.stencilOp=new Dt(this),this.stencilTest=new Rt(this),this.depthRange=new Bt(this),this.depthTest=new Ot(this),this.depthFunc=new Ft(this),this.blend=new Vt(this),this.blendFunc=new Nt(this),this.blendColor=new jt(this),this.program=new Gt(this),this.lineWidth=new Ut(this),this.activeTexture=new Wt(this),this.viewport=new $t(this),this.bindFramebuffer=new qt(this),this.bindRenderbuffer=new Zt(this),this.bindTexture=new Xt(this),this.bindVertexBuffer=new Ht(this),this.bindElementBuffer=new Kt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Yt(this),this.pixelStoreUnpack=new Jt(this),this.pixelStoreUnpackPremultiplyAlpha=new Qt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear")}he.prototype.createIndexBuffer=function(t,e){return new St(this,t,e)},he.prototype.createVertexBuffer=function(t,e,n){return new Tt(this,t,e,n)},he.prototype.createRenderbuffer=function(t,e,n){var i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),r},he.prototype.createFramebuffer=function(t,e){return new se(this,t,e)},he.prototype.clear=function(t){var e=t.color,n=t.depth,i=this.gl,r=0;e&&(r|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(r|=i.DEPTH_BUFFER_BIT,this.clearDepth.set(n),this.depthMask.set(!0)),i.clear(r)},he.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},he.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},he.prototype.setColorMode=function(t){V.default$11(t.blendFunction,ce.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)};var pe,fe=((pe=V.Evented)&&(de.__proto__=pe),((de.prototype=Object.create(pe&&pe.prototype)).constructor=de).prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},de.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},de.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},de.prototype.getSource=function(){return this._source},de.prototype.pause=function(){this._paused=!0},de.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},de.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},de.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},de.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},de.prototype.serialize=function(){return this._source.serialize()},de.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._tiles)this._tiles[e].upload(t)},de.prototype.getIds=function(){var a=this;return Object.keys(this._tiles).map(Number).sort(function(t,e){var n=a._tiles[t].tileID,i=a._tiles[e].tileID,r=new V.default$1(n.canonical.x,n.canonical.y).rotate(a.transform.angle),o=new V.default$1(i.canonical.x,i.canonical.y).rotate(a.transform.angle);return n.overscaledZ-i.overscaledZ||o.y-r.y||o.x-r.x})},de.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},de.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0,{});return!!e&&this._isIdRenderable(e.tileID.key)},de.prototype._isIdRenderable=function(t){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]},de.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._resetCache(),this._tiles)this._reloadTile(t,"reloading")},de.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},de.prototype._tileLoaded=function(t,e,n,i){if(i)return t.state="errored",void(404!==i.status?this._source.fire(new V.ErrorEvent(i,{tile:t})):this.update(this.transform));t.timeAdded=T.now(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._source.fire(new V.Event("data",{dataType:"source",tile:t,coord:t.tileID})),this.map&&(this.map.painter.tileExtentVAO.vao=null)},de.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var i=e[n];if(t.neighboringTiles&&t.neighboringTiles[i]){var r=this.getTileByID(i);o(t,r),o(r,t)}}function o(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,i=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0==i||1<Math.abs(i)||(1<Math.abs(n)&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,i),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},de.prototype.getTile=function(t){return this.getTileByID(t.key)},de.prototype.getTileByID=function(t){return this._tiles[t]},de.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},de.prototype._findLoadedChildren=function(t,e,n){var i=!1;for(var r in this._tiles){var o=this._tiles[r];if(!(n[r]||!o.hasData()||o.tileID.overscaledZ<=t.overscaledZ||o.tileID.overscaledZ>e)){var a=Math.pow(2,o.tileID.canonical.z-t.canonical.z);if(Math.floor(o.tileID.canonical.x/a)===t.canonical.x&&Math.floor(o.tileID.canonical.y/a)===t.canonical.y)for(n[r]=o.tileID,i=!0;o&&o.tileID.overscaledZ-1>t.overscaledZ;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);if(!s)break;(o=this._tiles[s.key])&&o.hasData()&&(delete n[r],n[s.key]=s)}}}return i},de.prototype.findLoadedParent=function(t,e,n){for(var i=t.overscaledZ-1;e<=i;i--){var r=t.scaledTo(i);if(!r)return;var o=String(r.key),a=this._tiles[o];if(a&&a.hasData())return n[o]=r,a;if(this._cache.has(o))return n[o]=r,this._cache.get(o)}},de.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),n=Math.floor(5*e),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(i)},de.prototype.update=function(t){var e=this;if(this.transform=t,this._sourceLoaded&&!this._paused){var n;this.updateCacheSize(t),this._coveredTiles={},this.used?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(t){return new V.OverscaledTileID(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)}):(n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(n=n.filter(function(t){return e._source.hasTile(t)}))):n=[];var i,r=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(t)),o=Math.max(r-de.maxOverzooming,this._source.minzoom),a=Math.max(r+de.maxUnderzooming,this._source.minzoom),s=this._updateRetainedTiles(n,r),l={};if(ye(this._source.type))for(var u=Object.keys(s),c=0;c<u.length;c++){var h=u[c],p=s[h];V.default$2(p.key===+h);var f=e._tiles[h];if(f&&(void 0===f.fadeEndTime||f.fadeEndTime>=T.now())){e._findLoadedChildren(p,a,s)&&(s[h]=p);var d=e.findLoadedParent(p,o,l);d&&e._addTile(d.tileID)}}for(i in l)s[i]||(e._coveredTiles[i]=!0);for(i in l)s[i]=l[i];for(var m=V.keysDifference(this._tiles,s),y=0;y<m.length;y++)e._removeTile(m[y])}},de.prototype._updateRetainedTiles=function(t,e){for(var n={},i={},r=Math.max(e-de.maxOverzooming,this._source.minzoom),o=Math.max(e+de.maxUnderzooming,this._source.minzoom),a=0;a<t.length;a++){var s=t[a],l=this._addTile(s),u=!1;if(l.hasData())n[s.key]=s;else{u=l.wasRequested(),n[s.key]=s;var c=!0;if(e+1>this._source.maxzoom){var h=s.children(this._source.maxzoom)[0],p=this.getTile(h);p&&p.hasData()?n[h.key]=h:c=!1}else{this._findLoadedChildren(s,o,n);for(var f=s.children(this._source.maxzoom),d=0;d<f.length;d++)if(!n[f[d].key]){c=!1;break}}if(!c)for(var m=s.overscaledZ-1;r<=m;--m){var y=s.scaledTo(m);if(i[y.key])break;if(i[y.key]=!0,!(l=this.getTile(y))&&u&&(l=this._addTile(y)),l&&(n[y.key]=y,u=l.wasRequested(),l.hasData()))break}}}return n},de.prototype._addTile=function(t){var e=this._tiles[t.key];if(e)return e;(e=this._cache.getAndRemove(t.key))&&this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e));var n=Boolean(e);return n||(e=new wt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))),e?(e.uses++,this._tiles[t.key]=e,n||this._source.fire(new V.Event("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null},de.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout(function(){n._reloadTile(t,"expired"),delete n._timers[t]},i))},de.prototype._setCacheInvalidationTimer=function(t,e){var n=this;t in this._cacheTimers&&(clearTimeout(this._cacheTimers[t]),delete this._cacheTimers[t]);var i=e.getExpiryTimeout();i&&(this._cacheTimers[t]=setTimeout(function(){n._cache.remove(t),delete n._cacheTimers[t]},i))},de.prototype._removeTile=function(t){var e=this._tiles[t];if(e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),!(0<e.uses)))if(e.hasData()){e.tileID=e.tileID.wrapped();var n=e.tileID.key;this._cache.add(n,e),this._setCacheInvalidationTimer(n,e)}else e.aborted=!0,this._abortTile(e),this._unloadTile(e)},de.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._resetCache()},de.prototype._resetCache=function(){for(var t in this._cacheTimers)clearTimeout(this._cacheTimers[t]);this._cacheTimers={},this._cache.reset()},de.prototype.tilesIn=function(t,e){for(var n=[],i=this.getIds(),r=1/0,o=1/0,a=-1/0,s=-1/0,l=t[0].zoom,u=0;u<t.length;u++){var c=t[u];r=Math.min(r,c.column),o=Math.min(o,c.row),a=Math.max(a,c.column),s=Math.max(s,c.row)}for(var h=0;h<i.length;h++){var p=this._tiles[i[h]],f=p.tileID,d=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),m=e*p.queryPadding*V.default$9/p.tileSize/d,y=[me(f,new V.default$19(r,o,l)),me(f,new V.default$19(a,s,l))];if(y[0].x-m<V.default$9&&y[0].y-m<V.default$9&&0<=y[1].x+m&&0<=y[1].y+m){for(var g=[],v=0;v<t.length;v++)g.push(me(f,t[v]));n.push({tile:p,tileID:f,queryGeometry:[g],scale:d})}}return n},de.prototype.getVisibleCoordinates=function(){for(var e=this,t=this.getRenderableIds().map(function(t){return e._tiles[t].tileID}),n=0,i=t;n<i.length;n+=1){var r=i[n];r.posMatrix=e.transform.calculatePosMatrix(r.toUnwrapped())}return t},de.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(ye(this._source.type))for(var t in this._tiles){var e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=T.now())return!0}return!1},de);function de(t,e,n){var i=this;pe.call(this),this.id=t,this.dispatcher=n,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(i._sourceLoaded=!0),i._sourceLoaded&&!i._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(i.reload(),i.transform&&i.update(i.transform))}),this.on("error",function(){i._sourceErrored=!0}),this._source=function(t,e,n,i){var r=new _t[e.type](t,e,n,i);if(r.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+r.id);return V.bindAll(["load","abort","unload","serialize","prepare"],r),r}(t,e,n,this),this._tiles={},this._cache=new Et(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={}}function me(t,e){var n=e.zoomTo(t.canonical.z);return new V.default$1((n.column-(t.canonical.x+t.wrap*Math.pow(2,t.canonical.z)))*V.default$9,(n.row-t.canonical.y)*V.default$9)}function ye(t){return"raster"===t||"image"===t||"video"===t}function ge(){return new V.default.Worker(rr.workerUrl)}fe.maxOverzooming=10,fe.maxUnderzooming=3;var ve,_e=function(){this.active={}};function xe(t,e){var n={};for(var i in t)"ref"!==i&&(n[i]=t[i]);return V.default$20.forEach(function(t){t in e&&(n[t]=e[t])}),n}function be(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=xe(t[i],e[t[i].ref]));return t}_e.prototype.acquire=function(t){if(!this.workers){var e=rr.workerCount;for(V.default$2("number"==typeof e&&e<1/0),this.workers=[];this.workers.length<e;)this.workers.push(new ge)}return this.active[t]=!0,this.workers.slice()},_e.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)};var we={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ee(t,e,n){n.push({command:we.addSource,args:[t,e[t]]})}function Se(t,e,n){e.push({command:we.removeSource,args:[t]}),n[t]=!0}function Te(t,e,n){var i;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!V.default$11(t[n][i],e[n][i]))return!1;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!V.default$11(t[n][i],e[n][i]))return!1;return!0}function Ae(t,e,n,i,r,o){var a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(V.default$11(t[a],e[a])||n.push({command:o,args:[i,a,e[a],r]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(V.default$11(t[a],e[a])||n.push({command:o,args:[i,a,e[a],r]}))}function ze(t){return t.id}function Ie(t,e){return t[e.id]=e,t}function ke(t,e){if(!t)return[{command:we.setStyle,args:[e]}];var n=[];try{if(!V.default$11(t.version,e.version))return[{command:we.setStyle,args:[e]}];V.default$11(t.center,e.center)||n.push({command:we.setCenter,args:[e.center]}),V.default$11(t.zoom,e.zoom)||n.push({command:we.setZoom,args:[e.zoom]}),V.default$11(t.bearing,e.bearing)||n.push({command:we.setBearing,args:[e.bearing]}),V.default$11(t.pitch,e.pitch)||n.push({command:we.setPitch,args:[e.pitch]}),V.default$11(t.sprite,e.sprite)||n.push({command:we.setSprite,args:[e.sprite]}),V.default$11(t.glyphs,e.glyphs)||n.push({command:we.setGlyphs,args:[e.glyphs]}),V.default$11(t.transition,e.transition)||n.push({command:we.setTransition,args:[e.transition]}),V.default$11(t.light,e.light)||n.push({command:we.setLight,args:[e.light]});var i={},r=[];!function(t,e,n,i){var r,o,a,s;for(r in e=e||{},t=t||{})t.hasOwnProperty(r)&&(e.hasOwnProperty(r)||Se(r,n,i));for(r in e)e.hasOwnProperty(r)&&(t.hasOwnProperty(r)?V.default$11(t[r],e[r])||("geojson"===t[r].type&&"geojson"===e[r].type&&Te(t,e,r)?n.push({command:we.setGeoJSONSourceData,args:[r,e[r].data]}):(a=e,Se(o=r,s=n,i),Ee(o,a,s))):Ee(r,e,n))}(t.sources,e.sources,r,i);var o=[];t.layers&&t.layers.forEach(function(t){i[t.source]?n.push({command:we.removeLayer,args:[t.id]}):o.push(t)}),n=n.concat(r),function(t,e,n){e=e||[];var i,r,o,a,s,l,u,c=(t=t||[]).map(ze),h=e.map(ze),p=t.reduce(Ie,{}),f=e.reduce(Ie,{}),d=c.slice(),m=Object.create(null);for(r=i=0;i<c.length;i++)o=c[i],f.hasOwnProperty(o)?r++:(n.push({command:we.removeLayer,args:[o]}),d.splice(d.indexOf(o,r),1));for(r=i=0;i<h.length;i++)o=h[h.length-1-i],d[d.length-1-i]!==o&&(p.hasOwnProperty(o)?(n.push({command:we.removeLayer,args:[o]}),d.splice(d.lastIndexOf(o,d.length-r),1)):r++,l=d[d.length-i],n.push({command:we.addLayer,args:[f[o],l]}),d.splice(d.length-i,0,o),m[o]=!0);for(i=0;i<h.length;i++)if(a=p[o=h[i]],s=f[o],!m[o]&&!V.default$11(a,s))if(V.default$11(a.source,s.source)&&V.default$11(a["source-layer"],s["source-layer"])&&V.default$11(a.type,s.type)){for(u in Ae(a.layout,s.layout,n,o,null,we.setLayoutProperty),Ae(a.paint,s.paint,n,o,null,we.setPaintProperty),V.default$11(a.filter,s.filter)||n.push({command:we.setFilter,args:[o,s.filter]}),V.default$11(a.minzoom,s.minzoom)&&V.default$11(a.maxzoom,s.maxzoom)||n.push({command:we.setLayerZoomRange,args:[o,s.minzoom,s.maxzoom]}),a)a.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Ae(a[u],s[u],n,o,u.slice(6),we.setPaintProperty):V.default$11(a[u],s[u])||n.push({command:we.setLayerProperty,args:[o,u,s[u]]}));for(u in s)s.hasOwnProperty(u)&&!a.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Ae(a[u],s[u],n,o,u.slice(6),we.setPaintProperty):V.default$11(a[u],s[u])||n.push({command:we.setLayerProperty,args:[o,u,s[u]]}))}else n.push({command:we.removeLayer,args:[o]}),l=d[d.lastIndexOf(o)+1],n.push({command:we.addLayer,args:[s,l]})}(o,e.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:we.setStyle,args:[e]}]}return n}function Me(t,e,n){var i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}Me.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Me.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},Me.prototype.insertCircle=function(t,e,n,i){this._forEachCell(e-i,n-i,e+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(i)},Me.prototype._insertBoxCell=function(t,e,n,i,r,o){this.boxCells[r].push(o)},Me.prototype._insertCircleCell=function(t,e,n,i,r,o){this.circleCells[r].push(o)},Me.prototype._query=function(t,e,n,i,r){if(n<0||t>this.width||i<0||e>this.height)return!r&&[];var o=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(var a=0;a<this.boxKeys.length;a++)o.push({key:this.boxKeys[a],x1:this.bboxes[4*a],y1:this.bboxes[4*a+1],x2:this.bboxes[4*a+2],y2:this.bboxes[4*a+3]});for(var s=0;s<this.circleKeys.length;s++){var l=this.circles[3*s],u=this.circles[3*s+1],c=this.circles[3*s+2];o.push({key:this.circleKeys[s],x1:l-c,y1:u-c,x2:l+c,y2:u+c})}}else{var h={hitTest:r,seenUids:{box:{},circle:{}}};this._forEachCell(t,e,n,i,this._queryCell,o,h)}return r?0<o.length:o},Me.prototype._queryCircle=function(t,e,n,i){var r=t-n,o=t+n,a=e-n,s=e+n;if(o<0||r>this.width||s<0||a>this.height)return!i&&[];var l=[],u={hitTest:i,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}};return this._forEachCell(r,a,o,s,this._queryCellCircle,l,u),i?0<l.length:l},Me.prototype.query=function(t,e,n,i){return this._query(t,e,n,i,!1)},Me.prototype.hitTest=function(t,e,n,i){return this._query(t,e,n,i,!0)},Me.prototype.hitTestCircle=function(t,e,n){return this._queryCircle(t,e,n,!0)},Me.prototype._queryCell=function(t,e,n,i,r,o,a){var s=a.seenUids,l=this.boxCells[r];if(null!==l)for(var u=this.bboxes,c=0,h=l;c<h.length;c+=1){var p=h[c];if(!s.box[p]){s.box[p]=!0;var f=4*p;if(t<=u[2+f]&&e<=u[3+f]&&n>=u[0+f]&&i>=u[1+f]){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:u[f],y1:u[1+f],x2:u[2+f],y2:u[3+f]})}}}var d=this.circleCells[r];if(null!==d)for(var m=this.circles,y=0,g=d;y<g.length;y+=1){var v=g[y];if(!s.circle[v]){s.circle[v]=!0;var _=3*v;if(this._circleAndRectCollide(m[_],m[1+_],m[2+_],t,e,n,i)){if(a.hitTest)return o.push(!0),!0;var x=m[_],b=m[1+_],w=m[2+_];o.push({key:this.circleKeys[v],x1:x-w,y1:b-w,x2:x+w,y2:b+w})}}}},Me.prototype._queryCellCircle=function(t,e,n,i,r,o,a){var s=a.circle,l=a.seenUids,u=this.boxCells[r];if(null!==u)for(var c=this.bboxes,h=0,p=u;h<p.length;h+=1){var f=p[h];if(!l.box[f]){l.box[f]=!0;var d=4*f;if(this._circleAndRectCollide(s.x,s.y,s.radius,c[0+d],c[1+d],c[2+d],c[3+d]))return o.push(!0),!0}}var m=this.circleCells[r];if(null!==m)for(var y=this.circles,g=0,v=m;g<v.length;g+=1){var _=v[g];if(!l.circle[_]){l.circle[_]=!0;var x=3*_;if(this._circlesCollide(y[x],y[1+x],y[2+x],s.x,s.y,s.radius))return o.push(!0),!0}}},Me.prototype._forEachCell=function(t,e,n,i,r,o,a){for(var s=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),u=this._convertToXCellCoord(n),c=this._convertToYCellCoord(i),h=s;h<=u;h++)for(var p=l;p<=c;p++){var f=this.xCellCount*p+h;if(r.call(this,t,e,n,i,f,o,a))return}},Me.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Me.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Me.prototype._circlesCollide=function(t,e,n,i,r,o){var a=i-t,s=r-e,l=n+o;return a*a+s*s<l*l},Me.prototype._circleAndRectCollide=function(t,e,n,i,r,o,a){var s=(o-i)/2,l=Math.abs(t-(i+s));if(s+n<l)return!1;var u=(a-r)/2,c=Math.abs(e-(r+u));if(u+n<c)return!1;if(l<=s||c<=u)return!0;var h=l-s,p=c-u;return h*h+p*p<=n*n};var Ce=V.default$21.layout;function Pe(t,e,n,i,r){var o=V.mat4.identity(new Float32Array(16));return e?(V.mat4.identity(o),V.mat4.scale(o,o,[1/r,1/r,1]),n||V.mat4.rotateZ(o,o,i.angle)):(V.mat4.scale(o,o,[i.width/2,-i.height/2,1]),V.mat4.translate(o,o,[1,-1,0]),V.mat4.multiply(o,o,t)),o}function Le(t,e){var n=[t.x,t.y,0,1];Ge(n,n,e);var i=n[3];return{point:new V.default$1(n[0]/i,n[1]/i),signedDistanceFromCamera:i}}function De(t,e,n,i,r,o,a,s){var l=i?t.textSizeData:t.iconSizeData,u=V.evaluateSizeForZoom(l,n.transform.zoom,Ce.properties[i?"text-size":"icon-size"]),c=[256/n.width*2+1,256/n.height*2+1],h=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;h.clear();for(var p,f,d,m,y=t.lineVertexArray,g=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,v=n.transform.width/n.transform.height,_=!1,x=0;x<g.length;x++){var b=g.get(x);if(b.hidden||b.writingMode===V.WritingMode.vertical&&!_)je(b.numGlyphs,h);else{_=!1;var w=[b.anchorX,b.anchorY,0,1];if(V.vec4.transformMat4(w,w,e),f=c,void 0,d=(p=w)[0]/p[3],m=p[1]/p[3],d>=-f[0]&&d<=f[0]&&m>=-f[1]&&m<=f[1]){var E=.5+w[3]/n.transform.cameraToCenterDistance*.5,S=V.evaluateSizeForFeature(l,u,b),T=a?S*E:S/E,A=new V.default$1(b.anchorX,b.anchorY),z=Le(A,r).point,I={},k=Oe(b,T,!1,s,e,r,o,t.glyphOffsetArray,y,h,z,A,I,v);_=k.useVertical,(k.notEnoughRoom||_||k.needsFlipping&&Oe(b,T,!0,s,e,r,o,t.glyphOffsetArray,y,h,z,A,I,v).notEnoughRoom)&&je(b.numGlyphs,h)}else je(b.numGlyphs,h)}}i?t.text.dynamicLayoutVertexBuffer.updateData(h):t.icon.dynamicLayoutVertexBuffer.updateData(h)}function Re(t,e,n,i,r,o,a,s,l,u,c,h){var p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,m=e.getoffsetX(s.glyphStartIndex),y=e.getoffsetX(p-1),g=Ve(t*m,n,i,r,o,a,s.segment,f,d,l,u,c,h);if(!g)return null;var v=Ve(t*y,n,i,r,o,a,s.segment,f,d,l,u,c,h);return v?{first:g,last:v}:null}function Be(t,e,n,i){if(t===V.WritingMode.horizontal){var r=Math.abs(n.y-e.y);if(Math.abs(n.x-e.x)*i<r)return{useVertical:!0}}return(t===V.WritingMode.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function Oe(t,e,n,i,r,o,a,s,l,u,c,h,p,f){var d,m=e/24,y=t.lineOffsetX*e,g=t.lineOffsetY*e;if(1<t.numGlyphs){var v=t.glyphStartIndex+t.numGlyphs,_=t.lineStartIndex,x=t.lineStartIndex+t.lineLength,b=Re(m,s,y,g,n,c,h,t,l,o,p,!1);if(!b)return{notEnoughRoom:!0};var w=Le(b.first.point,a).point,E=Le(b.last.point,a).point;if(i&&!n){var S=Be(t.writingMode,w,E,f);if(S)return S}d=[b.first];for(var T=t.glyphStartIndex+1;T<v-1;T++)d.push(Ve(m*s.getoffsetX(T),y,g,n,c,h,t.segment,_,x,l,o,p,!1));d.push(b.last)}else{if(i&&!n){var A=Le(h,r).point,z=t.lineStartIndex+t.segment+1,I=new V.default$1(l.getx(z),l.gety(z)),k=Le(I,r),M=0<k.signedDistanceFromCamera?k.point:Fe(h,I,A,1,r),C=Be(t.writingMode,A,M,f);if(C)return C}var P=Ve(m*s.getoffsetX(t.glyphStartIndex),y,g,n,c,h,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,l,o,p,!1);if(!P)return{notEnoughRoom:!0};d=[P]}for(var L=0,D=d;L<D.length;L+=1){var R=D[L];V.addDynamicAttributes(u,R.point,R.angle)}return{}}function Fe(t,e,n,i,r){var o=Le(t.add(t.sub(e)._unit()),r).point,a=n.sub(o);return n.add(a._mult(i/a.mag()))}function Ve(t,e,n,i,r,o,a,s,l,u,c,h,p){var f=i?t-e:t+e,d=0<f?1:-1,m=0;i&&(d*=-1,m=Math.PI),d<0&&(m+=Math.PI);for(var y=0<d?s+a:s+a+1,g=y,v=r,_=r,x=0,b=0,w=Math.abs(f);x+b<=w;){if((y+=d)<s||l<=y)return null;if(_=v,void 0===(v=h[y])){var E=new V.default$1(u.getx(y),u.gety(y)),S=Le(E,c);if(0<S.signedDistanceFromCamera)v=h[y]=S.point;else{var T=y-d;v=Fe(0===x?o:new V.default$1(u.getx(T),u.gety(T)),E,_,w-x+1,c)}}x+=b,b=_.dist(v)}var A=(w-x)/b,z=v.sub(_),I=z.mult(A)._add(_);return I._add(z._unit()._perp()._mult(n*d)),{point:I,angle:m+Math.atan2(v.y-_.y,v.x-_.x),tileDistance:p?{prevTileDistance:y-d===g?0:u.gettileUnitDistanceFromAnchor(y-d),lastSegmentViewportDistance:w-x}:null}}var Ne=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function je(t,e){for(var n=0;n<t;n++){var i=e.length;e.resize(i+4),e.float32.set(Ne,3*i)}}function Ge(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t[3]=n[3]*i+n[7]*r+n[15],t}function Ue(t,e,n){void 0===e&&(e=new Me(t.width+200,t.height+200,25)),void 0===n&&(n=new Me(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100}V.default$22.mat4;function We(t,e,n){t[e+4]=n?1:0}function $e(t,e,n){return e*(V.default$9/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}Ue.prototype.placeCollisionBox=function(t,e,n,i){var r=this.projectAndGetPerspectiveRatio(i,t.anchorPointX,t.anchorPointY),o=n*r.perspectiveRatio,a=t.x1*o+r.point.x,s=t.y1*o+r.point.y,l=t.x2*o+r.point.x,u=t.y2*o+r.point.y;return!e&&this.grid.hitTest(a,s,l,u)?{box:[],offscreen:!1}:{box:[a,s,l,u],offscreen:this.isOffscreen(a,s,l,u)}},Ue.prototype.approximateTileDistance=function(t,e,n,i,r){var o=r?1:i/this.pitchfactor,a=t.lastSegmentViewportDistance*n;return t.prevTileDistance+a+(o-1)*a*Math.abs(Math.sin(e))},Ue.prototype.placeCollisionCircles=function(t,e,n,i,r,o,a,s,l,u,c,h,p){var f=[],d=this.projectAnchor(u,o.anchorX,o.anchorY),m=l/24,y=o.lineOffsetX*l,g=o.lineOffsetY*l,v=new V.default$1(o.anchorX,o.anchorY),_=Re(m,s,y,g,!1,Le(v,c).point,v,o,a,c,{},!0),x=!1,b=!0,w=d.perspectiveRatio*i,E=1/(i*n),S=0,T=0;_&&(S=this.approximateTileDistance(_.first.tileDistance,_.first.angle,E,d.cameraDistance,p),T=this.approximateTileDistance(_.last.tileDistance,_.last.angle,E,d.cameraDistance,p));for(var A=0;A<t.length;A+=5){var z=t[A],I=t[A+1],k=t[A+2],M=t[A+3];if(!_||M<-S||T<M)We(t,A,!1);else{var C=this.projectPoint(u,z,I),P=k*w;if(0<f.length){var L=C.x-f[f.length-4],D=C.y-f[f.length-3];if(L*L+D*D<P*P*2)if(A+8<t.length){var R=t[A+8];if(-S<R&&R<T){We(t,A,!1);continue}}}var B=A/5;if(f.push(C.x,C.y,P,B),We(t,A,!0),b=b&&this.isOffscreen(C.x-P,C.y-P,C.x+P,C.y+P),!e&&this.grid.hitTestCircle(C.x,C.y,P)){if(!h)return{circles:[],offscreen:!1};x=!0}}}return{circles:x?[]:f,offscreen:b}},Ue.prototype.queryRenderedSymbols=function(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var e=[],n=1/0,i=1/0,r=-1/0,o=-1/0,a=0,s=t;a<s.length;a+=1){var l=s[a],u=new V.default$1(l.x+100,l.y+100);n=Math.min(n,u.x),i=Math.min(i,u.y),r=Math.max(r,u.x),o=Math.max(o,u.y),e.push(u)}for(var c={},h={},p=0,f=this.grid.query(n,i,r,o).concat(this.ignoredGrid.query(n,i,r,o));p<f.length;p+=1){var d=f[p],m=d.key;if(void 0===c[m.bucketInstanceId]&&(c[m.bucketInstanceId]={}),!c[m.bucketInstanceId][m.featureIndex]){var y=[new V.default$1(d.x1,d.y1),new V.default$1(d.x2,d.y1),new V.default$1(d.x2,d.y2),new V.default$1(d.x1,d.y2)];V.polygonIntersectsPolygon(e,y)&&(c[m.bucketInstanceId][m.featureIndex]=!0,void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]=[]),h[m.bucketInstanceId].push(m.featureIndex))}}return h},Ue.prototype.insertCollisionBox=function(t,e,n,i){var r={bucketInstanceId:n,featureIndex:i};(e?this.ignoredGrid:this.grid).insert(r,t[0],t[1],t[2],t[3])},Ue.prototype.insertCollisionCircles=function(t,e,n,i){for(var r=e?this.ignoredGrid:this.grid,o={bucketInstanceId:n,featureIndex:i},a=0;a<t.length;a+=4)r.insertCircle(o,t[a],t[a+1],t[a+2])},Ue.prototype.projectAnchor=function(t,e,n){var i=[e,n,0,1];return Ge(i,i,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5,cameraDistance:i[3]}},Ue.prototype.projectPoint=function(t,e,n){var i=[e,n,0,1];return Ge(i,i,t),new V.default$1((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100)},Ue.prototype.projectAndGetPerspectiveRatio=function(t,e,n){var i=[e,n,0,1];return Ge(i,i,t),{point:new V.default$1((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},Ue.prototype.isOffscreen=function(t,e,n,i){return n<100||t>=this.screenRightBoundary||i<100||e>this.screenBottomBoundary};function qe(t,e,n,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&n?1:0,this.placed=n}var Ze=V.default$21.layout;qe.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};function Xe(t,e,n,i,r){this.text=new qe(t?t.text:null,e,n,r),this.icon=new qe(t?t.icon:null,e,i,r)}Xe.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};function He(t,e,n){this.text=t,this.icon=e,this.skipFade=n}function Ke(t,e,n,i,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}function Ye(t,e){this.transform=t.clone(),this.collisionIndex=new Ue(this.transform),this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=e,this.retainedQueryData={}}function Je(t,e,n){t.emplaceBack(e?1:0,n?1:0),t.emplaceBack(e?1:0,n?1:0),t.emplaceBack(e?1:0,n?1:0),t.emplaceBack(e?1:0,n?1:0)}Ye.prototype.placeLayerTile=function(t,e,n,i){var r=e.getBucket(t),o=e.latestFeatureIndex;if(r&&o){var a=e.collisionBoxArray,s=r.layers[0].layout,l=Math.pow(2,this.transform.zoom-e.tileID.overscaledZ),u=e.tileSize/V.default$9,c=this.transform.calculatePosMatrix(e.tileID.toUnwrapped()),h=Pe(c,"map"===s.get("text-pitch-alignment"),"map"===s.get("text-rotation-alignment"),this.transform,$e(e,1,this.transform.zoom)),p=Pe(c,"map"===s.get("icon-pitch-alignment"),"map"===s.get("icon-rotation-alignment"),this.transform,$e(e,1,this.transform.zoom));this.retainedQueryData[r.bucketInstanceId]=new Ke(r.bucketInstanceId,o,r.sourceLayerIndex,r.index,e.tileID),this.placeLayerBucket(r,c,h,p,l,u,n,i,a)}},Ye.prototype.placeLayerBucket=function(t,e,n,i,r,o,a,s,l){for(var u=t.layers[0].layout,c=V.evaluateSizeForZoom(t.textSizeData,this.transform.zoom,Ze.properties["text-size"]),h=!t.hasTextData()||u.get("text-optional"),p=!t.hasIconData()||u.get("icon-optional"),f=0,d=t.symbolInstances;f<d.length;f+=1){var m=d[f];if(!s[m.crossTileID]){var y=void 0!==m.feature.text,g=void 0!==m.feature.icon,v=!0,_=null,x=null,b=null,w=0,E=0;m.collisionArrays||(m.collisionArrays=t.deserializeCollisionBoxes(l,m.textBoxStartIndex,m.textBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex)),m.collisionArrays.textFeatureIndex&&(w=m.collisionArrays.textFeatureIndex),m.collisionArrays.textBox&&(y=0<(_=this.collisionIndex.placeCollisionBox(m.collisionArrays.textBox,u.get("text-allow-overlap"),o,e)).box.length,v=v&&_.offscreen);var S=m.collisionArrays.textCircles;if(S){var T=t.text.placedSymbolArray.get(m.placedTextSymbolIndices[0]),A=V.evaluateSizeForFeature(t.textSizeData,c,T);x=this.collisionIndex.placeCollisionCircles(S,u.get("text-allow-overlap"),r,o,m.key,T,t.lineVertexArray,t.glyphOffsetArray,A,e,n,a,"map"===u.get("text-pitch-alignment")),y=u.get("text-allow-overlap")||0<x.circles.length,v=v&&x.offscreen}m.collisionArrays.iconFeatureIndex&&(E=m.collisionArrays.iconFeatureIndex),m.collisionArrays.iconBox&&(g=0<(b=this.collisionIndex.placeCollisionBox(m.collisionArrays.iconBox,u.get("icon-allow-overlap"),o,e)).box.length,v=v&&b.offscreen),h||p?p?h||(g=g&&y):y=g&&y:g=y=g&&y,y&&_&&this.collisionIndex.insertCollisionBox(_.box,u.get("text-ignore-placement"),t.bucketInstanceId,w),g&&b&&this.collisionIndex.insertCollisionBox(b.box,u.get("icon-ignore-placement"),t.bucketInstanceId,E),y&&x&&this.collisionIndex.insertCollisionCircles(x.circles,u.get("text-ignore-placement"),t.bucketInstanceId,w),V.default$2(0!==m.crossTileID),V.default$2(0!==t.bucketInstanceId),this.placements[m.crossTileID]=new He(y,g,v||t.justReloaded),s[m.crossTileID]=!0}}t.justReloaded=!1},Ye.prototype.commit=function(t,e){this.commitTime=e;var n=!1,i=t&&0!==this.fadeDuration?(this.commitTime-t.commitTime)/this.fadeDuration:1,r=t?t.opacities:{};for(var o in this.placements){var a=this.placements[o],s=r[o];n=s?(this.opacities[o]=new Xe(s,i,a.text,a.icon),n||a.text!==s.text.placed||a.icon!==s.icon.placed):(this.opacities[o]=new Xe(null,i,a.text,a.icon,a.skipFade),n||a.text||a.icon)}for(var l in r){var u=r[l];if(!this.opacities[l]){var c=new Xe(u,i,!1,!1);c.isHidden()||(this.opacities[l]=c,n=n||u.text.placed||u.icon.placed)}}V.default$2(!t||void 0!==t.lastPlacementChangeTime),n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)},Ye.prototype.updateLayerOpacities=function(t,e){for(var n={},i=0,r=e;i<r.length;i+=1){var o=r[i],a=o.getBucket(t);a&&o.latestFeatureIndex&&this.updateBucketOpacities(a,n,o.collisionBoxArray)}},Ye.prototype.updateBucketOpacities=function(t,e,n){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexArray.clear(),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexArray.clear();for(var i=t.layers[0].layout,r=new Xe(null,0,!1,!1,!0),o=new Xe(null,0,i.get("text-allow-overlap"),i.get("icon-allow-overlap"),!0),a=0;a<t.symbolInstances.length;a++){var s=t.symbolInstances[a],l=e[s.crossTileID],u=this.opacities[s.crossTileID];l?u=r:u||(u=o,this.opacities[s.crossTileID]=u),e[s.crossTileID]=!0;var c=0<s.numGlyphVertices||0<s.numVerticalGlyphVertices,h=0<s.numIconVertices;if(c){for(var p=sn(u.text),f=(s.numGlyphVertices+s.numVerticalGlyphVertices)/4,d=0;d<f;d++)t.text.opacityVertexArray.emplaceBack(p);for(var m=0,y=s.placedTextSymbolIndices;m<y.length;m+=1){var g=y[m];t.text.placedSymbolArray.get(g).hidden=u.text.isHidden()}}if(h){for(var v=sn(u.icon),_=0;_<s.numIconVertices/4;_++)t.icon.opacityVertexArray.emplaceBack(v);t.icon.placedSymbolArray.get(a).hidden=u.icon.isHidden()}s.collisionArrays||(s.collisionArrays=t.deserializeCollisionBoxes(n,s.textBoxStartIndex,s.textBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex));var x=s.collisionArrays;if(x){x.textBox&&t.hasCollisionBoxData()&&Je(t.collisionBox.collisionVertexArray,u.text.placed,!1),x.iconBox&&t.hasCollisionBoxData()&&Je(t.collisionBox.collisionVertexArray,u.icon.placed,!1);var b=x.textCircles;if(b&&t.hasCollisionCircleData())for(var w=0;w<b.length;w+=5){var E=l||0===b[w+4];Je(t.collisionCircle.collisionVertexArray,u.text.placed,E)}}}t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexBuffer&&t.collisionBox.collisionVertexBuffer.updateData(t.collisionBox.collisionVertexArray),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexBuffer&&t.collisionCircle.collisionVertexBuffer.updateData(t.collisionCircle.collisionVertexArray),V.default$2(t.text.opacityVertexArray.length===t.text.layoutVertexArray.length/4),V.default$2(t.icon.opacityVertexArray.length===t.icon.layoutVertexArray.length/4)},Ye.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},Ye.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},Ye.prototype.stillRecent=function(t){return"undefined"!==this.commitTime&&this.commitTime+this.fadeDuration>t},Ye.prototype.setStale=function(){this.stale=!0};var Qe=Math.pow(2,25),tn=Math.pow(2,24),en=Math.pow(2,17),nn=Math.pow(2,16),rn=Math.pow(2,9),on=Math.pow(2,8),an=Math.pow(2,1);function sn(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Qe+e*tn+n*en+e*nn+n*rn+e*on+n*an+e}function ln(){this._currentTileIndex=0,this._seenCrossTileIDs={}}ln.prototype.continuePlacement=function(t,e,n,i,r){for(;this._currentTileIndex<t.length;){var o=t[this._currentTileIndex];if(e.placeLayerTile(i,o,n,this._seenCrossTileIDs),this._currentTileIndex++,r())return!0}};function un(t,e,n,i,r){this.placement=new Ye(t,r),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}un.prototype.isDone=function(){return this._done},un.prototype.continuePlacement=function(t,e,n){for(var i=this,r=T.now(),o=function(){var t=T.now()-r;return!i._forceFullPlacement&&2<t};0<=this._currentPlacementIndex;){var a=e[t[i._currentPlacementIndex]],s=i.placement.collisionIndex.transform.zoom;if("symbol"===a.type&&(!a.minzoom||a.minzoom<=s)&&(!a.maxzoom||a.maxzoom>s)){if(i._inProgressLayer||(i._inProgressLayer=new ln),i._inProgressLayer.continuePlacement(n[a.source],i.placement,i._showCollisionBoxes,a,o))return;delete i._inProgressLayer}i._currentPlacementIndex--}this._done=!0},un.prototype.commit=function(t,e){return this.placement.commit(t,e),this.placement};function cn(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var i=0,r=e;i<r.length;i+=1){var o=r[i],a=o.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:o.crossTileID,coord:this.getScaledCoordinates(o,t)})}}var hn=512/V.default$9/2;cn.prototype.getScaledCoordinates=function(t,e){var n=e.canonical.z-this.tileID.canonical.z,i=hn/Math.pow(2,n),r=t.anchor;return{x:Math.floor((e.canonical.x*V.default$9+r.x)*i),y:Math.floor((e.canonical.y*V.default$9+r.y)*i)}},cn.prototype.findMatches=function(t,e,n){for(var i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),r=0,o=t;r<o.length;r+=1){var a=o[r];if(!a.crossTileID){var s=this.indexedSymbolInstances[a.key];if(s)for(var l=this.getScaledCoordinates(a,e),u=0,c=s;u<c.length;u+=1){var h=c[u];if(Math.abs(h.coord.x-l.x)<=i&&Math.abs(h.coord.y-l.y)<=i&&!n[h.crossTileID]){n[h.crossTileID]=!0,a.crossTileID=h.crossTileID;break}}}}};function pn(){this.maxCrossTileID=0}pn.prototype.generate=function(){return++this.maxCrossTileID};function fn(){this.indexes={},this.usedCrossTileIDs={}}fn.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var i=0,r=e.symbolInstances;i<r.length;i+=1){r[i].crossTileID=0}this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var o=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var s=this.indexes[a];if(Number(a)>t.overscaledZ)for(var l in s){var u=s[l];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,o)}else{var c=s[t.scaledTo(Number(a)).key];c&&c.findMatches(e.symbolInstances,t,o)}}for(var h=0,p=e.symbolInstances;h<p.length;h+=1){var f=p[h];f.crossTileID||(f.crossTileID=n.generate(),o[f.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new cn(t,e.symbolInstances,e.bucketInstanceId),!0},fn.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var i=0,r=e.indexedSymbolInstances[n];i<r.length;i+=1){var o=r[i];delete this.usedCrossTileIDs[t][o.crossTileID]}},fn.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var i=this.indexes[n];for(var r in i)t[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],e=!0)}return e};function dn(){this.layerIndexes={},this.crossTileIDs=new pn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}dn.prototype.addLayer=function(t,e){var n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new fn);for(var i=!1,r={},o=0,a=e;o<a.length;o+=1){var s=a[o],l=s.getBucket(t);l&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(s.tileID,l,this.crossTileIDs)&&(i=!0),r[l.bucketInstanceId]=!0)}return n.removeStaleBuckets(r)&&(i=!0),i},dn.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach(function(t){e[t]=!0}),this.layerIndexes)e[n]||delete this.layerIndexes[n]};function mn(t,e){return V.emitValidationErrors(t,e&&e.filter(function(t){return"source.canvas"!==t.identifier}))}var yn,gn=V.pick(we,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),vn=V.pick(we,["setCenter","setZoom","setBearing","setPitch"]),_n=((yn=V.Evented)&&(xn.__proto__=yn),((xn.prototype=Object.create(yn&&yn.prototype)).constructor=xn).prototype.loadURL=function(t,e){var n=this;void 0===e&&(e={}),this.fire(new V.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof e.validate?e.validate:!y(t);t=function(t,e){if(!y(t))return t;var n=w(t);return n.path="/styles/v1"+n.path,m(n,e)}(t,e.accessToken);var r=this.map._transformRequest(t,V.ResourceType.Style);V.getJSON(r,function(t,e){t?n.fire(new V.ErrorEvent(t)):e&&n._load(e,i)})},xn.prototype.loadJSON=function(t,e){var n=this;void 0===e&&(e={}),this.fire(new V.Event("dataloading",{dataType:"style"})),T.frame(function(){n._load(t,!1!==e.validate)})},xn.prototype._load=function(t,e){var i=this;if(!e||!mn(this,V.validateStyle(t))){for(var n in this._loaded=!0,(this.stylesheet=t).sources)i.addSource(n,t.sources[n],{validate:!1});t.sprite?function(t,e,h){var p,f,d,n=1<T.devicePixelRatio?"@2x":"";function i(){if(d)h(d);else if(p&&f){var t=T.getImageData(f),e={};for(var n in p){var i=p[n],r=i.width,o=i.height,a=i.x,s=i.y,l=i.sdf,u=i.pixelRatio,c=new V.RGBAImage({width:r,height:o});V.RGBAImage.copy(t,c,{x:a,y:s},{x:0,y:0},{width:r,height:o}),e[n]={data:c,pixelRatio:u,sdf:l}}h(null,e)}}V.getJSON(e(g(t,n,".json"),V.ResourceType.SpriteJSON),function(t,e){d||(d=t,p=e,i())}),V.getImage(e(g(t,n,".png"),V.ResourceType.SpriteImage),function(t,e){d||(d=t,f=e,i())})}(t.sprite,this.map._transformRequest,function(t,e){if(t)i.fire(new V.ErrorEvent(t));else if(e)for(var n in e)i.imageManager.addImage(n,e[n]);i.imageManager.setLoaded(!0),i.fire(new V.Event("data",{dataType:"style"}))}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);var r=be(this.stylesheet.layers);this._order=r.map(function(t){return t.id}),this._layers={};for(var o=0,a=r;o<a.length;o+=1){var s=a[o];(s=V.default$24(s)).setEventedParent(i,{layer:{id:s.id}}),i._layers[s.id]=s}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new G(this.stylesheet.light),this.fire(new V.Event("data",{dataType:"style"})),this.fire(new V.Event("style.load"))}},xn.prototype._validateLayer=function(t){var e=this.sourceCaches[t.source];if(e){var n=t.sourceLayer;if(n){var i=e.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new V.ErrorEvent(new Error('Source layer "'+n+'" does not exist on source "'+i.id+'" as specified by style layer "'+t.id+'"')))}}},xn.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},xn.prototype._serializeLayers=function(t){var e=this;return t.map(function(t){return e._layers[t].serialize()})},xn.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},xn.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},xn.prototype.update=function(t){var e=this;if(this._loaded){if(this._changed){var n=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var r in(n.length||i.length)&&this._updateWorkerLayers(n,i),e._updatedSources){var o=e._updatedSources[r];V.default$2("reload"===o||"clear"===o),"reload"===o?e._reloadSource(r):"clear"===o&&e._clearSource(r)}for(var a in e._updatedPaintProps)e._layers[a].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates(),this.fire(new V.Event("data",{dataType:"style"}))}for(var s in e.sourceCaches)e.sourceCaches[s].used=!1;for(var l=0,u=e._order;l<u.length;l+=1){var c=u[l],h=e._layers[c];h.recalculate(t),!h.isHidden(t.zoom)&&h.source&&(e.sourceCaches[h.source].used=!0)}this.light.recalculate(t),this.z=t.zoom}},xn.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},xn.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},xn.prototype.setState=function(t){var e=this;if(this._checkLoaded(),mn(this,V.validateStyle(t)))return!1;(t=V.clone(t)).layers=be(t.layers);var n=ke(this.serialize(),t).filter(function(t){return!(t.command in vn)});if(0===n.length)return!1;var i=n.filter(function(t){return!(t.command in gn)});if(0<i.length)throw new Error("Unimplemented: "+i.map(function(t){return t.command}).join(", ")+".");return n.forEach(function(t){"setTransition"!==t.command&&e[t.command].apply(e,t.args)}),this.stylesheet=t,!0},xn.prototype.addImage=function(t,e){if(this.getImage(t))return this.fire(new V.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,e),this.fire(new V.Event("data",{dataType:"style"}))},xn.prototype.getImage=function(t){return this.imageManager.getImage(t)},xn.prototype.removeImage=function(t){if(!this.getImage(t))return this.fire(new V.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this.fire(new V.Event("data",{dataType:"style"}))},xn.prototype.addSource=function(t,e,n){var i=this;if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!e.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(e).join(", ")+".");if(!(0<=["vector","raster","geojson","video","image"].indexOf(e.type)&&this._validate(V.validateStyle.source,"sources."+t,e,null,n))){this.map&&this.map._collectResourceTiming&&(e.collectResourceTiming=!0);var r=this.sourceCaches[t]=new fe(t,e,this.dispatcher);r.style=this,r.setEventedParent(this,function(){return{isSourceLoaded:i.loaded(),source:r.serialize(),sourceId:t}}),r.onAdd(this.map),this._changed=!0}},xn.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(var e in this._layers)if(this._layers[e].source===t)return this.fire(new V.ErrorEvent(new Error('Source "'+t+'" cannot be removed while layer "'+e+'" is using it.')));var n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new V.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.clearTiles(),n.onRemove&&n.onRemove(this.map),this._changed=!0},xn.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),V.default$2(void 0!==this.sourceCaches[t],"There is no source with this ID");var n=this.sourceCaches[t].getSource();V.default$2("geojson"===n.type),n.setData(e),this._changed=!0},xn.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},xn.prototype.addLayer=function(t,e,n){this._checkLoaded();var i=t.id;if(this.getLayer(i))this.fire(new V.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else if("object"==typeof t.source&&(this.addSource(i,t.source),t=V.clone(t),t=V.extend(t,{source:i})),!this._validate(V.validateStyle.layer,"layers."+i,t,{arrayIndex:-1},n)){var r=V.default$24(t);this._validateLayer(r),r.setEventedParent(this,{layer:{id:i}});var o=e?this._order.indexOf(e):this._order.length;if(e&&-1===o)this.fire(new V.ErrorEvent(new Error('Layer with id "'+e+'" does not exist on this map.')));else{if(this._order.splice(o,0,i),this._layerOrderChanged=!0,this._layers[i]=r,this._removedLayers[i]&&r.source){var a=this._removedLayers[i];delete this._removedLayers[i],a.type!==r.type?this._updatedSources[r.source]="clear":(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause())}this._updateLayer(r)}}},xn.prototype.moveLayer=function(t,e){if(this._checkLoaded(),this._changed=!0,this._layers[t]){var n=this._order.indexOf(t);this._order.splice(n,1);var i=e?this._order.indexOf(e):this._order.length;e&&-1===i?this.fire(new V.ErrorEvent(new Error('Layer with id "'+e+'" does not exist on this map.'))):(this._order.splice(i,0,t),this._layerOrderChanged=!0)}else this.fire(new V.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")))},xn.prototype.removeLayer=function(t){this._checkLoaded();var e=this._layers[t];if(e){e.setEventedParent(null);var n=this._order.indexOf(t);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=e,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t]}else this.fire(new V.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")))},xn.prototype.getLayer=function(t){return this._layers[t]},xn.prototype.setLayerZoomRange=function(t,e,n){this._checkLoaded();var i=this.getLayer(t);i?i.minzoom===e&&i.maxzoom===n||(null!=e&&(i.minzoom=e),null!=n&&(i.maxzoom=n),this._updateLayer(i)):this.fire(new V.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")))},xn.prototype.setFilter=function(t,e){this._checkLoaded();var n=this.getLayer(t);if(n){if(!V.default$11(n.filter,e))return null==e?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(V.validateStyle.filter,"layers."+n.id+".filter",e)||(n.filter=V.clone(e),this._updateLayer(n)))}else this.fire(new V.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")))},xn.prototype.getFilter=function(t){return V.clone(this.getLayer(t).filter)},xn.prototype.setLayoutProperty=function(t,e,n){this._checkLoaded();var i=this.getLayer(t);i?V.default$11(i.getLayoutProperty(e),n)||(i.setLayoutProperty(e,n),this._updateLayer(i)):this.fire(new V.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")))},xn.prototype.getLayoutProperty=function(t,e){return this.getLayer(t).getLayoutProperty(e)},xn.prototype.setPaintProperty=function(t,e,n){this._checkLoaded();var i=this.getLayer(t);if(i){if(!V.default$11(i.getPaintProperty(e),n)){var r=i._transitionablePaint._values[e].value.isDataDriven();i.setPaintProperty(e,n),(i._transitionablePaint._values[e].value.isDataDriven()||r)&&this._updateLayer(i),this._changed=!0,this._updatedPaintProps[t]=!0}}else this.fire(new V.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")))},xn.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},xn.prototype.getTransition=function(){return V.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},xn.prototype.serialize=function(){var e=this;return V.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:V.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._order.map(function(t){return e._layers[t].serialize()})},function(t){return void 0!==t})},xn.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},xn.prototype._flattenRenderedFeatures=function(t){for(var e=[],n=this._order.length-1;0<=n;n--)for(var i=this._order[n],r=0,o=t;r<o.length;r+=1){var a=o[r][i];if(a)for(var s=0,l=a;s<l.length;s+=1){var u=l[s];e.push(u)}}return e},xn.prototype.queryRenderedFeatures=function(t,e,n){e&&e.filter&&this._validate(V.validateStyle.filter,"queryRenderedFeatures.filter",e.filter);var i={};if(e&&e.layers){if(!Array.isArray(e.layers))return this.fire(new V.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var r=0,o=e.layers;r<o.length;r+=1){var a=o[r],s=this._layers[a];if(!s)return this.fire(new V.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be queried for features."))),[];i[s.source]=!0}}var l=[];for(var u in this.sourceCaches)e.layers&&!i[u]||l.push(xt(this.sourceCaches[u],this._layers,t.worldCoordinate,e,n));return this.placement&&l.push(function(l,t,u,e,n){for(var c={},h=e.queryRenderedSymbols(t),i=[],r=0,o=Object.keys(h).map(Number);r<o.length;r+=1){var a=o[r];i.push(n[a])}i.sort(bt);for(var s=function(){var o=f[p],t=o.featureIndex.lookupSymbolFeatures(h[o.bucketInstanceId],o.bucketIndex,o.sourceLayerIndex,u.filter,u.layers,l);for(var e in t){var n=c[e]=c[e]||[],i=t[e];i.sort(function(t,e){var n=o.featureSortOrder;if(n){var i=n.indexOf(t.featureIndex),r=n.indexOf(e.featureIndex);return V.default$2(0<=i),V.default$2(0<=r),r-i}return e.featureIndex-t.featureIndex});for(var r=0,a=i;r<a.length;r+=1){var s=a[r];n.push(s.feature)}}},p=0,f=i;p<f.length;p+=1)s();return c}(this._layers,t.viewport,e,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenRenderedFeatures(l)},xn.prototype.querySourceFeatures=function(t,e){e&&e.filter&&this._validate(V.validateStyle.filter,"querySourceFeatures.filter",e.filter);var n=this.sourceCaches[t];return n?function(e,t){for(var n=e.getRenderableIds().map(function(t){return e.getTileByID(t)}),i=[],r={},o=0;o<n.length;o++){var a=n[o],s=a.tileID.canonical.key;r[s]||(r[s]=!0,a.querySourceFeatures(i,t))}return i}(n,e):[]},xn.prototype.addSourceType=function(t,e,n){return xn.getSourceType(t)?n(new Error('A source type called "'+t+'" already exists.')):(xn.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))},xn.prototype.getLight=function(){return this.light.getLight()},xn.prototype.setLight=function(t){this._checkLoaded();var e=this.light.getLight(),n=!1;for(var i in t)if(!V.default$11(t[i],e[i])){n=!0;break}if(n){var r={now:T.now(),transition:V.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t),this.light.updateTransitions(r)}},xn.prototype._validate=function(t,e,n,i,r){return(!r||!1!==r.validate)&&mn(this,t.call(V.validateStyle,V.extend({key:e,style:this.serialize(),value:n,styleSpec:V.default$6},i)))},xn.prototype._remove=function(){for(var t in V.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[t].clearTiles();this.dispatcher.remove()},xn.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},xn.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},xn.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},xn.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},xn.prototype._updatePlacement=function(t,e,n){for(var i=!1,r=!1,o={},a=0,s=this._order;a<s.length;a+=1){var l=s[a],u=this._layers[l];if("symbol"===u.type){if(!o[u.source]){var c=this.sourceCaches[u.source];o[u.source]=c.getRenderableIds().map(function(t){return c.getTileByID(t)}).sort(function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)})}var h=this.crossTileSymbolIndex.addLayer(u,o[u.source]);i=i||h}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var p=this._layerOrderChanged;if((p||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(T.now()))&&(this.pauseablePlacement=new un(t,this._order,p,e,n),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,o),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(this.placement,T.now()),r=!0),i&&this.pauseablePlacement.placement.setStale()),r||i)for(var f=0,d=this._order;f<d.length;f+=1){var m=d[f],y=this._layers[m];"symbol"===y.type&&this.placement.updateLayerOpacities(y,o[y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(T.now())},xn.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n)},xn.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},xn);function xn(t,e){var o=this;void 0===e&&(e={}),yn.call(this),this.map=t,this.dispatcher=new $(ve=ve||new _e,this),this.imageManager=new M,this.glyphManager=new B(t._transformRequest,e.localIdeographFontFamily),this.lineAtlas=new W(256,512),this.crossTileSymbolIndex=new dn,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new V.default$25,this._loaded=!1,this._resetUpdates();var n=this;this._rtlTextPluginCallback=xn.registerForPluginAvailability(function(t){for(var e in n.dispatcher.broadcast("loadRTLTextPlugin",t.pluginURL,t.errorCallback),n.sourceCaches)n.sourceCaches[e].reload()}),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var i in o._layers){var r=o._layers[i];r.source===n.id&&o._validateLayer(r)}}}})}_n.getSourceType=function(t){return _t[t]},_n.setSourceType=function(t,e){_t[t]=e},_n.registerForPluginAvailability=V.registerForPluginAvailability;function bn(t){var e=En[t],a={};e.fragmentSource=e.fragmentSource.replace(Sn,function(t,e,n,i,r){return a[r]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nvarying "+n+" "+i+" "+r+";\n#else\nuniform "+n+" "+i+" u_"+r+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+r+"\n    "+n+" "+i+" "+r+" = u_"+r+";\n#endif\n"}),e.vertexSource=e.vertexSource.replace(Sn,function(t,e,n,i,r){var o="float"===i?"vec2":"vec4";return a[r]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float a_"+r+"_t;\nattribute "+n+" "+o+" a_"+r+";\nvarying "+n+" "+i+" "+r+";\n#else\nuniform "+n+" "+i+" u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+r+" = unpack_mix_"+o+"(a_"+r+", a_"+r+"_t);\n#else\n    "+n+" "+i+" "+r+" = u_"+r+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float a_"+r+"_t;\nattribute "+n+" "+o+" a_"+r+";\n#else\nuniform "+n+" "+i+" u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+n+" "+i+" "+r+" = unpack_mix_"+o+"(a_"+r+", a_"+r+"_t);\n#else\n    "+n+" "+i+" "+r+" = u_"+r+";\n#endif\n"})}var wn=V.createLayout([{name:"a_pos",type:"Int16",components:2}]),En={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\n// Unpack a pair of values that have been packed into a single float.\n// The packed values are assumed to be 8-bit unsigned integers, and are\n// packed like so:\n// packedValue = floor(input[0]) * 256 + input[1],\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue = int(packedValue);\n    int v0 = packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec2 unpack_opacity(const float packedOpacity) {\n    int intOpacity = int(packedOpacity) / 2;\n    return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\n}\n\n// To minimize the number of attributes needed, we encode a 4-component\n// color into a pair of floats (i.e. a vec2) as follows:\n// [ floor(color.r * 255) * 256 + color.g * 255,\n//   floor(color.b * 255) * 256 + color.g * 255 ]\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n        unpack_float(encodedColor[0]) / 255.0,\n        unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\n// Unpack a pair of paint values and interpolate between them.\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nvec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\n    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},background:{fragmentSource:"uniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main() {\n    gl_FragColor = u_color * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},backgroundPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\nuniform float u_opacity;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\nvoid main() {\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},circle:{fragmentSource:"#pragma emapgoWebGl: define highp vec4 color\n#pragma emapgoWebGl: define mediump float radius\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n#pragma emapgoWebGl: define highp vec4 stroke_color\n#pragma emapgoWebGl: define mediump float stroke_width\n#pragma emapgoWebGl: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 color\n    #pragma emapgoWebGl: initialize mediump float radius\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n    #pragma emapgoWebGl: initialize highp vec4 stroke_color\n    #pragma emapgoWebGl: initialize mediump float stroke_width\n    #pragma emapgoWebGl: initialize lowp float stroke_opacity\n\n    vec2 extrude = v_data.xy;\n    float extrude_length = length(extrude);\n\n    lowp float antialiasblur = v_data.z;\n    float antialiased_blur = -max(blur, antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform bool u_pitch_with_map;\nuniform vec2 u_extrude_scale;\nuniform highp float u_camera_to_center_distance;\n\nattribute vec2 a_pos;\n\n#pragma emapgoWebGl: define highp vec4 color\n#pragma emapgoWebGl: define mediump float radius\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n#pragma emapgoWebGl: define highp vec4 stroke_color\n#pragma emapgoWebGl: define mediump float stroke_width\n#pragma emapgoWebGl: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main(void) {\n    #pragma emapgoWebGl: initialize highp vec4 color\n    #pragma emapgoWebGl: initialize mediump float radius\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n    #pragma emapgoWebGl: initialize highp vec4 stroke_color\n    #pragma emapgoWebGl: initialize mediump float stroke_width\n    #pragma emapgoWebGl: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec2 circle_center = floor(a_pos * 0.5);\n    if (u_pitch_with_map) {\n        vec2 corner_position = circle_center;\n        if (u_scale_with_map) {\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale;\n        } else {\n            // Pitching the circle with the map effectively scales it with the map\n            // To counteract the effect for pitch-scale: viewport, we rescale the\n            // whole circle based on the pitch scaling effect at its central point\n            vec4 projected_center = u_matrix * vec4(circle_center, 0, 1);\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\n        }\n\n        gl_Position = u_matrix * vec4(corner_position, 0, 1);\n    } else {\n        gl_Position = u_matrix * vec4(circle_center, 0, 1);\n\n        if (u_scale_with_map) {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\n        } else {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n        }\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    lowp float antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n\n    v_data = vec3(extrude.x, extrude.y, antialiasblur);\n}\n"},clippingMask:{fragmentSource:"void main() {\n    gl_FragColor = vec4(1.0);\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},heatmap:{fragmentSource:"#pragma emapgoWebGl: define highp float weight\n\nuniform highp float u_intensity;\nvarying vec2 v_extrude;\n\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\n#define GAUSS_COEF 0.3989422804014327\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp float weight\n\n    // Kernel density estimation with a Gaussian kernel of size 5x5\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = weight * u_intensity * GAUSS_COEF * exp(d);\n\n    gl_FragColor = vec4(val, 1.0, 1.0, 1.0);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"#pragma emapgoWebGl: define highp float weight\n#pragma emapgoWebGl: define mediump float radius\n\nuniform mat4 u_matrix;\nuniform float u_extrude_scale;\nuniform float u_opacity;\nuniform float u_intensity;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_extrude;\n\n// Effective \"0\" in the kernel density texture to adjust the kernel size to;\n// this empirically chosen number minimizes artifacts on overlapping kernels\n// for typical heatmap cases (assuming clustered source)\nconst highp float ZERO = 1.0 / 255.0 / 16.0;\n\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\n#define GAUSS_COEF 0.3989422804014327\n\nvoid main(void) {\n    #pragma emapgoWebGl: initialize highp float weight\n    #pragma emapgoWebGl: initialize mediump float radius\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 unscaled_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // This 'extrude' comes in ranging from [-1, -1], to [1, 1].  We'll use\n    // it to produce the vertices of a square mesh framing the point feature\n    // we're adding to the kernel density texture.  We'll also pass it as\n    // a varying, so that the fragment shader can determine the distance of\n    // each fragment from the point feature.\n    // Before we do so, we need to scale it up sufficiently so that the\n    // kernel falls effectively to zero at the edge of the mesh.\n    // That is, we want to know S such that\n    // weight * u_intensity * GAUSS_COEF * exp(-0.5 * 3.0^2 * S^2) == ZERO\n    // Which solves to:\n    // S = sqrt(-2.0 * log(ZERO / (weight * u_intensity * GAUSS_COEF))) / 3.0\n    float S = sqrt(-2.0 * log(ZERO / weight / u_intensity / GAUSS_COEF)) / 3.0;\n\n    // Pass the varying in units of radius\n    v_extrude = S * unscaled_extrude;\n\n    // Scale by radius and the zoom-based scale factor to produce actual\n    // mesh position\n    vec2 extrude = v_extrude * radius * u_extrude_scale;\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec4 pos = vec4(floor(a_pos * 0.5) + extrude, 0, 1);\n\n    gl_Position = u_matrix * pos;\n}\n"},heatmapTexture:{fragmentSource:"uniform sampler2D u_image;\nuniform sampler2D u_color_ramp;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    float t = texture2D(u_image, v_pos).r;\n    vec4 color = texture2D(u_color_ramp, vec2(t, 0.5));\n    gl_FragColor = color * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x = a_pos.x;\n    v_pos.y = 1.0 - a_pos.y;\n}\n"},collisionBox:{fragmentSource:"\nvarying float v_placed;\nvarying float v_notUsed;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    // Red = collision, hide label\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n\n    // Blue = no collision, label is showing\n    if (v_placed > 0.5) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\n    }\n\n    if (v_notUsed > 0.5) {\n        // This box not used, fade it out\n        gl_FragColor *= .1;\n    }\n}",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_anchor_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_placed;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\nuniform float u_camera_to_center_distance;\n\nvarying float v_placed;\nvarying float v_notUsed;\n\nvoid main() {\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    highp float collision_perspective_ratio = clamp(\n        0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance),\n        0.0, // Prevents oversized near-field boxes in pitched/overzoomed tiles\n        4.0);\n\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n    gl_Position.xy += a_extrude * u_extrude_scale * gl_Position.w * collision_perspective_ratio;\n\n    v_placed = a_placed.x;\n    v_notUsed = a_placed.y;\n}\n"},collisionCircle:{fragmentSource:"uniform float u_overscale_factor;\n\nvarying float v_placed;\nvarying float v_notUsed;\nvarying float v_radius;\nvarying vec2 v_extrude;\nvarying vec2 v_extrude_scale;\n\nvoid main() {\n    float alpha = 0.5;\n\n    // Red = collision, hide label\n    vec4 color = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n\n    // Blue = no collision, label is showing\n    if (v_placed > 0.5) {\n        color = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\n    }\n\n    if (v_notUsed > 0.5) {\n        // This box not used, fade it out\n        color *= .2;\n    }\n\n    float extrude_scale_length = length(v_extrude_scale);\n    float extrude_length = length(v_extrude) * extrude_scale_length;\n    float stroke_width = 15.0 * extrude_scale_length / u_overscale_factor;\n    float radius = v_radius * extrude_scale_length;\n\n    float distance_to_edge = abs(extrude_length - radius);\n    float opacity_t = smoothstep(-stroke_width, 0.0, -distance_to_edge);\n\n    gl_FragColor = opacity_t * color;\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_anchor_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_placed;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\nuniform float u_camera_to_center_distance;\n\nvarying float v_placed;\nvarying float v_notUsed;\nvarying float v_radius;\n\nvarying vec2 v_extrude;\nvarying vec2 v_extrude_scale;\n\nvoid main() {\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    highp float collision_perspective_ratio = clamp(\n        0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance),\n        0.0, // Prevents oversized near-field circles in pitched/overzoomed tiles\n        4.0);\n\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n\n    highp float padding_factor = 1.2; // Pad the vertices slightly to make room for anti-alias blur\n    gl_Position.xy += a_extrude * u_extrude_scale * padding_factor * gl_Position.w * collision_perspective_ratio;\n\n    v_placed = a_placed.x;\n    v_notUsed = a_placed.y;\n    v_radius = abs(a_extrude.y); // We don't pitch the circles, so both units of the extrusion vector are equal in magnitude to the radius\n\n    v_extrude = a_extrude * padding_factor;\n    v_extrude_scale = u_extrude_scale * u_camera_to_center_distance * collision_perspective_ratio;\n}\n"},debug:{fragmentSource:"uniform highp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fill:{fragmentSource:"#pragma emapgoWebGl: define highp vec4 color\n#pragma emapgoWebGl: define lowp float opacity\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 color\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma emapgoWebGl: define highp vec4 color\n#pragma emapgoWebGl: define lowp float opacity\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 color\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma emapgoWebGl: define highp vec4 outline_color\n#pragma emapgoWebGl: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 outline_color\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma emapgoWebGl: define highp vec4 outline_color\n#pragma emapgoWebGl: define lowp float opacity\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 outline_color\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma emapgoWebGl: define lowp float opacity\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma emapgoWebGl: define lowp float opacity\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma emapgoWebGl: define lowp float opacity\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma emapgoWebGl: define lowp float opacity\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma emapgoWebGl: define lowp float base\n#pragma emapgoWebGl: define lowp float height\n#pragma emapgoWebGl: define highp vec4 color\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float base\n    #pragma emapgoWebGl: initialize lowp float height\n    #pragma emapgoWebGl: initialize highp vec4 color\n\n    gl_FragColor = v_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec4 a_normal_ed;\n\nvarying vec4 v_color;\n\n#pragma emapgoWebGl: define lowp float base\n#pragma emapgoWebGl: define lowp float height\n\n#pragma emapgoWebGl: define highp vec4 color\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float base\n    #pragma emapgoWebGl: initialize lowp float height\n    #pragma emapgoWebGl: initialize highp vec4 color\n\n    vec3 normal = a_normal_ed.xyz;\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float t = mod(normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma emapgoWebGl: define lowp float base\n#pragma emapgoWebGl: define lowp float height\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float base\n    #pragma emapgoWebGl: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec4 a_normal_ed;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma emapgoWebGl: define lowp float base\n#pragma emapgoWebGl: define lowp float height\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float base\n    #pragma emapgoWebGl: initialize lowp float height\n\n    vec3 normal = a_normal_ed.xyz;\n    float edgedistance = a_normal_ed.w;\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float t = mod(normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = normal.x == 1.0 && normal.y == 0.0 && normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_image;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_image, v_pos) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x = a_pos.x;\n    v_pos.y = 1.0 - a_pos.y;\n}\n"},hillshadePrepare:{fragmentSource:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D u_image;\nvarying vec2 v_pos;\nuniform vec2 u_dimension;\nuniform float u_zoom;\nuniform float u_maxzoom;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_image, coord) * 255.0;\n    return (data.r + data.g * 256.0 + data.b * 256.0 * 256.0) / 4.0;\n}\n\nvoid main() {\n    vec2 epsilon = 1.0 / u_dimension;\n\n    // queried pixels:\n    // +-----------+\n    // |   |   |   |\n    // | a | b | c |\n    // |   |   |   |\n    // +-----------+\n    // |   |   |   |\n    // | d | e | f |\n    // |   |   |   |\n    // +-----------+\n    // |   |   |   |\n    // | g | h | i |\n    // |   |   |   |\n    // +-----------+\n\n    float a = getElevation(v_pos + vec2(-epsilon.x, -epsilon.y), 0.0);\n    float b = getElevation(v_pos + vec2(0, -epsilon.y), 0.0);\n    float c = getElevation(v_pos + vec2(epsilon.x, -epsilon.y), 0.0);\n    float d = getElevation(v_pos + vec2(-epsilon.x, 0), 0.0);\n    float e = getElevation(v_pos, 0.0);\n    float f = getElevation(v_pos + vec2(epsilon.x, 0), 0.0);\n    float g = getElevation(v_pos + vec2(-epsilon.x, epsilon.y), 0.0);\n    float h = getElevation(v_pos + vec2(0, epsilon.y), 0.0);\n    float i = getElevation(v_pos + vec2(epsilon.x, epsilon.y), 0.0);\n\n    // here we divide the x and y slopes by 8 * pixel size\n    // where pixel size (aka meters/pixel) is:\n    // circumference of the world / (pixels per tile * number of tiles)\n    // which is equivalent to: 8 * 40075016.6855785 / (512 * pow(2, u_zoom))\n    // which can be reduced to: pow(2, 19.25619978527 - u_zoom)\n    // we want to vertically exaggerate the hillshading though, because otherwise\n    // it is barely noticeable at low zooms. to do this, we multiply this by some\n    // scale factor pow(2, (u_zoom - u_maxzoom) * a) where a is an arbitrary value\n    // Here we use a=0.3 which works out to the expression below. see \n    // nickidlugash's awesome breakdown for more info\n    // emapgo-webportal\n    float exaggeration = u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\n\n    vec2 deriv = vec2(\n        (c + f + f + i) - (a + d + d + g),\n        (g + h + h + i) - (a + b + b + c)\n    ) /  pow(2.0, (u_zoom - u_maxzoom) * exaggeration + 19.2562 - u_zoom);\n\n    gl_FragColor = clamp(vec4(\n        deriv.x / 2.0 + 0.5,\n        deriv.y / 2.0 + 0.5,\n        1.0,\n        1.0), 0.0, 1.0);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (a_texture_pos / 8192.0) / 2.0 + 0.25;\n}\n"},hillshade:{fragmentSource:"uniform sampler2D u_image;\nvarying vec2 v_pos;\n\nuniform vec2 u_latrange;\nuniform vec2 u_light;\nuniform vec4 u_shadow;\nuniform vec4 u_highlight;\nuniform vec4 u_accent;\n\n#define PI 3.141592653589793\n\nvoid main() {\n    vec4 pixel = texture2D(u_image, v_pos);\n\n    vec2 deriv = ((pixel.rg * 2.0) - 1.0);\n\n    // We divide the slope by a scale factor based on the cosin of the pixel's approximate latitude\n    // to account for mercator projection distortion. see #4807 for details\n    float scaleFactor = cos(radians((u_latrange[0] - u_latrange[1]) * (1.0 - v_pos.y) + u_latrange[1]));\n    // We also multiply the slope by an arbitrary z-factor of 1.25\n    float slope = atan(1.25 * length(deriv) / scaleFactor);\n    float aspect = deriv.x != 0.0 ? atan(deriv.y, -deriv.x) : PI / 2.0 * (deriv.y > 0.0 ? 1.0 : -1.0);\n\n    float intensity = u_light.x;\n    // We add PI to make this property match the global light object, which adds PI/2 to the light's azimuthal\n    // position property to account for 0deg corresponding to north/the top of the viewport in the style spec\n    // and the original shader was written to accept (-illuminationDirection - 90) as the azimuthal.\n    float azimuth = u_light.y + PI;\n\n    // We scale the slope exponentially based on intensity, using a calculation similar to\n    // the exponential interpolation function in the style spec:\n    // emapgo-webportal\n    // so that higher intensity values create more opaque hillshading.\n    float base = 1.875 - intensity * 1.75;\n    float maxValue = 0.5 * PI;\n    float scaledSlope = intensity != 0.5 ? ((pow(base, slope) - 1.0) / (pow(base, maxValue) - 1.0)) * maxValue : slope;\n\n    // The accent color is calculated with the cosine of the slope while the shade color is calculated with the sine\n    // so that the accent color's rate of change eases in while the shade color's eases out.\n    float accent = cos(scaledSlope);\n    // We multiply both the accent and shade color by a clamped intensity value\n    // so that intensities >= 0.5 do not additionally affect the color values\n    // while intensity values < 0.5 make the overall color more transparent.\n    vec4 accent_color = (1.0 - accent) * u_accent * clamp(intensity * 2.0, 0.0, 1.0);\n    float shade = abs(mod((aspect + azimuth) / PI + 0.5, 2.0) - 1.0);\n    vec4 shade_color = mix(u_shadow, u_highlight, shade) * sin(scaledSlope) * clamp(intensity * 2.0, 0.0, 1.0);\n    gl_FragColor = accent_color * (1.0 - shade_color.a) + shade_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = a_texture_pos / 8192.0;\n}\n"},line:{fragmentSource:"#pragma emapgoWebGl: define highp vec4 color\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 color\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying highp float v_linesofar;\n\n#pragma emapgoWebGl: define highp vec4 color\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n#pragma emapgoWebGl: define mediump float gapwidth\n#pragma emapgoWebGl: define lowp float offset\n#pragma emapgoWebGl: define mediump float width\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 color\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n    #pragma emapgoWebGl: initialize mediump float gapwidth\n    #pragma emapgoWebGl: initialize lowp float offset\n    #pragma emapgoWebGl: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    v_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * 2.0;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},lineGradient:{fragmentSource:"\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n\nuniform sampler2D u_image;\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nvarying highp float v_lineprogress;\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    // For gradient lines, v_lineprogress is the ratio along the entire line,\n    // scaled to [0, 2^15), and the gradient ramp is stored in a texture.\n    vec4 color = texture2D(u_image, vec2(v_lineprogress, 0.5));\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n// the attribute conveying progress along a line is scaled to [0, 2^15)\n#define MAX_LINE_DISTANCE 32767.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying highp float v_lineprogress;\n\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n#pragma emapgoWebGl: define mediump float gapwidth\n#pragma emapgoWebGl: define lowp float offset\n#pragma emapgoWebGl: define mediump float width\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n    #pragma emapgoWebGl: initialize mediump float gapwidth\n    #pragma emapgoWebGl: initialize lowp float offset\n    #pragma emapgoWebGl: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    v_lineprogress = (floor(a_data.z / 4.0) + a_data.w * 64.0) * 2.0 / MAX_LINE_DISTANCE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n\n    // v_normal.y is 0 at the midpoint of the line, -1 at the lower edge, 1 at the upper edge\n    // we clamp the line width outset to be between 0 and half the pattern height plus padding (2.0)\n    // to ensure we don't sample outside the designated symbol on the sprite sheet.\n    // 0.5 is added to shift the component to be bounded between 0 and 1 for interpolation of\n    // the texture coordinate\n    float y_a = 0.5 + (v_normal.y * clamp(v_width2.s, 0.0, (u_pattern_size_a.y + 2.0) / 2.0) / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * clamp(v_width2.s, 0.0, (u_pattern_size_b.y + 2.0) / 2.0) / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n#pragma emapgoWebGl: define lowp float offset\n#pragma emapgoWebGl: define mediump float gapwidth\n#pragma emapgoWebGl: define mediump float width\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n    #pragma emapgoWebGl: initialize lowp float offset\n    #pragma emapgoWebGl: initialize mediump float gapwidth\n    #pragma emapgoWebGl: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma emapgoWebGl: define highp vec4 color\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n#pragma emapgoWebGl: define mediump float width\n#pragma emapgoWebGl: define lowp float floorwidth\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 color\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n    #pragma emapgoWebGl: initialize mediump float width\n    #pragma emapgoWebGl: initialize lowp float floorwidth\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma / floorwidth, 0.5 + u_sdfgamma / floorwidth, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma emapgoWebGl: define highp vec4 color\n#pragma emapgoWebGl: define lowp float blur\n#pragma emapgoWebGl: define lowp float opacity\n#pragma emapgoWebGl: define mediump float gapwidth\n#pragma emapgoWebGl: define lowp float offset\n#pragma emapgoWebGl: define mediump float width\n#pragma emapgoWebGl: define lowp float floorwidth\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 color\n    #pragma emapgoWebGl: initialize lowp float blur\n    #pragma emapgoWebGl: initialize lowp float opacity\n    #pragma emapgoWebGl: initialize mediump float gapwidth\n    #pragma emapgoWebGl: initialize lowp float offset\n    #pragma emapgoWebGl: initialize mediump float width\n    #pragma emapgoWebGl: initialize lowp float floorwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x / floorwidth, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x / floorwidth, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    if (color0.a > 0.0) {\n        color0.rgb = color0.rgb / color0.a;\n    }\n    if (color1.a > 0.0) {\n        color1.rgb = color1.rgb / color1.a;\n    }\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    // We are using Int16 for texture position coordinates to give us enough precision for\n    // fractional coordinates. We use 8192 to scale the texture coordinates in the buffer\n    // as an arbitrarily high number to preserve adequate precision when rendering.\n    // This is also the same value as the EXTENT we are using for our tile buffer pos coordinates,\n    // so math for modifying either is consistent.\n    v_pos0 = (((a_texture_pos / 8192.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\n\n#pragma emapgoWebGl: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    lowp float alpha = opacity * v_fade_opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\nuniform highp float u_camera_to_center_distance;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform float u_fade_change;\n\n#pragma emapgoWebGl: define lowp float opacity\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\nvoid main() {\n    #pragma emapgoWebGl: initialize lowp float opacity\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp float segment_angle = -a_projected_pos[2];\n\n    float size;\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // See comments in symbol_sdf.vertex\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = clamp(\n            0.5 + 0.5 * distance_ratio,\n            0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\n            4.0);\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // See comments in symbol_sdf.vertex\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.0, 1.0);\n\n    v_tex = a_tex / u_texsize;\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\n    v_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\n}\n"},symbolSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma emapgoWebGl: define highp vec4 fill_color\n#pragma emapgoWebGl: define highp vec4 halo_color\n#pragma emapgoWebGl: define lowp float opacity\n#pragma emapgoWebGl: define lowp float halo_width\n#pragma emapgoWebGl: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform highp float u_gamma_scale;\nuniform bool u_is_text;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 fill_color\n    #pragma emapgoWebGl: initialize highp vec4 halo_color\n    #pragma emapgoWebGl: initialize lowp float opacity\n    #pragma emapgoWebGl: initialize lowp float halo_width\n    #pragma emapgoWebGl: initialize lowp float halo_blur\n\n    vec2 tex = v_data0.xy;\n    float gamma_scale = v_data1.x;\n    float size = v_data1.y;\n    float fade_opacity = v_data1[2];\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n        buff = (6.0 - halo_width / fontScale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, tex).a;\n    highp float gamma_scaled = gamma * gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n    gl_FragColor = color * (alpha * opacity * fade_opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\n// contents of a_size vary based on the type of property value\n// used for {text,icon}-size.\n// For constants, a_size is disabled.\n// For source functions, we bind only one value per vertex: the value of {text,icon}-size evaluated for the current feature.\n// For composite functions:\n// [ text-size(lowerZoomStop, feature),\n//   text-size(upperZoomStop, feature) ]\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\n\n#pragma emapgoWebGl: define highp vec4 fill_color\n#pragma emapgoWebGl: define highp vec4 halo_color\n#pragma emapgoWebGl: define lowp float opacity\n#pragma emapgoWebGl: define lowp float halo_width\n#pragma emapgoWebGl: define lowp float halo_blur\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform highp float u_camera_to_center_distance;\nuniform float u_fade_change;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\nvoid main() {\n    #pragma emapgoWebGl: initialize highp vec4 fill_color\n    #pragma emapgoWebGl: initialize highp vec4 halo_color\n    #pragma emapgoWebGl: initialize lowp float opacity\n    #pragma emapgoWebGl: initialize lowp float halo_width\n    #pragma emapgoWebGl: initialize lowp float halo_blur\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp float segment_angle = -a_projected_pos[2];\n    float size;\n\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // If the label is pitched with the map, layout is done in pitched space,\n    // which makes labels in the distance smaller relative to viewport space.\n    // We counteract part of that effect by multiplying by the perspective ratio.\n    // If the label isn't pitched with the map, we do layout in viewport space,\n    // which makes labels in the distance larger relative to the features around\n    // them. We counteract part of that effect by dividing by the perspective ratio.\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = clamp(\n        0.5 + 0.5 * distance_ratio,\n        0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\n        4.0);\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // Point labels with 'rotation-alignment: map' are horizontal with respect to tile units\n        // To figure out that angle in projected space, we draw a short horizontal line in tile\n        // space, project it, and measure its angle in projected space.\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.0, 1.0);\n    float gamma_scale = gl_Position.w;\n\n    vec2 tex = a_tex / u_texsize;\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\n    float interpolated_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\n\n    v_data0 = vec2(tex.x, tex.y);\n    v_data1 = vec3(gamma_scale, size, interpolated_fade_opacity);\n}\n"}},Sn=/#pragma emapgoWebGl: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g;for(var Tn in En)bn(Tn);function An(t,e,n,i){var r=t.gl;this.program=r.createProgram();var o=n.defines().concat("#define DEVICE_PIXEL_RATIO "+T.devicePixelRatio.toFixed(1));i&&o.push("#define OVERDRAW_INSPECTOR;");var a=o.concat(zn.prelude.fragmentSource,e.fragmentSource).join("\n"),s=o.concat(zn.prelude.vertexSource,e.vertexSource).join("\n"),l=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(l,a),r.compileShader(l),V.default$2(r.getShaderParameter(l,r.COMPILE_STATUS),r.getShaderInfoLog(l)),r.attachShader(this.program,l);var u=r.createShader(r.VERTEX_SHADER);r.shaderSource(u,s),r.compileShader(u),V.default$2(r.getShaderParameter(u,r.COMPILE_STATUS),r.getShaderInfoLog(u)),r.attachShader(this.program,u);for(var c=n.layoutAttributes||[],h=0;h<c.length;h++)r.bindAttribLocation(this.program,h,c[h].name);r.linkProgram(this.program),V.default$2(r.getProgramParameter(this.program,r.LINK_STATUS),r.getProgramInfoLog(this.program)),this.numAttributes=r.getProgramParameter(this.program,r.ACTIVE_ATTRIBUTES),this.attributes={},this.uniforms={};for(var p=0;p<this.numAttributes;p++){var f=r.getActiveAttrib(this.program,p);f&&(this.attributes[f.name]=r.getAttribLocation(this.program,f.name))}for(var d=r.getProgramParameter(this.program,r.ACTIVE_UNIFORMS),m=0;m<d;m++){var y=r.getActiveUniform(this.program,m);y&&(this.uniforms[y.name]=r.getUniformLocation(this.program,y.name))}}var zn=En;function In(t,e,n,i,r){for(var o=0;o<n.length;o++){var a=n[o];if(i.isLessThan(a.tileID))break;if(e.key===a.tileID.key)return;if(a.tileID.isChildOf(e)){for(var s=e.children(1/0),l=0;l<s.length;l++){In(t,s[l],n.slice(o),i,r)}return}}var u=e.overscaledZ-t.overscaledZ,c=new V.CanonicalTileID(u,e.canonical.x-(t.canonical.x<<u),e.canonical.y-(t.canonical.y<<u));r[c.key]=r[c.key]||c}function kn(t,e,n,i,r){var o=t.context,a=o.gl,s=r?t.useProgram("collisionCircle"):t.useProgram("collisionBox");o.setDepthMode(le.disabled),o.setStencilMode(ue.disabled),o.setColorMode(t.colorModeForRenderPass());for(var l=0;l<i.length;l++){var u=i[l],c=e.getTile(u),h=c.getBucket(n);if(h){var p=r?h.collisionCircle:h.collisionBox;if(p){a.uniformMatrix4fv(s.uniforms.u_matrix,!1,u.posMatrix),r||o.lineWidth.set(1),a.uniform1f(s.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance);var f=$e(c,1,t.transform.zoom),d=Math.pow(2,t.transform.zoom-c.tileID.overscaledZ);a.uniform1f(s.uniforms.u_pixels_to_tile_units,f),a.uniform2f(s.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits[0]/(f*d),t.transform.pixelsToGLUnits[1]/(f*d)),a.uniform1f(s.uniforms.u_overscale_factor,c.tileID.overscaleFactor()),s.draw(o,r?a.TRIANGLES:a.LINES,n.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,null,p.collisionVertexBuffer,null)}}}}An.prototype.draw=function(t,e,n,i,r,o,a,s,l){for(var u,c=t.gl,h=((u={})[c.LINES]=2,u[c.TRIANGLES]=3,u)[e],p=0,f=o.get();p<f.length;p+=1){var d=f[p],m=d.vaos||(d.vaos={});(m[n]||(m[n]=new ut)).bind(t,this,i,a?a.getPaintVertexBuffers():[],r,d.vertexOffset,s,l),c.drawElements(e,d.primitiveLength*h,c.UNSIGNED_SHORT,d.primitiveOffset*h*2)}};var Mn=V.mat4.identity(new Float32Array(16)),Cn=V.default$21.layout;function Pn(t,e,n,i,r,o,a,s,l,u){var c,h,p,f,d,m,y,g=t.context,v=g.gl,_=t.transform,x="map"===s,b="map"===l,w=x&&"line"===n.layout.get("symbol-placement"),E=x&&!b&&!w,S=b;g.setDepthMode(S?t.depthModeForSublayer(0,le.ReadOnly):le.disabled);for(var T=0,A=i;T<A.length;T+=1){var z=A[T],I=e.getTile(z),k=I.getBucket(n);if(k){var M=r?k.text:k.icon;if(M&&M.segments.get().length){var C=M.programConfigurations.get(n.id),P=r||k.sdfIcons,L=r?k.textSizeData:k.iconSizeData;if(c||(c=t.useProgram(P?"symbolSDF":"symbolIcon",C),C.setUniforms(t.context,c,n.paint,{zoom:t.transform.zoom}),Ln(c,t,n,r,E,b,L)),g.activeTexture.set(v.TEXTURE0),v.uniform1i(c.uniforms.u_texture,0),r)I.glyphAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.uniform2fv(c.uniforms.u_texsize,I.glyphAtlasTexture.size);else{var D=1!==n.layout.get("icon-size").constantOr(0)||k.iconsNeedLinear,R=b||0!==_.pitch;I.iconAtlasTexture.bind(P||t.options.rotating||t.options.zooming||D||R?v.LINEAR:v.NEAREST,v.CLAMP_TO_EDGE),v.uniform2fv(c.uniforms.u_texsize,I.iconAtlasTexture.size)}v.uniformMatrix4fv(c.uniforms.u_matrix,!1,t.translatePosMatrix(z.posMatrix,I,o,a));var B=$e(I,1,t.transform.zoom),O=Pe(z.posMatrix,b,x,t.transform,B),F=(h=z.posMatrix,p=b,f=x,d=t.transform,m=B,void 0,y=V.mat4.identity(new Float32Array(16)),p?(V.mat4.multiply(y,y,h),V.mat4.scale(y,y,[m,m,1]),f||V.mat4.rotateZ(y,y,-d.angle)):(V.mat4.scale(y,y,[1,-1,1]),V.mat4.translate(y,y,[-1,-1,0]),V.mat4.scale(y,y,[2/d.width,2/d.height,1])),y);v.uniformMatrix4fv(c.uniforms.u_gl_coord_matrix,!1,t.translatePosMatrix(F,I,o,a,!0)),w?(v.uniformMatrix4fv(c.uniforms.u_label_plane_matrix,!1,Mn),De(k,z.posMatrix,t,r,O,F,b,u)):v.uniformMatrix4fv(c.uniforms.u_label_plane_matrix,!1,O),v.uniform1f(c.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),Dn(c,C,t,n,I,M,r,P,b)}}}}function Ln(t,e,n,i,r,o,a){var s=e.context.gl,l=e.transform;s.uniform1i(t.uniforms.u_pitch_with_map,o?1:0),s.uniform1f(t.uniforms.u_is_text,i?1:0),s.uniform1f(t.uniforms.u_pitch,l.pitch/360*2*Math.PI);var u="constant"===a.functionType||"source"===a.functionType,c="constant"===a.functionType||"camera"===a.functionType;s.uniform1i(t.uniforms.u_is_size_zoom_constant,u?1:0),s.uniform1i(t.uniforms.u_is_size_feature_constant,c?1:0),s.uniform1f(t.uniforms.u_camera_to_center_distance,l.cameraToCenterDistance);var h=V.evaluateSizeForZoom(a,l.zoom,Cn.properties[i?"text-size":"icon-size"]);void 0!==h.uSizeT&&s.uniform1f(t.uniforms.u_size_t,h.uSizeT),void 0!==h.uSize&&s.uniform1f(t.uniforms.u_size,h.uSize),s.uniform1f(t.uniforms.u_aspect_ratio,l.width/l.height),s.uniform1i(t.uniforms.u_rotate_symbol,r?1:0)}function Dn(t,e,n,i,r,o,a,s,l){var u=n.context,c=u.gl,h=n.transform;if(s){var p=0!==i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),f=l?Math.cos(h._pitch)*h.cameraToCenterDistance:1;c.uniform1f(t.uniforms.u_gamma_scale,f),p&&(c.uniform1f(t.uniforms.u_is_halo,1),Rn(o,i,u,t)),c.uniform1f(t.uniforms.u_is_halo,0)}Rn(o,i,u,t)}function Rn(t,e,n,i){i.draw(n,n.gl.TRIANGLES,e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,t.programConfigurations.get(e.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Bn(t,e,n,i,r,o,a,s,l){var u,c,h,p,f=e.context,d=f.gl,m=r.paint.get("line-dasharray"),y=r.paint.get("line-pattern");if(s||l){var g=1/$e(n,1,e.transform.tileZoom);if(m){u=e.lineAtlas.getDash(m.from,"round"===r.layout.get("line-cap")),c=e.lineAtlas.getDash(m.to,"round"===r.layout.get("line-cap"));var v=u.width*m.fromScale,_=c.width*m.toScale;d.uniform2f(t.uniforms.u_patternscale_a,g/v,-u.height/2),d.uniform2f(t.uniforms.u_patternscale_b,g/_,-c.height/2),d.uniform1f(t.uniforms.u_sdfgamma,e.lineAtlas.width/(256*Math.min(v,_)*T.devicePixelRatio)/2)}else if(y){if(h=e.imageManager.getPattern(y.from),p=e.imageManager.getPattern(y.to),!h||!p)return;d.uniform2f(t.uniforms.u_pattern_size_a,h.displaySize[0]*y.fromScale/g,h.displaySize[1]),d.uniform2f(t.uniforms.u_pattern_size_b,p.displaySize[0]*y.toScale/g,p.displaySize[1]);var x=e.imageManager.getPixelSize(),b=x.width,w=x.height;d.uniform2fv(t.uniforms.u_texsize,[b,w])}d.uniform2f(t.uniforms.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1])}s&&(m?(d.uniform1i(t.uniforms.u_image,0),f.activeTexture.set(d.TEXTURE0),e.lineAtlas.bind(f),d.uniform1f(t.uniforms.u_tex_y_a,u.y),d.uniform1f(t.uniforms.u_tex_y_b,c.y),d.uniform1f(t.uniforms.u_mix,m.t)):y&&(d.uniform1i(t.uniforms.u_image,0),f.activeTexture.set(d.TEXTURE0),e.imageManager.bind(f),d.uniform2fv(t.uniforms.u_pattern_tl_a,h.tl),d.uniform2fv(t.uniforms.u_pattern_br_a,h.br),d.uniform2fv(t.uniforms.u_pattern_tl_b,p.tl),d.uniform2fv(t.uniforms.u_pattern_br_b,p.br),d.uniform1f(t.uniforms.u_fade,y.t))),f.setStencilMode(e.stencilModeForClipping(o));var E=e.translatePosMatrix(o.posMatrix,n,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"));if(d.uniformMatrix4fv(t.uniforms.u_matrix,!1,E),d.uniform1f(t.uniforms.u_ratio,1/$e(n,1,e.transform.zoom)),r.paint.get("line-gradient")){f.activeTexture.set(d.TEXTURE0);var S=r.gradientTexture;if(!r.gradient)return;(S=S||(r.gradientTexture=new k(f,r.gradient,d.RGBA))).bind(d.LINEAR,d.CLAMP_TO_EDGE),d.uniform1i(t.uniforms.u_image,0)}t.draw(f,d.TRIANGLES,r.id,i.layoutVertexBuffer,i.indexBuffer,i.segments,a)}var On=function(t,e){if(!t)return!1;var n=e.imageManager.getPattern(t.from),i=e.imageManager.getPattern(t.to);return!n||!i},Fn=function(t,e,n){var i=e.context,r=i.gl,o=e.imageManager.getPattern(t.from),a=e.imageManager.getPattern(t.to);V.default$2(o&&a),r.uniform1i(n.uniforms.u_image,0),r.uniform2fv(n.uniforms.u_pattern_tl_a,o.tl),r.uniform2fv(n.uniforms.u_pattern_br_a,o.br),r.uniform2fv(n.uniforms.u_pattern_tl_b,a.tl),r.uniform2fv(n.uniforms.u_pattern_br_b,a.br);var s=e.imageManager.getPixelSize(),l=s.width,u=s.height;r.uniform2fv(n.uniforms.u_texsize,[l,u]),r.uniform1f(n.uniforms.u_mix,t.t),r.uniform2fv(n.uniforms.u_pattern_size_a,o.displaySize),r.uniform2fv(n.uniforms.u_pattern_size_b,a.displaySize),r.uniform1f(n.uniforms.u_scale_a,t.fromScale),r.uniform1f(n.uniforms.u_scale_b,t.toScale),i.activeTexture.set(r.TEXTURE0),e.imageManager.bind(e.context)},Vn=function(t,e,n){var i=e.context.gl;i.uniform1f(n.uniforms.u_tile_units_to_pixels,1/$e(t,1,e.transform.tileZoom));var r=Math.pow(2,t.tileID.overscaledZ),o=t.tileSize*Math.pow(2,e.transform.tileZoom)/r,a=o*(t.tileID.canonical.x+t.tileID.wrap*r),s=o*t.tileID.canonical.y;i.uniform2f(n.uniforms.u_pixel_coord_upper,a>>16,s>>16),i.uniform2f(n.uniforms.u_pixel_coord_lower,65535&a,65535&s)};function Nn(t,e,n,i,r){if(!On(n.paint.get("fill-pattern"),t))for(var o=!0,a=0,s=i;a<s.length;a+=1){var l=s[a],u=e.getTile(l),c=u.getBucket(n);c&&(t.context.setStencilMode(t.stencilModeForClipping(l)),r(t,e,n,u,l,c,o),o=!1)}}function jn(t,e,n,i,r,o,a){var s=t.context.gl,l=o.programConfigurations.get(n.id);Un("fill",n.paint.get("fill-pattern"),t,l,n,i,r,a).draw(t.context,s.TRIANGLES,n.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,l)}function Gn(t,e,n,i,r,o,a){var s=t.context.gl,l=o.programConfigurations.get(n.id),u=Un("fillOutline",n.getPaintProperty("fill-outline-color")?null:n.paint.get("fill-pattern"),t,l,n,i,r,a);s.uniform2f(u.uniforms.u_world,s.drawingBufferWidth,s.drawingBufferHeight),u.draw(t.context,s.LINES,n.id,o.layoutVertexBuffer,o.indexBuffer2,o.segments2,l)}function Un(t,e,n,i,r,o,a,s){var l,u=n.context.program.get();return e?(l=n.useProgram(t+"Pattern",i),!s&&l.program===u||(i.setUniforms(n.context,l,r.paint,{zoom:n.transform.zoom}),Fn(e,n,l)),Vn(o,n,l)):(l=n.useProgram(t,i),!s&&l.program===u||i.setUniforms(n.context,l,r.paint,{zoom:n.transform.zoom})),n.context.gl.uniformMatrix4fv(l.uniforms.u_matrix,!1,n.translatePosMatrix(a.posMatrix,o,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"))),l}var Wn=V.default$22.mat3,$n=V.default$22.mat4,qn=V.default$22.vec3;function Zn(t,e,n,i,r,o,a){var s=t.context,l=s.gl,u=n.paint.get("fill-extrusion-pattern"),c=t.context.program.get(),h=o.programConfigurations.get(n.id),p=t.useProgram(u?"fillExtrusionPattern":"fillExtrusion",h);if(!a&&p.program===c||h.setUniforms(s,p,n.paint,{zoom:t.transform.zoom}),u){if(On(u,t))return;Fn(u,t,p),Vn(i,t,p),l.uniform1f(p.uniforms.u_height_factor,-Math.pow(2,r.overscaledZ)/i.tileSize/8)}t.context.gl.uniformMatrix4fv(p.uniforms.u_matrix,!1,t.translatePosMatrix(r.posMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor"))),function(t,e){var n=e.context.gl,i=e.style.light,r=i.properties.get("position"),o=[r.x,r.y,r.z],a=Wn.create();"viewport"===i.properties.get("anchor")&&Wn.fromRotation(a,-e.transform.angle);qn.transformMat3(o,o,a);var s=i.properties.get("color");n.uniform3fv(t.uniforms.u_lightpos,o),n.uniform1f(t.uniforms.u_lightintensity,i.properties.get("intensity")),n.uniform3f(t.uniforms.u_lightcolor,s.r,s.g,s.b)}(p,t),p.draw(s,l.TRIANGLES,n.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,h)}function Xn(t,e,n){var i=t.context,r=i.gl,o=e.fbo;if(o){var a=t.useProgram("hillshade"),s=t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),!0);!function(t,e,n){var i=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(i-=e.transform.angle),e.context.gl.uniform2f(t.uniforms.u_light,n.paint.get("hillshade-exaggeration"),i)}(a,t,n);var l=function(t,e){var n=e.toCoordinate(),i=new V.default$19(n.column,n.row+1,n.zoom);return[t.transform.coordinateLocation(n).lat,t.transform.coordinateLocation(i).lat]}(t,e.tileID);i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),r.uniformMatrix4fv(a.uniforms.u_matrix,!1,s),r.uniform2fv(a.uniforms.u_latrange,l),r.uniform1i(a.uniforms.u_image,0);var u=n.paint.get("hillshade-shadow-color");r.uniform4f(a.uniforms.u_shadow,u.r,u.g,u.b,u.a);var c=n.paint.get("hillshade-highlight-color");r.uniform4f(a.uniforms.u_highlight,c.r,c.g,c.b,c.a);var h=n.paint.get("hillshade-accent-color");if(r.uniform4f(a.uniforms.u_accent,h.r,h.g,h.b,h.a),e.maskedBoundsBuffer&&e.maskedIndexBuffer&&e.segments)a.draw(i,r.TRIANGLES,n.id,e.maskedBoundsBuffer,e.maskedIndexBuffer,e.segments);else{var p=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(i,a,p,[]),r.drawArrays(r.TRIANGLE_STRIP,0,p.length)}}}function Hn(t,e,n){var i=t.context,r=i.gl;if(e.dem&&e.dem.level){var o=e.dem.level.dim,a=e.dem.getPixels();if(i.activeTexture.set(r.TEXTURE1),i.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(e.tileSize),e.demTexture){var s=e.demTexture;s.update(a,!1),s.bind(r.NEAREST,r.CLAMP_TO_EDGE)}else e.demTexture=new k(i,a,r.RGBA,!1),e.demTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE);i.activeTexture.set(r.TEXTURE0);var l=e.fbo;if(!l){var u=new k(i,{width:o,height:o,data:null},r.RGBA);u.bind(r.LINEAR,r.CLAMP_TO_EDGE),(l=e.fbo=i.createFramebuffer(o,o)).colorAttachment.set(u.texture)}i.bindFramebuffer.set(l.framebuffer),i.viewport.set([0,0,o,o]);var c=V.mat4.create();V.mat4.ortho(c,0,V.default$9,-V.default$9,0,0,1),V.mat4.translate(c,c,[0,-V.default$9,0]);var h=t.useProgram("hillshadePrepare");r.uniformMatrix4fv(h.uniforms.u_matrix,!1,c),r.uniform1f(h.uniforms.u_zoom,e.tileID.overscaledZ),r.uniform2fv(h.uniforms.u_dimension,[2*o,2*o]),r.uniform1i(h.uniforms.u_image,1),r.uniform1f(h.uniforms.u_maxzoom,n);var p=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(i,h,p,[]),r.drawArrays(r.TRIANGLE_STRIP,0,p.length),e.needsHillshadePrepare=!1}}function Kn(t,e,n,i,r){var o=i.paint.get("raster-fade-duration");if(0<o){var a=T.now(),s=(a-t.timeAdded)/o,l=e?(a-e.timeAdded)/o:-1,u=n.getSource(),c=r.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),h=!e||Math.abs(e.tileID.overscaledZ-c)>Math.abs(t.tileID.overscaledZ-c),p=h&&t.refreshedUponExpiration?1:V.clamp(h?s:1-l,0,1);return t.refreshedUponExpiration&&1<=s&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}function Yn(t,e,n){var i=t.context,r=i.gl;i.lineWidth.set(1*T.devicePixelRatio);var o=n.posMatrix,a=t.useProgram("debug");i.setDepthMode(le.disabled),i.setStencilMode(ue.disabled),i.setColorMode(t.colorModeForRenderPass()),r.uniformMatrix4fv(a.uniforms.u_matrix,!1,o),r.uniform4f(a.uniforms.u_color,1,0,0,1),t.debugVAO.bind(i,a,t.debugBuffer,[]),r.drawArrays(r.LINE_STRIP,0,t.debugBuffer.length);for(var s=function(t,e,n,i){i=i||1;var r,o,a,s,l,u,c,h,p=[];for(r=0,o=t.length;r<o;r++)if(l=Jn[t[r]]){for(h=null,a=0,s=l[1].length;a<s;a+=2)h=-1===l[1][a]&&-1===l[1][a+1]?null:(u=e+l[1][a]*i,c=n-l[1][a+1]*i,h&&p.push(h.x,h.y,u,c),{x:u,y:c});e+=l[0]*i}return p}(n.toString(),50,200,5),l=new V.PosArray,u=0;u<s.length;u+=2)l.emplaceBack(s[u],s[u+1]);var c=i.createVertexBuffer(l,wn.members);(new ut).bind(i,a,c,[]),r.uniform4f(a.uniforms.u_color,1,1,1,1);for(var h=e.getTile(n).tileSize,p=V.default$9/(Math.pow(2,t.transform.zoom-n.overscaledZ)*h),f=[[-1,-1],[-1,1],[1,-1],[1,1]],d=0;d<f.length;d++){var m=f[d];r.uniformMatrix4fv(a.uniforms.u_matrix,!1,V.mat4.translate([],o,[p*m[0],p*m[1],0])),r.drawArrays(r.LINES,0,c.length)}r.uniform4f(a.uniforms.u_color,0,0,0,1),r.uniformMatrix4fv(a.uniforms.u_matrix,!1,o),r.drawArrays(r.LINES,0,c.length)}var Jn={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};function Qn(t,e){this.context=new he(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=fe.maxUnderzooming+fe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new V.default$26,this.crossTileSymbolIndex=new dn}var ti={symbol:function(t,e,n,i){if("translucent"===t.renderPass){var r=t.context;r.setStencilMode(ue.disabled),r.setColorMode(t.colorModeForRenderPass()),0!==n.paint.get("icon-opacity").constantOr(1)&&Pn(t,e,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright")),0!==n.paint.get("text-opacity").constantOr(1)&&Pn(t,e,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright")),e.map.showCollisionBoxes&&function(t,e,n,i){kn(t,e,n,i,!1),kn(t,e,n,i,!0)}(t,e,n,i)}},circle:function(t,e,n,i){if("translucent"===t.renderPass){var r=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity");if(0!==r.constantOr(1)||0!==o.constantOr(1)&&0!==a.constantOr(1)){var s=t.context,l=s.gl;s.setDepthMode(t.depthModeForSublayer(0,le.ReadOnly)),s.setStencilMode(ue.disabled),s.setColorMode(t.colorModeForRenderPass());for(var u=!0,c=0;c<i.length;c++){var h=i[c],p=e.getTile(h),f=p.getBucket(n);if(f){var d=t.context.program.get(),m=f.programConfigurations.get(n.id),y=t.useProgram("circle",m);if(!u&&y.program===d||(m.setUniforms(s,y,n.paint,{zoom:t.transform.zoom}),u=!1),l.uniform1f(y.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance),l.uniform1i(y.uniforms.u_scale_with_map,"map"===n.paint.get("circle-pitch-scale")?1:0),"map"===n.paint.get("circle-pitch-alignment")){l.uniform1i(y.uniforms.u_pitch_with_map,1);var g=$e(p,1,t.transform.zoom);l.uniform2f(y.uniforms.u_extrude_scale,g,g)}else l.uniform1i(y.uniforms.u_pitch_with_map,0),l.uniform2fv(y.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits);l.uniformMatrix4fv(y.uniforms.u_matrix,!1,t.translatePosMatrix(h.posMatrix,p,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor"))),y.draw(s,l.TRIANGLES,n.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,m)}}}}},heatmap:function(t,e,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var r=t.context,o=r.gl;r.setDepthMode(t.depthModeForSublayer(0,le.ReadOnly)),r.setStencilMode(ue.disabled),function(t,e,n){var i=t.gl;t.activeTexture.set(i.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var r=n.heatmapFbo;if(r)i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{var o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),r=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,n,i,r){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,n.width/4,n.height/4,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null);r.colorAttachment.set(i);e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,r.colorAttachment.setDirty(),t(e,n,i,r))}(t,e,o,r)}}(r,t,n),r.clear({color:V.default$7.transparent}),r.setColorMode(new ce([o.ONE,o.ONE],V.default$7.transparent,[!0,!0,!0,!0]));for(var a=!0,s=0;s<i.length;s++){var l=i[s];if(!e.hasRenderableParent(l)){var u=e.getTile(l),c=u.getBucket(n);if(c){var h=t.context.program.get(),p=c.programConfigurations.get(n.id),f=t.useProgram("heatmap",p),d=t.transform.zoom;!a&&f.program===h||(p.setUniforms(t.context,f,n.paint,{zoom:d}),a=!1),o.uniform1f(f.uniforms.u_extrude_scale,$e(u,1,d)),o.uniform1f(f.uniforms.u_intensity,n.paint.get("heatmap-intensity")),o.uniformMatrix4fv(f.uniforms.u_matrix,!1,l.posMatrix),f.draw(r,o.TRIANGLES,n.id,c.layoutVertexBuffer,c.indexBuffer,c.segments,p)}}}r.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,e){var n=t.context,i=n.gl,r=e.heatmapFbo;if(!r)return;n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),n.activeTexture.set(i.TEXTURE1);var o=e.colorRampTexture;o=o||(e.colorRampTexture=new k(n,e.colorRamp,i.RGBA));o.bind(i.LINEAR,i.CLAMP_TO_EDGE),n.setDepthMode(le.disabled);var a=t.useProgram("heatmapTexture"),s=e.paint.get("heatmap-opacity");i.uniform1f(a.uniforms.u_opacity,s),i.uniform1i(a.uniforms.u_image,0),i.uniform1i(a.uniforms.u_color_ramp,1);var l=V.mat4.create();V.mat4.ortho(l,0,t.width,t.height,0,0,1),i.uniformMatrix4fv(a.uniforms.u_matrix,!1,l),i.uniform2f(a.uniforms.u_world,i.drawingBufferWidth,i.drawingBufferHeight),t.viewportVAO.bind(t.context,a,t.viewportBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,4)}(t,n))},line:function(t,e,n,i){if("translucent"===t.renderPass&&0!==n.paint.get("line-opacity").constantOr(1)){var r=t.context;r.setDepthMode(t.depthModeForSublayer(0,le.ReadOnly)),r.setColorMode(t.colorModeForRenderPass());for(var o,a=n.paint.get("line-dasharray")?"lineSDF":n.paint.get("line-pattern")?"linePattern":n.paint.get("line-gradient")?"lineGradient":"line",s=!0,l=0,u=i;l<u.length;l+=1){var c=u[l],h=e.getTile(c),p=h.getBucket(n);if(p){var f=p.programConfigurations.get(n.id),d=t.context.program.get(),m=t.useProgram(a,f),y=s||m.program!==d,g=o!==h.tileID.overscaledZ;y&&f.setUniforms(t.context,m,n.paint,{zoom:t.transform.zoom}),Bn(m,t,h,p,n,c,f,y,g),o=h.tileID.overscaledZ,s=!1}}}},fill:function(t,e,n,i){var r=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0!==o.constantOr(1)){var a=t.context;a.setColorMode(t.colorModeForRenderPass());var s=n.paint.get("fill-pattern")||1!==r.constantOr(V.default$7.transparent).a||1!==o.constantOr(0)?"translucent":"opaque";t.renderPass===s&&(a.setDepthMode(t.depthModeForSublayer(1,"opaque"===t.renderPass?le.ReadWrite:le.ReadOnly)),Nn(t,e,n,i,jn)),"translucent"===t.renderPass&&n.paint.get("fill-antialias")&&(a.lineWidth.set(2),a.setDepthMode(t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,le.ReadOnly)),Nn(t,e,n,i,Gn))}},"fill-extrusion":function(t,e,n,i){if(0!==n.paint.get("fill-extrusion-opacity"))if("offscreen"===t.renderPass){!function(t,e){var n=t.context,i=n.gl,r=e.viewportFrame;t.depthRboNeedsClear&&t.setupOffscreenDepthRenderbuffer();if(!r){var o=new k(n,{width:t.width,height:t.height,data:null},i.RGBA);o.bind(i.LINEAR,i.CLAMP_TO_EDGE),(r=e.viewportFrame=n.createFramebuffer(t.width,t.height)).colorAttachment.set(o.texture)}n.bindFramebuffer.set(r.framebuffer),r.depthAttachment.set(t.depthRbo),t.depthRboNeedsClear&&(n.clear({depth:1}),t.depthRboNeedsClear=!1);n.clear({color:V.default$7.transparent}),n.setStencilMode(ue.disabled),n.setDepthMode(new le(i.LEQUAL,le.ReadWrite,[0,1])),n.setColorMode(t.colorModeForRenderPass())}(t,n);for(var r=!0,o=0,a=i;o<a.length;o+=1){var s=a[o],l=e.getTile(s),u=l.getBucket(n);u&&(Zn(t,e,n,l,s,u,r),r=!1)}}else"translucent"===t.renderPass&&function(t,e){var n=e.viewportFrame;if(!n)return;var i=t.context,r=i.gl,o=t.useProgram("extrusionTexture");i.setStencilMode(ue.disabled),i.setDepthMode(le.disabled),i.setColorMode(t.colorModeForRenderPass()),i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n.colorAttachment.get()),r.uniform1f(o.uniforms.u_opacity,e.paint.get("fill-extrusion-opacity")),r.uniform1i(o.uniforms.u_image,0);var a=$n.create();$n.ortho(a,0,t.width,t.height,0,0,1),r.uniformMatrix4fv(o.uniforms.u_matrix,!1,a),r.uniform2f(o.uniforms.u_world,r.drawingBufferWidth,r.drawingBufferHeight),t.viewportVAO.bind(i,o,t.viewportBuffer,[]),r.drawArrays(r.TRIANGLE_STRIP,0,4)}(t,n)},hillshade:function(t,e,n,i){if("offscreen"===t.renderPass||"translucent"===t.renderPass){var r=t.context,o=e.getSource().maxzoom;r.setDepthMode(t.depthModeForSublayer(0,le.ReadOnly)),r.setStencilMode(ue.disabled),r.setColorMode(t.colorModeForRenderPass());for(var a=0,s=i;a<s.length;a+=1){var l=s[a],u=e.getTile(l);u.needsHillshadePrepare&&"offscreen"===t.renderPass?Hn(t,u,o):"translucent"===t.renderPass&&Xn(t,u,n)}r.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,i){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity")){var r=t.context,o=r.gl,a=e.getSource(),s=t.useProgram("raster");r.setStencilMode(ue.disabled),r.setColorMode(t.colorModeForRenderPass()),o.uniform1f(s.uniforms.u_brightness_low,n.paint.get("raster-brightness-min")),o.uniform1f(s.uniforms.u_brightness_high,n.paint.get("raster-brightness-max")),o.uniform1f(s.uniforms.u_saturation_factor,function(t){return 0<t?1-1/(1.001-t):-t}(n.paint.get("raster-saturation"))),o.uniform1f(s.uniforms.u_contrast_factor,function(t){return 0<t?1/(1-t):1+t}(n.paint.get("raster-contrast"))),o.uniform3fv(s.uniforms.u_spin_weights,function(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}(n.paint.get("raster-hue-rotate"))),o.uniform1f(s.uniforms.u_buffer_scale,1),o.uniform1i(s.uniforms.u_image0,0),o.uniform1i(s.uniforms.u_image1,1);for(var l=i.length&&i[0].overscaledZ,u=0,c=i;u<c.length;u+=1){var h=c[u];r.setDepthMode(t.depthModeForSublayer(h.overscaledZ-l,1===n.paint.get("raster-opacity")?le.ReadWrite:le.ReadOnly,o.LESS));var p=e.getTile(h),f=t.transform.calculatePosMatrix(h.toUnwrapped(),!0);p.registerFadeDuration(n.paint.get("raster-fade-duration")),o.uniformMatrix4fv(s.uniforms.u_matrix,!1,f);var d=e.findLoadedParent(h,0,{}),m=Kn(p,d,e,n,t.transform),y=void 0,g=void 0;if(r.activeTexture.set(o.TEXTURE0),p.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(o.TEXTURE1),d?(d.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),y=Math.pow(2,d.tileID.overscaledZ-p.tileID.overscaledZ),g=[p.tileID.canonical.x*y%1,p.tileID.canonical.y*y%1]):p.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),o.uniform2fv(s.uniforms.u_tl_parent,g||[0,0]),o.uniform1f(s.uniforms.u_scale_parent,y||1),o.uniform1f(s.uniforms.u_fade_t,m.mix),o.uniform1f(s.uniforms.u_opacity,m.opacity*n.paint.get("raster-opacity")),a instanceof ht){var v=a.boundsBuffer;a.boundsVAO.bind(r,s,v,[]),o.drawArrays(o.TRIANGLE_STRIP,0,v.length)}else if(p.maskedBoundsBuffer&&p.maskedIndexBuffer&&p.segments)s.draw(r,o.TRIANGLES,n.id,p.maskedBoundsBuffer,p.maskedIndexBuffer,p.segments);else{var _=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(r,s,_,[]),o.drawArrays(o.TRIANGLE_STRIP,0,_.length)}}}},background:function(t,e,n){var i=n.paint.get("background-color"),r=n.paint.get("background-opacity");if(0!==r){var o=t.context,a=o.gl,s=t.transform,l=s.tileSize,u=n.paint.get("background-pattern"),c=u||1!==i.a||1!==r?"translucent":"opaque";if(t.renderPass===c){var h;if(o.setStencilMode(ue.disabled),o.setDepthMode(t.depthModeForSublayer(0,"opaque"==c?le.ReadWrite:le.ReadOnly)),o.setColorMode(t.colorModeForRenderPass()),u){if(On(u,t))return;h=t.useProgram("backgroundPattern"),Fn(u,t,h),t.tileExtentPatternVAO.bind(o,h,t.tileExtentBuffer,[])}else h=t.useProgram("background"),a.uniform4fv(h.uniforms.u_color,[i.r,i.g,i.b,i.a]),t.tileExtentVAO.bind(o,h,t.tileExtentBuffer,[]);a.uniform1f(h.uniforms.u_opacity,r);for(var p=0,f=s.coveringTiles({tileSize:l});p<f.length;p+=1){var d=f[p];u&&Vn({tileID:d,tileSize:l},t,h),a.uniformMatrix4fv(h.uniforms.u_matrix,!1,t.transform.calculatePosMatrix(d.toUnwrapped())),a.drawArrays(a.TRIANGLE_STRIP,0,t.tileExtentBuffer.length)}}}},debug:function(t,e,n){for(var i=0;i<n.length;i++)Yn(t,e,n[i])}};function ei(t,e){if(t.row>e.row){var n=t;t=e,e=n}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function ni(t,e,n,i,r){var o=Math.max(n,Math.floor(e.y0)),a=Math.min(i,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,u=e.dx/e.dy,c=0<t.dx,h=e.dx<0,p=o;p<a;p++){var f=l*Math.max(0,Math.min(t.dy,p+c-t.y0))+t.x0,d=u*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;r(Math.floor(d),Math.ceil(f),p)}}function ii(t,e,n,i,r,o){var a,s=ei(t,e),l=ei(e,n),u=ei(n,t);s.dy>l.dy&&(a=s,s=l,l=a),s.dy>u.dy&&(a=s,s=u,u=a),l.dy>u.dy&&(a=l,l=u,u=a),s.dy&&ni(u,s,i,r,o),l.dy&&ni(u,l,i,r,o)}Qn.prototype.resize=function(t,e){var n=this.context.gl;if(this.width=t*T.devicePixelRatio,this.height=e*T.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var i=0,r=this.style._order;i<r.length;i+=1){var o=r[i];this.style._layers[o].resize()}this.depthRbo&&(n.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},Qn.prototype.setup=function(){var t=this.context,e=new V.PosArray;e.emplaceBack(0,0),e.emplaceBack(V.default$9,0),e.emplaceBack(0,V.default$9),e.emplaceBack(V.default$9,V.default$9),this.tileExtentBuffer=t.createVertexBuffer(e,wn.members),this.tileExtentVAO=new ut,this.tileExtentPatternVAO=new ut;var n=new V.PosArray;n.emplaceBack(0,0),n.emplaceBack(V.default$9,0),n.emplaceBack(V.default$9,V.default$9),n.emplaceBack(0,V.default$9),n.emplaceBack(0,0),this.debugBuffer=t.createVertexBuffer(n,wn.members),this.debugVAO=new ut;var i=new V.RasterBoundsArray;i.emplaceBack(0,0,0,0),i.emplaceBack(V.default$9,0,V.default$9,0),i.emplaceBack(0,V.default$9,0,V.default$9),i.emplaceBack(V.default$9,V.default$9,V.default$9,V.default$9),this.rasterBoundsBuffer=t.createVertexBuffer(i,lt.members),this.rasterBoundsVAO=new ut;var r=new V.PosArray;r.emplaceBack(0,0),r.emplaceBack(1,0),r.emplaceBack(0,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,wn.members),this.viewportVAO=new ut},Qn.prototype.clearStencil=function(){var t=this.context,e=t.gl;t.setColorMode(ce.disabled),t.setDepthMode(le.disabled),t.setStencilMode(new ue({func:e.ALWAYS,mask:0},0,255,e.ZERO,e.ZERO,e.ZERO));var n=V.mat4.create();V.mat4.ortho(n,0,this.width,this.height,0,0,1),V.mat4.scale(n,n,[e.drawingBufferWidth,e.drawingBufferHeight,0]);var i=this.useProgram("clippingMask");e.uniformMatrix4fv(i.uniforms.u_matrix,!1,n),this.viewportVAO.bind(t,i,this.viewportBuffer,[]),e.drawArrays(e.TRIANGLE_STRIP,0,4)},Qn.prototype._renderTileClippingMasks=function(t){var e=this.context,n=e.gl;e.setColorMode(ce.disabled),e.setDepthMode(le.disabled);var i=1;this._tileClippingMaskIDs={};for(var r=0,o=t;r<o.length;r+=1){var a=o[r],s=this._tileClippingMaskIDs[a.key]=i++;e.setStencilMode(new ue({func:n.ALWAYS,mask:0},s,255,n.KEEP,n.KEEP,n.REPLACE));var l=this.useProgram("clippingMask");n.uniformMatrix4fv(l.uniforms.u_matrix,!1,a.posMatrix),this.tileExtentVAO.bind(this.context,l,this.tileExtentBuffer,[]),n.drawArrays(n.TRIANGLE_STRIP,0,this.tileExtentBuffer.length)}},Qn.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new ue({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},Qn.prototype.colorModeForRenderPass=function(){var t=this.context.gl;if(this._showOverdrawInspector){return new ce([t.CONSTANT_COLOR,t.ONE],new V.default$7(1/8,1/8,1/8,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?ce.unblended:ce.alphaBlended},Qn.prototype.depthModeForSublayer=function(t,e,n){var i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,r=i-1+this.depthRange;return new le(n||this.context.gl.LEQUAL,e,[r,i])},Qn.prototype.render=function(t,e){var n=this;for(var i in this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(T.now()),t.sourceCaches){var r=n.style.sourceCaches[i];r.used&&r.prepare(n.context)}function o(t){var e=s[t];!function(t,e){for(var n=t.sort(function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0}),i=0;i<n.length;i++){var r={},o=n[i],a=n.slice(i+1);In(o.tileID.wrapped(),o.tileID,a,new V.OverscaledTileID(0,o.tileID.wrap+1,0,0,0),r),o.setMask(r,e)}}(e.getVisibleCoordinates().map(function(t){return e.getTile(t)}),n.context)}var a=this.style._order,s=V.filterObject(this.style.sourceCaches,function(t){return"raster"===t.getSource().type||"raster-dem"===t.getSource().type});for(var l in s)o(l);this.renderPass="offscreen";var u,c=[];this.depthRboNeedsClear=!0;for(var h=0;h<a.length;h++){var p=n.style._layers[a[h]];p.hasOffscreenPass()&&!p.isHidden(n.transform.zoom)&&(p.source!==(u&&u.id)&&(c=[],(u=n.style.sourceCaches[p.source])&&(c=u.getVisibleCoordinates()).reverse()),c.length&&n.renderLayer(n,u,p,c))}this.context.bindFramebuffer.set(null),this.context.clear({color:e.showOverdrawInspector?V.default$7.black:V.default$7.transparent,depth:1}),this._showOverdrawInspector=e.showOverdrawInspector,this.depthRange=(t._order.length+2)*this.numSublayers*this.depthEpsilon,this.renderPass="opaque";var f,d=[];for(this.currentLayer=a.length-1,this.currentLayer;0<=this.currentLayer;this.currentLayer--){var m=n.style._layers[a[n.currentLayer]];m.source!==(f&&f.id)&&(d=[],(f=n.style.sourceCaches[m.source])&&(n.clearStencil(),d=f.getVisibleCoordinates(),f.getSource().isTileClipped&&n._renderTileClippingMasks(d))),n.renderLayer(n,f,m,d)}this.renderPass="translucent";var y,g=[];for(this.currentLayer=0,this.currentLayer;this.currentLayer<a.length;this.currentLayer++){var v=n.style._layers[a[n.currentLayer]];v.source!==(y&&y.id)&&(g=[],(y=n.style.sourceCaches[v.source])&&(n.clearStencil(),g=y.getVisibleCoordinates(),y.getSource().isTileClipped&&n._renderTileClippingMasks(g)),g.reverse()),n.renderLayer(n,y,v,g)}if(this.options.showTileBoundaries){var _=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];_&&ti.debug(this,_,_.getVisibleCoordinates())}},Qn.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},Qn.prototype.renderLayer=function(t,e,n,i){n.isHidden(this.transform.zoom)||"background"!==n.type&&!i.length||(this.id=n.id,ti[n.type](t,e,n,i))},Qn.prototype.translatePosMatrix=function(t,e,n,i,r){if(!n[0]&&!n[1])return t;var o=r?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(o){var a=Math.sin(o),s=Math.cos(o);n=[n[0]*s-n[1]*a,n[0]*a+n[1]*s]}var l=[r?n[0]:$e(e,n[0],this.transform.zoom),r?n[1]:$e(e,n[1],this.transform.zoom),0],u=new Float32Array(16);return V.mat4.translate(u,t,l),u},Qn.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},Qn.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&0<e.length?e.pop():null},Qn.prototype._createProgramCached=function(t,e){this.cache=this.cache||{};var n=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new An(this.context,zn[t],e,this._showOverdrawInspector)),this.cache[n]},Qn.prototype.useProgram=function(t,e){var n=this._createProgramCached(t,e||this.emptyProgramConfiguration);return this.context.program.set(n.program),n};function ri(t,e,n){this.tileSize=512,this._renderWorldCopies=void 0===n||n,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new Z(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}}var oi=V.default$22.vec4,ai=V.default$22.mat4,si=V.default$22.mat2,li={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},x:{configurable:!0},y:{configurable:!0},point:{configurable:!0}};ri.prototype.clone=function(){var t=new ri(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},li.minZoom.get=function(){return this._minZoom},li.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},li.maxZoom.get=function(){return this._maxZoom},li.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},li.renderWorldCopies.get=function(){return this._renderWorldCopies},li.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},li.worldSize.get=function(){return this.tileSize*this.scale},li.centerPoint.get=function(){return this.size._div(2)},li.size.get=function(){return new V.default$1(this.width,this.height)},li.bearing.get=function(){return-this.angle/Math.PI*180},li.bearing.set=function(t){var e=-V.wrap(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=si.create(),si.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},li.pitch.get=function(){return this._pitch/Math.PI*180},li.pitch.set=function(t){var e=V.clamp(t,0,60)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())},li.fov.get=function(){return this._fov/Math.PI*180},li.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},li.zoom.get=function(){return this._zoom},li.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},li.center.get=function(){return this._center},li.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},ri.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},ri.prototype.getVisibleUnwrappedCoordinates=function(t){var e=this.pointCoordinate(new V.default$1(0,0),0),n=this.pointCoordinate(new V.default$1(this.width,0),0),i=Math.floor(e.column),r=Math.floor(n.column),o=[new V.UnwrappedTileID(0,t)];if(this._renderWorldCopies)for(var a=i;a<=r;a++)0!==a&&o.push(new V.UnwrappedTileID(a,t));return o},ri.prototype.coveringTiles=function(t){var e=this.coveringZoomLevel(t),n=e;if(void 0!==t.minzoom&&e<t.minzoom)return[];void 0!==t.maxzoom&&e>t.maxzoom&&(e=t.maxzoom);var i=this.pointCoordinate(this.centerPoint,e),r=new V.default$1(i.column-.5,i.row-.5);return function(s,t,l,u){void 0===u&&(u=!0);var c=1<<s,h={};function e(t,e,n){var i,r,o,a;if(0<=n&&n<=c)for(i=t;i<e;i++)r=Math.floor(i/c),o=(i%c+c)%c,0!==r&&!0!==u||(a=new V.OverscaledTileID(l,r,s,o,n),h[a.key]=a)}return ii(t[0],t[1],t[2],0,c,e),ii(t[2],t[3],t[0],0,c,e),Object.keys(h).map(function(t){return h[t]})}(e,[this.pointCoordinate(new V.default$1(0,0),e),this.pointCoordinate(new V.default$1(this.width,0),e),this.pointCoordinate(new V.default$1(this.width,this.height),e),this.pointCoordinate(new V.default$1(0,this.height),e)],t.reparseOverscaled?n:e,this._renderWorldCopies).sort(function(t,e){return r.dist(t.canonical)-r.dist(e.canonical)})},ri.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},li.unmodified.get=function(){return this._unmodified},ri.prototype.zoomScale=function(t){return Math.pow(2,t)},ri.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},ri.prototype.project=function(t){return new V.default$1(this.lngX(t.lng),this.latY(t.lat))},ri.prototype.unproject=function(t){return new Z(this.xLng(t.x),this.yLat(t.y))},li.x.get=function(){return this.lngX(this.center.lng)},li.y.get=function(){return this.latY(this.center.lat)},li.point.get=function(){return new V.default$1(this.x,this.y)},ri.prototype.lngX=function(t){return(180+t)*this.worldSize/360},ri.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},ri.prototype.xLng=function(t){return 360*t/this.worldSize-180},ri.prototype.yLat=function(t){var e=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90},ri.prototype.setLocationAtPoint=function(t,e){var n=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(n)),this._renderWorldCopies&&(this.center=this.center.wrap())},ri.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},ri.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},ri.prototype.locationCoordinate=function(t){return new V.default$19(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},ri.prototype.coordinateLocation=function(t){var e=t.zoomTo(this.zoom);return new Z(this.xLng(e.column*this.tileSize),this.yLat(e.row*this.tileSize))},ri.prototype.pointCoordinate=function(t,e){void 0===e&&(e=this.tileZoom);var n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];oi.transformMat4(n,n,this.pixelMatrixInverse),oi.transformMat4(i,i,this.pixelMatrixInverse);var r=n[3],o=i[3],a=n[0]/r,s=i[0]/o,l=n[1]/r,u=i[1]/o,c=n[2]/r,h=i[2]/o,p=c==h?0:(0-c)/(h-c);return new V.default$19(V.number(a,s,p)/this.tileSize,V.number(l,u,p)/this.tileSize,this.zoom)._zoomTo(e)},ri.prototype.coordinatePoint=function(t){var e=t.zoomTo(this.zoom),n=[e.column*this.tileSize,e.row*this.tileSize,0,1];return oi.transformMat4(n,n,this.pixelMatrix),new V.default$1(n[0]/n[3],n[1]/n[3])},ri.prototype.calculatePosMatrix=function(t,e){void 0===e&&(e=!1);var n=t.key,i=e?this._alignedPosMatrixCache:this._posMatrixCache;if(i[n])return i[n];var r=t.canonical,o=this.worldSize/this.zoomScale(r.z),a=r.x+Math.pow(2,r.z)*t.wrap,s=ai.identity(new Float64Array(16));return ai.translate(s,s,[a*o,r.y*o,0]),ai.scale(s,s,[o/V.default$9,o/V.default$9,1]),ai.multiply(s,e?this.alignedProjMatrix:this.projMatrix,s),i[n]=new Float32Array(s),i[n]},ri.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,n,i,r=-90,o=90,a=-180,s=180,l=this.size,u=this._unmodified;if(this.latRange){var c=this.latRange;r=this.latY(c[1]),t=(o=this.latY(c[0]))-r<l.y?l.y/(o-r):0}if(this.lngRange){var h=this.lngRange;a=this.lngX(h[0]),e=(s=this.lngX(h[1]))-a<l.x?l.x/(s-a):0}var p=Math.max(e||0,t||0);if(p)return this.center=this.unproject(new V.default$1(e?(s+a)/2:this.x,t?(o+r)/2:this.y)),this.zoom+=this.scaleZoom(p),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var f=this.y,d=l.y/2;f-d<r&&(i=r+d),o<f+d&&(i=o-d)}if(this.lngRange){var m=this.x,y=l.x/2;m-y<a&&(n=a+y),s<m+y&&(n=s-y)}void 0===n&&void 0===i||(this.center=this.unproject(new V.default$1(void 0!==n?n:this.x,void 0!==i?i:this.y))),this._unmodified=u,this._constraining=!1}},ri.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,n=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),i=this.x,r=this.y,o=1.01*(Math.cos(Math.PI/2-this._pitch)*n+this.cameraToCenterDistance),a=new Float64Array(16);ai.perspective(a,this._fov,this.width/this.height,1,o),ai.scale(a,a,[1,-1,1]),ai.translate(a,a,[0,0,-this.cameraToCenterDistance]),ai.rotateX(a,a,this._pitch),ai.rotateZ(a,a,this.angle),ai.translate(a,a,[-i,-r,0]);var s=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));ai.scale(a,a,[1,1,s,1]),this.projMatrix=a;var l=this.width%2/2,u=this.height%2/2,c=Math.cos(this.angle),h=Math.sin(this.angle),p=i-Math.round(i)+c*l+h*u,f=r-Math.round(r)+c*u+h*l,d=new Float64Array(a);if(ai.translate(d,d,[.5<p?p-1:p,.5<f?f-1:f,0]),this.alignedProjMatrix=d,a=ai.create(),ai.scale(a,a,[this.width/2,-this.height/2,1]),ai.translate(a,a,[1,-1,0]),this.pixelMatrix=ai.multiply(new Float64Array(16),a,this.projMatrix),!(a=ai.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ri.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new V.default$1(0,0)).zoomTo(this.zoom),e=[t.column*this.tileSize,t.row*this.tileSize,0,1];return oi.transformMat4(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance},Object.defineProperties(ri.prototype,li);function ui(){V.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=function(t,e){var n=!1,i=0,r=function(){i=0,n&&(t(),i=setTimeout(r,e),n=!1)};return function(){return n=!0,i||r(),i}}(this._updateHashUnthrottled.bind(this),300)}ui.prototype.addTo=function(t){return this._map=t,V.default.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ui.prototype.remove=function(){return V.default.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ui.prototype.getHashString=function(t){var e=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),o=Math.round(e.lng*r)/r,a=Math.round(e.lat*r)/r,s=this._map.getBearing(),l=this._map.getPitch(),u="";return u+=t?"#/"+o+"/"+a+"/"+n:"#"+n+"/"+a+"/"+o,(s||l)&&(u+="/"+Math.round(10*s)/10),l&&(u+="/"+Math.round(l)),u},ui.prototype._onHashChange=function(){var t=V.default.location.hash.replace("#","").split("/");return 3<=t.length&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},ui.prototype._updateHashUnthrottled=function(){var t=this.getHashString();V.default.history.replaceState(V.default.history.state,"",t)};function ci(t){this._map=t,this._el=t.getCanvasContainer(),this._delta=0,V.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)}var hi=function(a){function t(t,e,n,i){void 0===i&&(i={});var r=v.mousePos(e.getCanvasContainer(),n),o=e.unproject(r);a.call(this,t,V.extend({point:r,lngLat:o,originalEvent:n},i)),this._defaultPrevented=!1}a&&(t.__proto__=a);var e={defaultPrevented:{configurable:!0}};return((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.preventDefault=function(){this._defaultPrevented=!0},e.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,e),t}(V.Event),pi=function(s){function t(t,e,n){var i=v.touchPos(e.getCanvasContainer(),n),r=i.map(function(t){return e.unproject(t)}),o=i.reduce(function(t,e,n,i){return t.add(e.div(i.length))},new V.default$1(0,0)),a=e.unproject(o);s.call(this,t,{points:i,point:o,lngLats:r,lngLat:a,originalEvent:n}),this._defaultPrevented=!1}s&&(t.__proto__=s);var e={defaultPrevented:{configurable:!0}};return((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.preventDefault=function(){this._defaultPrevented=!0},e.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,e),t}(V.Event),fi=function(i){function t(t,e,n){i.call(this,t,{originalEvent:n}),this._defaultPrevented=!1}i&&(t.__proto__=i);var e={defaultPrevented:{configurable:!0}};return((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.preventDefault=function(){this._defaultPrevented=!0},e.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,e),t}(V.Event),di=4.000244140625;ci.prototype.isEnabled=function(){return!!this._enabled},ci.prototype.isActive=function(){return!!this._active},ci.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},ci.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ci.prototype.onWheel=function(t){if(this.isEnabled()){var e=t.deltaMode===V.default.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,n=T.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==e&&e%di==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":400<i?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this.isActive()||this._start(t)),t.preventDefault()}},ci.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},ci.prototype._start=function(t){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this._map.fire(new V.Event("movestart",{originalEvent:t})),this._map.fire(new V.Event("zoomstart",{originalEvent:t})),this._finishTimeout&&clearTimeout(this._finishTimeout);var e=v.mousePos(this._el,t);this._around=Z.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(e)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},ci.prototype._onScrollFrame=function(){var t=this;if(this._frameId=null,this.isActive()){var e=this._map.transform;if(0!==this._delta){var n="wheel"===this._type&&Math.abs(this._delta)>di?1/450:.01,i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);var r="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(r*i))),"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o=!1;if("wheel"===this._type){var a=Math.min((T.now()-this._lastWheelEventTime)/200,1),s=this._easing(a);e.zoom=V.number(this._startZoom,this._targetZoom,s),a<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):o=!0}else e.zoom=this._targetZoom,o=!0;e.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new V.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new V.Event("zoom",{originalEvent:this._lastWheelEvent})),o&&(this._active=!1,this._finishTimeout=setTimeout(function(){t._map.fire(new V.Event("zoomend",{originalEvent:t._lastWheelEvent})),t._map.fire(new V.Event("moveend",{originalEvent:t._lastWheelEvent})),delete t._targetZoom},200))}},ci.prototype._smoothOutEasing=function(t){var e=V.ease;if(this._prevEase){var n=this._prevEase,i=(T.now()-n.start)/n.duration,r=n.easing(.01+i)-n.easing(i),o=.27/Math.sqrt(r*r+1e-4)*.01,a=Math.sqrt(.0729-o*o);e=V.bezier(o,a,.25,1)}return this._prevEase={start:T.now(),duration:t,easing:e},e};function mi(t){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),V.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)}mi.prototype.isEnabled=function(){return!!this._enabled},mi.prototype.isActive=function(){return!!this._active},mi.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},mi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},mi.prototype.onMouseDown=function(t){this.isEnabled()&&t.shiftKey&&0===t.button&&(V.default.document.addEventListener("mousemove",this._onMouseMove,!1),V.default.document.addEventListener("keydown",this._onKeyDown,!1),V.default.document.addEventListener("mouseup",this._onMouseUp,!1),v.disableDrag(),this._startPos=v.mousePos(this._el,t),this._active=!0)},mi.prototype._onMouseMove=function(t){var e=this._startPos,n=v.mousePos(this._el,t);this._box||(this._box=v.create("div","emapgo-boxzoom",this._container),this._container.classList.add("emapgo-crosshair"),this._fireEvent("boxzoomstart",t));var i=Math.min(e.x,n.x),r=Math.max(e.x,n.x),o=Math.min(e.y,n.y),a=Math.max(e.y,n.y);v.setTransform(this._box,"translate("+i+"px,"+o+"px)"),this._box.style.width=r-i+"px",this._box.style.height=a-o+"px"},mi.prototype._onMouseUp=function(t){if(0===t.button){var e=this._startPos,n=v.mousePos(this._el,t),i=(new X).extend(this._map.unproject(e)).extend(this._map.unproject(n));this._finish(),v.suppressClick(),e.x===n.x&&e.y===n.y?this._fireEvent("boxzoomcancel",t):this._map.fitBounds(i,{linear:!0}).fire(new V.Event("boxzoomend",{originalEvent:t,boxZoomBounds:i}))}},mi.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},mi.prototype._finish=function(){this._active=!1,V.default.document.removeEventListener("mousemove",this._onMouseMove,!1),V.default.document.removeEventListener("keydown",this._onKeyDown,!1),V.default.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("emapgo-crosshair"),this._box&&(v.remove(this._box),this._box=null),v.enableDrag()},mi.prototype._fireEvent=function(t,e){return this._map.fire(new V.Event(t,{originalEvent:e}))};function yi(t,e){this._map=t,this._el=e.element||t.getCanvasContainer(),this._state="disabled",this._button=e.button||"right",this._bearingSnap=e.bearingSnap||0,this._pitchWithRotate=!1!==e.pitchWithRotate,V.bindAll(["_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)}var gi=V.bezier(0,0,.25,1);yi.prototype.isEnabled=function(){return"disabled"!==this._state},yi.prototype.isActive=function(){return"active"===this._state},yi.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},yi.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},yi.prototype.onMouseDown=function(t){if("enabled"===this._state){if("right"===this._button){if(this._eventButton=v.mouseButton(t),this._eventButton!==(t.ctrlKey?0:2))return}else{if(t.ctrlKey||0!==v.mouseButton(t))return;this._eventButton=0}v.disableDrag(),V.default.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),V.default.document.addEventListener("mouseup",this._onMouseUp),V.default.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[T.now(),this._map.getBearing()]],this._previousPos=v.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault()}},yi.prototype._onMouseMove=function(t){this._lastMoveEvent=t,this._pos=v.mousePos(this._el,t),"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame))},yi.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform,n=this._previousPos,i=this._pos,r=.8*(n.x-i.x),o=-.5*(n.y-i.y),a=e.bearing-r,s=e.pitch-o,l=this._inertia,u=l[l.length-1];this._drainInertiaBuffer(),l.push([T.now(),this._map._normalizeBearing(a,u[1])]),e.bearing=a,this._pitchWithRotate&&(this._fireEvent("pitch",t),e.pitch=s),this._fireEvent("rotate",t),this._fireEvent("move",t),delete this._lastMoveEvent,this._previousPos=this._pos}},yi.prototype._onMouseUp=function(t){if(v.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",v.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind();break;default:V.default$2(!1)}},yi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind();break;default:V.default$2(!1)}},yi.prototype._unbind=function(){V.default.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),V.default.document.removeEventListener("mouseup",this._onMouseUp),V.default.removeEventListener("blur",this._onBlur),v.enableDrag()},yi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._previousPos},yi.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();function n(){Math.abs(r)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)}var i=this._map,r=i.getBearing(),o=this._inertia;if(o.length<2)n();else{var a=o[0],s=o[o.length-1],l=o[o.length-2],u=i._normalizeBearing(r,l[1]),c=s[1]-a[1],h=c<0?-1:1,p=(s[0]-a[0])/1e3;if(0!=c&&0!=p){var f=Math.abs(.25/p*c);180<f&&(f=180);var d=f/180;u+=h*f*(d/2),Math.abs(i._normalizeBearing(u,0))<this._bearingSnap&&(u=i._normalizeBearing(0,u)),i.rotateTo(u,{duration:1e3*d,easing:gi,noMoveStart:!0},{originalEvent:t})}else n()}},yi.prototype._fireEvent=function(t,e){return this._map.fire(new V.Event(t,e?{originalEvent:e}:{}))},yi.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=T.now();0<t.length&&160<e-t[0][0];)t.shift()};function vi(t){this._map=t,this._el=t.getCanvasContainer(),this._state="disabled",V.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)}var _i=V.bezier(0,0,.3,1);vi.prototype.isEnabled=function(){return"disabled"!==this._state},vi.prototype.isActive=function(){return"active"===this._state},vi.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("emapgo-touch-drag-pan"),this._state="enabled")},vi.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("emapgo-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},vi.prototype.onMouseDown=function(t){"enabled"===this._state&&(t.ctrlKey||0!==v.mouseButton(t)||(v.addEventListener(V.default.document,"mousemove",this._onMove,{capture:!0}),v.addEventListener(V.default.document,"mouseup",this._onMouseUp),this._start(t)))},vi.prototype.onTouchStart=function(t){"enabled"===this._state&&(1<t.touches.length||(v.addEventListener(V.default.document,"touchmove",this._onMove,{capture:!0,passive:!1}),v.addEventListener(V.default.document,"touchend",this._onTouchEnd),this._start(t)))},vi.prototype._start=function(t){V.default.addEventListener("blur",this._onBlur),this._state="pending",this._previousPos=v.mousePos(this._el,t),this._inertia=[[T.now(),this._previousPos]]},vi.prototype._onMove=function(t){(this._lastMoveEvent=t).preventDefault(),this._pos=v.mousePos(this._el,t),this._drainInertiaBuffer(),this._inertia.push([T.now(),this._pos]),"pending"===this._state&&(this._state="active",this._fireEvent("dragstart",t),this._fireEvent("movestart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame))},vi.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._previousPos),this._pos),this._fireEvent("drag",t),this._fireEvent("move",t),this._previousPos=this._pos,delete this._lastMoveEvent}},vi.prototype._onMouseUp=function(t){if(0===v.mouseButton(t))switch(this._state){case"active":this._state="enabled",v.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind();break;default:V.default$2(!1)}},vi.prototype._onTouchEnd=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind();break;default:V.default$2(!1)}},vi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("dragend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind();break;default:V.default$2(!1)}},vi.prototype._unbind=function(){v.removeEventListener(V.default.document,"touchmove",this._onMove,{capture:!0,passive:!1}),v.removeEventListener(V.default.document,"touchend",this._onTouchEnd),v.removeEventListener(V.default.document,"mousemove",this._onMove,{capture:!0}),v.removeEventListener(V.default.document,"mouseup",this._onMouseUp),v.removeEventListener(V.default,"blur",this._onBlur)},vi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._previousPos,delete this._pos},vi.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var n=e[e.length-1],i=e[0],r=n[1].sub(i[1]),o=(n[0]-i[0])/1e3;if(0==o||n[1].equals(i[1]))this._fireEvent("moveend",t);else{var a=r.mult(.3/o),s=a.mag();1400<s&&(s=1400,a._unit()._mult(s));var l=s/750,u=a.mult(-l/2);this._map.panBy(u,{duration:1e3*l,easing:_i,noMoveStart:!0},{originalEvent:t})}}},vi.prototype._fireEvent=function(t,e){return this._map.fire(new V.Event(t,e?{originalEvent:e}:{}))},vi.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=T.now();0<t.length&&160<e-t[0][0];)t.shift()};function xi(t){this._map=t,this._el=t.getCanvasContainer(),V.bindAll(["_onKeyDown"],this)}function bi(t){return t*(2-t)}xi.prototype.isEnabled=function(){return!!this._enabled},xi.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},xi.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},xi.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,n=0,i=0,r=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?i=-1:(o=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),l={duration:300,delayEndEvents:500,easing:bi,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*n,pitch:a.getPitch()+10*i,offset:[100*-r,100*-o],center:a.getCenter()};a.easeTo(l,{originalEvent:t})}};function wi(t){this._map=t,V.bindAll(["_onDblClick","_onZoomEnd"],this)}wi.prototype.isEnabled=function(){return!!this._enabled},wi.prototype.isActive=function(){return!!this._active},wi.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},wi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},wi.prototype.onTouchStart=function(t){var e=this;this.isEnabled()&&(1<t.points.length||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._zoom(t)):this._tapped=setTimeout(function(){e._tapped=null},300)))},wi.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t))},wi.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},wi.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};function Ei(t){this._map=t,this._el=t.getCanvasContainer(),V.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)}var Si=V.bezier(0,0,.15,1);Ei.prototype.isEnabled=function(){return!!this._enabled},Ei.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("emapgo-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},Ei.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("emapgo-touch-zoom-rotate"),this._enabled=!1)},Ei.prototype.disableRotation=function(){this._rotationDisabled=!0},Ei.prototype.enableRotation=function(){this._rotationDisabled=!1},Ei.prototype.onStart=function(t){if(this.isEnabled()&&2===t.touches.length){var e=v.mousePos(this._el,t.touches[0]),n=v.mousePos(this._el,t.touches[1]);this._startVec=e.sub(n),this._gestureIntent=void 0,this._inertia=[],v.addEventListener(V.default.document,"touchmove",this._onMove,{passive:!1}),v.addEventListener(V.default.document,"touchend",this._onEnd)}},Ei.prototype._getTouchEventData=function(t){var e=v.mousePos(this._el,t.touches[0]),n=v.mousePos(this._el,t.touches[1]),i=e.sub(n);return{vec:i,center:e.add(n).div(2),scale:i.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*i.angleWith(this._startVec)/Math.PI}},Ei.prototype._onMove=function(t){if(2===t.touches.length){var e=this._getTouchEventData(t),n=e.vec,i=e.scale,r=e.bearing;if(!this._gestureIntent){var o=.15<Math.abs(1-i);10<Math.abs(r)?this._gestureIntent="rotate":o&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new V.Event(this._gestureIntent+"start",{originalEvent:t})),this._map.fire(new V.Event("movestart",{originalEvent:t})),this._startVec=n)}this._lastTouchEvent=t,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),t.preventDefault()}},Ei.prototype._onTouchFrame=function(){this._frameId=null;var t=this._gestureIntent;if(t){var e=this._map.transform;this._startScale||(this._startScale=e.scale,this._startBearing=e.bearing);var n=this._getTouchEventData(this._lastTouchEvent),i=n.center,r=n.bearing,o=n.scale,a=e.pointLocation(i),s=e.locationPoint(a);"rotate"===t&&(e.bearing=this._startBearing+r),e.zoom=e.scaleZoom(this._startScale*o),e.setLocationAtPoint(a,s),this._map.fire(new V.Event(t,{originalEvent:this._lastTouchEvent})),this._map.fire(new V.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([T.now(),o,i])}},Ei.prototype._onEnd=function(t){v.removeEventListener(V.default.document,"touchmove",this._onMove,{passive:!1}),v.removeEventListener(V.default.document,"touchend",this._onEnd);var e=this._gestureIntent,n=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,e){this._map.fire(new V.Event(e+"end",{originalEvent:t})),this._drainInertiaBuffer();var i=this._inertia,r=this._map;if(i.length<2)r.snapToNorth({},{originalEvent:t});else{var o=i[i.length-1],a=i[0],s=r.transform.scaleZoom(n*o[1]),l=r.transform.scaleZoom(n*a[1]),u=s-l,c=(o[0]-a[0])/1e3,h=o[2];if(0!=c&&s!==l){var p=.15*u/c;2.5<Math.abs(p)&&(p=0<p?2.5:-2.5);var f=1e3*Math.abs(p/(12*.15)),d=s+p*f/2e3;d<0&&(d=0),r.easeTo({zoom:d,duration:f,easing:Si,around:this._aroundCenter?r.getCenter():r.unproject(h),noMoveStart:!0},{originalEvent:t})}else r.snapToNorth({},{originalEvent:t})}}},Ei.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=T.now();2<t.length&&160<e-t[0][0];)t.shift()};var Ti={scrollZoom:ci,boxZoom:mi,dragRotate:yi,dragPan:vi,keyboard:xi,doubleClickZoom:wi,touchZoomRotate:Ei};var Ai,zi=((Ai=V.Evented)&&(Ii.__proto__=Ai),((Ii.prototype=Object.create(Ai&&Ai.prototype)).constructor=Ii).prototype.getCenter=function(){return this.transform.center},Ii.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},Ii.prototype.panBy=function(t,e,n){return t=V.default$1.convert(t).mult(-1),this.panTo(this.transform.center,V.extend({offset:t},e),n)},Ii.prototype.panTo=function(t,e,n){return this.easeTo(V.extend({center:t},e),n)},Ii.prototype.getZoom=function(){return this.transform.zoom},Ii.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},Ii.prototype.zoomTo=function(t,e,n){return this.easeTo(V.extend({zoom:t},e),n)},Ii.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},Ii.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},Ii.prototype.getBearing=function(){return this.transform.bearing},Ii.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},Ii.prototype.rotateTo=function(t,e,n){return this.easeTo(V.extend({bearing:t},e),n)},Ii.prototype.resetNorth=function(t,e){return this.rotateTo(0,V.extend({duration:1e3},t),e),this},Ii.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},Ii.prototype.getPitch=function(){return this.transform.pitch},Ii.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},Ii.prototype.fitBounds=function(t,e,n){if("number"==typeof(e=V.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){var i=e.padding;e.padding={top:i,bottom:i,right:i,left:i}}if(!V.default$11(Object.keys(e.padding).sort(function(t,e){return t<e?-1:e<t?1:0}),["bottom","left","right","top"]))return V.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'"),this;t=X.convert(t);var r=[(e.padding.left-e.padding.right)/2,(e.padding.top-e.padding.bottom)/2],o=Math.min(e.padding.right,e.padding.left),a=Math.min(e.padding.top,e.padding.bottom);e.offset=[e.offset[0]+r[0],e.offset[1]+r[1]];var s=V.default$1.convert(e.offset),l=this.transform,u=l.project(t.getNorthWest()),c=l.project(t.getSouthEast()),h=c.sub(u),p=(l.width-2*o-2*Math.abs(s.x))/h.x,f=(l.height-2*a-2*Math.abs(s.y))/h.y;return f<0||p<0?(V.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset."),this):(e.center=l.unproject(u.add(c).div(2)),e.zoom=Math.min(l.scaleZoom(l.scale*Math.min(p,f)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e,n):this.flyTo(e,n))},Ii.prototype.jumpTo=function(t,e){this.stop();var n=this.transform,i=!1,r=!1,o=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(i=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=Z.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(r=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),this.fire(new V.Event("movestart",e)).fire(new V.Event("move",e)),i&&this.fire(new V.Event("zoomstart",e)).fire(new V.Event("zoom",e)).fire(new V.Event("zoomend",e)),r&&this.fire(new V.Event("rotatestart",e)).fire(new V.Event("rotate",e)).fire(new V.Event("rotateend",e)),o&&this.fire(new V.Event("pitchstart",e)).fire(new V.Event("pitch",e)).fire(new V.Event("pitchend",e)),this.fire(new V.Event("moveend",e))},Ii.prototype.easeTo=function(t,o){var a=this;this.stop(),!1===(t=V.extend({offset:[0,0],duration:500,easing:V.ease},t)).animate&&(t.duration=0);var s=this.transform,l=this.getZoom(),u=this.getBearing(),c=this.getPitch(),h="zoom"in t?+t.zoom:l,p="bearing"in t?this._normalizeBearing(t.bearing,u):u,f="pitch"in t?+t.pitch:c,d=s.centerPoint.add(V.default$1.convert(t.offset)),e=s.pointLocation(d),n=Z.convert(t.center||e);this._normalizeCenter(n);var m,y,g=s.project(e),v=s.project(n).sub(g),_=s.zoomScale(h-l);return t.around&&(m=Z.convert(t.around),y=s.locationPoint(m)),this._zooming=h!==l,this._rotating=u!==p,this._pitching=f!==c,this._prepareEase(o,t.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(t){if(a._zooming&&(s.zoom=V.number(l,h,t)),a._rotating&&(s.bearing=V.number(u,p,t)),a._pitching&&(s.pitch=V.number(c,f,t)),m)s.setLocationAtPoint(m,y);else{var e=s.zoomScale(s.zoom-l),n=l<h?Math.min(2,_):Math.max(.5,_),i=Math.pow(n,1-t),r=s.unproject(g.add(v.mult(t*i)).mult(e));s.setLocationAtPoint(s.renderWorldCopies?r.wrap():r,d)}a._fireMoveEvents(o)},function(){t.delayEndEvents?a._easeEndTimeoutID=setTimeout(function(){return a._afterEase(o)},t.delayEndEvents):a._afterEase(o)},t),this},Ii.prototype._prepareEase=function(t,e){this._moving=!0,e||this.fire(new V.Event("movestart",t)),this._zooming&&this.fire(new V.Event("zoomstart",t)),this._rotating&&this.fire(new V.Event("rotatestart",t)),this._pitching&&this.fire(new V.Event("pitchstart",t))},Ii.prototype._fireMoveEvents=function(t){this.fire(new V.Event("move",t)),this._zooming&&this.fire(new V.Event("zoom",t)),this._rotating&&this.fire(new V.Event("rotate",t)),this._pitching&&this.fire(new V.Event("pitch",t))},Ii.prototype._afterEase=function(t){var e=this._zooming,n=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,e&&this.fire(new V.Event("zoomend",t)),n&&this.fire(new V.Event("rotateend",t)),i&&this.fire(new V.Event("pitchend",t)),this.fire(new V.Event("moveend",t))},Ii.prototype.flyTo=function(t,r){var o=this;this.stop(),t=V.extend({offset:[0,0],speed:1.2,curve:1.42,easing:V.ease},t);var a=this.transform,s=this.getZoom(),l=this.getBearing(),u=this.getPitch(),e="zoom"in t?V.clamp(+t.zoom,a.minZoom,a.maxZoom):s,c="bearing"in t?this._normalizeBearing(t.bearing,l):l,h="pitch"in t?+t.pitch:u,n=a.zoomScale(e-s),p=a.centerPoint.add(V.default$1.convert(t.offset)),i=a.pointLocation(p),f=Z.convert(t.center||i);this._normalizeCenter(f);var d=a.project(i),m=a.project(f).sub(d),y=t.curve,g=Math.max(a.width,a.height),v=g/n,_=m.mag();if("minZoom"in t){var x=V.clamp(Math.min(t.minZoom,s,e),a.minZoom,a.maxZoom),b=g/a.zoomScale(x-s);y=Math.sqrt(b/_*2)}var w=y*y;function E(t){var e=(v*v-g*g+(t?-1:1)*w*w*_*_)/(2*(t?v:g)*w*_);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function T(t){return(Math.exp(t)+Math.exp(-t))/2}var A=E(0),z=function(t){return T(A)/T(A+y*t)},I=function(t){return g*((T(A)*function(t){return S(t)/T(t)}(A+y*t)-S(A))/w)/_},k=(E(1)-A)/y;if(Math.abs(_)<1e-6||!isFinite(k)){if(Math.abs(g-v)<1e-6)return this.easeTo(t,r);var M=v<g?-1:1;k=Math.abs(Math.log(v/g))/y,I=function(){return 0},z=function(t){return Math.exp(M*y*t)}}if("duration"in t)t.duration=+t.duration;else{var C="screenSpeed"in t?+t.screenSpeed/y:+t.speed;t.duration=1e3*k/C}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=l!==c,this._pitching=h!==u,this._prepareEase(r,!1),this._ease(function(t){var e=t*k,n=1/z(e);a.zoom=s+a.scaleZoom(n),o._rotating&&(a.bearing=V.number(l,c,t)),o._pitching&&(a.pitch=V.number(u,h,t));var i=a.unproject(d.add(m.mult(I(e))).mult(n));a.setLocationAtPoint(a.renderWorldCopies?i.wrap():i,p),o._fireMoveEvents(r)},function(){return o._afterEase(r)},t),this},Ii.prototype.isEasing=function(){return!!this._easeFrameId},Ii.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},Ii.prototype._ease=function(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this._easeStart=T.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},Ii.prototype._renderFrameCallback=function(){var t=Math.min((T.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},Ii.prototype._normalizeBearing=function(t,e){t=V.wrap(t,-180,180);var n=Math.abs(t-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t},Ii.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=180<n?-360:n<-180?360:0}},Ii);function Ii(t,e){Ai.call(this),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=e.bearingSnap,V.bindAll(["_renderFrameCallback"],this)}function ki(t){void 0===t&&(t={}),this.options=t,V.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)}ki.prototype.getDefaultPosition=function(){return"bottom-right"},ki.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=v.create("div","emapgo-ctrl emapgo-ctrl-attrib"),e&&this._container.classList.add("emapgo-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ki.prototype.onRemove=function(){v.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},ki.prototype._updateEditLink=function(){var t=this._editLink;t=t||(this._editLink=this._container.querySelector(".emapgoIMS-improve-map"));var i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:f.ACCESS_TOKEN}];if(t){var e=i.reduce(function(t,e,n){return e.value&&(t+=e.key+"="+e.value+(n<i.length-1?"&":"")),t},"?");t.href="emapgo-webportal"+e+(this._map._hash?this._map._hash.getHashString(!0):"")}},ki.prototype._updateData=function(t){t&&"metadata"===t.sourceDataType&&(this._updateAttributions(),this._updateEditLink())},ki.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this._map.style.stylesheet){var t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}var e=this._map.style.sourceCaches;for(var n in e){var r=e[n].getSource();r.attribution&&i.indexOf(r.attribution)<0&&i.push(r.attribution)}i.sort(function(t,e){return t.length-e.length}),(i=i.filter(function(t,e){for(var n=e+1;n<i.length;n++)if(0<=i[n].indexOf(t))return!1;return!0})).length?(this._container.innerHTML=i.join(" | "),this._container.classList.remove("emapgo-attrib-empty")):this._container.classList.add("emapgo-attrib-empty"),this._editLink=null}},ki.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("emapgo-compact"):this._container.classList.remove("emapgo-compact")};function Mi(){V.bindAll(["_updateLogo"],this)}Mi.prototype.onAdd=function(t){this._map=t,this._container=v.create("div","emapgo-ctrl");var e=v.create("a","emapgo-ctrl-logo");return e.target="_blank",e.href="emapgo-webportal",e.setAttribute("aria-label","emapgo logo"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},Mi.prototype.onRemove=function(){v.remove(this._container),this._map.off("sourcedata",this._updateLogo)},Mi.prototype.getDefaultPosition=function(){return"bottom-left"},Mi.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Mi.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t){if(t[e].getSource().emapgo_logo)return!0}return!1}};function Ci(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}Ci.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},Ci.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,i=e?this._queue.concat(e):this._queue;n<i.length;n+=1){var r=i[n];if(r.id===t)return void(r.cancelled=!0)}},Ci.prototype.run=function(){V.default$2(!this._currentlyRunning);var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,n=t;e<n.length;e+=1){var i=n[e];if(!i.cancelled&&(i.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ci.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Pi=V.default.HTMLImageElement,Li=V.default.HTMLElement,Di={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300},Ri=function(s){function t(t){if(null!=(t=V.extend({},Di,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than minZoom");var e=new ri(t.minZoom,t.maxZoom,t.renderWorldCopies);s.call(this,e,t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new Ci;var n=t.transformRequest;if(this._transformRequest=n?function(t,e){return n(t,e)||{url:t}}:function(t){return{url:t}},"string"==typeof t.container){var i=V.default.document.getElementById(t.container);if(!i)throw new Error("Container '"+t.container+"' not found.");this._container=i}else{if(!(t.container instanceof Li))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}t.maxBounds&&this.setMaxBounds(t.maxBounds),V.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),void 0!==V.default&&(V.default.addEventListener("online",this._onWindowOnline,!1),V.default.addEventListener("resize",this._onWindowResize,!1)),function(n,i){var r=n.getCanvasContainer(),o=null,a=!1;for(var t in Ti)n[t]=new Ti[t](n,i),i.interactive&&i[t]&&n[t].enable(i[t]);v.addEventListener(r,"mouseout",function(t){n.fire(new hi("mouseout",n,t))}),v.addEventListener(r,"mousedown",function(t){a=!0;var e=new hi("mousedown",n,t);if(n.fire(e),e.defaultPrevented)return;i.interactive&&!n.doubleClickZoom.isActive()&&n.stop();n.boxZoom.onMouseDown(t),n.boxZoom.isActive()||n.dragPan.isActive()||n.dragRotate.onMouseDown(t);n.boxZoom.isActive()||n.dragRotate.isActive()||n.dragPan.onMouseDown(t)}),v.addEventListener(r,"mouseup",function(t){var e=n.dragRotate.isActive();o&&!e&&n.fire(new hi("contextmenu",n,o));o=null,a=!1,n.fire(new hi("mouseup",n,t))}),v.addEventListener(r,"mousemove",function(t){if(n.dragPan.isActive())return;if(n.dragRotate.isActive())return;var e=t.toElement||t.target;for(;e&&e!==r;)e=e.parentNode;if(e!==r)return;n.fire(new hi("mousemove",n,t))}),v.addEventListener(r,"mouseover",function(t){var e=t.toElement||t.target;for(;e&&e!==r;)e=e.parentNode;if(e!==r)return;n.fire(new hi("mouseover",n,t))}),v.addEventListener(r,"touchstart",function(t){var e=new pi("touchstart",n,t);if(n.fire(e),e.defaultPrevented)return;i.interactive&&n.stop();n.boxZoom.isActive()||n.dragRotate.isActive()||n.dragPan.onTouchStart(t);n.touchZoomRotate.onStart(t),n.doubleClickZoom.onTouchStart(e)},{passive:!1}),v.addEventListener(r,"touchmove",function(t){n.fire(new pi("touchmove",n,t))},{passive:!1}),v.addEventListener(r,"touchend",function(t){n.fire(new pi("touchend",n,t))}),v.addEventListener(r,"touchcancel",function(t){n.fire(new pi("touchcancel",n,t))}),v.addEventListener(r,"click",function(t){n.fire(new hi("click",n,t))}),v.addEventListener(r,"dblclick",function(t){var e=new hi("dblclick",n,t);if(n.fire(e),e.defaultPrevented)return;n.doubleClickZoom.onDblClick(e)}),v.addEventListener(r,"contextmenu",function(t){var e=n.dragRotate.isActive();a||e?a&&(o=t):n.fire(new hi("contextmenu",n,t));t.preventDefault()}),v.addEventListener(r,"wheel",function(t){var e=new fi("wheel",n,t);if(n.fire(e),e.defaultPrevented)return;n.scrollZoom.onWheel(t)},{passive:!1})}(this,t),this._hash=t.hash&&(new ui).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),this.resize(),t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new ki),this.addControl(new Mi,t.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading)}s&&(t.__proto__=s);var e={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0}};return((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var n=t.onAdd(this),i=this._controlPositions[e];return-1!==e.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this},t.prototype.removeControl=function(t){return t.onRemove(this),this},t.prototype.resize=function(t){var e=this._containerDimensions(),n=e[0],i=e[1];return this._resizeCanvas(n,i),this.transform.resize(n,i),this.painter.resize(n,i),this.fire(new V.Event("movestart",t)).fire(new V.Event("move",t)).fire(new V.Event("resize",t)).fire(new V.Event("moveend",t))},t.prototype.getBounds=function(){var t=new X(this.transform.pointLocation(new V.default$1(0,this.transform.height)),this.transform.pointLocation(new V.default$1(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(t.extend(this.transform.pointLocation(new V.default$1(this.transform.size.x,0))),t.extend(this.transform.pointLocation(new V.default$1(0,this.transform.size.y)))),t},t.prototype.getMaxBounds=function(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new X([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null},t.prototype.setMaxBounds=function(t){if(t){var e=X.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null==t&&(this.transform.lngRange=null,this.transform.latRange=null,this._update());return this},t.prototype.setMinZoom=function(t){if(0<=(t=null==t?0:t)&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},t.prototype.getMinZoom=function(){return this.transform.minZoom},t.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},t.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},t.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update(),this},t.prototype.getMaxZoom=function(){return this.transform.maxZoom},t.prototype.project=function(t){return this.transform.locationPoint(Z.convert(t))},t.prototype.unproject=function(t){return this.transform.pointLocation(V.default$1.convert(t))},t.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},t.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isActive()},t.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},t.prototype.on=function(i,r,o){var t,a=this;if(void 0===o)return s.prototype.on.call(this,i,r);var e=function(){if("mouseenter"===i||"mouseover"===i){var n=!1;return{layer:r,listener:o,delegates:{mousemove:function(t){var e=a.getLayer(r)?a.queryRenderedFeatures(t.point,{layers:[r]}):[];e.length?n||(n=!0,o.call(a,new hi(i,a,t.originalEvent,{features:e}))):n=!1},mouseout:function(){n=!1}}}}if("mouseleave"===i||"mouseout"===i){var e=!1;return{layer:r,listener:o,delegates:{mousemove:function(t){(a.getLayer(r)?a.queryRenderedFeatures(t.point,{layers:[r]}):[]).length?e=!0:e&&(e=!1,o.call(a,new hi(i,a,t.originalEvent)))},mouseout:function(t){e&&(e=!1,o.call(a,new hi(i,a,t.originalEvent)))}}}}return{layer:r,listener:o,delegates:(t={},t[i]=function(t){var e=a.getLayer(r)?a.queryRenderedFeatures(t.point,{layers:[r]}):[];e.length&&(t.features=e,o.call(a,t),delete t.features)},t)}}();for(var n in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[i]=this._delegatedListeners[i]||[],this._delegatedListeners[i].push(e),e.delegates)a.on(n,e.delegates[n]);return this},t.prototype.off=function(t,e,n){if(void 0===n)return s.prototype.off.call(this,t,e);if(this._delegatedListeners&&this._delegatedListeners[t])for(var i=this._delegatedListeners[t],r=0;r<i.length;r++){var o=i[r];if(o.layer===e&&o.listener===n){for(var a in o.delegates)this.off(a,o.delegates[a]);return i.splice(r,1),this}}return this},t.prototype.queryRenderedFeatures=function(t,e){var n;return e=2===arguments.length?(t=arguments[0],arguments[1]):1===arguments.length&&((n=arguments[0])instanceof V.default$1||Array.isArray(n))?(t=arguments[0],{}):1===arguments.length?(t=void 0,arguments[0]):(t=void 0,{}),this.style?this.style.queryRenderedFeatures(this._makeQueryGeometry(t),e,this.transform):[]},t.prototype._makeQueryGeometry=function(t){var e,n=this;if(void 0===t&&(t=[V.default$1.convert([0,0]),V.default$1.convert([this.transform.width,this.transform.height])]),t instanceof V.default$1||"number"==typeof t[0]){e=[V.default$1.convert(t)]}else{var i=[V.default$1.convert(t[0]),V.default$1.convert(t[1])];e=[i[0],new V.default$1(i[1].x,i[0].y),i[1],new V.default$1(i[0].x,i[1].y),i[0]]}return{viewport:e,worldCoordinate:e.map(function(t){return n.transform.pointCoordinate(t)})}},t.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},t.prototype.setStyle=function(t,e){if((!e||!1!==e.diff&&!e.localIdeographFontFamily)&&this.style&&t&&"object"==typeof t)try{return this.style.setState(t)&&this._update(!0),this}catch(t){V.warnOnce("Unable to perform style diff: "+(t.message||t.error||t)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new _n(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)):delete this.style,this},t.prototype.getStyle=function(){if(this.style)return this.style.serialize()},t.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():V.warnOnce("There is no style added to the map.")},t.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},t.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];if(void 0!==e)return e.loaded();this.fire(new V.ErrorEvent(new Error("There is no source with ID '"+t+"'")))},t.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var i in n){var r=n[i];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0},t.prototype.addSourceType=function(t,e,n){return this.style.addSourceType(t,e,n)},t.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},t.prototype.getSource=function(t){return this.style.getSource(t)},t.prototype.addImage=function(t,e,n){void 0===n&&(n={});var i=n.pixelRatio;void 0===i&&(i=1);var r=n.sdf;if(void 0===r&&(r=!1),e instanceof Pi){var o=T.getImageData(e),a=o.width,s=o.height,l=o.data;this.style.addImage(t,{data:new V.RGBAImage({width:a,height:s},l),pixelRatio:i,sdf:r})}else{if(void 0===e.width||void 0===e.height)return this.fire(new V.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var u=e.width,c=e.height,h=e.data;this.style.addImage(t,{data:new V.RGBAImage({width:u,height:c},h.slice(0)),pixelRatio:i,sdf:r})}},t.prototype.hasImage=function(t){return t?!!this.style.getImage(t):(this.fire(new V.ErrorEvent(new Error("Missing required image id"))),!1)},t.prototype.removeImage=function(t){this.style.removeImage(t)},t.prototype.loadImage=function(t,e){V.getImage(this._transformRequest(t,V.ResourceType.Image),e)},t.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},t.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},t.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},t.prototype.getLayer=function(t){return this.style.getLayer(t)},t.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},t.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0),this},t.prototype.getFilter=function(t){return this.style.getFilter(t)},t.prototype.setPaintProperty=function(t,e,n){return this.style.setPaintProperty(t,e,n),this._update(!0),this},t.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},t.prototype.setLayoutProperty=function(t,e,n){return this.style.setLayoutProperty(t,e,n),this._update(!0),this},t.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},t.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},t.prototype.getLight=function(){return this.style.getLight()},t.prototype.getContainer=function(){return this._container},t.prototype.getCanvasContainer=function(){return this._canvasContainer},t.prototype.getCanvas=function(){return this._canvas},t.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},t.prototype._setupContainer=function(){var t=this._container;t.classList.add("emapgo-map"),(this._missingCSSContainer=v.create("div","emapgo-missing-css",t)).innerHTML="Sorry Missing Emapgo  JS CSS";var e=this._canvasContainer=v.create("div","emapgo-canvas-container",t);this._interactive&&e.classList.add("emapgo-interactive"),this._canvas=v.create("canvas","emapgo-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);var i=this._controlContainer=v.create("div","emapgo-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){r[t]=v.create("div","emapgo-ctrl-"+t,i)})},t.prototype._resizeCanvas=function(t,e){var n=V.default.devicePixelRatio||1;this._canvas.width=n*t,this._canvas.height=n*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},t.prototype._setupPainter=function(){var t=V.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},n.webGLContextAttributes),e=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);e?this.painter=new Qn(e,this.transform):this.fire(new V.ErrorEvent(new Error("Failed to initialize WebGL")))},t.prototype._contextLost=function(t){t.preventDefault(),this._frameId&&(T.cancelFrame(this._frameId),this._frameId=null),this.fire(new V.Event("webglcontextlost",{originalEvent:t}))},t.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire(new V.Event("webglcontextrestored",{originalEvent:t}))},t.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},t.prototype._update=function(t){this.style&&(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender())},t.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},t.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},t.prototype._render=function(){this._renderTaskQueue.run();var t=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var e=this.transform.zoom,n=T.now();this.style.zoomHistory.update(e,n);var i=new V.default$27(e,{now:n,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=i.crossFadingFactor();1===r&&r===this._crossFadingFactor||(t=!0,this._crossFadingFactor=r),this.style.update(i)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),fadeDuration:this._fadeDuration}),this.fire(new V.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new V.Event("load"))),this.style&&(this.style.hasTransitions()||t)&&(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty)&&this._rerender(),this},t.prototype.remove=function(){this._hash&&this._hash.remove(),T.cancelFrame(this._frameId),this._renderTaskQueue.clear(),this._frameId=null,this.setStyle(null),void 0!==V.default&&(V.default.removeEventListener("resize",this._onWindowResize,!1),V.default.removeEventListener("online",this._onWindowOnline,!1));var t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),Bi(this._canvasContainer),Bi(this._controlContainer),Bi(this._missingCSSContainer),this._container.classList.remove("emapgo-map"),this.fire(new V.Event("remove"))},t.prototype._rerender=function(){var t=this;this.style&&!this._frameId&&(this._frameId=T.frame(function(){t._frameId=null,t._render()}))},t.prototype._onWindowOnline=function(){this._update()},t.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},e.showTileBoundaries.get=function(){return!!this._showTileBoundaries},e.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},e.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},e.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&((this._showCollisionBoxes=t)?this.style._generateCollisionBoxes():this._update())},e.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},e.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},e.repaint.get=function(){return!!this._repaint},e.repaint.set=function(t){this._repaint=t,this._update()},e.vertices.get=function(){return!!this._vertices},e.vertices.set=function(t){this._vertices=t,this._update()},t.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(new V.Event(t.dataType+"data",t))},t.prototype._onDataLoading=function(t){this.fire(new V.Event(t.dataType+"dataloading",t))},Object.defineProperties(t.prototype,e),t}(zi);function Bi(t){t.parentNode&&t.parentNode.removeChild(t)}function Oi(t){var e=this;this.options=V.extend({},Fi,t),this._container=v.create("div","emapgo-ctrl emapgo-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(this._zoomInButton=this._createButton("emapgo-ctrl-icon emapgo-ctrl-zoom-in","Zoom In",function(){return e._map.zoomIn()}),this._zoomOutButton=this._createButton("emapgo-ctrl-icon emapgo-ctrl-zoom-out","Zoom Out",function(){return e._map.zoomOut()})),this.options.showCompass&&(V.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("emapgo-ctrl-icon emapgo-ctrl-compass","Reset North",function(){return e._map.resetNorth()}),this._compassArrow=v.create("span","emapgo-ctrl-compass-arrow",this._compass))}var Fi={showCompass:!0,showZoom:!0};function Vi(t,e,n){if(t=new Z(t.lng,t.lat),e){var i=new Z(t.lng-360,t.lat),r=new Z(t.lng+360,t.lat),o=n.locationPoint(t).distSqr(e);n.locationPoint(i).distSqr(e)<o?t=i:n.locationPoint(r).distSqr(e)<o&&(t=r)}for(;180<Math.abs(t.lng-n.center.lng);){var a=n.locationPoint(t);if(0<=a.x&&0<=a.y&&a.x<=n.width&&a.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}Oi.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},Oi.prototype.onAdd=function(t){return this._map=t,this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yi(t,{button:"left",element:this._compass}),this._handler.enable()),this._container},Oi.prototype.onRemove=function(){v.remove(this._container),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),this._handler.disable(),delete this._handler),delete this._map},Oi.prototype._createButton=function(t,e,n){var i=v.create("button",t,this._container);return i.type="button",i.setAttribute("aria-label",e),i.addEventListener("click",n),i};var Ni={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ji(t,e,n){var i=t.classList;for(var r in Ni)i.remove("emapgo-"+n+"-anchor-"+r);i.add("emapgo-"+n+"-anchor-"+e)}function Gi(t,e){if((arguments[0]instanceof V.default.HTMLElement||2===arguments.length)&&(t=V.extend({element:t},e)),V.bindAll(["_update","_onMapClick"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",t&&t.element)this._element=t.element,this._offset=V.default$1.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=v.create("div");var n=v.createNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS(null,"height","41px"),n.setAttributeNS(null,"width","27px"),n.setAttributeNS(null,"viewBox","0 0 27 41");var i=v.createNS("http://www.w3.org/2000/svg","g");i.setAttributeNS(null,"stroke","none"),i.setAttributeNS(null,"stroke-width","1"),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"fill-rule","evenodd");var r=v.createNS("http://www.w3.org/2000/svg","g");r.setAttributeNS(null,"fill-rule","nonzero");var o=v.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"transform","translate(3.0, 29.0)"),o.setAttributeNS(null,"fill","#000000");for(var a=0,s=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];a<s.length;a+=1){var l=s[a],u=v.createNS("http://www.w3.org/2000/svg","ellipse");u.setAttributeNS(null,"opacity","0.04"),u.setAttributeNS(null,"cx","10.5"),u.setAttributeNS(null,"cy","5.80029008"),u.setAttributeNS(null,"rx",l.rx),u.setAttributeNS(null,"ry",l.ry),o.appendChild(u)}var c=v.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"fill",this._color);var h=v.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),c.appendChild(h);var p=v.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"opacity","0.25"),p.setAttributeNS(null,"fill","#000000");var f=v.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),p.appendChild(f);var d=v.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"transform","translate(6.0, 7.0)"),d.setAttributeNS(null,"fill","#FFFFFF");var m=v.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");var y=v.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#000000"),y.setAttributeNS(null,"opacity","0.25"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962");var g=v.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#FFFFFF"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962"),m.appendChild(y),m.appendChild(g),r.appendChild(o),r.appendChild(c),r.appendChild(p),r.appendChild(d),r.appendChild(m),n.appendChild(r),this._element.appendChild(n),this._offset=V.default$1.convert(t&&t.offset||[0,-14])}this._element.classList.add("emapgo-marker"),this._popup=null}Gi.prototype.addTo=function(t){return this.remove(),(this._map=t).getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),this},Gi.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),delete this._map),v.remove(this._element),this._popup&&this._popup.remove(),this},Gi.prototype.getLngLat=function(){return this._lngLat},Gi.prototype.setLngLat=function(t){return this._lngLat=Z.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},Gi.prototype.getElement=function(){return this._element},Gi.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat)}return this},Gi.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},Gi.prototype.getPopup=function(){return this._popup},Gi.prototype.togglePopup=function(){var t=this._popup;return t&&(t.isOpen()?t.remove():t.addTo(this._map)),this},Gi.prototype._update=function(t){this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Vi(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset),t&&"moveend"!==t.type||(this._pos=this._pos.round()),v.setTransform(this._element,Ni[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px)"),ji(this._element,this._anchor,"marker"))},Gi.prototype.getOffset=function(){return this._offset};var Ui,Wi={positionOptions:{enableHighAccuracy:!(Gi.prototype.setOffset=function(t){return this._offset=V.default$1.convert(t),this._update(),this}),maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},$i="emapgo-ctrl";var qi,Zi=((qi=V.Evented)&&(Xi.__proto__=qi),((Xi.prototype=Object.create(qi&&qi.prototype)).constructor=Xi).prototype.onAdd=function(t){return this._map=t,this._container=v.create("div",$i+" "+$i+"-group"),function(e){void 0!==Ui?e(Ui):void 0!==V.default.navigator.permissions?V.default.navigator.permissions.query({name:"geolocation"}).then(function(t){Ui="denied"!==t.state,e(Ui)}):(Ui=!!V.default.navigator.geolocation,e(Ui))}(this._setupUI),this._container},Xi.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(V.default.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),v.remove(this._container),this._map=void 0},Xi.prototype._onSuccess=function(t){if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-background");break;default:V.default$2(!1,"Unexpected watchState "+this._watchState)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("emapgo-user-location-dot-stale"),this.fire(new V.Event("geolocate",t)),this._finish()},Xi.prototype._updateCamera=function(t){var e=new Z(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy;this._map.fitBounds(e.toBounds(n),this.options.fitBoundsOptions,{geolocateSource:!0})},Xi.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},Xi.prototype._onError=function(t){if(this.options.trackUserLocation)if(1===t.code)this._watchState="OFF",this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-active"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-background"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-active"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-active"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-background"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:V.default$2(!1,"Unexpected watchState "+this._watchState)}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("emapgo-user-location-dot-stale"),this.fire(new V.Event("error",t)),this._finish()},Xi.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},Xi.prototype._setupUI=function(t){var e=this;!1!==t&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=v.create("button",$i+"-icon "+$i+"-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=v.create("div","emapgo-user-location-dot"),this._userLocationDotMarker=new Gi(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(t){t.geolocateSource||"ACTIVE_LOCK"!==e._watchState||(e._watchState="BACKGROUND",e._geolocateButton.classList.add("emapgo-ctrl-geolocate-background"),e._geolocateButton.classList.remove("emapgo-ctrl-geolocate-active"),e.fire(new V.Event("trackuserlocationend")))}))},Xi.prototype.trigger=function(){if(!this._setup)return V.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new V.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-active"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-background"),this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-background-error"),this.fire(new V.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new V.Event("trackuserlocationstart"));break;default:V.default$2(!1,"Unexpected watchState "+this._watchState)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("emapgo-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("emapgo-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("emapgo-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("emapgo-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("emapgo-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("emapgo-ctrl-geolocate-background-error");break;case"OFF":break;default:V.default$2(!1,"Unexpected watchState "+this._watchState)}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("emapgo-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=V.default.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else V.default.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},Xi.prototype._clearWatch=function(){V.default.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("emapgo-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},Xi);function Xi(t){qi.call(this),this.options=V.extend({},Wi,t),V.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this)}function Hi(t){this.options=V.extend({},Ki,t),V.bindAll(["_onMove","setUnit"],this)}var Ki={maxWidth:100,unit:"metric"};function Yi(t,e,n){var i=n&&n.maxWidth||100,r=t._container.clientHeight/2,o=function(t,e){var n=Math.PI/180,i=t.lat*n,r=e.lat*n,o=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-t.lng)*n);return 6371e3*Math.acos(Math.min(o,1))}(t.unproject([0,r]),t.unproject([i,r]));if(n&&"imperial"===n.unit){var a=3.2808*o;if(5280<a)Ji(e,i,a/5280,"mi");else Ji(e,i,a,"ft")}else if(n&&"nautical"===n.unit){Ji(e,i,o/1852,"nm")}else Ji(e,i,o,"m")}function Ji(t,e,n,i){var r=function(t){var e=Math.pow(10,(""+Math.floor(t)).length-1),n=t/e;return e*(n=10<=n?10:5<=n?5:3<=n?3:2<=n?2:1)}(n),o=r/n;"m"===i&&1e3<=r&&(r/=1e3,i="km"),t.style.width=e*o+"px",t.innerHTML=r+i}Hi.prototype.getDefaultPosition=function(){return"bottom-left"},Hi.prototype._onMove=function(){Yi(this._map,this._container,this.options)},Hi.prototype.onAdd=function(t){return this._map=t,this._container=v.create("div","emapgo-ctrl emapgo-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Hi.prototype.onRemove=function(){v.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Hi.prototype.setUnit=function(t){this.options.unit=t,Yi(this._map,this._container,this.options)};function Qi(){this._fullscreen=!1,V.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in V.default.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in V.default.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in V.default.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in V.default.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="emapgo-ctrl"}Qi.prototype.onAdd=function(t){return this._map=t,this._mapContainer=this._map.getContainer(),this._container=v.create("div",this._className+" emapgo-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",V.warnOnce("This device does not support fullscreen mode.")),this._container},Qi.prototype.onRemove=function(){v.remove(this._container),this._map=null,V.default.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Qi.prototype._checkFullscreenSupport=function(){return!!(V.default.document.fullscreenEnabled||V.default.document.mozFullScreenEnabled||V.default.document.msFullscreenEnabled||V.default.document.webkitFullscreenEnabled)},Qi.prototype._setupUI=function(){var t=this._fullscreenButton=v.create("button",this._className+"-icon "+this._className+"-fullscreen",this._container);t.setAttribute("aria-label","Toggle fullscreen"),t.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),V.default.document.addEventListener(this._fullscreenchange,this._changeIcon)},Qi.prototype._isFullscreen=function(){return this._fullscreen},Qi.prototype._changeIcon=function(){(V.default.document.fullscreenElement||V.default.document.mozFullScreenElement||V.default.document.webkitFullscreenElement||V.default.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"))},Qi.prototype._onClickFullscreen=function(){this._isFullscreen()?V.default.document.exitFullscreen?V.default.document.exitFullscreen():V.default.document.mozCancelFullScreen?V.default.document.mozCancelFullScreen():V.default.document.msExitFullscreen?V.default.document.msExitFullscreen():V.default.document.webkitCancelFullScreen&&V.default.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()};var tr,er={closeButton:!0,closeOnClick:!0},nr=((tr=V.Evented)&&(ir.__proto__=tr),((ir.prototype=Object.create(tr&&tr.prototype)).constructor=ir).prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this.fire(new V.Event("open")),this},ir.prototype.isOpen=function(){return!!this._map},ir.prototype.remove=function(){return this._content&&v.remove(this._content),this._container&&(v.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire(new V.Event("close")),this},ir.prototype.getLngLat=function(){return this._lngLat},ir.prototype.setLngLat=function(t){return this._lngLat=Z.convert(t),this._pos=null,this._update(),this},ir.prototype.setText=function(t){return this.setDOMContent(V.default.document.createTextNode(t))},ir.prototype.setHTML=function(t){var e,n=V.default.document.createDocumentFragment(),i=V.default.document.createElement("body");for(i.innerHTML=t;e=i.firstChild;)n.appendChild(e);return this.setDOMContent(n)},ir.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},ir.prototype._createContent=function(){this._content&&v.remove(this._content),this._content=v.create("div","emapgo-popup-content",this._container),this.options.closeButton&&(this._closeButton=v.create("button","emapgo-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},ir.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=v.create("div","emapgo-popup",this._map.getContainer()),this._tip=v.create("div","emapgo-popup-tip",this._container),this._container.appendChild(this._content)),this._map.transform.renderWorldCopies&&(this._lngLat=Vi(this._lngLat,this._pos,this._map.transform));var t=this._pos=this._map.project(this._lngLat),e=this.options.anchor,n=function t(e){if(e){if("number"==typeof e){var n=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{center:new V.default$1(0,0),top:new V.default$1(0,e),"top-left":new V.default$1(n,n),"top-right":new V.default$1(-n,n),bottom:new V.default$1(0,-e),"bottom-left":new V.default$1(n,-n),"bottom-right":new V.default$1(-n,-n),left:new V.default$1(e,0),right:new V.default$1(-e,0)}}if(e instanceof V.default$1||Array.isArray(e)){var i=V.default$1.convert(e);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:V.default$1.convert(e.center||[0,0]),top:V.default$1.convert(e.top||[0,0]),"top-left":V.default$1.convert(e["top-left"]||[0,0]),"top-right":V.default$1.convert(e["top-right"]||[0,0]),bottom:V.default$1.convert(e.bottom||[0,0]),"bottom-left":V.default$1.convert(e["bottom-left"]||[0,0]),"bottom-right":V.default$1.convert(e["bottom-right"]||[0,0]),left:V.default$1.convert(e.left||[0,0]),right:V.default$1.convert(e.right||[0,0])}}return t(new V.default$1(0,0))}(this.options.offset);if(!e){var i,r=this._container.offsetWidth,o=this._container.offsetHeight;i=t.y+n.bottom.y<o?["top"]:t.y>this._map.transform.height-o?["bottom"]:[],t.x<r/2?i.push("left"):t.x>this._map.transform.width-r/2&&i.push("right"),e=0===i.length?"bottom":i.join("-")}var a=t.add(n[e]).round();v.setTransform(this._container,Ni[e]+" translate("+a.x+"px,"+a.y+"px)"),ji(this._container,e,"popup")}},ir.prototype._onClickClose=function(){this.remove()},ir);function ir(t){tr.call(this),this.options=V.extend(Object.create(er),t),V.bindAll(["_update","_onClickClose"],this)}var rr={version:"0.44.2",supported:n,workerCount:Math.max(Math.floor(T.hardwareConcurrency/2),1),setRTLTextPlugin:V.setRTLTextPlugin,Map:Ri,NavigationControl:Oi,GeolocateControl:Zi,AttributionControl:ki,ScaleControl:Hi,FullscreenControl:Qi,Popup:nr,Marker:Gi,Style:_n,LngLat:Z,LngLatBounds:X,Point:V.default$1,config:f,get accessToken(){return f.ACCESS_TOKEN},set accessToken(t){f.ACCESS_TOKEN=t},workerUrl:""};return V.default$2(!0,"canary assert"),rr}),a});